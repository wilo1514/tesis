var XAdES=function(e){"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function r(e,t,r,n,a,i,s){try{var o=e[i](s),u=o.value}catch(e){return void r(e)}o.done?t(u):Promise.resolve(u).then(n,a)}function n(e){return function(){var t=this,n=arguments;return new Promise((function(a,i){var s=e.apply(t,n);function o(e){r(s,a,i,o,u,"next",e)}function u(e){r(s,a,i,o,u,"throw",e)}o(void 0)}))}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}function l(e,t){return l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},l(e,t)}function c(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=u(e);if(t){var a=u(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return c(this,r)}}function f(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}function m(){return m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=f(e,t);if(n){var a=Object.getOwnPropertyDescriptor(n,t);return a.get?a.get.call(arguments.length<3?e:r):a.value}},m.apply(this,arguments)}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,a,i=[],s=!0,o=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);s=!0);}catch(e){o=!0,a=e}finally{try{s||null==r.return||r.return()}finally{if(o)throw a}}return i}(e,t)||d(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e){return function(e){if(Array.isArray(e))return y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||d(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){if(e){if("string"==typeof e)return y(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(e,t):void 0}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function p(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=d(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw i}}}}function k(e,r,n,a){var i,s=arguments.length,o=s<3?r:null===a?a=Object.getOwnPropertyDescriptor(r,n):a;if("object"===("undefined"==typeof Reflect?"undefined":t(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,r,n,a);else for(var u=e.length-1;u>=0;u--)(i=e[u])&&(o=(s<3?i(o):s>3?i(r,n,o):i(r,n))||o);return s>3&&o&&Object.defineProperty(r,n,o),o}var b="element",w="attribute",S="content",N=1e9;function A(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];for(var a=arguments[0],i=1;i<arguments.length;i++){var s=arguments[i];for(var o in s)s.hasOwnProperty(o)&&(a[o]=s[o])}return a}function C(e){return function(t){var r=t;r.localName=e.localName||r.name,r.namespaceURI=e.namespaceURI||r.namespaceURI||null,r.prefix=e.prefix||r.prefix||null,r.parser=e.parser||r.parser,r.target!==r&&(r.items=A({},r.items)),r.target=t}}function B(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,r){var n=t.constructor,a=r;n.items||(n.items={}),n.target!==n&&(n.items=A({},n.items)),n.target=t,e.parser?n.items[a]={parser:e.parser,required:e.required||!1,maxOccurs:e.maxOccurs||N,minOccurs:void 0===e.minOccurs?0:e.minOccurs,noRoot:e.noRoot||!1}:n.items[a]={namespaceURI:e.namespaceURI||null,required:e.required||!1,prefix:e.prefix||null,defaultValue:e.defaultValue,converter:e.converter,noRoot:e.noRoot||!1},e.localName=e.localName||e.parser&&e.parser.localName||a,n.items[a].namespaceURI=e.namespaceURI||e.parser&&e.parser.namespaceURI||null,n.items[a].prefix=e.prefix||e.parser&&e.parser.prefix||null,n.items[a].localName=e.localName,n.items[a].type=b,E(t,a,e)}}function x(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{required:!1,namespaceURI:null};return function(t,r){var n=t.constructor,a=r;e.localName||(e.localName=r),n.items||(n.items={}),n.target!==n&&(n.items=A({},n.items)),n.target=t,n.items[r]=e,n.items[r].type=w,E(t,a,e)}}function I(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{required:!1};return function(t,r){var n=t.constructor,a=r;n.items||(n.items={}),n.target!==n&&(n.items=A({},n.items)),n.target=t,n.items[r]=e,n.items[r].type=S,E(t,a,e)}}function E(e,t,r){var n="_".concat(t),a={set:function(e){this[n]!==e&&(this.element=null,this[n]=e)},get:function(){if(void 0===this[n]){var e=r.defaultValue;r.parser&&((e=new r.parser).localName=r.localName),this[n]=e}return this[n]}};Object.defineProperty(e,n,{writable:!0,enumerable:!1}),Object.defineProperty(e,t,a)}var P=function(){function e(t){a(this,e),this.items=new Array,t&&(this.items=t)}return s(e,[{key:"Count",get:function(){return this.items.length}},{key:"Item",value:function(e){return this.items[e]||null}},{key:"Add",value:function(e){this.items.push(e)}},{key:"Pop",value:function(){return this.items.pop()}},{key:"RemoveAt",value:function(e){this.items=this.items.filter((function(t,r){return r!==e}))}},{key:"Clear",value:function(){this.items=new Array}},{key:"GetIterator",value:function(){return this.items}},{key:"ForEach",value:function(e){this.GetIterator().forEach(e)}},{key:"Map",value:function(t){return new e(this.GetIterator().map(t))}},{key:"Filter",value:function(t){return new e(this.GetIterator().filter(t))}},{key:"Sort",value:function(t){return new e(this.GetIterator().sort(t))}},{key:"Every",value:function(e){return this.GetIterator().every(e)}},{key:"Some",value:function(e){return this.GetIterator().some(e)}},{key:"IsEmpty",value:function(){return 0===this.Count}}]),e}();function R(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];for(var a=e,i=/[^%](%\d+)/g,s=null,o=[];s=i.exec(a);)o.push({arg:s[1],index:s.index});for(var u=o.length-1;u>=0;u--){var l=o[u],c=l.arg.substring(1),h=l.index+1;a=a.substring(0,h)+arguments[+c]+a.substring(h+1+c.length)}return a=a.replace("%%","%")}function L(e,t){for(var r=e+"";r.length<t;)r="0"+r;return r}var U,O=s((function e(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];a(this,e),this.prefix="XMLJS",this.code=t,this.name=this.constructor.name,arguments[0]=D[t];var s=R.apply(this,arguments);this.message="".concat(this.prefix).concat(L(t,4),": ").concat(s),this.stack=new Error(this.message).stack}));!function(e){e[e.NONE=0]="NONE",e[e.NULL_REFERENCE=1]="NULL_REFERENCE",e[e.NULL_PARAM=2]="NULL_PARAM",e[e.DECORATOR_NULL_PARAM=3]="DECORATOR_NULL_PARAM",e[e.COLLECTION_LIMIT=4]="COLLECTION_LIMIT",e[e.METHOD_NOT_IMPLEMENTED=5]="METHOD_NOT_IMPLEMENTED",e[e.METHOD_NOT_SUPPORTED=6]="METHOD_NOT_SUPPORTED",e[e.PARAM_REQUIRED=7]="PARAM_REQUIRED",e[e.CONVERTER_UNSUPPORTED=8]="CONVERTER_UNSUPPORTED",e[e.ELEMENT_MALFORMED=9]="ELEMENT_MALFORMED",e[e.ELEMENT_MISSING=10]="ELEMENT_MISSING",e[e.ATTRIBUTE_MISSING=11]="ATTRIBUTE_MISSING",e[e.CONTENT_MISSING=12]="CONTENT_MISSING",e[e.CRYPTOGRAPHIC=13]="CRYPTOGRAPHIC",e[e.CRYPTOGRAPHIC_NO_MODULE=14]="CRYPTOGRAPHIC_NO_MODULE",e[e.CRYPTOGRAPHIC_UNKNOWN_TRANSFORM=15]="CRYPTOGRAPHIC_UNKNOWN_TRANSFORM",e[e.ALGORITHM_NOT_SUPPORTED=16]="ALGORITHM_NOT_SUPPORTED",e[e.ALGORITHM_WRONG_NAME=17]="ALGORITHM_WRONG_NAME",e[e.XML_EXCEPTION=18]="XML_EXCEPTION"}(U||(U={}));var D={};D[U.NONE]="No description",D[U.NULL_REFERENCE]="Null reference",D[U.NULL_PARAM]="'%1' has empty '%2' object",D[U.DECORATOR_NULL_PARAM]="Decorator '%1' has empty '%2' parameter",D[U.COLLECTION_LIMIT]="Collection of '%1' in element '%2' has wrong amount of items",D[U.METHOD_NOT_IMPLEMENTED]="Method is not implemented",D[U.METHOD_NOT_SUPPORTED]="Method is not supported",D[U.PARAM_REQUIRED]="Required parameter is missing '%1'",D[U.CONVERTER_UNSUPPORTED]="Converter is not supported",D[U.ELEMENT_MALFORMED]="Malformed element '%1'",D[U.ELEMENT_MISSING]="Element '%1' is missing in '%2'",D[U.ATTRIBUTE_MISSING]="Attribute '%1' is missing in '%2'",D[U.CONTENT_MISSING]="Content is missing in '%1'",D[U.CRYPTOGRAPHIC]="Cryptographic error: %1",D[U.CRYPTOGRAPHIC_NO_MODULE]="WebCrypto module is not found",D[U.CRYPTOGRAPHIC_UNKNOWN_TRANSFORM]="Unknown transform %1",D[U.ALGORITHM_NOT_SUPPORTED]="Algorithm is not supported '%1'",D[U.ALGORITHM_WRONG_NAME]="Algorithm wrong name in use '%1'",D[U.XML_EXCEPTION]="XML exception: %1";var T,H=function(){function e(){a(this,e)}return s(e,null,[{key:"ToString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",r=new Uint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);default:throw new O(U.CONVERTER_UNSUPPORTED)}}},{key:"FromString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);default:throw new O(U.CONVERTER_UNSUPPORTED)}}},{key:"ToBase64",value:function(e){if("undefined"!=typeof btoa){var t=this.ToString(e,"binary");return btoa(t)}if("undefined"!=typeof Buffer)return Buffer.from(e).toString("base64");throw new O(U.CONVERTER_UNSUPPORTED)}},{key:"FromBase64",value:function(e){if(e=e.replace(/\n/g,"").replace(/\r/g,"").replace(/\t/g,"").replace(/\s/g,""),"undefined"!=typeof atob)return this.FromBinary(atob(e));if("undefined"!=typeof Buffer)return new Uint8Array(Buffer.from(e,"base64"));throw new O(U.CONVERTER_UNSUPPORTED)}},{key:"FromBase64Url",value:function(e){return this.FromBase64(this.Base64Padding(e.replace(/\-/g,"+").replace(/\_/g,"/")))}},{key:"ToBase64Url",value:function(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}},{key:"FromUtf8String",value:function(e){for(var t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r}},{key:"ToUtf8String",value:function(e){var t=String.fromCharCode.apply(null,e);return decodeURIComponent(escape(t))}},{key:"FromBinary",value:function(e){for(var t=e.length,r=new Uint8Array(t),n=0;n<t;n++)r[n]=e.charCodeAt(n);return r}},{key:"ToBinary",value:function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}},{key:"ToHex",value:function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r].toString(16);t.push(1===n.length?"0"+n:n)}return t.join("")}},{key:"FromHex",value:function(e){for(var t=new Uint8Array(e.length/2),r=0;r<e.length;r+=2){var n=e.slice(r,r+2);t[r/2]=parseInt(n,16)}return t}},{key:"ToDateTime",value:function(e){return new Date(e)}},{key:"FromDateTime",value:function(e){return e.toISOString()}},{key:"Base64Padding",value:function(e){var t=4-e.length%4;if(t<4)for(var r=0;r<t;r++)e+="=";return e}}]),e}(),V="application/xml";!function(e){e[e.None=0]="None",e[e.Element=1]="Element",e[e.Attribute=2]="Attribute",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.EntityReference=5]="EntityReference",e[e.Entity=6]="Entity",e[e.ProcessingInstruction=7]="ProcessingInstruction",e[e.Comment=8]="Comment",e[e.Document=9]="Document",e[e.DocumentType=10]="DocumentType",e[e.DocumentFragment=11]="DocumentFragment",e[e.Notation=12]="Notation",e[e.Whitespace=13]="Whitespace",e[e.SignificantWhitespace=14]="SignificantWhitespace",e[e.EndElement=15]="EndElement",e[e.EndEntity=16]="EndEntity",e[e.XmlDeclaration=17]="XmlDeclaration"}(T||(T={}));var _,j=function(e,t){throw new Error("Not implemented")};if("undefined"==typeof self){_=global;var M=require("@xmldom/xmldom");j=require("xpath.js"),_.XMLSerializer=M.XMLSerializer,_.DOMParser=M.DOMParser,_.DOMImplementation=M.DOMImplementation,_.document=(new DOMImplementation).createDocument("http://www.w3.org/1999/xhtml","html",null)}else _=self;var K="undefined"!=typeof self?function(e,t){for(var r,n=null==e.ownerDocument?e:e.ownerDocument,a=document.createNSResolver(null==e.ownerDocument?e.documentElement:e.ownerDocument.documentElement),i=n.evaluate(t,e,a,XPathResult.ANY_TYPE,null),s=[];r=i.iterateNext();)s.push(r);return s}:j;function F(e){return e=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n"),(new DOMParser).parseFromString(e,V)}function X(e,t){var r=K(e,t);return r&&r.length>0?r[0]:null}function G(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Q(e)){e.namespaceURI&&"http://www.w3.org/XML/1998/namespace"!==e.namespaceURI&&!t[e.prefix||""]&&(t[e.prefix?e.prefix:""]=e.namespaceURI);for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes.item(r);n&&n.nodeType===T.Element&&G(n,t)}}}function J(e){var t={};return G(e,t),t}function q(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];for(var a=arguments[0],i=1;i<arguments.length;i++){var s=arguments[i];for(var o in s)s.hasOwnProperty(o)&&(a[o]=s[o])}return a}function W(e,t){return e&&e.nodeType===t}function Q(e){return W(e,T.Element)}function z(e){return W(e,T.Document)}var Y={get:function(e){if(e)return H.ToBase64(e)},set:function(e){return H.FromBase64(e)}},Z={get:function(e){return e?e.toString():"0"},set:function(e){return Number(e)}},$="xml_root",ee=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(a(this,e),this.prefix=this.GetStatic().prefix||null,this.localName=this.GetStatic().localName,this.namespaceURI=this.GetStatic().namespaceURI,t)for(var r=0,n=Object.entries(t);r<n.length;r++){var i=v(n[r],2),s=i[0],o=i[1];void 0!==o&&(this[s]=o)}}return s(e,[{key:"Element",get:function(){return this.element}},{key:"Prefix",get:function(){return this.prefix},set:function(e){this.prefix=e}},{key:"LocalName",get:function(){return this.localName}},{key:"NamespaceURI",get:function(){return this.namespaceURI||null}},{key:"HasChanged",value:function(){var e=this.GetStatic();if(e.items)for(var t in e.items)if(e.items.hasOwnProperty(t)){var r=e.items[t],n=this[t];if(r.parser&&n&&n.HasChanged())return!0}return null===this.element}},{key:"GetXml",value:function(t){if(!t&&!this.HasChanged())return this.element||null;var r=this.CreateDocument(),n=this.CreateElement(),a=this.GetStatic(),i=this.localName;if(a.items)for(var s in a.items)if(a.items.hasOwnProperty(s)){var o=this[s],u=a.items[s];switch(u.type){case S:var l=u,c=l.converter?l.converter.get(o):o;if(l.required&&null==c)throw new O(U.CONTENT_MISSING,i);(l.defaultValue!==o||l.required)&&(n.textContent=c);break;case w:var h=u,f=h.converter?h.converter.get(o):o;if(h.required&&null==f)throw new O(U.ATTRIBUTE_MISSING,h.localName,i);(h.defaultValue!==o||h.required)&&(h.namespaceURI?n.setAttributeNS(h.namespaceURI,h.localName,f):n.setAttribute(h.localName,f));break;case b:var m=u,v=null;if(m.parser){if(m.required&&!o||m.minOccurs&&!o.Count)throw new O(U.ELEMENT_MISSING,o.localName,i);o&&(v=o.GetXml(void 0===o.element&&(m.required||o.Count)))}else{var g=m.converter?m.converter.get(o):o;if(m.required&&void 0===g)throw new O(U.ELEMENT_MISSING,m.localName,i);if(o!==m.defaultValue||m.required)if(v=m.namespaceURI?r.createElementNS(m.namespaceURI,"".concat(m.prefix?m.prefix+":":"").concat(m.localName)):r.createElement("".concat(m.prefix?m.prefix+":":"").concat(m.localName)),Array.isArray(g)){var d,y=p(g);try{for(y.s();!(d=y.n()).done;){var k=d.value,N=k instanceof e?k.GetXml(!0):k;null!==N&&v.appendChild(N)}}catch(e){y.e(e)}finally{y.f()}}else g instanceof e?v.appendChild(g.GetXml(!0)):v.textContent=g}if(v)if(m.noRoot){for(var A=[],C=0;C<v.childNodes.length;C++){var B=v.childNodes.item(C);Q(B)&&A.push(B)}if(A.length<m.minOccurs||A.length>m.maxOccurs)throw new O(U.COLLECTION_LIMIT,o.localName,a.localName);A.forEach((function(e){return n.appendChild(e.cloneNode(!0))}))}else{if(v.childNodes.length<m.minOccurs||v.childNodes.length>m.maxOccurs)throw new O(U.COLLECTION_LIMIT,o.localName,a.localName);n.appendChild(v)}}}return this.OnGetXml(n),this.element=n,n}},{key:"LoadXml",value:function(e){var t,r=this;"string"==typeof e?t=F(e).documentElement:t=e;if(!t)throw new O(U.PARAM_REQUIRED,"element");var n=this.GetStatic(),a=this.localName;if(t.localName!==a||t.namespaceURI!=this.NamespaceURI)throw new O(U.ELEMENT_MALFORMED,a);if(n.items)for(var i in n.items)if(n.items.hasOwnProperty(i)){var s=n.items[i];switch(s.type){case S:var o=s;if(o.required&&!t.textContent)throw new O(U.CONTENT_MISSING,a);if(t.textContent){var u=o.converter?o.converter.set(t.textContent):t.textContent;r[i]=u}else r[i]=o.defaultValue;break;case w:var l=s,c=void 0,h=void 0;if(!l.localName)throw new O(U.PARAM_REQUIRED,"localName");if(l.namespaceURI?(c=t.hasAttributeNS.bind(t,l.namespaceURI,l.localName),h=t.getAttributeNS.bind(t,l.namespaceURI,l.localName)):(c=t.hasAttribute.bind(t,l.localName),h=t.getAttribute.bind(t,l.localName)),l.required&&!c())throw new O(U.ATTRIBUTE_MISSING,l.localName,a);if(c()){var f=l.converter?l.converter.set(h()):h();r[i]=f}else r[i]=l.defaultValue;break;case b:var m=s;if(m.noRoot){if(!m.parser)throw new O(U.XML_EXCEPTION,"Schema for '".concat(m.localName,"' with flag noRoot must have 'parser'"));var v=new m.parser;if(!(v instanceof te))throw new O(U.XML_EXCEPTION,"Schema for '".concat(m.localName,"' with flag noRoot must have 'parser' like instance of XmlCollection"));if(v.OnLoadXml(t),delete v.element,v.Count<m.minOccurs||v.Count>m.maxOccurs)throw new O(U.COLLECTION_LIMIT,m.parser.localName,a);r[i]=v;continue}for(var g=null,d=0;d<t.childNodes.length;d++){var y=t.childNodes.item(d);if(Q(y)){var p=y;if(p.localName===m.localName&&p.namespaceURI==m.namespaceURI){g=p;break}}}if(m.required&&!g)throw new O(U.ELEMENT_MISSING,m.parser?m.parser.localName:m.localName,a);if(m.parser){if(g){var k=new m.parser;k.localName=m.localName,k.namespaceURI=m.namespaceURI,r[i]=k,k.LoadXml(g)}}else if(g){var N=m.converter?m.converter.set(g.textContent):g.textContent;r[i]=N}else r[i]=m.defaultValue}}this.OnLoadXml(t),this.prefix=t.prefix||"",this.element=t}},{key:"toString",value:function(){var e=this.GetXml();return e?(new XMLSerializer).serializeToString(e):""}},{key:"GetElement",value:function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.element)throw new O(U.NULL_PARAM,this.localName);return e.GetElement(this.element,t,r)}},{key:"GetChildren",value:function(t,r){if(!this.element)throw new O(U.NULL_PARAM,this.localName);return e.GetChildren(this.element,t,r||this.NamespaceURI||void 0)}},{key:"GetChild",value:function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.element)throw new O(U.NULL_PARAM,this.localName);return e.GetChild(this.element,t,this.NamespaceURI||void 0,r)}},{key:"GetFirstChild",value:function(t,r){if(!this.element)throw new O(U.NULL_PARAM,this.localName);return e.GetFirstChild(this.element,t,r)}},{key:"GetAttribute",value:function(t,r){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this.element)throw new O(U.NULL_PARAM,this.localName);return e.GetAttribute(this.element,t,r,n)}},{key:"IsEmpty",value:function(){return void 0===this.Element}},{key:"OnLoadXml",value:function(e){}},{key:"GetStatic",value:function(){return this.constructor}},{key:"GetPrefix",value:function(){return this.Prefix?this.prefix+":":""}},{key:"OnGetXml",value:function(e){}},{key:"CreateElement",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;e||(e=this.CreateDocument()),t=t||this.localName,r=r||this.NamespaceURI;var a=((n=n||this.prefix)?"".concat(n,":"):"")+t,i=r?e.createElementNS(r,a):e.createElement(a);return e.importNode(i,!0),i}},{key:"CreateDocument",value:function(){return e.CreateDocument(this.localName,this.NamespaceURI,this.Prefix)}}],[{key:"LoadXml",value:function(e){var t=new this;return t.LoadXml(e),t}},{key:"GetElement",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=e.getElementsByTagName(t);if(r&&0===n.length)throw new O(U.ELEMENT_MISSING,t,e.localName);return n[0]||null}},{key:"GetAttribute",value:function(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e.hasAttribute(t))return e.getAttribute(t);if(n)throw new O(U.ATTRIBUTE_MISSING,t,e.localName);return r}},{key:"GetElementById",value:function(e,t){if(null==e||null==t)return null;var r=null;return z(e)&&(r=e.getElementById(t)),null==r&&null==(r=X(e,"//*[@Id='".concat(t,"']")))&&null==(r=X(e,"//*[@ID='".concat(t,"']")))&&(r=X(e,"//*[@id='".concat(t,"']"))),r}},{key:"CreateDocument",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n="",a="",i="";r&&(n=r+":",a=":"+r),t&&(i=" xmlns".concat(a,'="').concat(t,'"'));var s="".concat(n).concat(e),o=(new DOMParser).parseFromString("<".concat(s).concat(i,"></").concat(s,">"),V);return o}},{key:"GetChildren",value:function(e,t,r){e=z(e)?e.documentElement:e;for(var n=[],a=0;a<e.childNodes.length;a++){var i=e.childNodes[a];!Q(i)||i.localName!==t||i.namespaceURI!==r&&r||n.push(i)}return n}},{key:"GetFirstChild",value:function(e,t,r){e=z(e)?e.documentElement:e;for(var n=0;n<e.childNodes.length;n++){var a=e.childNodes[n];if(Q(a)&&a.localName===t&&(a.namespaceURI===r||!r))return a}return null}},{key:"GetChild",value:function(e,t,r){for(var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=0;a<e.childNodes.length;a++){var i=e.childNodes[a];if(Q(i)&&i.localName===t&&(i.namespaceURI===r||!r))return i}if(n)throw new O(U.ELEMENT_MISSING,t,e.localName);return null}}]),e}(),te=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.apply(this,arguments)).MaxOccurs=Number.MAX_VALUE,e.MinOccurs=0,e.items=[],e}return s(r,[{key:"HasChanged",value:function(){var e=m(u(r.prototype),"HasChanged",this).call(this),t=this.Some((function(e){return e.HasChanged()}));return e||t}},{key:"Count",get:function(){return this.items.length}},{key:"Item",value:function(e){return this.items[e]||null}},{key:"Add",value:function(e){this.items.push(e),this.element=null}},{key:"Pop",value:function(){return this.element=null,this.items.pop()}},{key:"RemoveAt",value:function(e){this.items=this.items.filter((function(t,r){return r!==e})),this.element=null}},{key:"Clear",value:function(){this.items=new Array,this.element=null}},{key:"GetIterator",value:function(){return this.items}},{key:"ForEach",value:function(e){this.GetIterator().forEach(e)}},{key:"Map",value:function(e){return new P(this.GetIterator().map(e))}},{key:"Filter",value:function(e){return new P(this.GetIterator().filter(e))}},{key:"Sort",value:function(e){return new P(this.GetIterator().sort(e))}},{key:"Every",value:function(e){return this.GetIterator().every(e)}},{key:"Some",value:function(e){return this.GetIterator().some(e)}},{key:"IsEmpty",value:function(){return 0===this.Count}},{key:"OnGetXml",value:function(e){var t,r=p(this.GetIterator());try{for(r.s();!(t=r.n()).done;){var n=t.value.GetXml();n&&e.appendChild(n)}}catch(e){r.e(e)}finally{r.f()}}},{key:"OnLoadXml",value:function(e){var t=this.GetStatic();if(!t.parser)throw new O(U.XML_EXCEPTION,"".concat(t.localName," doesn't have required 'parser' in @XmlElement"));for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes.item(r);if(Q(n)&&n.localName===t.parser.localName&&n.namespaceURI==t.namespaceURI){var a=n,i=new t.parser;i.LoadXml(a),this.Add(i)}}}}]),r}(ee),re=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r,[{key:"Add",value:function(e){e.prefix=e.prefix||"",e.namespace=e.namespace||"",m(u(r.prototype),"Add",this).call(this,e)}},{key:"GetPrefix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.Count-1,r=this.Count-1;e=e||"",t>r&&(t=r);for(var n=t;n>=0;n--){var a=this.items[n];if(a.prefix===e)return a}return null}},{key:"GetNamespace",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.Count-1,r=this.Count-1;e=e||"",t>r&&(t=r);for(var n=t;n>=0;n--){var a=this.items[n];if(a.namespace===e)return a}return null}}]),r}(P),ne={DefaultPrefix:"xades",NamespaceURI:"http://uri.etsi.org/01903/v1.3.2#",SignedPropertiesType:"http://uri.etsi.org/01903/v1.3.2#SignedProperties",ElementNames:{Any:"Any",ByName:"ByName",ByKey:"ByKey",AttrAuthoritiesCertValues:"AttrAuthoritiesCertValues",AttributeRevocationValues:"AttributeRevocationValues",AttributeCertificateRefs:"AttributeCertificateRefs",AttributeRevocationRefs:"AttributeRevocationRefs",QualifyingProperties:"QualifyingProperties",QualifyingPropertiesReference:"QualifyingPropertiesReference",SignedProperties:"SignedProperties",SignedSignatureProperties:"SignedSignatureProperties",SignedDataObjectProperties:"SignedDataObjectProperties",UnsignedProperties:"UnsignedProperties",UnsignedSignatureProperties:"UnsignedSignatureProperties",UnsignedDataObjectProperties:"UnsignedDataObjectProperties",UnsignedDataObjectProperty:"UnsignedDataObjectProperty",SigningTime:"SigningTime",SigningCertificate:"SigningCertificate",SigningCertificateV2:"SigningCertificateV2",SignaturePolicyIdentifier:"SignaturePolicyIdentifier",SignatureProductionPlace:"SignatureProductionPlace",SignerRole:"SignerRole",Cert:"Cert",CertDigest:"CertDigest",IssuerSerial:"IssuerSerial",IssuerSerialV2:"IssuerSerialV2",DataObjectFormat:"DataObjectFormat",CommitmentTypeIndication:"CommitmentTypeIndication",AllDataObjectsTimeStamp:"AllDataObjectsTimeStamp",IndividualDataObjectsTimeStamp:"IndividualDataObjectsTimeStamp",HashDataInfo:"HashDataInfo",EncapsulatedTimeStamp:"EncapsulatedTimeStamp",XMLTimeStamp:"XMLTimeStamp",XAdESTimeStamp:"XAdESTimeStamp",OtherTimeStamp:"OtherTimeStamp",Description:"Description",ObjectIdentifier:"ObjectIdentifier",MimeType:"MimeType",Encoding:"Encoding",Identifier:"Identifier",DocumentationReferences:"DocumentationReferences",DocumentationReference:"DocumentationReference",CommitmentTypeId:"CommitmentTypeId",ObjectReference:"ObjectReference",CommitmentTypeQualifiers:"CommitmentTypeQualifiers",AllSignedDataObjects:"AllSignedDataObjects",CommitmentTypeQualifier:"CommitmentTypeQualifier",SignaturePolicyId:"SignaturePolicyId",SignaturePolicyImplied:"SignaturePolicyImplied",SigPolicyId:"SigPolicyId",SigPolicyHash:"SigPolicyHash",SigPolicyQualifier:"SigPolicyQualifier",SigPolicyQualifiers:"SigPolicyQualifiers",SPURI:"SPURI",SPUserNotice:"SPUserNotice",NoticeRef:"NoticeRef",ExplicitText:"ExplicitText",ClaimedRoles:"ClaimedRoles",ClaimedRole:"ClaimedRole",CertifiedRoles:"CertifiedRoles",CertifiedRole:"CertifiedRole",Organization:"Organization",NoticeNumbers:"NoticeNumbers",Int:"int",City:"City",PostalCode:"PostalCode",StateOrProvince:"StateOrProvince",CountryName:"CountryName",CounterSignature:"CounterSignature",SignatureTimeStamp:"SignatureTimeStamp",CompleteCertificateRefs:"CompleteCertificateRefs",CompleteRevocationRefs:"CompleteRevocationRefs",SigAndRefsTimeStamp:"SigAndRefsTimeStamp",RefsOnlyTimeStamp:"RefsOnlyTimeStamp",CertificateValues:"CertificateValues",RevocationValues:"RevocationValues",ArchiveTimeStamp:"ArchiveTimeStamp",CertRefs:"CertRefs",CRLRefs:"CRLRefs",CRLRef:"CRLRef",OCSPRefs:"OCSPRefs",OtherRefs:"OtherRefs",OtherRef:"OtherRef",DigestAlgAndValue:"DigestAlgAndValue",CRLIdentifier:"CRLIdentifier",Issuer:"Issuer",IssueTime:"IssueTime",Number:"Number",OCSPRef:"OCSPRef",OCSPIdentifier:"OCSPIdentifier",ResponderID:"ResponderID",ProducedAt:"ProducedAt",EncapsulatedX509Certificate:"EncapsulatedX509Certificate",OtherCertificate:"OtherCertificate",CRLValues:"CRLValues",OCSPValues:"OCSPValues",OtherValues:"OtherValues",OtherValue:"OtherValue",EncapsulatedCRLValue:"EncapsulatedCRLValue",EncapsulatedOCSPValue:"EncapsulatedOCSPValue",ReferenceInfo:"ReferenceInfo",Include:"Include"},AttributeNames:{Id:"Id",Encoding:"Encoding",Target:"Target",ObjectReference:"ObjectReference",Qualifier:"Qualifier",Uri:"uri",URI:"URI",ReferencedData:"referencedData"}},ae=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ee);ae=k([C({localName:"xades",namespaceURI:ne.NamespaceURI,prefix:ne.DefaultPrefix})],ae);var ie=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(te);ie=k([C({localName:"xades_collection",namespaceURI:ne.NamespaceURI,prefix:ne.DefaultPrefix})],ie);var se=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([I()],se.prototype,"Value",void 0),se=k([C({localName:ne.ElementNames.Any})],se);var oe=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ie);oe=k([C({localName:ne.ElementNames.Any})],oe);var ue=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([x({localName:ne.AttributeNames.Id,defaultValue:""})],ue.prototype,"Id",void 0),k([x({localName:ne.AttributeNames.Encoding,defaultValue:null,converter:{get:function(e){switch(e){case"der":case"ber":case"cer":case"per":case"xer":return"http://uri.etsi.org/01903/v1.2.2#".concat(e.toUpperCase())}},set:function(e){var t=/#(\w+)$/.exec(e);return t?t[1].toLowerCase():null}}})],ue.prototype,"Encoding",void 0),k([I({required:!0,converter:Y})],ue.prototype,"Value",void 0),ue=k([C({localName:"EncapsulatedPKIData"})],ue);var le=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(se);le=k([C({localName:ne.ElementNames.OtherCertificate})],le);var ce=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ie);ce=k([C({localName:"OtherCertificateCollection",parser:le})],ce);var he=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ue);he=k([C({localName:ne.ElementNames.EncapsulatedX509Certificate})],he);var fe=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ie);fe=k([C({localName:"EncapsulatedX509CertificateCollection",parser:he})],fe);var me=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([x({localName:ne.AttributeNames.Id,defaultValue:""})],me.prototype,"Id",void 0),k([B({parser:fe,noRoot:!0})],me.prototype,"EncapsulatedX509Certificates",void 0),k([B({parser:ce,noRoot:!0})],me.prototype,"OtherCertificates",void 0),me=k([C({localName:ne.ElementNames.CertificateValues})],me);var ve=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([x({localName:ne.AttributeNames.Qualifier})],ve.prototype,"Qualifier",void 0),k([I({defaultValue:"",required:!0})],ve.prototype,"Value",void 0),ve=k([C({localName:ne.ElementNames.Identifier})],ve);var ge=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r,[{key:"OnLoadXml",value:function(e){e.textContent&&(this.Uri=e.textContent)}},{key:"OnGetXml",value:function(e){this.Uri&&(e.textContent=this.Uri)}}]),r}(ae);k([I({defaultValue:"",required:!0})],ge.prototype,"Uri",void 0),ge=k([C({localName:ne.ElementNames.DocumentationReference})],ge);var de=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ie);de=k([C({localName:ne.ElementNames.DocumentationReferences,parser:ge})],de);var ye=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([B({parser:ve,required:!0})],ye.prototype,"Identifier",void 0),k([B({localName:ne.ElementNames.Description,namespaceURI:ne.NamespaceURI,prefix:ne.DefaultPrefix,defaultValue:""})],ye.prototype,"Description",void 0),k([B({parser:de})],ye.prototype,"DocumentationReferences",void 0),ye=k([C({localName:ne.ElementNames.ObjectIdentifier})],ye);var pe=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(se);pe=k([C({localName:ne.ElementNames.CommitmentTypeQualifier})],pe);var ke=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ie);ke=k([C({localName:ne.ElementNames.CommitmentTypeQualifiers,parser:pe})],ke);var be=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([I({required:!0})],be.prototype,"Value",void 0),be=k([C({localName:ne.ElementNames.ObjectReference})],be);var we=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ie);we=k([C({localName:"ObjectReferences",parser:be})],we);var Se=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);function Ne(e,t,r){var n;return e instanceof Object==!1?r:null!==(n=e[t])&&void 0!==n?n:r}function Ae(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.byteLength-r,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i="",s=p(new Uint8Array(e,r,n));try{for(s.s();!(t=s.n()).done;){var o=t.value,u=o.toString(16).toUpperCase();1===u.length&&(i+="0"),i+=u,a&&(i+=" ")}}catch(e){s.e(e)}finally{s.f()}return i.trim()}function Ce(e,t,r,n){return t instanceof ArrayBuffer?t.byteLength?r<0?(e.error="Wrong parameter: inputOffset less than zero",!1):n<0?(e.error="Wrong parameter: inputLength less than zero",!1):!(t.byteLength-r-n<0)||(e.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):(e.error="Wrong parameter: inputBuffer has zero length",!1):(e.error='Wrong parameter: inputBuffer must be "ArrayBuffer"',!1)}function Be(e,t){var r=0;if(1===e.length)return e[0];for(var n=e.length-1;n>=0;n--)r+=e[e.length-1-n]*Math.pow(2,t*n);return r}function xe(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=r,a=e,i=0,s=Math.pow(2,t),o=1;o<8;o++){if(e<s){var u=void 0;if(n<0)u=new ArrayBuffer(o),i=o;else{if(n<o)return new ArrayBuffer(0);u=new ArrayBuffer(n),i=n}for(var l=new Uint8Array(u),c=o-1;c>=0;c--){var h=Math.pow(2,c*t);l[i-c-1]=Math.floor(a/h),a-=l[i-c-1]*h}return u}s*=Math.pow(2,t)}return new ArrayBuffer(0)}function Ie(){for(var e=0,t=0,r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];for(var i=0,s=n;i<s.length;i++){var o=s[i];e+=o.byteLength}for(var u=new ArrayBuffer(e),l=new Uint8Array(u),c=0,h=n;c<h.length;c++){var f=h[c];l.set(new Uint8Array(f),t),t+=f.byteLength}return u}function Ee(){for(var e=0,t=0,r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];for(var i=0,s=n;i<s.length;i++){var o=s[i];e+=o.length}for(var u=new ArrayBuffer(e),l=new Uint8Array(u),c=0,h=n;c<h.length;c++){var f=h[c];l.set(f,t),t+=f.length}return l}function Pe(){var e=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){var t=255===e[0]&&128&e[1],r=0===e[0]&&0==(128&e[1]);(t||r)&&this.warnings.push("Needlessly long format")}for(var n=new ArrayBuffer(this.valueHex.byteLength),a=new Uint8Array(n),i=0;i<this.valueHex.byteLength;i++)a[i]=0;a[0]=128&e[0];for(var s=Be(a,8),o=new ArrayBuffer(this.valueHex.byteLength),u=new Uint8Array(o),l=0;l<this.valueHex.byteLength;l++)u[l]=e[l];return u[0]&=127,Be(u,8)-s}function Re(e){for(var t=e<0?-1*e:e,r=128,n=1;n<8;n++){if(t<=r){if(e<0){var a=xe(r-t,8,n);return new Uint8Array(a)[0]|=128,a}var i=xe(t,8,n),s=new Uint8Array(i);if(128&s[0]){var o=i.slice(0),u=new Uint8Array(o);i=new ArrayBuffer(i.byteLength+1),s=new Uint8Array(i);for(var l=0;l<o.byteLength;l++)s[l+1]=u[l];s[0]=0}return i}r*=Math.pow(2,8)}return new ArrayBuffer(0)}function Le(e,t){if(e.byteLength!==t.byteLength)return!1;for(var r=new Uint8Array(e),n=new Uint8Array(t),a=0;a<r.length;a++)if(r[a]!==n[a])return!1;return!0}function Ue(e,t){var r=e.toString(10);if(t<r.length)return"";for(var n=t-r.length,a=new Array(n),i=0;i<n;i++)a[i]="0";return a.join("").concat(r)}k([B({localName:ne.ElementNames.CommitmentTypeId,required:!0,namespaceURI:ne.NamespaceURI,prefix:ne.DefaultPrefix,parser:ye})],Se.prototype,"CommitmentTypeId",void 0),k([B({parser:we,noRoot:!0})],Se.prototype,"ObjectReference",void 0),k([B({localName:ne.ElementNames.AllSignedDataObjects,namespaceURI:ne.NamespaceURI,prefix:ne.DefaultPrefix,converter:{set:function(e){return!0},get:function(e){}},defaultValue:!1})],Se.prototype,"AllSignedDataObjects",void 0),k([B({localName:ne.ElementNames.CommitmentTypeQualifiers,parser:pe})],Se.prototype,"CommitmentTypeQualifiers",void 0),Se=k([C({localName:ne.ElementNames.CommitmentTypeIndication})],Se);var Oe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",De="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";function Te(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=0,i=0,s=0,o="",u=t?De:Oe;if(n){for(var l=0,c=0;c<e.length;c++)if(0!==e.charCodeAt(c)){l=c;break}e=e.slice(l)}for(;a<e.length;){var h=e.charCodeAt(a++);a>=e.length&&(i=1);var f=e.charCodeAt(a++);a>=e.length&&(s=1);var m=e.charCodeAt(a++),v=h>>2,g=(3&h)<<4|f>>4,d=(15&f)<<2|m>>6,y=63&m;1===i?d=y=64:1===s&&(y=64),o+=r?64===d?"".concat(u.charAt(v)).concat(u.charAt(g)):64===y?"".concat(u.charAt(v)).concat(u.charAt(g)).concat(u.charAt(d)):"".concat(u.charAt(v)).concat(u.charAt(g)).concat(u.charAt(d)).concat(u.charAt(y)):"".concat(u.charAt(v)).concat(u.charAt(g)).concat(u.charAt(d)).concat(u.charAt(y))}return o}function He(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=t?De:Oe;function a(e){for(var t=0;t<64;t++)if(n.charAt(t)===e)return t;return 64}function i(e){return 64===e?0:e}for(var s=0,o="";s<e.length;){var u=a(e.charAt(s++)),l=s>=e.length?0:a(e.charAt(s++)),c=s>=e.length?0:a(e.charAt(s++)),h=s>=e.length?0:a(e.charAt(s++)),f=i(u)<<2|i(l)>>4,m=(15&i(l))<<4|i(c)>>2,v=(3&i(c))<<6|i(h);o+=String.fromCharCode(f),64!==c&&(o+=String.fromCharCode(m)),64!==h&&(o+=String.fromCharCode(v))}if(r){for(var g=o.length,d=-1,y=g-1;y>=0;y--)if(0!==o.charCodeAt(y)){d=y;break}o=-1!==d?o.slice(0,d+1):""}return o}function Ve(e){var t,r="",n=p(new Uint8Array(e));try{for(n.s();!(t=n.n()).done;){var a=t.value;r+=String.fromCharCode(a)}}catch(e){n.e(e)}finally{n.f()}return r}function _e(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),a=0;a<t;a++)n[a]=e.charCodeAt(a);return r}var je=Math.log(2);function Me(e,t){var r,n=p(t);try{for(n.s();!(r=n.n()).done;){delete e[r.value]}}catch(e){n.e(e)}finally{n.f()}}function Ke(){if("undefined"==typeof BigInt)throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function Fe(e){if(e.idBlock.isConstructed)for(var t=0;t<e.valueBlock.value.length;t++)Fe(e.valueBlock.value[t])&&(e.lenBlock.isIndefiniteForm=!0);return!!e.lenBlock.isIndefiniteForm}function Xe(e){for(var t=0,r=0,n=0;n<e.length;n++){t+=e[n].byteLength}for(var a=new ArrayBuffer(t),i=new Uint8Array(a),s=0;s<e.length;s++){var o=e[s];i.set(new Uint8Array(o),r),r+=o.byteLength}return a}var Ge=[new Uint8Array([1])],Je="0123456789",qe="name",We="valueBeforeDecode",Qe="blockLength",ze="error",Ye="warnings",Ze="valueHex",$e="isHexOnly",et="idBlock",tt="tagClass",rt="tagNumber",nt="isConstructed",at="lenBlock",it="isIndefiniteForm",st="longFormUsed",ot="length",ut="optional",lt="primitiveSchema",ct="value",ht="valueDate",ft="local",mt="unusedBits",vt="valueDec",gt="isFirstSid",dt="data",yt="",pt=new ArrayBuffer(0),kt=function(){function e(){a(this,e),this.items=[]}return s(e,[{key:"write",value:function(e){this.items.push(e)}},{key:"final",value:function(){return Xe(this.items)}}]),e}(),bt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.blockLength=Ne(t,Qe,0),this.error=Ne(t,ze,yt),this.warnings=Ne(t,Ye,[]),this.valueBeforeDecode=We in t?t.valueBeforeDecode.slice(0):pt}return s(e,[{key:"toJSON",value:function(){return{blockName:this.constructor.blockName(),blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:Ae(this.valueBeforeDecode,0,this.valueBeforeDecode.byteLength)}}}],[{key:"blockName",value:function(){return"baseBlock"}}]),e}(),wt=function(e){return function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).isHexOnly=Ne(n,$e,!1),e.valueHex=Ze in n?n.valueHex.slice(0):pt,e}return s(r,[{key:"fromBER",value:function(e,t,r){return!1===Ce(this,e,t,r)?-1:0===new Uint8Array(e,t,r).length?(this.warnings.push("Zero buffer length"),t):(this.valueHex=e.slice(t,t+r),this.blockLength=r,t+r)}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!0!==this.isHexOnly?(this.error='Flag "isHexOnly" is not set, abort',pt):!0===e?new ArrayBuffer(this.valueHex.byteLength):this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.blockName=this.constructor.blockName(),e.isHexOnly=this.isHexOnly,e.valueHex=Ae(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"hexBlock"}}]),r}(e)},St=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),e=t.call(this),et in n?(e.isHexOnly=Ne(n.idBlock,$e,!1),e.valueHex=Ne(n.idBlock,Ze,pt),e.tagClass=Ne(n.idBlock,tt,-1),e.tagNumber=Ne(n.idBlock,rt,-1),e.isConstructed=Ne(n.idBlock,nt,!1)):(e.tagClass=-1,e.tagNumber=-1,e.isConstructed=!1),e}return s(r,[{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=0;switch(this.tagClass){case 1:n|=0;break;case 2:n|=64;break;case 3:n|=128;break;case 4:n|=192;break;default:return this.error="Unknown tag class",pt}if(this.isConstructed&&(n|=32),this.tagNumber<31&&!this.isHexOnly){if(e=new ArrayBuffer(1),t=new Uint8Array(e),!r){var a=this.tagNumber;n|=a&=31,t[0]=n}return e}if(!1===this.isHexOnly){var i=xe(this.tagNumber,7),s=new Uint8Array(i),o=i.byteLength;if(e=new ArrayBuffer(o+1),(t=new Uint8Array(e))[0]=31|n,!r){for(var u=0;u<o-1;u++)t[u+1]=128|s[u];t[o]=s[o-1]}return e}if(e=new ArrayBuffer(this.valueHex.byteLength+1),(t=new Uint8Array(e))[0]=31|n,!1===r){for(var l=new Uint8Array(this.valueHex),c=0;c<l.length-1;c++)t[c+1]=128|l[c];t[this.valueHex.byteLength]=l[l.length-1]}return e}},{key:"fromBER",value:function(e,t,r){if(!1===Ce(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);if(0===n.length)return this.error="Zero buffer length",-1;switch(192&n[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=32==(32&n[0]),this.isHexOnly=!1;var a=31&n[0];if(31!==a)this.tagNumber=a,this.blockLength=1;else{var i=1;this.valueHex=new ArrayBuffer(255);for(var s=255,o=new Uint8Array(this.valueHex);128&n[i];){if(o[i-1]=127&n[i],++i>=n.length)return this.error="End of input reached before message was fully decoded",-1;if(i===s){s+=255;for(var u=new ArrayBuffer(s),l=new Uint8Array(u),c=0;c<o.length;c++)l[c]=o[c];this.valueHex=new ArrayBuffer(s),o=new Uint8Array(this.valueHex)}}this.blockLength=i+1,o[i-1]=127&n[i];for(var h=new ArrayBuffer(i),f=new Uint8Array(h),m=0;m<i;m++)f[m]=o[m];this.valueHex=new ArrayBuffer(i),(o=new Uint8Array(this.valueHex)).set(f),this.blockLength<=9?this.tagNumber=Be(o,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.blockName=this.constructor.blockName(),e.tagClass=this.tagClass,e.tagNumber=this.tagNumber,e.isConstructed=this.isConstructed,e}}],[{key:"blockName",value:function(){return"identificationBlock"}}]),r}(wt(bt)),Nt=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),e=t.call(this),at in n?(e.isIndefiniteForm=Ne(n.lenBlock,it,!1),e.longFormUsed=Ne(n.lenBlock,st,!1),e.length=Ne(n.lenBlock,ot,0)):(e.isIndefiniteForm=!1,e.longFormUsed=!1,e.length=0),e}return s(r,[{key:"fromBER",value:function(e,t,r){if(!1===Ce(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);if(0===n.length)return this.error="Zero buffer length",-1;if(255===n[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===n[0],!0===this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(128&n[0]),!1===this.longFormUsed)return this.length=n[0],this.blockLength=1,t+this.blockLength;var a=127&n[0];if(a>8)return this.error="Too big integer",-1;if(a+1>n.length)return this.error="End of input reached before message was fully decoded",-1;for(var i=new Uint8Array(a),s=0;s<a;s++)i[s]=n[s+1];return 0===i[a-1]&&this.warnings.push("Needlessly long encoded length"),this.length=Be(i,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=a+1,t+this.blockLength}},{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return e=new ArrayBuffer(1),!1===r&&((t=new Uint8Array(e))[0]=128),e;if(!0===this.longFormUsed){var n=xe(this.length,8);if(n.byteLength>127)return this.error="Too big length",pt;if(e=new ArrayBuffer(n.byteLength+1),!0===r)return e;var a=new Uint8Array(n);(t=new Uint8Array(e))[0]=128|n.byteLength;for(var i=0;i<n.byteLength;i++)t[i+1]=a[i];return e}return e=new ArrayBuffer(1),!1===r&&((t=new Uint8Array(e))[0]=this.length),e}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.blockName=this.constructor.blockName(),e.isIndefiniteForm=this.isIndefiniteForm,e.longFormUsed=this.longFormUsed,e.length=this.length,e}}],[{key:"blockName",value:function(){return"lengthBlock"}}]),r}(bt),At=function(e){o(r,e);var t=h(r);function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),t.call(this,e)}return s(r,[{key:"fromBER",value:function(e,t,r){throw TypeError('User need to make a specific function in a class which extends "ValueBlock"')}},{key:"toBER",value:function(){throw TypeError('User need to make a specific function in a class which extends "ValueBlock"')}}],[{key:"blockName",value:function(){return"valueBlock"}}]),r}(bt),Ct=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:At;return a(this,r),e=t.call(this,n),qe in n&&(e.name=n.name),ut in n&&(e.optional=n.optional),lt in n&&(e.primitiveSchema=n.primitiveSchema),e.idBlock=new St(n),e.lenBlock=new Nt(n),e.valueBlock=new i(n),e}return s(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0,r=t||new kt;t||Fe(this);var n=this.idBlock.toBER(e);if(r.write(n),this.lenBlock.isIndefiniteForm)r.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,r),r.write(new ArrayBuffer(2));else{var a=this.valueBlock.toBER(!0);this.lenBlock.length=a.byteLength;var i=this.lenBlock.toBER(e);r.write(i);var s=e?new ArrayBuffer(this.lenBlock.length):this.valueBlock.toBER(e);r.write(s,r)}if(!t)return r.final()}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.idBlock=this.idBlock.toJSON(),e.lenBlock=this.lenBlock.toJSON(),e.valueBlock=this.valueBlock.toJSON(),qe in this&&(e.name=this.name),ut in this&&(e.optional=this.optional),lt in this&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}},{key:"toString",value:function(){return"".concat(this.constructor.blockName()," : ").concat(Ae(this.valueBlock.valueHex))}}],[{key:"blockName",value:function(){return"BaseBlock"}}]),r}(bt),Bt=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).valueHex=Ze in n?n.valueHex.slice(0):pt,e.isHexOnly=Ne(n,$e,!0),e}return s(r,[{key:"fromBER",value:function(e,t,r){if(!1===Ce(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);if(0===n.length)return this.warnings.push("Zero buffer length"),t;this.valueHex=new ArrayBuffer(n.length);for(var a=new Uint8Array(this.valueHex),i=0;i<n.length;i++)a[i]=n[i];return this.blockLength=r,t+r}},{key:"toBER",value:function(){return this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.valueHex=Ae(this.valueHex,0,this.valueHex.byteLength),e.isHexOnly=this.isHexOnly,e}}],[{key:"blockName",value:function(){return"PrimitiveValueBlock"}}]),r}(At),xt=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n,Bt)).idBlock.isConstructed=!1,e}return s(r,null,[{key:"blockName",value:function(){return"PRIMITIVE"}}]),r}(Ct),It=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).value=Ne(n,ct,[]),e.isIndefiniteForm=Ne(n,it,!1),e}return s(r,[{key:"fromBER",value:function(e,t,r){var n=t,a=r;if(!1===Ce(this,e,t,r))return-1;if(0===new Uint8Array(e,t,r).length)return this.warnings.push("Zero buffer length"),t;for(var i,s,o=t;i=this.isIndefiniteForm,s=r,(!0===i?1:s)>0;){var u=Ar(e,o,r);if(-1===u.offset)return this.error=u.result.error,this.warnings.concat(u.result.warnings),-1;if(o=u.offset,this.blockLength+=u.result.blockLength,r-=u.result.blockLength,this.value.push(u.result),!0===this.isIndefiniteForm&&u.result.constructor.blockName()===Rt.blockName())break}return!0===this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.blockName()===Rt.blockName()?this.value.pop():this.warnings.push("No EndOfContent block encoded")),this.valueBeforeDecode=e.slice(n,n+a),o}},{key:"toBER",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0,r=t||new kt,n=0;n<this.value.length;n++)this.value[n].toBER(e,r);if(!t)return r.final()}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}e.isIndefiniteForm=this.isIndefiniteForm,e.value=[];for(var t=0;t<this.value.length;t++)e.value.push(this.value[t].toJSON());return e}}],[{key:"blockName",value:function(){return"ConstructedValueBlock"}}]),r}(At),Et=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n,It)).idBlock.isConstructed=!0,e}return s(r,[{key:"fromBER",value:function(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"toString",value:function(){var e,t=[],r=p(this.valueBlock.value);try{for(r.s();!(e=r.n()).done;){var n=e.value;t.push(n.toString().split("\n").map((function(e){return"  ".concat(e)})).join("\n"))}}catch(e){r.e(e)}finally{r.f()}var a=3===this.idBlock.tagClass?"[".concat(this.idBlock.tagNumber,"]"):this.constructor.blockName();return t.length?"".concat(a," :\n").concat(t.join("\n")):"".concat(a," :")}}],[{key:"blockName",value:function(){return"CONSTRUCTED"}}]),r}(Ct),Pt=function(e){o(r,e);var t=h(r);function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),t.call(this,e)}return s(r,[{key:"fromBER",value:function(e,t,r){return t}},{key:"toBER",value:function(){return pt}}],[{key:"blockName",value:function(){return"EndOfContentValueBlock"}}]),r}(At),Rt=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n,Pt)).idBlock.tagClass=1,e.idBlock.tagNumber=0,e}return s(r,null,[{key:"blockName",value:function(){return"EndOfContent"}}]),r}(Ct),Lt=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(a(this,r),(e=t.call(this,n)).value=Ne(n,ct,!1),e.isHexOnly=Ne(n,$e,!1),Ze in n)e.valueHex=n.valueHex.slice(0);else if(e.valueHex=new ArrayBuffer(1),!0===e.value){var i=new Uint8Array(e.valueHex);i[0]=255}return e}return s(r,[{key:"fromBER",value:function(e,t,r){if(!1===Ce(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,this.valueHex=new ArrayBuffer(n.length);for(var a=new Uint8Array(this.valueHex),i=0;i<n.length;i++)a[i]=n[i];return 0!==Pe.call(this)?this.value=!0:this.value=!1,this.blockLength=r,t+r}},{key:"toBER",value:function(){return this.valueHex}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e.isHexOnly=this.isHexOnly,e.valueHex=Ae(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"BooleanValueBlock"}}]),r}(At),Ut=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n,Lt)).idBlock.tagClass=1,e.idBlock.tagNumber=1,e}return s(r,[{key:"toString",value:function(){return"".concat(this.constructor.blockName()," : ").concat(this.valueBlock.value)}}],[{key:"blockName",value:function(){return"BOOLEAN"}}]),r}(Ct),Ot=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=16,e}return s(r,null,[{key:"blockName",value:function(){return"SEQUENCE"}}]),r}(Et),Dt=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=17,e}return s(r,null,[{key:"blockName",value:function(){return"SET"}}]),r}(Et),Tt=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n,bt)).idBlock.tagClass=1,e.idBlock.tagNumber=5,e}return s(r,[{key:"fromBER",value:function(e,t,r){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+r}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0,r=new ArrayBuffer(2);if(!e){var n=new Uint8Array(r);n[0]=5,n[1]=0}return t&&t.write(r),r}},{key:"toString",value:function(){return"".concat(this.constructor.blockName())}}],[{key:"blockName",value:function(){return"NULL"}}]),r}(Ct),Ht=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).isConstructed=Ne(n,nt,!1),e}return s(r,[{key:"fromBER",value:function(e,t,n){var a=0;if(!0===this.isConstructed){if(this.isHexOnly=!1,-1===(a=It.prototype.fromBER.call(this,e,t,n)))return a;for(var i=0;i<this.value.length;i++){var s=this.value[i].constructor.blockName();if(s===Rt.blockName()){if(!0===this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(s!==Vt.blockName())return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,a=m(u(r.prototype),"fromBER",this).call(this,e,t,n),this.blockLength=n;return a}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if(!0===this.isConstructed)return It.prototype.toBER.call(this,e,t);var r=new ArrayBuffer(this.valueHex.byteLength);return!0===e||0===this.valueHex.byteLength?r:r=this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.isConstructed=this.isConstructed,e.isHexOnly=this.isHexOnly,e.valueHex=Ae(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"OctetStringValueBlock"}}]),r}(wt(It)),Vt=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n,Ht)).idBlock.tagClass=1,e.idBlock.tagNumber=4,e}return s(r,[{key:"fromBER",value:function(e,t,n){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===n)return 0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){var a=e.slice(t,t+n);try{var i=Cr(a);-1!==i.offset&&i.offset===n&&(this.valueBlock.value=[i.result])}catch(e){}}return m(u(r.prototype),"fromBER",this).call(this,e,t,n)}},{key:"isEqual",value:function(e){return e instanceof r!=!1&&JSON.stringify(this)===JSON.stringify(e)}},{key:"toString",value:function(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?Et.prototype.toString.call(this):"".concat(this.constructor.blockName()," : ").concat(Ae(this.valueBlock.valueHex))}}],[{key:"blockName",value:function(){return"OCTET STRING"}}]),r}(Ct),_t=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).unusedBits=Ne(n,mt,0),e.isConstructed=Ne(n,nt,!1),e.blockLength=e.valueHex.byteLength,e}return s(r,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;var n=-1;if(!0===this.isConstructed){if(-1===(n=It.prototype.fromBER.call(this,e,t,r)))return n;for(var a=0;a<this.value.length;a++){var i=this.value[a].constructor.blockName();if(i===Rt.blockName()){if(!0===this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(i!==jt.blockName())return this.error="BIT STRING may consists of BIT STRINGs only",-1;if(this.unusedBits>0&&this.value[a].valueBlock.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;if(this.unusedBits=this.value[a].valueBlock.unusedBits,this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1}return n}if(!1===Ce(this,e,t,r))return-1;var s=new Uint8Array(e,t,r);if(this.unusedBits=s[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){var o=e.slice(t+1,t+r);try{var u=Cr(o);-1!==u.offset&&u.offset===r-1&&(this.value=[u.result])}catch(e){}}this.valueHex=new ArrayBuffer(s.length-1);for(var l=new Uint8Array(this.valueHex),c=0;c<r-1;c++)l[c]=s[c+1];return this.blockLength=s.length,t+r}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if(!0===this.isConstructed)return It.prototype.toBER.call(this,e,t);if(!0===e)return new ArrayBuffer(this.valueHex.byteLength+1);if(0===this.valueHex.byteLength)return pt;var r=new Uint8Array(this.valueHex),n=new ArrayBuffer(this.valueHex.byteLength+1),a=new Uint8Array(n);a[0]=this.unusedBits;for(var i=0;i<this.valueHex.byteLength;i++)a[i+1]=r[i];return n}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.unusedBits=this.unusedBits,e.isConstructed=this.isConstructed,e.isHexOnly=this.isHexOnly,e.valueHex=Ae(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"BitStringValueBlock"}}]),r}(wt(It)),jt=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n,_t)).idBlock.tagClass=1,e.idBlock.tagNumber=3,e}return s(r,[{key:"fromBER",value:function(e,t,n){return 0===n?t:(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,m(u(r.prototype),"fromBER",this).call(this,e,t,n))}},{key:"isEqual",value:function(e){return e instanceof r!=!1&&JSON.stringify(this)===JSON.stringify(e)}},{key:"toString",value:function(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return Et.prototype.toString.call(this);var e,t=[],r=p(new Uint8Array(this.valueBlock.valueHex));try{for(r.s();!(e=r.n()).done;){var n=e.value;t.push(n.toString(2).padStart(8,"0"))}}catch(e){r.e(e)}finally{r.f()}return"".concat(this.constructor.blockName()," : ").concat(t.join(""))}}],[{key:"blockName",value:function(){return"BIT STRING"}}]),r}(Ct),Mt=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),e=t.call(this,n),ct in n&&(e.valueDec=n.value),e}return s(r,[{key:"valueHex",get:function(){return this._valueHex},set:function(e){this._valueHex=e.slice(0),e.byteLength>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,e.byteLength>0&&(this._valueDec=Pe.call(this)))}},{key:"valueDec",get:function(){return this._valueDec},set:function(e){this._valueDec=e,this.isHexOnly=!1,this._valueHex=Re(e)}},{key:"fromDER",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=this.fromBER(e,t,r);if(-1===a)return a;var i=new Uint8Array(this._valueHex);if(0===i[0]&&0!=(128&i[1])){var s=new ArrayBuffer(this._valueHex.byteLength-1),o=new Uint8Array(s);o.set(new Uint8Array(this._valueHex,1,this._valueHex.byteLength-1)),this._valueHex=s.slice(0)}else if(0!==n&&this._valueHex.byteLength<n){n-this._valueHex.byteLength>1&&(n=this._valueHex.byteLength+1);var u=new ArrayBuffer(n),l=new Uint8Array(u);l.set(i,n-this._valueHex.byteLength),this._valueHex=u.slice(0)}return a}},{key:"toDER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new Uint8Array(this._valueHex);switch(!0){case 0!=(128&t[0]):var r=new ArrayBuffer(this._valueHex.byteLength+1),n=new Uint8Array(r);n[0]=0,n.set(t,1),this._valueHex=r.slice(0);break;case 0===t[0]&&0==(128&t[1]):var a=new ArrayBuffer(this._valueHex.byteLength-1),i=new Uint8Array(a);i.set(new Uint8Array(this._valueHex,1,this._valueHex.byteLength-1)),this._valueHex=a.slice(0)}return this.toBER(e)}},{key:"fromBER",value:function(e,t,n){var a=m(u(r.prototype),"fromBER",this).call(this,e,t,n);return-1===a?a:(this.blockLength=n,t+n)}},{key:"toBER",value:function(){return this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.valueDec=this.valueDec,e}},{key:"toString",value:function(){function e(e,t){for(var r=new Uint8Array([0]),n=new Uint8Array(e),a=new Uint8Array(t),i=n.slice(0),s=i.length-1,o=a.slice(0),u=o.length-1,l=0,c=0,h=u<s?s:u;h>=0;h--,c++){if(!0==c<o.length)l=i[s-c]+o[u-c]+r[0];else l=i[s-c]+r[0];if(r[0]=l/10,!0==c>=i.length)i=Ee(new Uint8Array([l%10]),i);else i[s-c]=l%10}return r[0]>0&&(i=Ee(r,i)),i.slice(0)}function t(e){if(e>=Ge.length)for(var t=Ge.length;t<=e;t++){for(var r=new Uint8Array([0]),n=Ge[t-1].slice(0),a=n.length-1;a>=0;a--){var i=new Uint8Array([(n[a]<<1)+r[0]]);r[0]=i[0]/10,n[a]=i[0]%10}r[0]>0&&(n=Ee(r,n)),Ge.push(n)}return Ge[e]}function r(e,t){for(var r,n=0,a=new Uint8Array(e),i=new Uint8Array(t),s=a.slice(0),o=s.length-1,u=i.slice(0),l=u.length-1,c=0,h=l;h>=0;h--,c++)if(!0==(r=s[o-c]-u[l-c]-n)<0)n=1,s[o-c]=r+10;else n=0,s[o-c]=r;if(n>0)for(var f=o-l+1;f>=0;f--,c++){if(!((r=s[o-c]-n)<0)){n=0,s[o-c]=r;break}n=1,s[o-c]=r+10}return s.slice()}for(var n,a=8*this._valueHex.byteLength-1,i=new Uint8Array(8*this._valueHex.byteLength/3),s=0,o=new Uint8Array(this._valueHex),u="",l=!1,c=this._valueHex.byteLength-1;c>=0;c--){n=o[c];for(var h=0;h<8;h++){if(1==(1&n))if(s===a)i=r(t(s),i),u="-";else i=e(i,t(s));s++,n>>=1}}for(var f=0;f<i.length;f++)i[f]&&(l=!0),l&&(u+=Je.charAt(i[f]));return!1===l&&(u+=Je.charAt(0)),u}}],[{key:"blockName",value:function(){return"IntegerValueBlock"}}]),r}(wt(At)),Kt=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n,Mt)).idBlock.tagClass=1,e.idBlock.tagNumber=2,e}return s(r,[{key:"isEqual",value:function(e){return e instanceof r?this.valueBlock.isHexOnly&&e.valueBlock.isHexOnly?Le(this.valueBlock.valueHex,e.valueBlock.valueHex):this.valueBlock.isHexOnly===e.valueBlock.isHexOnly&&this.valueBlock.valueDec===e.valueBlock.valueDec:e instanceof ArrayBuffer&&Le(this.valueBlock.valueHex,e)}},{key:"convertToDER",value:function(){var e=new r({valueHex:this.valueBlock.valueHex});return e.valueBlock.toDER(),e}},{key:"convertFromDER",value:function(){var e=this.valueBlock.valueHex.byteLength%2?this.valueBlock.valueHex.byteLength+1:this.valueBlock.valueHex.byteLength,t=new r({valueHex:this.valueBlock.valueHex});return t.valueBlock.fromDER(t.valueBlock.valueHex,0,t.valueBlock.valueHex.byteLength,e),t}},{key:"toString",value:function(){Ke();var e=Ae(this.valueBlock.valueHex),t=BigInt("0x".concat(e));return"".concat(this.constructor.blockName()," : ").concat(t.toString())}}],[{key:"blockName",value:function(){return"INTEGER"}}]),r}(Ct),Ft=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=10,e}return s(r,null,[{key:"blockName",value:function(){return"ENUMERATED"}}]),r}(Kt),Xt=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).valueDec=Ne(n,vt,-1),e.isFirstSid=Ne(n,gt,!1),e}return s(r,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;if(!1===Ce(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);this.valueHex=new ArrayBuffer(r);for(var a=new Uint8Array(this.valueHex),i=0;i<r&&(a[i]=127&n[i],this.blockLength++,0!=(128&n[i]));i++);for(var s=new ArrayBuffer(this.blockLength),o=new Uint8Array(s),u=0;u<this.blockLength;u++)o[u]=a[u];return this.valueHex=s.slice(0),a=new Uint8Array(this.valueHex),0!=(128&n[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===a[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Be(a,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}},{key:"valueBigInt",set:function(e){Ke();for(var t=BigInt(e).toString(2);t.length%7;)t="0"+t;for(var r=new Uint8Array(t.length/7),n=0;n<r.length;n++)r[n]=parseInt(t.slice(7*n,7*n+7),2)+(n+1<r.length?128:0);this.fromBER(r.buffer,0,r.length)}},{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isHexOnly){if(!0===r)return new ArrayBuffer(this.valueHex.byteLength);var n=new Uint8Array(this.valueHex);e=new ArrayBuffer(this.blockLength),t=new Uint8Array(e);for(var a=0;a<this.blockLength-1;a++)t[a]=128|n[a];return t[this.blockLength-1]=n[this.blockLength-1],e}var i=xe(this.valueDec,7);if(0===i.byteLength)return this.error="Error during encoding SID value",pt;if(e=new ArrayBuffer(i.byteLength),!1===r){var s=new Uint8Array(i);t=new Uint8Array(e);for(var o=0;o<i.byteLength-1;o++)t[o]=128|s[o];t[i.byteLength-1]=s[i.byteLength-1]}return e}},{key:"toString",value:function(){var e="";if(!0===this.isHexOnly)e=Ae(this.valueHex,0,this.valueHex.byteLength);else if(this.isFirstSid){var t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.valueDec=this.valueDec,e.isFirstSid=this.isFirstSid,e}}],[{key:"blockName",value:function(){return"sidBlock"}}]),r}(wt(bt)),Gt=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).fromString(Ne(n,ct,yt)),e}return s(r,[{key:"fromBER",value:function(e,t,r){for(var n=t;r>0;){var a=new Xt;if(-1===(n=a.fromBER(e,n,r)))return this.blockLength=0,this.error=a.error,n;0===this.value.length&&(a.isFirstSid=!0),this.blockLength+=a.blockLength,r-=a.blockLength,this.value.push(a)}return n}},{key:"toBER",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=[],r=0;r<this.value.length;r++){var n=this.value[r].toBER(e);if(0===n.byteLength)return this.error=this.value[r].error,pt;t.push(n)}return Xe(t)}},{key:"fromString",value:function(e){this.value=[];var t=0,r=0,n="",a=!1;do{if(n=-1===(r=e.indexOf(".",t))?e.substr(t):e.substr(t,r-t),t=r+1,a){var i=this.value[0],s=0;switch(i.valueDec){case 0:break;case 1:s=40;break;case 2:s=80;break;default:return this.value=[],!1}var o=parseInt(n,10);if(isNaN(o))return!0;i.valueDec=o+s,a=!1}else{var u=new Xt;if(n>Number.MAX_SAFE_INTEGER){Ke();var l=BigInt(n);u.valueBigInt=l}else if(u.valueDec=parseInt(n,10),isNaN(u.valueDec))return!0;0===this.value.length&&(u.isFirstSid=!0,a=!0),this.value.push(u)}}while(-1!==r);return!0}},{key:"toString",value:function(){for(var e="",t=!1,r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var n=this.value[r].toString();0!==r&&(e="".concat(e,".")),t?(n="{".concat(n,"}"),this.value[r].isFirstSid?e="2.{".concat(n," - 80}"):e+=n):e+=n}return e}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}e.value=this.toString(),e.sidArray=[];for(var t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}],[{key:"blockName",value:function(){return"ObjectIdentifierValueBlock"}}]),r}(At),Jt=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n,Gt)).idBlock.tagClass=1,e.idBlock.tagNumber=6,e}return s(r,[{key:"toString",value:function(){return"".concat(this.constructor.blockName()," : ").concat(this.valueBlock.toString())}}],[{key:"blockName",value:function(){return"OBJECT IDENTIFIER"}}]),r}(Ct),qt=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).isHexOnly=!0,e.value="",e}return s(r,[{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"Utf8StringValueBlock"}}]),r}(wt(bt)),Wt=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),e=t.call(this,n,qt),ct in n&&e.fromString(n.value),e.idBlock.tagClass=1,e.idBlock.tagNumber=12,e}return s(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.valueBlock.value=String.fromCharCode.apply(null,new Uint8Array(e));try{this.valueBlock.value=decodeURIComponent(escape(this.valueBlock.value))}catch(e){this.warnings.push('Error during "decodeURIComponent": '.concat(e,", using raw string"))}}},{key:"fromString",value:function(e){var t=unescape(encodeURIComponent(e)),r=t.length;this.valueBlock.valueHex=new ArrayBuffer(r);for(var n=new Uint8Array(this.valueBlock.valueHex),a=0;a<r;a++)n[a]=t.charCodeAt(a);this.valueBlock.value=e}},{key:"toString",value:function(){return"".concat(this.constructor.blockName()," : ").concat(this.valueBlock.value)}}],[{key:"blockName",value:function(){return"UTF8String"}}]),r}(Ct),Qt=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).valueDec=Ne(n,vt,-1),e}return s(r,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;if(!1===Ce(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);this.valueHex=new ArrayBuffer(r);for(var a=new Uint8Array(this.valueHex),i=0;i<r&&(a[i]=127&n[i],this.blockLength++,0!=(128&n[i]));i++);for(var s=new ArrayBuffer(this.blockLength),o=new Uint8Array(s),u=0;u<this.blockLength;u++)o[u]=a[u];return this.valueHex=s.slice(0),a=new Uint8Array(this.valueHex),0!=(128&n[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===a[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Be(a,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}},{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isHexOnly){if(!0===r)return new ArrayBuffer(this.valueHex.byteLength);var n=new Uint8Array(this.valueHex);e=new ArrayBuffer(this.blockLength),t=new Uint8Array(e);for(var a=0;a<this.blockLength-1;a++)t[a]=128|n[a];return t[this.blockLength-1]=n[this.blockLength-1],e}var i=xe(this.valueDec,7);if(0===i.byteLength)return this.error="Error during encoding SID value",pt;if(e=new ArrayBuffer(i.byteLength),!1===r){var s=new Uint8Array(i);t=new Uint8Array(e);for(var o=0;o<i.byteLength-1;o++)t[o]=128|s[o];t[i.byteLength-1]=s[i.byteLength-1]}return e}},{key:"toString",value:function(){return!0===this.isHexOnly?Ae(this.valueHex,0,this.valueHex.byteLength):this.valueDec.toString()}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.valueDec=this.valueDec,e}}],[{key:"blockName",value:function(){return"relativeSidBlock"}}]),r}(wt(bt)),zt=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).fromString(Ne(n,ct,yt)),e}return s(r,[{key:"fromBER",value:function(e,t,r){for(var n=t;r>0;){var a=new Qt;if(-1===(n=a.fromBER(e,n,r)))return this.blockLength=0,this.error=a.error,n;this.blockLength+=a.blockLength,r-=a.blockLength,this.value.push(a)}return n}},{key:"toBER",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=[],r=0;r<this.value.length;r++){var n=this.value[r].toBER(e);if(0===n.byteLength)return this.error=this.value[r].error,pt;t.push(n)}return Xe(t)}},{key:"fromString",value:function(e){this.value=[];var t=0,r=0,n="";do{n=-1===(r=e.indexOf(".",t))?e.substr(t):e.substr(t,r-t),t=r+1;var a=new Qt;if(a.valueDec=parseInt(n,10),isNaN(a.valueDec))return!0;this.value.push(a)}while(-1!==r);return!0}},{key:"toString",value:function(){for(var e="",t=!1,r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var n=this.value[r].toString();0!==r&&(e="".concat(e,".")),e+=t?n="{".concat(n,"}"):n}return e}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}e.value=this.toString(),e.sidArray=[];for(var t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}],[{key:"blockName",value:function(){return"RelativeObjectIdentifierValueBlock"}}]),r}(At),Yt=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n,zt)).idBlock.tagClass=1,e.idBlock.tagNumber=13,e}return s(r,null,[{key:"blockName",value:function(){return"RelativeObjectIdentifier"}}]),r}(Ct),Zt=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).isHexOnly=!0,e.value="",e}return s(r,[{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"BmpStringValueBlock"}}]),r}(wt(bt)),$t=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),e=t.call(this,n,Zt),ct in n&&e.fromString(n.value),e.idBlock.tagClass=1,e.idBlock.tagNumber=30,e}return s(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){for(var t=e.slice(0),r=new Uint8Array(t),n=0;n<r.length;n+=2){var a=r[n];r[n]=r[n+1],r[n+1]=a}this.valueBlock.value=String.fromCharCode.apply(null,new Uint16Array(t))}},{key:"fromString",value:function(e){var t=e.length;this.valueBlock.valueHex=new ArrayBuffer(2*t);for(var r=new Uint8Array(this.valueBlock.valueHex),n=0;n<t;n++){var a=xe(e.charCodeAt(n),8),i=new Uint8Array(a);if(!(i.length>2))for(var s=2-i.length,o=i.length-1;o>=0;o--)r[2*n+o+s]=i[o]}this.valueBlock.value=e}},{key:"toString",value:function(){return"".concat(this.constructor.blockName()," : ").concat(this.valueBlock.value)}}],[{key:"blockName",value:function(){return"BMPString"}}]),r}(Ct),er=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).isHexOnly=!0,e.value="",e}return s(r,[{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"UniversalStringValueBlock"}}]),r}(wt(bt)),tr=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),e=t.call(this,n,er),ct in n&&e.fromString(n.value),e.idBlock.tagClass=1,e.idBlock.tagNumber=28,e}return s(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){for(var t=e.slice(0),r=new Uint8Array(t),n=0;n<r.length;n+=4)r[n]=r[n+3],r[n+1]=r[n+2],r[n+2]=0,r[n+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}},{key:"fromString",value:function(e){var t=e.length;this.valueBlock.valueHex=new ArrayBuffer(4*t);for(var r=new Uint8Array(this.valueBlock.valueHex),n=0;n<t;n++){var a=xe(e.charCodeAt(n),8),i=new Uint8Array(a);if(!(i.length>4))for(var s=4-i.length,o=i.length-1;o>=0;o--)r[4*n+o+s]=i[o]}this.valueBlock.value=e}},{key:"toString",value:function(){return"".concat(this.constructor.blockName()," : ").concat(this.valueBlock.value)}}],[{key:"blockName",value:function(){return"UniversalString"}}]),r}(Ct),rr=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).value="",e.isHexOnly=!0,e}return s(r,[{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"SimpleStringValueBlock"}}]),r}(wt(bt)),nr=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),e=t.call(this,n,rr),ct in n&&e.fromString(n.value),e}return s(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.valueBlock.value=String.fromCharCode.apply(null,new Uint8Array(e))}},{key:"fromString",value:function(e){var t=e.length;this.valueBlock.valueHex=new ArrayBuffer(t);for(var r=new Uint8Array(this.valueBlock.valueHex),n=0;n<t;n++)r[n]=e.charCodeAt(n);this.valueBlock.value=e}},{key:"toString",value:function(){return"".concat(this.constructor.blockName()," : ").concat(this.valueBlock.value)}}],[{key:"blockName",value:function(){return"SIMPLESTRING"}}]),r}(Ct),ar=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=18,e}return s(r,null,[{key:"blockName",value:function(){return"NumericString"}}]),r}(nr),ir=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=19,e}return s(r,null,[{key:"blockName",value:function(){return"PrintableString"}}]),r}(nr),sr=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=20,e}return s(r,null,[{key:"blockName",value:function(){return"TeletexString"}}]),r}(nr),or=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=21,e}return s(r,null,[{key:"blockName",value:function(){return"VideotexString"}}]),r}(nr),ur=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=22,e}return s(r,null,[{key:"blockName",value:function(){return"IA5String"}}]),r}(nr),lr=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=25,e}return s(r,null,[{key:"blockName",value:function(){return"GraphicString"}}]),r}(nr),cr=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=26,e}return s(r,null,[{key:"blockName",value:function(){return"VisibleString"}}]),r}(nr),hr=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=27,e}return s(r,null,[{key:"blockName",value:function(){return"GeneralString"}}]),r}(nr),fr=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=29,e}return s(r,null,[{key:"blockName",value:function(){return"CharacterString"}}]),r}(nr),mr=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(a(this,r),(e=t.call(this,n)).year=0,e.month=0,e.day=0,e.hour=0,e.minute=0,e.second=0,ct in n){e.fromString(n.value),e.valueBlock.valueHex=new ArrayBuffer(n.value.length);for(var i=new Uint8Array(e.valueBlock.valueHex),s=0;s<n.value.length;s++)i[s]=n.value.charCodeAt(s)}return ht in n&&(e.fromDate(n.valueDate),e.valueBlock.valueHex=e.toBuffer()),e.idBlock.tagClass=1,e.idBlock.tagNumber=23,e}return s(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.fromString(String.fromCharCode.apply(null,new Uint8Array(e)))}},{key:"toBuffer",value:function(){for(var e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t}},{key:"fromDate",value:function(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}},{key:"fromString",value:function(e){var t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/gi.exec(e);if(null!==t){var r=parseInt(t[1],10);this.year=r>=50?1900+r:2e3+r,this.month=parseInt(t[2],10),this.day=parseInt(t[3],10),this.hour=parseInt(t[4],10),this.minute=parseInt(t[5],10),this.second=parseInt(t[6],10)}else this.error="Wrong input string for conversion"}},{key:"toString",value:function(){var e=new Array(7);return e[0]=Ue(this.year<2e3?this.year-1900:this.year-2e3,2),e[1]=Ue(this.month,2),e[2]=Ue(this.day,2),e[3]=Ue(this.hour,2),e[4]=Ue(this.minute,2),e[5]=Ue(this.second,2),e[6]="Z",e.join("")}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.year=this.year,e.month=this.month,e.day=this.day,e.hour=this.hour,e.minute=this.minute,e.second=this.second,e}}],[{key:"blockName",value:function(){return"UTCTime"}}]),r}(cr),vr=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(a(this,r),(e=t.call(this,n)).year=0,e.month=0,e.day=0,e.hour=0,e.minute=0,e.second=0,e.millisecond=0,ct in n){e.fromString(n.value),e.valueBlock.valueHex=new ArrayBuffer(n.value.length);for(var i=new Uint8Array(e.valueBlock.valueHex),s=0;s<n.value.length;s++)i[s]=n.value.charCodeAt(s)}return ht in n&&(e.fromDate(n.valueDate),e.valueBlock.valueHex=e.toBuffer()),e.idBlock.tagClass=1,e.idBlock.tagNumber=24,e}return s(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.fromString(String.fromCharCode.apply(null,new Uint8Array(e)))}},{key:"toBuffer",value:function(){for(var e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t}},{key:"fromDate",value:function(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds(),this.millisecond=e.getUTCMilliseconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}},{key:"fromString",value:function(e){var t,r=!1,n="",a="",i=0,s=0,o=0;if("Z"===e[e.length-1])n=e.substr(0,e.length-1),r=!0;else{var u=new Number(e[e.length-1]);if(isNaN(u.valueOf()))throw new Error("Wrong input string for conversion");n=e}if(r){if(-1!==n.indexOf("+"))throw new Error("Wrong input string for conversion");if(-1!==n.indexOf("-"))throw new Error("Wrong input string for conversion")}else{var l=1,c=n.indexOf("+"),h="";if(-1===c&&(c=n.indexOf("-"),l=-1),-1!==c){if(h=n.substr(c+1),n=n.substr(0,c),2!==h.length&&4!==h.length)throw new Error("Wrong input string for conversion");var f=new Number(h.substr(0,2));if(isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");if(s=l*f,4===h.length){if(f=new Number(h.substr(2,2)),isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");o=l*f}}}var m=n.indexOf(".");if(-1===m&&(m=n.indexOf(",")),-1!==m){var v=new Number("0".concat(n.substr(m)));if(isNaN(v.valueOf()))throw new Error("Wrong input string for conversion");i=v.valueOf(),a=n.substr(0,m)}else a=n;switch(!0){case 8===a.length:if(t=/(\d{4})(\d{2})(\d{2})/gi,-1!==m)throw new Error("Wrong input string for conversion");break;case 10===a.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})/gi,-1!==m){var g=60*i;this.minute=Math.floor(g),g=60*(g-this.minute),this.second=Math.floor(g),g=1e3*(g-this.second),this.millisecond=Math.floor(g)}break;case 12===a.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==m){var d=60*i;this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case 14===a.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==m){var y=1e3*i;this.millisecond=Math.floor(y)}break;default:throw new Error("Wrong input string for conversion")}var p=t.exec(a);if(null===p)throw new Error("Wrong input string for conversion");for(var k=1;k<p.length;k++)switch(k){case 1:this.year=parseInt(p[k],10);break;case 2:this.month=parseInt(p[k],10);break;case 3:this.day=parseInt(p[k],10);break;case 4:this.hour=parseInt(p[k],10)+s;break;case 5:this.minute=parseInt(p[k],10)+o;break;case 6:this.second=parseInt(p[k],10);break;default:throw new Error("Wrong input string for conversion")}if(!1===r){var b=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=b.getUTCFullYear(),this.month=b.getUTCMonth(),this.day=b.getUTCDay(),this.hour=b.getUTCHours(),this.minute=b.getUTCMinutes(),this.second=b.getUTCSeconds(),this.millisecond=b.getUTCMilliseconds()}}},{key:"toString",value:function(){var e=[];return e.push(Ue(this.year,4)),e.push(Ue(this.month,2)),e.push(Ue(this.day,2)),e.push(Ue(this.hour,2)),e.push(Ue(this.minute,2)),e.push(Ue(this.second,2)),0!==this.millisecond&&(e.push("."),e.push(Ue(this.millisecond,3))),e.push("Z"),e.join("")}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.year=this.year,e.month=this.month,e.day=this.day,e.hour=this.hour,e.minute=this.minute,e.second=this.second,e.millisecond=this.millisecond,e}}],[{key:"blockName",value:function(){return"GeneralizedTime"}}]),r}(cr),gr=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=31,e}return s(r,null,[{key:"blockName",value:function(){return"DATE"}}]),r}(Wt),dr=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=32,e}return s(r,null,[{key:"blockName",value:function(){return"TimeOfDay"}}]),r}(Wt),yr=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=33,e}return s(r,null,[{key:"blockName",value:function(){return"DateTime"}}]),r}(Wt),pr=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=34,e}return s(r,null,[{key:"blockName",value:function(){return"Duration"}}]),r}(Wt),kr=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=14,e}return s(r,null,[{key:"blockName",value:function(){return"TIME"}}]),r}(Wt),br=s((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.value=Ne(t,ct,[]),this.optional=Ne(t,ut,!1)})),wr=s((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.name=Ne(t,qe,yt),this.optional=Ne(t,ut,!1)})),Sr=s((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.name=Ne(t,qe,yt),this.optional=Ne(t,ut,!1),this.value=Ne(t,ct,new wr),this.local=Ne(t,ft,!1)})),Nr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.data=Ne(t,dt,pt)}return s(e,[{key:"fromBER",value:function(e,t,r){return this.data=e.slice(t,r),t+r}},{key:"toBER",value:function(){return this.data}}]),e}();function Ar(e,t,r){var n=t;var a=new Ct({},Object),i=new bt;if(!1===Ce(i,e,t,r))return a.error=i.error,{offset:-1,result:a};if(0===new Uint8Array(e,t,r).length)return a.error="Zero buffer length",{offset:-1,result:a};var s=a.idBlock.fromBER(e,t,r);if(a.warnings.concat(a.idBlock.warnings),-1===s)return a.error=a.idBlock.error,{offset:-1,result:a};if(t=s,r-=a.idBlock.blockLength,s=a.lenBlock.fromBER(e,t,r),a.warnings.concat(a.lenBlock.warnings),-1===s)return a.error=a.lenBlock.error,{offset:-1,result:a};if(t=s,r-=a.lenBlock.blockLength,!1===a.idBlock.isConstructed&&!0===a.lenBlock.isIndefiniteForm)return a.error="Indefinite length form used for primitive encoding form",{offset:-1,result:a};var o=Ct;if(1===a.idBlock.tagClass){if(a.idBlock.tagNumber>=37&&!1===a.idBlock.isHexOnly)return a.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:a};switch(a.idBlock.tagNumber){case 0:if(!0===a.idBlock.isConstructed&&a.lenBlock.length>0)return a.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:a};o=Rt;break;case 1:o=Ut;break;case 2:o=Kt;break;case 3:o=jt;break;case 4:o=Vt;break;case 5:o=Tt;break;case 6:o=Jt;break;case 10:o=Ft;break;case 12:o=Wt;break;case 13:o=Yt;break;case 14:o=kr;break;case 15:return a.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:a};case 16:o=Ot;break;case 17:o=Dt;break;case 18:o=ar;break;case 19:o=ir;break;case 20:o=sr;break;case 21:o=or;break;case 22:o=ur;break;case 23:o=mr;break;case 24:o=vr;break;case 25:o=lr;break;case 26:o=cr;break;case 27:o=hr;break;case 28:o=tr;break;case 29:o=fr;break;case 30:o=$t;break;case 31:o=gr;break;case 32:o=dr;break;case 33:o=yr;break;case 34:o=pr;break;default:var u;(u=!0===a.idBlock.isConstructed?new Et:new xt).idBlock=a.idBlock,u.lenBlock=a.lenBlock,u.warnings=a.warnings,a=u}}else o=!0===a.idBlock.isConstructed?Et:xt;return a=function(e,t){if(e instanceof t)return e;var r=new t;return r.idBlock=e.idBlock,r.lenBlock=e.lenBlock,r.warnings=e.warnings,r.valueBeforeDecode=e.valueBeforeDecode.slice(0),r}(a,o),s=a.fromBER(e,t,!0===a.lenBlock.isIndefiniteForm?r:a.lenBlock.length),a.valueBeforeDecode=e.slice(n,n+a.blockLength),{offset:s,result:a}}function Cr(e){if(0===e.byteLength){var t=new Ct({},Object);return t.error="Input buffer has zero length",{offset:-1,result:t}}return Ar(e,0,e.byteLength)}function Br(e,t,r){if(r instanceof br){for(var n=0;n<r.value.length;n++){if(!0===Br(e,t,r.value[n]).verified)return{verified:!0,result:e}}var a={verified:!1,result:{error:"Wrong values for Choice type"}};return r.hasOwnProperty(qe)&&(a.name=r.name),a}if(r instanceof wr)return r.hasOwnProperty(qe)&&(e[r.name]=t),{verified:!0,result:e};if(e instanceof Object==!1)return{verified:!1,result:{error:"Wrong root object"}};if(t instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(r instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(et in r==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("fromBER"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("toBER"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};var i=r.idBlock.toBER(!1);if(0===i.byteLength)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(-1===r.idBlock.fromBER(i,0,i.byteLength))return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(!1===r.idBlock.hasOwnProperty(tt))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagClass!==t.idBlock.tagClass)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty(rt))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagNumber!==t.idBlock.tagNumber)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty(nt))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isConstructed!==t.idBlock.isConstructed)return{verified:!1,result:e};if($e in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isHexOnly!==t.idBlock.isHexOnly)return{verified:!1,result:e};if(!0===r.idBlock.isHexOnly){if(Ze in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};var s=new Uint8Array(r.idBlock.valueHex),o=new Uint8Array(t.idBlock.valueHex);if(s.length!==o.length)return{verified:!1,result:e};for(var u=0;u<s.length;u++)if(s[u]!==o[1])return{verified:!1,result:e}}if(r.hasOwnProperty(qe)&&(r.name=r.name.replace(/^\s+|\s+$/g,yt),""!==r.name&&(e[r.name]=t)),!0===r.idBlock.isConstructed){var l=0,c={verified:!1},h=r.valueBlock.value.length;if(h>0&&r.valueBlock.value[0]instanceof Sr&&(h=t.valueBlock.value.length),0===h)return{verified:!0,result:e};if(0===t.valueBlock.value.length&&0!==r.valueBlock.value.length){for(var f=!0,m=0;m<r.valueBlock.value.length;m++)f=f&&(r.valueBlock.value[m].optional||!1);return!0===f?{verified:!0,result:e}:(r.hasOwnProperty(qe)&&(r.name=r.name.replace(/^\s+|\s+$/g,yt),""!==r.name&&delete e[r.name]),e.error="Inconsistent object length",{verified:!1,result:e})}for(var v=0;v<h;v++)if(v-l>=t.valueBlock.value.length){if(!1===r.valueBlock.value[v].optional){var g={verified:!1,result:e};return e.error="Inconsistent length between ASN.1 data and schema",r.hasOwnProperty(qe)&&(r.name=r.name.replace(/^\s+|\s+$/g,yt),""!==r.name&&(delete e[r.name],g.name=r.name)),g}}else if(r.valueBlock.value[0]instanceof Sr){if(!1===(c=Br(e,t.valueBlock.value[v],r.valueBlock.value[0].value)).verified){if(!0!==r.valueBlock.value[0].optional)return r.hasOwnProperty(qe)&&(r.name=r.name.replace(/^\s+|\s+$/g,yt),""!==r.name&&delete e[r.name]),c;l++}if(qe in r.valueBlock.value[0]&&r.valueBlock.value[0].name.length>0){var d={};void 0===(d=ft in r.valueBlock.value[0]&&!0===r.valueBlock.value[0].local?t:e)[r.valueBlock.value[0].name]&&(d[r.valueBlock.value[0].name]=[]),d[r.valueBlock.value[0].name].push(t.valueBlock.value[v])}}else if(!1===(c=Br(e,t.valueBlock.value[v-l],r.valueBlock.value[v])).verified){if(!0!==r.valueBlock.value[v].optional)return r.hasOwnProperty(qe)&&(r.name=r.name.replace(/^\s+|\s+$/g,yt),""!==r.name&&delete e[r.name]),c;l++}if(!1===c.verified){var y={verified:!1,result:e};return r.hasOwnProperty(qe)&&(r.name=r.name.replace(/^\s+|\s+$/g,yt),""!==r.name&&(delete e[r.name],y.name=r.name)),y}return{verified:!0,result:e}}if(lt in r&&Ze in t.valueBlock){var p=Cr(t.valueBlock.valueHex);if(-1===p.offset){var k={verified:!1,result:p.result};return r.hasOwnProperty(qe)&&(r.name=r.name.replace(/^\s+|\s+$/g,yt),""!==r.name&&(delete e[r.name],k.name=r.name)),k}return Br(e,p.result,r.primitiveSchema)}return{verified:!0,result:e}}var xr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.algorithmId=Ne(t,"algorithmId",e.defaultValues("algorithmId")),"algorithmParams"in t&&(this.algorithmParams=Ne(t,"algorithmParams",e.defaultValues("algorithmParams"))),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["algorithm","params"]);var r=Br(t,t,e.schema({names:{algorithmIdentifier:"algorithm",algorithmParams:"params"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for AlgorithmIdentifier");this.algorithmId=r.result.algorithm.valueBlock.toString(),"params"in r.result&&(this.algorithmParams=r.result.params)}},{key:"toSchema",value:function(){var e=[];return e.push(new Jt({value:this.algorithmId})),"algorithmParams"in this&&this.algorithmParams instanceof wr==!1&&e.push(this.algorithmParams),new Ot({value:e})}},{key:"toJSON",value:function(){var e={algorithmId:this.algorithmId};return"algorithmParams"in this&&this.algorithmParams instanceof wr==!1&&(e.algorithmParams=this.algorithmParams.toJSON()),e}},{key:"isEqual",value:function(t){return t instanceof e!=!1&&(this.algorithmId===t.algorithmId&&("algorithmParams"in this?"algorithmParams"in t&&JSON.stringify(this.algorithmParams)===JSON.stringify(t.algorithmParams):!("algorithmParams"in t)))}}],[{key:"defaultValues",value:function(e){switch(e){case"algorithmId":return"";case"algorithmParams":return new wr;default:throw new Error("Invalid member name for AlgorithmIdentifier class: ".concat(e))}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"algorithmId":return""===t;case"algorithmParams":return t instanceof wr;default:throw new Error("Invalid member name for AlgorithmIdentifier class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",optional:t.optional||!1,value:[new Jt({name:t.algorithmIdentifier||""}),new wr({name:t.algorithmParams||"",optional:!0})]})}}]),e}(),Ir=function(){function e(){a(this,e)}return s(e,null,[{key:"register",value:function(e,t,r){this.namedCurves[e.toLowerCase()]=this.namedCurves[t]={name:e,id:t,size:r}}},{key:"find",value:function(e){return this.namedCurves[e.toLowerCase()]||null}}]),e}();Ir.namedCurves={},Ir.register("P-256","1.2.840.10045.3.1.7",32),Ir.register("P-384","1.3.132.0.34",48),Ir.register("P-521","1.3.132.0.35",66),Ir.register("brainpoolP256r1","1.3.36.3.3.2.8.1.1.7",32),Ir.register("brainpoolP384r1","1.3.36.3.3.2.8.1.1.11",48),Ir.register("brainpoolP512r1","1.3.36.3.3.2.8.1.1.13",64);var Er=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.x=Ne(t,"x",e.defaultValues("x")),this.y=Ne(t,"y",e.defaultValues("y")),this.namedCurve=Ne(t,"namedCurve",e.defaultValues("namedCurve")),"schema"in t&&this.fromSchema(t.schema),"json"in t&&this.fromJSON(t.json)}return s(e,[{key:"fromSchema",value:function(e){if(e instanceof ArrayBuffer==!1)throw new Error("Object's schema was not verified against input data for ECPublicKey");if(4!==new Uint8Array(e)[0])throw new Error("Object's schema was not verified against input data for ECPublicKey");var t=Ir.find(this.namedCurve);if(!t)throw new Error("Incorrect curve OID: ".concat(this.namedCurve));var r=t.size;if(e.byteLength!==2*r+1)throw new Error("Object's schema was not verified against input data for ECPublicKey");this.x=e.slice(1,r+1),this.y=e.slice(1+r,2*r+1)}},{key:"toSchema",value:function(){return new Nr({data:Ie(new Uint8Array([4]).buffer,this.x,this.y)})}},{key:"toJSON",value:function(){var e=Ir.find(this.namedCurve);return{crv:e?e.name:this.namedCurve,x:Te(Ve(this.x),!0,!0,!1),y:Te(Ve(this.y),!0,!0,!1)}}},{key:"fromJSON",value:function(e){var t=0;if(!("crv"in e))throw new Error('Absent mandatory parameter "crv"');var r=Ir.find(e.crv);if(r&&(this.namedCurve=r.id,t=r.size),!("x"in e))throw new Error('Absent mandatory parameter "x"');var n=_e(He(e.x,!0));if(n.byteLength<t){this.x=new ArrayBuffer(t);var a=new Uint8Array(this.x),i=new Uint8Array(n);a.set(i,1)}else this.x=n.slice(0,t);if(!("y"in e))throw new Error('Absent mandatory parameter "y"');var s=_e(He(e.y,!0));if(s.byteLength<t){this.y=new ArrayBuffer(t);var o=new Uint8Array(this.y),u=new Uint8Array(s);o.set(u,1)}else this.y=s.slice(0,t)}}],[{key:"defaultValues",value:function(e){switch(e){case"x":case"y":return new ArrayBuffer(0);case"namedCurve":return"";default:throw new Error("Invalid member name for ECCPublicKey class: ".concat(e))}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"x":case"y":return Le(r,e.defaultValues(t));case"namedCurve":return""===r;default:throw new Error("Invalid member name for ECCPublicKey class: ".concat(t))}}},{key:"schema",value:function(){return new Nr}}]),e}(),Pr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.modulus=Ne(t,"modulus",e.defaultValues("modulus")),this.publicExponent=Ne(t,"publicExponent",e.defaultValues("publicExponent")),"schema"in t&&this.fromSchema(t.schema),"json"in t&&this.fromJSON(t.json)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["modulus","publicExponent"]);var r=Br(t,t,e.schema({names:{modulus:"modulus",publicExponent:"publicExponent"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for RSAPublicKey");this.modulus=r.result.modulus.convertFromDER(256),this.publicExponent=r.result.publicExponent}},{key:"toSchema",value:function(){return new Ot({value:[this.modulus.convertToDER(),this.publicExponent]})}},{key:"toJSON",value:function(){return{n:Te(Ve(this.modulus.valueBlock.valueHex),!0,!0,!0),e:Te(Ve(this.publicExponent.valueBlock.valueHex),!0,!0,!0)}}},{key:"fromJSON",value:function(e){if(!("n"in e))throw new Error('Absent mandatory parameter "n"');var t,r,n,a,i=_e(He(e.n,!0));if(this.modulus=new Kt({valueHex:i.slice(0,Math.pow(2,(t=i.byteLength,r=Math.log(t)/je,n=Math.floor(r),a=Math.round(r),n===a?n:a)))}),!("e"in e))throw new Error('Absent mandatory parameter "e"');this.publicExponent=new Kt({valueHex:_e(He(e.e,!0)).slice(0,3)})}}],[{key:"defaultValues",value:function(e){switch(e){case"modulus":case"publicExponent":return new Kt;default:throw new Error("Invalid member name for RSAPublicKey class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Kt({name:t.modulus||""}),new Kt({name:t.publicExponent||""})]})}}]),e}(),Rr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.algorithm=Ne(t,"algorithm",e.defaultValues("algorithm")),this.subjectPublicKey=Ne(t,"subjectPublicKey",e.defaultValues("subjectPublicKey")),"parsedKey"in t&&(this.parsedKey=Ne(t,"parsedKey",e.defaultValues("parsedKey"))),"schema"in t&&this.fromSchema(t.schema),"json"in t&&this.fromJSON(t.json)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["algorithm","subjectPublicKey"]);var r=Br(t,t,e.schema({names:{algorithm:{names:{blockName:"algorithm"}},subjectPublicKey:"subjectPublicKey"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PublicKeyInfo");switch(this.algorithm=new xr({schema:r.result.algorithm}),this.subjectPublicKey=r.result.subjectPublicKey,this.algorithm.algorithmId){case"1.2.840.10045.2.1":if("algorithmParams"in this.algorithm&&this.algorithm.algorithmParams.constructor.blockName()===Jt.blockName())try{this.parsedKey=new Er({namedCurve:this.algorithm.algorithmParams.valueBlock.toString(),schema:this.subjectPublicKey.valueBlock.valueHex})}catch(e){}break;case"1.2.840.113549.1.1.1":var n=Cr(this.subjectPublicKey.valueBlock.valueHex);if(-1!==n.offset)try{this.parsedKey=new Pr({schema:n.result})}catch(e){}}}},{key:"toSchema",value:function(){return new Ot({value:[this.algorithm.toSchema(),this.subjectPublicKey]})}},{key:"toJSON",value:function(){if("parsedKey"in this==!1)return{algorithm:this.algorithm.toJSON(),subjectPublicKey:this.subjectPublicKey.toJSON()};var e={};switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA"}for(var t=this.parsedKey.toJSON(),r=0,n=Object.keys(t);r<n.length;r++){var a=n[r];e[a]=t[a]}return e}},{key:"fromJSON",value:function(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new Er({json:e}),this.algorithm=new xr({algorithmId:"1.2.840.10045.2.1",algorithmParams:new Jt({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new Pr({json:e}),this.algorithm=new xr({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new Tt});break;default:throw new Error('Invalid value for "kty" parameter: '.concat(e.kty))}this.subjectPublicKey=new jt({valueHex:this.parsedKey.toSchema().toBER(!1)})}}},{key:"importKey",value:function(e){var t=Promise.resolve(),r=this;if(void 0===e)return Promise.reject("Need to provide publicKey input parameter");var n=Jr();return void 0===n?Promise.reject("Unable to create WebCrypto object"):t=(t=t.then((function(){return n.exportKey("spki",e)}))).then((function(e){var t=Cr(e);try{r.fromSchema(t.result)}catch(e){return Promise.reject("Error during initializing object from schema")}}),(function(e){return Promise.reject("Error during exporting public key: ".concat(e))}))}}],[{key:"defaultValues",value:function(e){switch(e){case"algorithm":return new xr;case"subjectPublicKey":return new jt;default:throw new Error("Invalid member name for PublicKeyInfo class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[xr.schema(t.algorithm||{}),new jt({name:t.subjectPublicKey||""})]})}}]),e}(),Lr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.type=Ne(t,"type",e.defaultValues("type")),this.values=Ne(t,"values",e.defaultValues("values")),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["type","values"]);var r=Br(t,t,e.schema({names:{type:"type",values:"values"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for Attribute");this.type=r.result.type.valueBlock.toString(),this.values=r.result.values}},{key:"toSchema",value:function(){return new Ot({value:[new Jt({value:this.type}),new Dt({value:this.values})]})}},{key:"toJSON",value:function(){return{type:this.type,values:Array.from(this.values,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){switch(e){case"type":return"";case"values":return[];default:throw new Error("Invalid member name for Attribute class: ".concat(e))}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"type":return""===t;case"values":return 0===t.length;default:throw new Error("Invalid member name for Attribute class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Jt({name:t.type||""}),new Dt({name:t.setName||"",value:[new Sr({name:t.values||"",value:new wr})]})]})}}]),e}(),Ur=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.version=Ne(t,"version",e.defaultValues("version")),this.privateKey=Ne(t,"privateKey",e.defaultValues("privateKey")),"namedCurve"in t&&(this.namedCurve=Ne(t,"namedCurve",e.defaultValues("namedCurve"))),"publicKey"in t&&(this.publicKey=Ne(t,"publicKey",e.defaultValues("publicKey"))),"schema"in t&&this.fromSchema(t.schema),"json"in t&&this.fromJSON(t.json)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["version","privateKey","namedCurve","publicKey"]);var r=Br(t,t,e.schema({names:{version:"version",privateKey:"privateKey",namedCurve:"namedCurve",publicKey:"publicKey"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for ECPrivateKey");if(this.version=r.result.version.valueBlock.valueDec,this.privateKey=r.result.privateKey,"namedCurve"in r.result&&(this.namedCurve=r.result.namedCurve.valueBlock.toString()),"publicKey"in r.result){var n={schema:r.result.publicKey.valueBlock.valueHex};"namedCurve"in this&&(n.namedCurve=this.namedCurve),this.publicKey=new Er(n)}}},{key:"toSchema",value:function(){var e=[new Kt({value:this.version}),this.privateKey];return"namedCurve"in this&&e.push(new Et({idBlock:{tagClass:3,tagNumber:0},value:[new Jt({value:this.namedCurve})]})),"publicKey"in this&&e.push(new Et({idBlock:{tagClass:3,tagNumber:1},value:[new jt({valueHex:this.publicKey.toSchema().toBER(!1)})]})),new Ot({value:e})}},{key:"toJSON",value:function(){if("namedCurve"in this==!1||e.compareWithDefault("namedCurve",this.namedCurve))throw new Error('Not enough information for making JSON: absent "namedCurve" value');var t="";switch(this.namedCurve){case"1.2.840.10045.3.1.7":t="P-256";break;case"1.3.132.0.34":t="P-384";break;case"1.3.132.0.35":t="P-521"}var r={crv:t,d:Te(Ve(this.privateKey.valueBlock.valueHex),!0,!0,!1)};if("publicKey"in this){var n=this.publicKey.toJSON();r.x=n.x,r.y=n.y}return r}},{key:"fromJSON",value:function(e){var t=0;if(!("crv"in e))throw new Error('Absent mandatory parameter "crv"');switch(e.crv.toUpperCase()){case"P-256":this.namedCurve="1.2.840.10045.3.1.7",t=32;break;case"P-384":this.namedCurve="1.3.132.0.34",t=48;break;case"P-521":this.namedCurve="1.3.132.0.35",t=66}if(!("d"in e))throw new Error('Absent mandatory parameter "d"');var r=_e(He(e.d,!0));if(r.byteLength<t){var n=new ArrayBuffer(t),a=new Uint8Array(n),i=new Uint8Array(r);a.set(i,1),this.privateKey=new Vt({valueHex:n})}else this.privateKey=new Vt({valueHex:r.slice(0,t)});"x"in e&&"y"in e&&(this.publicKey=new Er({json:e}))}}],[{key:"defaultValues",value:function(e){switch(e){case"version":return 1;case"privateKey":return new Vt;case"namedCurve":return"";case"publicKey":return new Er;default:throw new Error("Invalid member name for ECCPrivateKey class: ".concat(e))}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"version":return r===e.defaultValues(t);case"privateKey":return r.isEqual(e.defaultValues(t));case"namedCurve":return""===r;case"publicKey":return Er.compareWithDefault("namedCurve",r.namedCurve)&&Er.compareWithDefault("x",r.x)&&Er.compareWithDefault("y",r.y);default:throw new Error("Invalid member name for ECCPrivateKey class: ".concat(t))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Kt({name:t.version||""}),new Vt({name:t.privateKey||""}),new Et({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Jt({name:t.namedCurve||""})]}),new Et({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new jt({name:t.publicKey||""})]})]})}}]),e}(),Or=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.prime=Ne(t,"prime",e.defaultValues("prime")),this.exponent=Ne(t,"exponent",e.defaultValues("exponent")),this.coefficient=Ne(t,"coefficient",e.defaultValues("coefficient")),"schema"in t&&this.fromSchema(t.schema),"json"in t&&this.fromJSON(t.json)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["prime","exponent","coefficient"]);var r=Br(t,t,e.schema({names:{prime:"prime",exponent:"exponent",coefficient:"coefficient"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for OtherPrimeInfo");this.prime=r.result.prime.convertFromDER(),this.exponent=r.result.exponent.convertFromDER(),this.coefficient=r.result.coefficient.convertFromDER()}},{key:"toSchema",value:function(){return new Ot({value:[this.prime.convertToDER(),this.exponent.convertToDER(),this.coefficient.convertToDER()]})}},{key:"toJSON",value:function(){return{r:Te(Ve(this.prime.valueBlock.valueHex),!0,!0),d:Te(Ve(this.exponent.valueBlock.valueHex),!0,!0),t:Te(Ve(this.coefficient.valueBlock.valueHex),!0,!0)}}},{key:"fromJSON",value:function(e){if(!("r"in e))throw new Error('Absent mandatory parameter "r"');if(this.prime=new Kt({valueHex:_e(He(e.r,!0))}),!("d"in e))throw new Error('Absent mandatory parameter "d"');if(this.exponent=new Kt({valueHex:_e(He(e.d,!0))}),!("t"in e))throw new Error('Absent mandatory parameter "t"');this.coefficient=new Kt({valueHex:_e(He(e.t,!0))})}}],[{key:"defaultValues",value:function(e){switch(e){case"prime":case"exponent":case"coefficient":return new Kt;default:throw new Error("Invalid member name for OtherPrimeInfo class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Kt({name:t.prime||""}),new Kt({name:t.exponent||""}),new Kt({name:t.coefficient||""})]})}}]),e}(),Dr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.version=Ne(t,"version",e.defaultValues("version")),this.modulus=Ne(t,"modulus",e.defaultValues("modulus")),this.publicExponent=Ne(t,"publicExponent",e.defaultValues("publicExponent")),this.privateExponent=Ne(t,"privateExponent",e.defaultValues("privateExponent")),this.prime1=Ne(t,"prime1",e.defaultValues("prime1")),this.prime2=Ne(t,"prime2",e.defaultValues("prime2")),this.exponent1=Ne(t,"exponent1",e.defaultValues("exponent1")),this.exponent2=Ne(t,"exponent2",e.defaultValues("exponent2")),this.coefficient=Ne(t,"coefficient",e.defaultValues("coefficient")),"otherPrimeInfos"in t&&(this.otherPrimeInfos=Ne(t,"otherPrimeInfos",e.defaultValues("otherPrimeInfos"))),"schema"in t&&this.fromSchema(t.schema),"json"in t&&this.fromJSON(t.json)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["version","modulus","publicExponent","privateExponent","prime1","prime2","exponent1","exponent2","coefficient","otherPrimeInfos"]);var r=Br(t,t,e.schema({names:{version:"version",modulus:"modulus",publicExponent:"publicExponent",privateExponent:"privateExponent",prime1:"prime1",prime2:"prime2",exponent1:"exponent1",exponent2:"exponent2",coefficient:"coefficient",otherPrimeInfo:{names:{blockName:"otherPrimeInfos"}}}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for RSAPrivateKey");this.version=r.result.version.valueBlock.valueDec,this.modulus=r.result.modulus.convertFromDER(256),this.publicExponent=r.result.publicExponent,this.privateExponent=r.result.privateExponent.convertFromDER(256),this.prime1=r.result.prime1.convertFromDER(128),this.prime2=r.result.prime2.convertFromDER(128),this.exponent1=r.result.exponent1.convertFromDER(128),this.exponent2=r.result.exponent2.convertFromDER(128),this.coefficient=r.result.coefficient.convertFromDER(128),"otherPrimeInfos"in r.result&&(this.otherPrimeInfos=Array.from(r.result.otherPrimeInfos,(function(e){return new Or({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(new Kt({value:this.version})),e.push(this.modulus.convertToDER()),e.push(this.publicExponent),e.push(this.privateExponent.convertToDER()),e.push(this.prime1.convertToDER()),e.push(this.prime2.convertToDER()),e.push(this.exponent1.convertToDER()),e.push(this.exponent2.convertToDER()),e.push(this.coefficient.convertToDER()),"otherPrimeInfos"in this&&e.push(new Ot({value:Array.from(this.otherPrimeInfos,(function(e){return e.toSchema()}))})),new Ot({value:e})}},{key:"toJSON",value:function(){var e={n:Te(Ve(this.modulus.valueBlock.valueHex),!0,!0,!0),e:Te(Ve(this.publicExponent.valueBlock.valueHex),!0,!0,!0),d:Te(Ve(this.privateExponent.valueBlock.valueHex),!0,!0,!0),p:Te(Ve(this.prime1.valueBlock.valueHex),!0,!0,!0),q:Te(Ve(this.prime2.valueBlock.valueHex),!0,!0,!0),dp:Te(Ve(this.exponent1.valueBlock.valueHex),!0,!0,!0),dq:Te(Ve(this.exponent2.valueBlock.valueHex),!0,!0,!0),qi:Te(Ve(this.coefficient.valueBlock.valueHex),!0,!0,!0)};return"otherPrimeInfos"in this&&(e.oth=Array.from(this.otherPrimeInfos,(function(e){return e.toJSON()}))),e}},{key:"fromJSON",value:function(e){if(!("n"in e))throw new Error('Absent mandatory parameter "n"');if(this.modulus=new Kt({valueHex:_e(He(e.n,!0,!0))}),!("e"in e))throw new Error('Absent mandatory parameter "e"');if(this.publicExponent=new Kt({valueHex:_e(He(e.e,!0,!0))}),!("d"in e))throw new Error('Absent mandatory parameter "d"');if(this.privateExponent=new Kt({valueHex:_e(He(e.d,!0,!0))}),!("p"in e))throw new Error('Absent mandatory parameter "p"');if(this.prime1=new Kt({valueHex:_e(He(e.p,!0,!0))}),!("q"in e))throw new Error('Absent mandatory parameter "q"');if(this.prime2=new Kt({valueHex:_e(He(e.q,!0,!0))}),!("dp"in e))throw new Error('Absent mandatory parameter "dp"');if(this.exponent1=new Kt({valueHex:_e(He(e.dp,!0,!0))}),!("dq"in e))throw new Error('Absent mandatory parameter "dq"');if(this.exponent2=new Kt({valueHex:_e(He(e.dq,!0,!0))}),!("qi"in e))throw new Error('Absent mandatory parameter "qi"');this.coefficient=new Kt({valueHex:_e(He(e.qi,!0,!0))}),"oth"in e&&(this.otherPrimeInfos=Array.from(e.oth,(function(e){return new Or({json:e})})))}}],[{key:"defaultValues",value:function(e){switch(e){case"version":return 0;case"modulus":case"publicExponent":case"privateExponent":case"prime1":case"prime2":case"exponent1":case"exponent2":case"coefficient":return new Kt;case"otherPrimeInfos":return[];default:throw new Error("Invalid member name for RSAPrivateKey class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Kt({name:t.version||""}),new Kt({name:t.modulus||""}),new Kt({name:t.publicExponent||""}),new Kt({name:t.privateExponent||""}),new Kt({name:t.prime1||""}),new Kt({name:t.prime2||""}),new Kt({name:t.exponent1||""}),new Kt({name:t.exponent2||""}),new Kt({name:t.coefficient||""}),new Ot({optional:!0,value:[new Sr({name:t.otherPrimeInfosName||"",value:Or.schema(t.otherPrimeInfo||{})})]})]})}}]),e}(),Tr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.version=Ne(t,"version",e.defaultValues("version")),this.privateKeyAlgorithm=Ne(t,"privateKeyAlgorithm",e.defaultValues("privateKeyAlgorithm")),this.privateKey=Ne(t,"privateKey",e.defaultValues("privateKey")),"attributes"in t&&(this.attributes=Ne(t,"attributes",e.defaultValues("attributes"))),"parsedKey"in t&&(this.parsedKey=Ne(t,"parsedKey",e.defaultValues("parsedKey"))),"schema"in t&&this.fromSchema(t.schema),"json"in t&&this.fromJSON(t.json)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["version","privateKeyAlgorithm","privateKey","attributes"]);var r=Br(t,t,e.schema({names:{version:"version",privateKeyAlgorithm:{names:{blockName:"privateKeyAlgorithm"}},privateKey:"privateKey",attributes:"attributes"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PrivateKeyInfo");switch(this.version=r.result.version.valueBlock.valueDec,this.privateKeyAlgorithm=new xr({schema:r.result.privateKeyAlgorithm}),this.privateKey=r.result.privateKey,"attributes"in r.result&&(this.attributes=Array.from(r.result.attributes,(function(e){return new Lr({schema:e})}))),this.privateKeyAlgorithm.algorithmId){case"1.2.840.113549.1.1.1":var n=Cr(this.privateKey.valueBlock.valueHex);-1!==n.offset&&(this.parsedKey=new Dr({schema:n.result}));break;case"1.2.840.10045.2.1":if("algorithmParams"in this.privateKeyAlgorithm&&this.privateKeyAlgorithm.algorithmParams instanceof Jt){var a=Cr(this.privateKey.valueBlock.valueHex);-1!==a.offset&&(this.parsedKey=new Ur({namedCurve:this.privateKeyAlgorithm.algorithmParams.valueBlock.toString(),schema:a.result}))}}}},{key:"toSchema",value:function(){var e=[new Kt({value:this.version}),this.privateKeyAlgorithm.toSchema(),this.privateKey];return"attributes"in this&&e.push(new Et({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes,(function(e){return e.toSchema()}))})),new Ot({value:e})}},{key:"toJSON",value:function(){if("parsedKey"in this==!1){var e={version:this.version,privateKeyAlgorithm:this.privateKeyAlgorithm.toJSON(),privateKey:this.privateKey.toJSON()};return"attributes"in this&&(e.attributes=Array.from(this.attributes,(function(e){return e.toJSON()}))),e}var t={};switch(this.privateKeyAlgorithm.algorithmId){case"1.2.840.10045.2.1":t.kty="EC";break;case"1.2.840.113549.1.1.1":t.kty="RSA"}for(var r=this.parsedKey.toJSON(),n=0,a=Object.keys(r);n<a.length;n++){var i=a[n];t[i]=r[i]}return t}},{key:"fromJSON",value:function(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new Ur({json:e}),this.privateKeyAlgorithm=new xr({algorithmId:"1.2.840.10045.2.1",algorithmParams:new Jt({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new Dr({json:e}),this.privateKeyAlgorithm=new xr({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new Tt});break;default:throw new Error('Invalid value for "kty" parameter: '.concat(e.kty))}this.privateKey=new Vt({valueHex:this.parsedKey.toSchema().toBER(!1)})}}}],[{key:"defaultValues",value:function(e){switch(e){case"version":return 0;case"privateKeyAlgorithm":return new xr;case"privateKey":return new Vt;case"attributes":return[];case"parsedKey":return{};default:throw new Error("Invalid member name for PrivateKeyInfo class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Kt({name:t.version||""}),xr.schema(t.privateKeyAlgorithm||{}),new Vt({name:t.privateKey||""}),new Et({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Sr({name:t.attributes||"",value:Lr.schema()})]})]})}}]),e}(),Hr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(a(this,e),this.contentType=Ne(t,"contentType",e.defaultValues("contentType")),this.contentEncryptionAlgorithm=Ne(t,"contentEncryptionAlgorithm",e.defaultValues("contentEncryptionAlgorithm")),"encryptedContent"in t&&(this.encryptedContent=t.encryptedContent,1===this.encryptedContent.idBlock.tagClass&&4===this.encryptedContent.idBlock.tagNumber&&!1===this.encryptedContent.idBlock.isConstructed)){for(var r=new Vt({idBlock:{isConstructed:!0},isConstructed:!0}),n=0,i=this.encryptedContent.valueBlock.valueHex.byteLength;i>0;){for(var s=new Uint8Array(this.encryptedContent.valueBlock.valueHex,n,n+1024>this.encryptedContent.valueBlock.valueHex.byteLength?this.encryptedContent.valueBlock.valueHex.byteLength-n:1024),o=new ArrayBuffer(s.length),u=new Uint8Array(o),l=0;l<u.length;l++)u[l]=s[l];r.valueBlock.value.push(new Vt({valueHex:o})),i-=s.length,n+=s.length}this.encryptedContent=r}"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["contentType","contentEncryptionAlgorithm","encryptedContent"]);var r=Br(t,t,e.schema({names:{contentType:"contentType",contentEncryptionAlgorithm:{names:{blockName:"contentEncryptionAlgorithm"}},encryptedContent:"encryptedContent"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for EncryptedContentInfo");this.contentType=r.result.contentType.valueBlock.toString(),this.contentEncryptionAlgorithm=new xr({schema:r.result.contentEncryptionAlgorithm}),"encryptedContent"in r.result&&(this.encryptedContent=r.result.encryptedContent,this.encryptedContent.idBlock.tagClass=1,this.encryptedContent.idBlock.tagNumber=4)}},{key:"toSchema",value:function(){var e={isIndefiniteForm:!1},t=[];if(t.push(new Jt({value:this.contentType})),t.push(this.contentEncryptionAlgorithm.toSchema()),"encryptedContent"in this){e.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed;var r=this.encryptedContent;r.idBlock.tagClass=3,r.idBlock.tagNumber=0,r.lenBlock.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed,t.push(r)}return new Ot({lenBlock:e,value:t})}},{key:"toJSON",value:function(){var e={contentType:this.contentType,contentEncryptionAlgorithm:this.contentEncryptionAlgorithm.toJSON()};return"encryptedContent"in this&&(e.encryptedContent=this.encryptedContent.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case"contentType":return"";case"contentEncryptionAlgorithm":return new xr;case"encryptedContent":return new Vt;default:throw new Error("Invalid member name for EncryptedContentInfo class: ".concat(e))}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"contentType":return""===r;case"contentEncryptionAlgorithm":return""===r.algorithmId&&"algorithmParams"in r==!1;case"encryptedContent":return r.isEqual(e.defaultValues(t));default:throw new Error("Invalid member name for EncryptedContentInfo class: ".concat(t))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Jt({name:t.contentType||""}),xr.schema(t.contentEncryptionAlgorithm||{}),new br({value:[new Et({name:t.encryptedContent||"",idBlock:{tagClass:3,tagNumber:0},value:[new Sr({value:new Vt})]}),new xt({name:t.encryptedContent||"",idBlock:{tagClass:3,tagNumber:0}})]})]})}}]),e}(),Vr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.hashAlgorithm=Ne(t,"hashAlgorithm",e.defaultValues("hashAlgorithm")),this.maskGenAlgorithm=Ne(t,"maskGenAlgorithm",e.defaultValues("maskGenAlgorithm")),this.saltLength=Ne(t,"saltLength",e.defaultValues("saltLength")),this.trailerField=Ne(t,"trailerField",e.defaultValues("trailerField")),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["hashAlgorithm","maskGenAlgorithm","saltLength","trailerField"]);var r=Br(t,t,e.schema({names:{hashAlgorithm:{names:{blockName:"hashAlgorithm"}},maskGenAlgorithm:{names:{blockName:"maskGenAlgorithm"}},saltLength:"saltLength",trailerField:"trailerField"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for RSASSAPSSParams");"hashAlgorithm"in r.result&&(this.hashAlgorithm=new xr({schema:r.result.hashAlgorithm})),"maskGenAlgorithm"in r.result&&(this.maskGenAlgorithm=new xr({schema:r.result.maskGenAlgorithm})),"saltLength"in r.result&&(this.saltLength=r.result.saltLength.valueBlock.valueDec),"trailerField"in r.result&&(this.trailerField=r.result.trailerField.valueBlock.valueDec)}},{key:"toSchema",value:function(){var t=[];return this.hashAlgorithm.isEqual(e.defaultValues("hashAlgorithm"))||t.push(new Et({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(e.defaultValues("maskGenAlgorithm"))||t.push(new Et({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.saltLength!==e.defaultValues("saltLength")&&t.push(new Et({idBlock:{tagClass:3,tagNumber:2},value:[new Kt({value:this.saltLength})]})),this.trailerField!==e.defaultValues("trailerField")&&t.push(new Et({idBlock:{tagClass:3,tagNumber:3},value:[new Kt({value:this.trailerField})]})),new Ot({value:t})}},{key:"toJSON",value:function(){var t={};return this.hashAlgorithm.isEqual(e.defaultValues("hashAlgorithm"))||(t.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(e.defaultValues("maskGenAlgorithm"))||(t.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.saltLength!==e.defaultValues("saltLength")&&(t.saltLength=this.saltLength),this.trailerField!==e.defaultValues("trailerField")&&(t.trailerField=this.trailerField),t}}],[{key:"defaultValues",value:function(e){switch(e){case"hashAlgorithm":return new xr({algorithmId:"1.3.14.3.2.26",algorithmParams:new Tt});case"maskGenAlgorithm":return new xr({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new xr({algorithmId:"1.3.14.3.2.26",algorithmParams:new Tt}).toSchema()});case"saltLength":return 20;case"trailerField":return 1;default:throw new Error("Invalid member name for RSASSAPSSParams class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Et({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[xr.schema(t.hashAlgorithm||{})]}),new Et({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[xr.schema(t.maskGenAlgorithm||{})]}),new Et({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[new Kt({name:t.saltLength||""})]}),new Et({idBlock:{tagClass:3,tagNumber:3},optional:!0,value:[new Kt({name:t.trailerField||""})]})]})}}]),e}(),_r=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.salt=Ne(t,"salt",e.defaultValues("salt")),this.iterationCount=Ne(t,"iterationCount",e.defaultValues("iterationCount")),"keyLength"in t&&(this.keyLength=Ne(t,"keyLength",e.defaultValues("keyLength"))),"prf"in t&&(this.prf=Ne(t,"prf",e.defaultValues("prf"))),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["salt","iterationCount","keyLength","prf"]);var r=Br(t,t,e.schema({names:{saltPrimitive:"salt",saltConstructed:{names:{blockName:"salt"}},iterationCount:"iterationCount",keyLength:"keyLength",prf:{names:{blockName:"prf",optional:!0}}}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PBKDF2Params");this.salt=r.result.salt,this.iterationCount=r.result.iterationCount.valueBlock.valueDec,"keyLength"in r.result&&(this.keyLength=r.result.keyLength.valueBlock.valueDec),"prf"in r.result&&(this.prf=new xr({schema:r.result.prf}))}},{key:"toSchema",value:function(){var t=[];return t.push(this.salt),t.push(new Kt({value:this.iterationCount})),"keyLength"in this&&e.defaultValues("keyLength")!==this.keyLength&&t.push(new Kt({value:this.keyLength})),"prf"in this&&!1===e.defaultValues("prf").isEqual(this.prf)&&t.push(this.prf.toSchema()),new Ot({value:t})}},{key:"toJSON",value:function(){var t={salt:this.salt.toJSON(),iterationCount:this.iterationCount};return"keyLength"in this&&e.defaultValues("keyLength")!==this.keyLength&&(t.keyLength=this.keyLength),"prf"in this&&!1===e.defaultValues("prf").isEqual(this.prf)&&(t.prf=this.prf.toJSON()),t}}],[{key:"defaultValues",value:function(e){switch(e){case"salt":return{};case"iterationCount":return-1;case"keyLength":return 0;case"prf":return new xr({algorithmId:"1.3.14.3.2.26",algorithmParams:new Tt});default:throw new Error("Invalid member name for PBKDF2Params class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new br({value:[new Vt({name:t.saltPrimitive||""}),xr.schema(t.saltConstructed||{})]}),new Kt({name:t.iterationCount||""}),new Kt({name:t.keyLength||"",optional:!0}),xr.schema(t.prf||{names:{optional:!0}})]})}}]),e}(),jr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.keyDerivationFunc=Ne(t,"keyDerivationFunc",e.defaultValues("keyDerivationFunc")),this.encryptionScheme=Ne(t,"encryptionScheme",e.defaultValues("encryptionScheme")),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["keyDerivationFunc","encryptionScheme"]);var r=Br(t,t,e.schema({names:{keyDerivationFunc:{names:{blockName:"keyDerivationFunc"}},encryptionScheme:{names:{blockName:"encryptionScheme"}}}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PBES2Params");this.keyDerivationFunc=new xr({schema:r.result.keyDerivationFunc}),this.encryptionScheme=new xr({schema:r.result.encryptionScheme})}},{key:"toSchema",value:function(){return new Ot({value:[this.keyDerivationFunc.toSchema(),this.encryptionScheme.toSchema()]})}},{key:"toJSON",value:function(){return{keyDerivationFunc:this.keyDerivationFunc.toJSON(),encryptionScheme:this.encryptionScheme.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case"keyDerivationFunc":case"encryptionScheme":return new xr;default:throw new Error("Invalid member name for PBES2Params class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[xr.schema(t.keyDerivationFunc||{}),xr.schema(t.encryptionScheme||{})]})}}]),e}();function Mr(e,t,r,n,a,i){var s,o,u=[];switch(t.toUpperCase()){case"SHA-1":s=20,o=64;break;case"SHA-256":s=32,o=64;break;case"SHA-384":s=48,o=128;break;case"SHA-512":s=64,o=128;break;default:throw new Error("Unsupported hashing algorithm")}for(var l=new Uint8Array(n),c=new ArrayBuffer(2*n.byteLength+2),h=new Uint8Array(c),f=0;f<l.length;f++)h[2*f]=0,h[2*f+1]=l[f];h[h.length-2]=0,h[h.length-1]=0,n=c.slice(0);for(var m=new ArrayBuffer(o),v=new Uint8Array(m),d=0;d<m.byteLength;d++)v[d]=3;for(var y=a.byteLength,p=o*Math.ceil(y/o),k=new ArrayBuffer(p),b=new Uint8Array(k),w=new Uint8Array(a),S=0;S<p;S++)b[S]=w[S%y];for(var N=n.byteLength,A=o*Math.ceil(N/o),C=new ArrayBuffer(A),B=new Uint8Array(C),x=new Uint8Array(n),I=0;I<A;I++)B[I]=x[I%N];var E=k.byteLength+C.byteLength,P=new ArrayBuffer(E),R=new Uint8Array(P);R.set(b),R.set(B,b.length);for(var L=Math.ceil((r>>3)/s),U=Promise.resolve(P),O=0;O<=L;O++){U=U.then((function(e){var t=new ArrayBuffer(m.byteLength+e.byteLength),r=new Uint8Array(t);return r.set(v),r.set(R,v.length),t}));for(var D=0;D<i;D++)U=U.then((function(r){return e.digest({name:t},new Uint8Array(r))}));U=U.then((function(e){for(var t=new ArrayBuffer(o),r=new Uint8Array(t),n=0;n<t.byteLength;n++)r[n]=e[n%e.length];for(var a=Math.ceil(y/o)+Math.ceil(N/o),i=[],s=0,l=o,c=0;c<a;c++){var h=Array.from(new Uint8Array(P.slice(s,s+l)));(s+=o)+o>P.byteLength&&(l=P.byteLength-s);for(var f=511,m=t.byteLength-1;m>=0;m--)f>>=8,f+=r[m]+h[m],h[m]=255&f;i.push.apply(i,g(h))}return P=new ArrayBuffer(i.length),(R=new Uint8Array(P)).set(i),u.push.apply(u,g(new Uint8Array(e))),P}))}return U=U.then((function(){var e=new ArrayBuffer(r>>3);return new Uint8Array(e).set(new Uint8Array(u).slice(0,r>>3)),e}))}var Kr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.crypto=Ne(t,"crypto",{}),this.subtle=Ne(t,"subtle",{}),this.name=Ne(t,"name","")}return s(e,[{key:"importKey",value:function(e,t,r,n,a){var i=this,s={};switch(t instanceof Uint8Array&&(t=t.buffer),e.toLowerCase()){case"raw":return this.subtle.importKey("raw",t,r,n,a);case"spki":var o=Cr(t);if(-1===o.offset)return Promise.reject("Incorrect keyData");var u=new Rr;try{u.fromSchema(o.result)}catch(e){return Promise.reject("Incorrect keyData")}switch(r.name.toUpperCase()){case"RSA-PSS":switch(r.hash.name.toUpperCase()){case"SHA-1":s.alg="PS1";break;case"SHA-256":s.alg="PS256";break;case"SHA-384":s.alg="PS384";break;case"SHA-512":s.alg="PS512";break;default:return Promise.reject("Incorrect hash algorithm: ".concat(r.hash.name.toUpperCase()))}case"RSASSA-PKCS1-V1_5":if(a=["verify"],s.kty="RSA",s.ext=n,s.key_ops=a,"1.2.840.113549.1.1.1"!==u.algorithm.algorithmId)return Promise.reject("Incorrect public key algorithm: ".concat(u.algorithm.algorithmId));if("alg"in s==!1)switch(r.hash.name.toUpperCase()){case"SHA-1":s.alg="RS1";break;case"SHA-256":s.alg="RS256";break;case"SHA-384":s.alg="RS384";break;case"SHA-512":s.alg="RS512";break;default:return Promise.reject("Incorrect hash algorithm: ".concat(r.hash.name.toUpperCase()))}for(var l=u.toJSON(),c=0,h=Object.keys(l);c<h.length;c++){var f=h[c];s[f]=l[f]}break;case"ECDSA":a=["verify"];case"ECDH":if(s={kty:"EC",ext:n,key_ops:a},"1.2.840.10045.2.1"!==u.algorithm.algorithmId)return Promise.reject("Incorrect public key algorithm: ".concat(u.algorithm.algorithmId));for(var m=u.toJSON(),v=0,g=Object.keys(m);v<g.length;v++){var d=g[v];s[d]=m[d]}break;case"RSA-OAEP":if(s.kty="RSA",s.ext=n,s.key_ops=a,"safari"===this.name.toLowerCase())s.alg="RSA-OAEP";else switch(r.hash.name.toUpperCase()){case"SHA-1":s.alg="RSA-OAEP";break;case"SHA-256":s.alg="RSA-OAEP-256";break;case"SHA-384":s.alg="RSA-OAEP-384";break;case"SHA-512":s.alg="RSA-OAEP-512";break;default:return Promise.reject("Incorrect hash algorithm: ".concat(r.hash.name.toUpperCase()))}for(var y=u.toJSON(),p=0,k=Object.keys(y);p<k.length;p++){var b=k[p];s[b]=y[b]}break;case"RSAES-PKCS1-V1_5":s.kty="RSA",s.ext=n,s.key_ops=a,s.alg="PS1";for(var w=u.toJSON(),S=0,N=Object.keys(w);S<N.length;S++){var A=N[S];s[A]=w[A]}break;default:return Promise.reject("Incorrect algorithm name: ".concat(r.name.toUpperCase()))}break;case"pkcs8":var C=new Tr,B=Cr(t);if(-1===B.offset)return Promise.reject("Incorrect keyData");try{C.fromSchema(B.result)}catch(e){return Promise.reject("Incorrect keyData")}if("parsedKey"in C==!1)return Promise.reject("Incorrect keyData");switch(r.name.toUpperCase()){case"RSA-PSS":switch(r.hash.name.toUpperCase()){case"SHA-1":s.alg="PS1";break;case"SHA-256":s.alg="PS256";break;case"SHA-384":s.alg="PS384";break;case"SHA-512":s.alg="PS512";break;default:return Promise.reject("Incorrect hash algorithm: ".concat(r.hash.name.toUpperCase()))}case"RSASSA-PKCS1-V1_5":if(a=["sign"],s.kty="RSA",s.ext=n,s.key_ops=a,"1.2.840.113549.1.1.1"!==C.privateKeyAlgorithm.algorithmId)return Promise.reject("Incorrect private key algorithm: ".concat(C.privateKeyAlgorithm.algorithmId));if("alg"in s==!1)switch(r.hash.name.toUpperCase()){case"SHA-1":s.alg="RS1";break;case"SHA-256":s.alg="RS256";break;case"SHA-384":s.alg="RS384";break;case"SHA-512":s.alg="RS512";break;default:return Promise.reject("Incorrect hash algorithm: ".concat(r.hash.name.toUpperCase()))}for(var x=C.toJSON(),I=0,E=Object.keys(x);I<E.length;I++){var P=E[I];s[P]=x[P]}break;case"ECDSA":a=["sign"];case"ECDH":if(s={kty:"EC",ext:n,key_ops:a},"1.2.840.10045.2.1"!==C.privateKeyAlgorithm.algorithmId)return Promise.reject("Incorrect algorithm: ".concat(C.privateKeyAlgorithm.algorithmId));for(var R=C.toJSON(),L=0,U=Object.keys(R);L<U.length;L++){var O=U[L];s[O]=R[O]}break;case"RSA-OAEP":if(s.kty="RSA",s.ext=n,s.key_ops=a,"safari"===this.name.toLowerCase())s.alg="RSA-OAEP";else switch(r.hash.name.toUpperCase()){case"SHA-1":s.alg="RSA-OAEP";break;case"SHA-256":s.alg="RSA-OAEP-256";break;case"SHA-384":s.alg="RSA-OAEP-384";break;case"SHA-512":s.alg="RSA-OAEP-512";break;default:return Promise.reject("Incorrect hash algorithm: ".concat(r.hash.name.toUpperCase()))}for(var D=C.toJSON(),T=0,H=Object.keys(D);T<H.length;T++){var V=H[T];s[V]=D[V]}break;case"RSAES-PKCS1-V1_5":a=["decrypt"],s.kty="RSA",s.ext=n,s.key_ops=a,s.alg="PS1";for(var _=C.toJSON(),j=0,M=Object.keys(_);j<M.length;j++){var K=M[j];s[K]=_[K]}break;default:return Promise.reject("Incorrect algorithm name: ".concat(r.name.toUpperCase()))}break;case"jwk":s=t;break;default:return Promise.reject("Incorrect format: ".concat(e))}return"safari"===this.name.toLowerCase()?Promise.resolve().then((function(){return i.subtle.importKey("jwk",_e(JSON.stringify(s)),r,n,a)})).then((function(e){return e}),(function(){return i.subtle.importKey("jwk",s,r,n,a)})):this.subtle.importKey("jwk",s,r,n,a)}},{key:"exportKey",value:function(e,t){var r=this.subtle.exportKey("jwk",t);switch("safari"===this.name.toLowerCase()&&(r=r.then((function(e){return e instanceof ArrayBuffer?JSON.parse(Ve(e)):e}))),e.toLowerCase()){case"raw":return this.subtle.exportKey("raw",t);case"spki":r=r.then((function(e){var t=new Rr;try{t.fromJSON(e)}catch(e){return Promise.reject("Incorrect key data")}return t.toSchema().toBER(!1)}));break;case"pkcs8":r=r.then((function(e){var t=new Tr;try{t.fromJSON(e)}catch(e){return Promise.reject("Incorrect key data")}return t.toSchema().toBER(!1)}));break;case"jwk":break;default:return Promise.reject("Incorrect format: ".concat(e))}return r}},{key:"convert",value:function(e,t,r,n,a,i){var s=this;switch(e.toLowerCase()){case"raw":switch(t.toLowerCase()){case"raw":return Promise.resolve(r);case"spki":return Promise.resolve().then((function(){return s.importKey("raw",r,n,a,i)})).then((function(e){return s.exportKey("spki",e)}));case"pkcs8":return Promise.resolve().then((function(){return s.importKey("raw",r,n,a,i)})).then((function(e){return s.exportKey("pkcs8",e)}));case"jwk":return Promise.resolve().then((function(){return s.importKey("raw",r,n,a,i)})).then((function(e){return s.exportKey("jwk",e)}));default:return Promise.reject("Incorrect outputFormat: ".concat(t))}case"spki":switch(t.toLowerCase()){case"raw":return Promise.resolve().then((function(){return s.importKey("spki",r,n,a,i)})).then((function(e){return s.exportKey("raw",e)}));case"spki":return Promise.resolve(r);case"pkcs8":return Promise.reject("Impossible to convert between SPKI/PKCS8");case"jwk":return Promise.resolve().then((function(){return s.importKey("spki",r,n,a,i)})).then((function(e){return s.exportKey("jwk",e)}));default:return Promise.reject("Incorrect outputFormat: ".concat(t))}case"pkcs8":switch(t.toLowerCase()){case"raw":return Promise.resolve().then((function(){return s.importKey("pkcs8",r,n,a,i)})).then((function(e){return s.exportKey("raw",e)}));case"spki":return Promise.reject("Impossible to convert between SPKI/PKCS8");case"pkcs8":return Promise.resolve(r);case"jwk":return Promise.resolve().then((function(){return s.importKey("pkcs8",r,n,a,i)})).then((function(e){return s.exportKey("jwk",e)}));default:return Promise.reject("Incorrect outputFormat: ".concat(t))}case"jwk":switch(t.toLowerCase()){case"raw":return Promise.resolve().then((function(){return s.importKey("jwk",r,n,a,i)})).then((function(e){return s.exportKey("raw",e)}));case"spki":return Promise.resolve().then((function(){return s.importKey("jwk",r,n,a,i)})).then((function(e){return s.exportKey("spki",e)}));case"pkcs8":return Promise.resolve().then((function(){return s.importKey("jwk",r,n,a,i)})).then((function(e){return s.exportKey("pkcs8",e)}));case"jwk":return Promise.resolve(r);default:return Promise.reject("Incorrect outputFormat: ".concat(t))}default:return Promise.reject("Incorrect inputFormat: ".concat(e))}}},{key:"encrypt",value:function(){var e;return(e=this.subtle).encrypt.apply(e,arguments)}},{key:"decrypt",value:function(){var e;return(e=this.subtle).decrypt.apply(e,arguments)}},{key:"sign",value:function(){var e;return(e=this.subtle).sign.apply(e,arguments)}},{key:"verify",value:function(){var e;return(e=this.subtle).verify.apply(e,arguments)}},{key:"digest",value:function(){var e;return(e=this.subtle).digest.apply(e,arguments)}},{key:"generateKey",value:function(){var e;return(e=this.subtle).generateKey.apply(e,arguments)}},{key:"deriveKey",value:function(){var e;return(e=this.subtle).deriveKey.apply(e,arguments)}},{key:"deriveBits",value:function(){var e;return(e=this.subtle).deriveBits.apply(e,arguments)}},{key:"wrapKey",value:function(){var e;return(e=this.subtle).wrapKey.apply(e,arguments)}},{key:"unwrapKey",value:function(){var e;return(e=this.subtle).unwrapKey.apply(e,arguments)}},{key:"getRandomValues",value:function(e){if("getRandomValues"in this.crypto==!1)throw new Error("No support for getRandomValues");return this.crypto.getRandomValues(e)}},{key:"getAlgorithmByOID",value:function(e){switch(e){case"1.2.840.113549.1.1.1":return{name:"RSAES-PKCS1-v1_5"};case"1.2.840.113549.1.1.5":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case"1.2.840.113549.1.1.11":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"1.2.840.113549.1.1.12":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case"1.2.840.113549.1.1.13":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case"1.2.840.113549.1.1.10":return{name:"RSA-PSS"};case"1.2.840.113549.1.1.7":return{name:"RSA-OAEP"};case"1.2.840.10045.2.1":case"1.2.840.10045.4.1":return{name:"ECDSA",hash:{name:"SHA-1"}};case"1.2.840.10045.4.3.2":return{name:"ECDSA",hash:{name:"SHA-256"}};case"1.2.840.10045.4.3.3":return{name:"ECDSA",hash:{name:"SHA-384"}};case"1.2.840.10045.4.3.4":return{name:"ECDSA",hash:{name:"SHA-512"}};case"1.3.133.16.840.63.0.2":return{name:"ECDH",kdf:"SHA-1"};case"1.3.132.1.11.1":return{name:"ECDH",kdf:"SHA-256"};case"1.3.132.1.11.2":return{name:"ECDH",kdf:"SHA-384"};case"1.3.132.1.11.3":return{name:"ECDH",kdf:"SHA-512"};case"2.16.840.1.101.3.4.1.2":return{name:"AES-CBC",length:128};case"2.16.840.1.101.3.4.1.22":return{name:"AES-CBC",length:192};case"2.16.840.1.101.3.4.1.42":return{name:"AES-CBC",length:256};case"2.16.840.1.101.3.4.1.6":return{name:"AES-GCM",length:128};case"2.16.840.1.101.3.4.1.26":return{name:"AES-GCM",length:192};case"2.16.840.1.101.3.4.1.46":return{name:"AES-GCM",length:256};case"2.16.840.1.101.3.4.1.4":return{name:"AES-CFB",length:128};case"2.16.840.1.101.3.4.1.24":return{name:"AES-CFB",length:192};case"2.16.840.1.101.3.4.1.44":return{name:"AES-CFB",length:256};case"2.16.840.1.101.3.4.1.5":return{name:"AES-KW",length:128};case"2.16.840.1.101.3.4.1.25":return{name:"AES-KW",length:192};case"2.16.840.1.101.3.4.1.45":return{name:"AES-KW",length:256};case"1.2.840.113549.2.7":return{name:"HMAC",hash:{name:"SHA-1"}};case"1.2.840.113549.2.9":return{name:"HMAC",hash:{name:"SHA-256"}};case"1.2.840.113549.2.10":return{name:"HMAC",hash:{name:"SHA-384"}};case"1.2.840.113549.2.11":return{name:"HMAC",hash:{name:"SHA-512"}};case"1.2.840.113549.1.9.16.3.5":return{name:"DH"};case"1.3.14.3.2.26":return{name:"SHA-1"};case"2.16.840.1.101.3.4.2.1":return{name:"SHA-256"};case"2.16.840.1.101.3.4.2.2":return{name:"SHA-384"};case"2.16.840.1.101.3.4.2.3":return{name:"SHA-512"};case"1.2.840.113549.1.5.12":return{name:"PBKDF2"};case"1.2.840.10045.3.1.7":return{name:"P-256"};case"1.3.132.0.34":return{name:"P-384"};case"1.3.132.0.35":return{name:"P-521"}}return{}}},{key:"getOIDByAlgorithm",value:function(e){var t="";switch(e.name.toUpperCase()){case"RSAES-PKCS1-V1_5":t="1.2.840.113549.1.1.1";break;case"RSASSA-PKCS1-V1_5":switch(e.hash.name.toUpperCase()){case"SHA-1":t="1.2.840.113549.1.1.5";break;case"SHA-256":t="1.2.840.113549.1.1.11";break;case"SHA-384":t="1.2.840.113549.1.1.12";break;case"SHA-512":t="1.2.840.113549.1.1.13"}break;case"RSA-PSS":t="1.2.840.113549.1.1.10";break;case"RSA-OAEP":t="1.2.840.113549.1.1.7";break;case"ECDSA":switch(e.hash.name.toUpperCase()){case"SHA-1":t="1.2.840.10045.4.1";break;case"SHA-256":t="1.2.840.10045.4.3.2";break;case"SHA-384":t="1.2.840.10045.4.3.3";break;case"SHA-512":t="1.2.840.10045.4.3.4"}break;case"ECDH":switch(e.kdf.toUpperCase()){case"SHA-1":t="1.3.133.16.840.63.0.2";break;case"SHA-256":t="1.3.132.1.11.1";break;case"SHA-384":t="1.3.132.1.11.2";break;case"SHA-512":t="1.3.132.1.11.3"}break;case"AES-CTR":case"AES-CMAC":case"CONCAT":case"HKDF":break;case"AES-CBC":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.2";break;case 192:t="2.16.840.1.101.3.4.1.22";break;case 256:t="2.16.840.1.101.3.4.1.42"}break;case"AES-GCM":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.6";break;case 192:t="2.16.840.1.101.3.4.1.26";break;case 256:t="2.16.840.1.101.3.4.1.46"}break;case"AES-CFB":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.4";break;case 192:t="2.16.840.1.101.3.4.1.24";break;case 256:t="2.16.840.1.101.3.4.1.44"}break;case"AES-KW":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.5";break;case 192:t="2.16.840.1.101.3.4.1.25";break;case 256:t="2.16.840.1.101.3.4.1.45"}break;case"HMAC":switch(e.hash.name.toUpperCase()){case"SHA-1":t="1.2.840.113549.2.7";break;case"SHA-256":t="1.2.840.113549.2.9";break;case"SHA-384":t="1.2.840.113549.2.10";break;case"SHA-512":t="1.2.840.113549.2.11"}break;case"DH":t="1.2.840.113549.1.9.16.3.5";break;case"SHA-1":t="1.3.14.3.2.26";break;case"SHA-256":t="2.16.840.1.101.3.4.2.1";break;case"SHA-384":t="2.16.840.1.101.3.4.2.2";break;case"SHA-512":t="2.16.840.1.101.3.4.2.3";break;case"PBKDF2":t="1.2.840.113549.1.5.12";break;case"P-256":t="1.2.840.10045.3.1.7";break;case"P-384":t="1.3.132.0.34";break;case"P-521":t="1.3.132.0.35"}return t}},{key:"getAlgorithmParameters",value:function(e,t){var r={algorithm:{},usages:[]};switch(e.toUpperCase()){case"RSAES-PKCS1-V1_5":case"RSASSA-PKCS1-V1_5":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["sign","verify"]};break;case"verify":case"sign":case"importkey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},usages:["verify"]};break;default:return{algorithm:{name:"RSASSA-PKCS1-v1_5"},usages:[]}}break;case"RSA-PSS":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"},saltLength:20},usages:["sign","verify"]};break;case"generatekey":r={algorithm:{name:"RSA-PSS",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"}},usages:["verify"]};break;default:return{algorithm:{name:"RSA-PSS"},usages:[]}}break;case"RSA-OAEP":switch(t.toLowerCase()){case"encrypt":case"decrypt":r={algorithm:{name:"RSA-OAEP"},usages:["encrypt","decrypt"]};break;case"generatekey":r={algorithm:{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"importkey":r={algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]};break;default:return{algorithm:{name:"RSA-OAEP"},usages:[]}}break;case"ECDSA":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["verify"]};break;case"verify":case"sign":r={algorithm:{name:"ECDSA",hash:{name:"SHA-256"}},usages:["sign"]};break;default:return{algorithm:{name:"ECDSA"},usages:[]}}break;case"ECDH":switch(t.toLowerCase()){case"exportkey":case"importkey":case"generatekey":r={algorithm:{name:"ECDH",namedCurve:"P-256"},usages:["deriveKey","deriveBits"]};break;case"derivekey":case"derivebits":r={algorithm:{name:"ECDH",namedCurve:"P-256",public:[]},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"ECDH"},usages:[]}}break;case"AES-CTR":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CTR",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CTR",counter:new Uint8Array(16),length:10},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CTR"},usages:[]}}break;case"AES-CBC":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CBC",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CBC",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CBC"},usages:[]}}break;case"AES-GCM":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-GCM",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-GCM",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-GCM"},usages:[]}}break;case"AES-KW":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":case"wrapkey":case"unwrapkey":r={algorithm:{name:"AES-KW",length:256},usages:["wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-KW"},usages:[]}}break;case"HMAC":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"HMAC"},usages:["sign","verify"]};break;case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"HMAC",length:32,hash:{name:"SHA-256"}},usages:["sign","verify"]};break;default:return{algorithm:{name:"HMAC"},usages:[]}}break;case"HKDF":if("derivekey"!==t.toLowerCase())return{algorithm:{name:"HKDF"},usages:[]};r={algorithm:{name:"HKDF",hash:"SHA-256",salt:new Uint8Array([]),info:new Uint8Array([])},usages:["encrypt","decrypt"]};break;case"PBKDF2":if("derivekey"!==t.toLowerCase())return{algorithm:{name:"PBKDF2"},usages:[]};r={algorithm:{name:"PBKDF2",hash:{name:"SHA-256"},salt:new Uint8Array([]),iterations:1e4},usages:["encrypt","decrypt"]}}return r}},{key:"getHashAlgorithm",value:function(e){var t="";switch(e.algorithmId){case"1.2.840.10045.4.1":case"1.2.840.113549.1.1.5":t="SHA-1";break;case"1.2.840.10045.4.3.2":case"1.2.840.113549.1.1.11":t="SHA-256";break;case"1.2.840.10045.4.3.3":case"1.2.840.113549.1.1.12":t="SHA-384";break;case"1.2.840.10045.4.3.4":case"1.2.840.113549.1.1.13":t="SHA-512";break;case"1.2.840.113549.1.1.10":try{var r=new Vr({schema:e.algorithmParams});if("hashAlgorithm"in r){var n=this.getAlgorithmByOID(r.hashAlgorithm.algorithmId);if("name"in n==!1)return"";t=n.name}else t="SHA-1"}catch(e){}}return t}},{key:"encryptEncryptedContentInfo",value:function(e){var t=this;if(e instanceof Object==!1)return Promise.reject('Parameters must have type "Object"');if("password"in e==!1)return Promise.reject('Absent mandatory parameter "password"');if("contentEncryptionAlgorithm"in e==!1)return Promise.reject('Absent mandatory parameter "contentEncryptionAlgorithm"');if("hmacHashAlgorithm"in e==!1)return Promise.reject('Absent mandatory parameter "hmacHashAlgorithm"');if("iterationCount"in e==!1)return Promise.reject('Absent mandatory parameter "iterationCount"');if("contentToEncrypt"in e==!1)return Promise.reject('Absent mandatory parameter "contentToEncrypt"');if("contentType"in e==!1)return Promise.reject('Absent mandatory parameter "contentType"');var r=this.getOIDByAlgorithm(e.contentEncryptionAlgorithm);if(""===r)return Promise.reject('Wrong "contentEncryptionAlgorithm" value');var n=this.getOIDByAlgorithm({name:"PBKDF2"});if(""===n)return Promise.reject("Can not find OID for PBKDF2");var a=this.getOIDByAlgorithm({name:"HMAC",hash:{name:e.hmacHashAlgorithm}});if(""===a)return Promise.reject('Incorrect value for "hmacHashAlgorithm": '.concat(e.hmacHashAlgorithm));var i=Promise.resolve(),s=new ArrayBuffer(16),o=new Uint8Array(s);this.getRandomValues(o);var u=new ArrayBuffer(64),l=new Uint8Array(u);this.getRandomValues(l);var c=new Uint8Array(e.contentToEncrypt),h=new _r({salt:new Vt({valueHex:u}),iterationCount:e.iterationCount,prf:new xr({algorithmId:a,algorithmParams:new Tt})});return i=(i=(i=(i=i.then((function(){var r=new Uint8Array(e.password);return t.importKey("raw",r,"PBKDF2",!1,["deriveKey"])}),(function(e){return Promise.reject(e)}))).then((function(r){return t.deriveKey({name:"PBKDF2",hash:{name:e.hmacHashAlgorithm},salt:l,iterations:e.iterationCount},r,e.contentEncryptionAlgorithm,!1,["encrypt"])}),(function(e){return Promise.reject(e)}))).then((function(r){return t.encrypt({name:e.contentEncryptionAlgorithm.name,iv:o},r,c)}),(function(e){return Promise.reject(e)}))).then((function(t){var a=new jr({keyDerivationFunc:new xr({algorithmId:n,algorithmParams:h.toSchema()}),encryptionScheme:new xr({algorithmId:r,algorithmParams:new Vt({valueHex:s})})});return new Hr({contentType:e.contentType,contentEncryptionAlgorithm:new xr({algorithmId:"1.2.840.113549.1.5.13",algorithmParams:a.toSchema()}),encryptedContent:new Vt({valueHex:t})})}),(function(e){return Promise.reject(e)}))}},{key:"decryptEncryptedContentInfo",value:function(e){var t=this;if(e instanceof Object==!1)return Promise.reject('Parameters must have type "Object"');if("password"in e==!1)return Promise.reject('Absent mandatory parameter "password"');if("encryptedContentInfo"in e==!1)return Promise.reject('Absent mandatory parameter "encryptedContentInfo"');if("1.2.840.113549.1.5.13"!==e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId)return Promise.reject('Unknown "contentEncryptionAlgorithm": '.concat(e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId));var r,n,a=Promise.resolve();try{r=new jr({schema:e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams})}catch(e){return Promise.reject('Incorrectly encoded "pbes2Parameters"')}try{n=new _r({schema:r.keyDerivationFunc.algorithmParams})}catch(e){return Promise.reject('Incorrectly encoded "pbkdf2Params"')}var i=this.getAlgorithmByOID(r.encryptionScheme.algorithmId);if("name"in i==!1)return Promise.reject('Incorrect OID for "contentEncryptionAlgorithm": '.concat(r.encryptionScheme.algorithmId));var s=r.encryptionScheme.algorithmParams.valueBlock.valueHex,o=new Uint8Array(s),u=n.salt.valueBlock.valueHex,l=new Uint8Array(u),c=n.iterationCount,h="SHA-1";if("prf"in n){var f=this.getAlgorithmByOID(n.prf.algorithmId);if("name"in f==!1)return Promise.reject("Incorrect OID for HMAC hash algorithm");h=f.hash.name}return a=(a=(a=a.then((function(){return t.importKey("raw",e.password,"PBKDF2",!1,["deriveKey"])}),(function(e){return Promise.reject(e)}))).then((function(e){return t.deriveKey({name:"PBKDF2",hash:{name:h},salt:l,iterations:c},e,i,!1,["decrypt"])}),(function(e){return Promise.reject(e)}))).then((function(r){var n=new ArrayBuffer(0);if(!1===e.encryptedContentInfo.encryptedContent.idBlock.isConstructed)n=e.encryptedContentInfo.encryptedContent.valueBlock.valueHex;else{var a,s=p(e.encryptedContentInfo.encryptedContent.valueBlock.value);try{for(s.s();!(a=s.n()).done;){n=Ie(n,a.value.valueBlock.valueHex)}}catch(e){s.e(e)}finally{s.f()}}return t.decrypt({name:i.name,iv:o},r,n)}),(function(e){return Promise.reject(e)}))}},{key:"stampDataWithPassword",value:function(e){var t,r=this;if(e instanceof Object==!1)return Promise.reject('Parameters must have type "Object"');if("password"in e==!1)return Promise.reject('Absent mandatory parameter "password"');if("hashAlgorithm"in e==!1)return Promise.reject('Absent mandatory parameter "hashAlgorithm"');if("salt"in e==!1)return Promise.reject('Absent mandatory parameter "iterationCount"');if("iterationCount"in e==!1)return Promise.reject('Absent mandatory parameter "salt"');if("contentToStamp"in e==!1)return Promise.reject('Absent mandatory parameter "contentToStamp"');switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:return Promise.reject('Incorrect "parameters.hashAlgorithm" parameter: '.concat(e.hashAlgorithm))}var n=Promise.resolve(),a={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}};return n=(n=(n=n.then((function(){return Mr(r,e.hashAlgorithm,t,e.password,e.salt,e.iterationCount)}))).then((function(e){return r.importKey("raw",new Uint8Array(e),a,!1,["sign"])}))).then((function(t){return r.sign(a,t,new Uint8Array(e.contentToStamp))}),(function(e){return Promise.reject(e)}))}},{key:"verifyDataStampedWithPassword",value:function(e){var t,r=this;if(e instanceof Object==!1)return Promise.reject('Parameters must have type "Object"');if("password"in e==!1)return Promise.reject('Absent mandatory parameter "password"');if("hashAlgorithm"in e==!1)return Promise.reject('Absent mandatory parameter "hashAlgorithm"');if("salt"in e==!1)return Promise.reject('Absent mandatory parameter "iterationCount"');if("iterationCount"in e==!1)return Promise.reject('Absent mandatory parameter "salt"');if("contentToVerify"in e==!1)return Promise.reject('Absent mandatory parameter "contentToVerify"');if("signatureToVerify"in e==!1)return Promise.reject('Absent mandatory parameter "signatureToVerify"');switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:return Promise.reject('Incorrect "parameters.hashAlgorithm" parameter: '.concat(e.hashAlgorithm))}var n=Promise.resolve(),a={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}};return n=(n=(n=n.then((function(){return Mr(r,e.hashAlgorithm,t,e.password,e.salt,e.iterationCount)}))).then((function(e){return r.importKey("raw",new Uint8Array(e),a,!1,["verify"])}))).then((function(t){return r.verify(a,t,new Uint8Array(e.signatureToVerify),new Uint8Array(e.contentToVerify))}),(function(e){return Promise.reject(e)}))}},{key:"getSignatureParameters",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"SHA-1",r=this.getOIDByAlgorithm({name:t});if(""===r)return Promise.reject("Unsupported hash algorithm: ".concat(t));var n=new xr,a=this.getAlgorithmParameters(e.algorithm.name,"sign");switch(a.algorithm.hash.name=t,e.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":n.algorithmId=this.getOIDByAlgorithm(a.algorithm);break;case"RSA-PSS":switch(t.toUpperCase()){case"SHA-256":a.algorithm.saltLength=32;break;case"SHA-384":a.algorithm.saltLength=48;break;case"SHA-512":a.algorithm.saltLength=64}var i={};if("SHA-1"!==t.toUpperCase()){var s=this.getOIDByAlgorithm({name:t});if(""===s)return Promise.reject("Unsupported hash algorithm: ".concat(t));i.hashAlgorithm=new xr({algorithmId:s,algorithmParams:new Tt}),i.maskGenAlgorithm=new xr({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:i.hashAlgorithm.toSchema()})}20!==a.algorithm.saltLength&&(i.saltLength=a.algorithm.saltLength);var o=new Vr(i);n.algorithmId="1.2.840.113549.1.1.10",n.algorithmParams=o.toSchema();break;default:return Promise.reject("Unsupported signature algorithm: ".concat(e.algorithm.name))}return Promise.resolve().then((function(){return{signatureAlgorithm:n,parameters:a}}))}},{key:"signWithPrivateKey",value:function(e,t,r){return this.sign(r.algorithm,t,new Uint8Array(e)).then((function(e){return"ECDSA"===r.algorithm.name&&(e=function(e){if(e.byteLength%2!=0)return new ArrayBuffer(0);var t=e.byteLength/2,r=new ArrayBuffer(t);new Uint8Array(r).set(new Uint8Array(e,0,t));var n=new Kt({valueHex:r}),a=new ArrayBuffer(t);new Uint8Array(a).set(new Uint8Array(e,t,t));var i=new Kt({valueHex:a});return new Ot({value:[n.convertToDER(),i.convertToDER()]}).toBER(!1)}(e)),e}),(function(e){return Promise.reject("Signing error: ".concat(e))}))}},{key:"fillPublicKeyParameters",value:function(e,t){var r,n={},a=this.getHashAlgorithm(t);if(""===a)return Promise.reject("Unsupported signature algorithm: ".concat(t.algorithmId));r="1.2.840.113549.1.1.10"===t.algorithmId?t.algorithmId:e.algorithm.algorithmId;var i=this.getAlgorithmByOID(r);if("name"in i==="")return Promise.reject("Unsupported public key algorithm: ".concat(t.algorithmId));if(n.algorithm=this.getAlgorithmParameters(i.name,"importkey"),"hash"in n.algorithm.algorithm&&(n.algorithm.algorithm.hash.name=a),"ECDSA"===i.name){var s=!1;if("algorithmParams"in e.algorithm==!0&&"idBlock"in e.algorithm.algorithmParams&&1===e.algorithm.algorithmParams.idBlock.tagClass&&6===e.algorithm.algorithmParams.idBlock.tagNumber&&(s=!0),!1===s)return Promise.reject("Incorrect type for ECDSA public key parameters");var o=this.getAlgorithmByOID(e.algorithm.algorithmParams.valueBlock.toString());if("name"in o==!1)return Promise.reject("Unsupported named curve algorithm: ".concat(e.algorithm.algorithmParams.valueBlock.toString()));n.algorithm.algorithm.namedCurve=o.name}return n}},{key:"getPublicKey",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===r&&(r=this.fillPublicKeyParameters(e,t));var n=e.toSchema(),a=n.toBER(!1),i=new Uint8Array(a);return this.importKey("spki",i,r.algorithm.algorithm,!0,r.algorithm.usages)}},{key:"verifyWithPublicKey",value:function(e,t,r,n){var a=this,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=Promise.resolve();if(null===i){if(""===(i=this.getHashAlgorithm(n)))return Promise.reject("Unsupported signature algorithm: ".concat(n.algorithmId));s=s.then((function(){return a.getPublicKey(r,n)}))}else{var o,u={};o="1.2.840.113549.1.1.10"===n.algorithmId?n.algorithmId:r.algorithm.algorithmId;var l=this.getAlgorithmByOID(o);if("name"in l==="")return Promise.reject("Unsupported public key algorithm: ".concat(n.algorithmId));if(u.algorithm=this.getAlgorithmParameters(l.name,"importkey"),"hash"in u.algorithm.algorithm&&(u.algorithm.algorithm.hash.name=i),"ECDSA"===l.name){var c=!1;if("algorithmParams"in r.algorithm==!0&&"idBlock"in r.algorithm.algorithmParams&&1===r.algorithm.algorithmParams.idBlock.tagClass&&6===r.algorithm.algorithmParams.idBlock.tagNumber&&(c=!0),!1===c)return Promise.reject("Incorrect type for ECDSA public key parameters");var h=this.getAlgorithmByOID(r.algorithm.algorithmParams.valueBlock.toString());if("name"in h==!1)return Promise.reject("Unsupported named curve algorithm: ".concat(r.algorithm.algorithmParams.valueBlock.toString()));u.algorithm.algorithm.namedCurve=h.name}s=s.then((function(){return a.getPublicKey(r,null,u)}))}return s=s.then((function(r){var s=a.getAlgorithmParameters(r.algorithm.name,"verify");"hash"in s.algorithm&&(s.algorithm.hash.name=i);var o=t.valueBlock.valueHex;"ECDSA"===r.algorithm.name&&(o=Wr(Cr(o).result));if("RSA-PSS"===r.algorithm.name){var u;try{u=new Vr({schema:n.algorithmParams})}catch(e){return Promise.reject(e)}s.algorithm.saltLength="saltLength"in u?u.saltLength:20;var l="SHA-1";if("hashAlgorithm"in u){var c=a.getAlgorithmByOID(u.hashAlgorithm.algorithmId);if("name"in c==!1)return Promise.reject("Unrecognized hash algorithm: ".concat(u.hashAlgorithm.algorithmId));l=c.name}s.algorithm.hash.name=l}return a.verify(s.algorithm,r,new Uint8Array(o),new Uint8Array(e))}))}}]),e}(),Fr={name:"none",crypto:null,subtle:null};function Xr(e,r,n){if("undefined"!=typeof process&&"pid"in process&&"undefined"!=typeof global&&"undefined"==typeof window){if(void 0===global[process.pid])global[process.pid]={};else if("object"!==t(global[process.pid]))throw new Error("Name global.".concat(process.pid," already exists and it is not an object"));if(void 0===global[process.pid].pkijs)global[process.pid].pkijs={};else if("object"!==t(global[process.pid].pkijs))throw new Error("Name global.".concat(process.pid,".pkijs already exists and it is not an object"));global[process.pid].pkijs.engine={name:e,crypto:r,subtle:n}}else Fr.name!==e&&(Fr={name:e,crypto:r,subtle:n})}function Gr(){if("undefined"!=typeof process&&"pid"in process&&"undefined"!=typeof global&&"undefined"==typeof window){var e;try{e=global[process.pid].pkijs.engine}catch(e){throw new Error('Please call "setEngine" before call to "getEngine"')}return e}return Fr}function Jr(){var e=Gr();if(null!==e.subtle)return e.subtle}function qr(e){for(var t=!1,r="",n=e.trim(),a=0;a<n.length;a++)32===n.charCodeAt(a)?!1===t&&(t=!0):(t&&(r+=" ",t=!1),r+=n[a]);return r.toLowerCase()}function Wr(e){if(e instanceof Ot==!1)return new ArrayBuffer(0);if(2!==e.valueBlock.value.length)return new ArrayBuffer(0);if(e.valueBlock.value[0]instanceof Kt==!1)return new ArrayBuffer(0);if(e.valueBlock.value[1]instanceof Kt==!1)return new ArrayBuffer(0);var t=e.valueBlock.value[0].convertFromDER(),r=e.valueBlock.value[1].convertFromDER();switch(!0){case t.valueBlock.valueHex.byteLength<r.valueBlock.valueHex.byteLength:if(r.valueBlock.valueHex.byteLength-t.valueBlock.valueHex.byteLength!=1)throw new Error("Incorrect DER integer decoding");var n=r.valueBlock.valueHex.byteLength,a=new Uint8Array(t.valueBlock.valueHex),i=new ArrayBuffer(n),s=new Uint8Array(i);return s.set(a,1),s[0]=0,Ie(i,r.valueBlock.valueHex);case t.valueBlock.valueHex.byteLength>r.valueBlock.valueHex.byteLength:if(t.valueBlock.valueHex.byteLength-r.valueBlock.valueHex.byteLength!=1)throw new Error("Incorrect DER integer decoding");var o=t.valueBlock.valueHex.byteLength,u=new Uint8Array(r.valueBlock.valueHex),l=new ArrayBuffer(o),c=new Uint8Array(l);return c.set(u,1),c[0]=0,Ie(t.valueBlock.valueHex,l);default:if(t.valueBlock.valueHex.byteLength%2){var h=t.valueBlock.valueHex.byteLength+1,f=new Uint8Array(t.valueBlock.valueHex),m=new ArrayBuffer(h),v=new Uint8Array(m);v.set(f,1),v[0]=0;var g=new Uint8Array(r.valueBlock.valueHex),d=new ArrayBuffer(h),y=new Uint8Array(d);return y.set(g,1),y[0]=0,Ie(m,d)}}return Ie(t.valueBlock.valueHex,r.valueBlock.valueHex)}!function(){if("undefined"!=typeof self&&"crypto"in self){var e,t="webcrypto",r=self.crypto;if("webkitSubtle"in self.crypto){try{e=self.crypto.webkitSubtle}catch(t){e=self.crypto.subtle}t="safari"}"subtle"in self.crypto&&(e=self.crypto.subtle),Fr=void 0===e?{name:t,crypto:r,subtle:null}:{name:t,crypto:r,subtle:new Kr({name:t,crypto:self.crypto,subtle:e})}}Xr(Fr.name,Fr.crypto,Fr.subtle)}();var Qr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.type=Ne(t,"type",e.defaultValues("type")),this.value=Ne(t,"value",e.defaultValues("value")),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["type","typeValue"]);var r=Br(t,t,e.schema({names:{type:"type",value:"typeValue"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for AttributeTypeAndValue");this.type=r.result.type.valueBlock.toString(),this.value=r.result.typeValue}},{key:"toSchema",value:function(){return new Ot({value:[new Jt({value:this.type}),this.value]})}},{key:"toJSON",value:function(){var e={type:this.type};return 0!==Object.keys(this.value).length?e.value=this.value.toJSON():e.value=this.value,e}},{key:"isEqual",value:function(t){var r=[Wt.blockName(),$t.blockName(),tr.blockName(),ar.blockName(),ir.blockName(),sr.blockName(),or.blockName(),ur.blockName(),lr.blockName(),cr.blockName(),hr.blockName(),fr.blockName()];if(t.constructor.blockName()===e.blockName()){if(this.type!==t.type)return!1;var n,a=[!1,!1],i=this.value.constructor.blockName(),s=p(r);try{for(s.s();!(n=s.n()).done;){var o=n.value;i===o&&(a[0]=!0),t.value.constructor.blockName()===o&&(a[1]=!0)}}catch(e){s.e(e)}finally{s.f()}if(a[0]^a[1])return!1;if(a=a[0]&&a[1]){var u=qr(this.value.valueBlock.value),l=qr(t.value.valueBlock.value);if(0!==u.localeCompare(l))return!1}else if(!1===Le(this.value.valueBeforeDecode,t.value.valueBeforeDecode))return!1;return!0}return t instanceof ArrayBuffer&&Le(this.value.valueBeforeDecode,t)}}],[{key:"defaultValues",value:function(e){switch(e){case"type":return"";case"value":return{};default:throw new Error("Invalid member name for AttributeTypeAndValue class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Jt({name:t.type||""}),new wr({name:t.value||""})]})}},{key:"blockName",value:function(){return"AttributeTypeAndValue"}}]),e}(),zr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.typesAndValues=Ne(t,"typesAndValues",e.defaultValues("typesAndValues")),this.valueBeforeDecode=Ne(t,"valueBeforeDecode",e.defaultValues("valueBeforeDecode")),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["RDN","typesAndValues"]);var r=Br(t,t,e.schema({names:{blockName:"RDN",repeatedSet:"typesAndValues"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for RelativeDistinguishedNames");"typesAndValues"in r.result&&(this.typesAndValues=Array.from(r.result.typesAndValues,(function(e){return new Qr({schema:e})}))),this.valueBeforeDecode=r.result.RDN.valueBeforeDecode}},{key:"toSchema",value:function(){return 0===this.valueBeforeDecode.byteLength?new Ot({value:[new Dt({value:Array.from(this.typesAndValues,(function(e){return e.toSchema()}))})]}):Cr(this.valueBeforeDecode).result}},{key:"toJSON",value:function(){return{typesAndValues:Array.from(this.typesAndValues,(function(e){return e.toJSON()}))}}},{key:"isEqual",value:function(t){if(t instanceof e){if(this.typesAndValues.length!==t.typesAndValues.length)return!1;var r,n=p(this.typesAndValues.entries());try{for(n.s();!(r=n.n()).done;){var a=v(r.value,2),i=a[0];if(!1===a[1].isEqual(t.typesAndValues[i]))return!1}}catch(e){n.e(e)}finally{n.f()}return!0}return t instanceof ArrayBuffer&&Le(this.valueBeforeDecode,t)}}],[{key:"defaultValues",value:function(e){switch(e){case"typesAndValues":return[];case"valueBeforeDecode":return new ArrayBuffer(0);default:throw new Error("Invalid member name for RelativeDistinguishedNames class: ".concat(e))}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"typesAndValues":return 0===t.length;case"valueBeforeDecode":return 0===t.byteLength;default:throw new Error("Invalid member name for RelativeDistinguishedNames class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Sr({name:t.repeatedSequence||"",value:new Dt({value:[new Sr({name:t.repeatedSet||"",value:Qr.schema(t.typeAndValue||{})})]})})]})}}]),e}();function Yr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Ne(e,"names",{});return new Ot({optional:t,value:[new Et({optional:!0,idBlock:{tagClass:2,tagNumber:1},name:r.country_name||"",value:[new br({value:[new ar,new ir]})]}),new Et({optional:!0,idBlock:{tagClass:2,tagNumber:2},name:r.administration_domain_name||"",value:[new br({value:[new ar,new ir]})]}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},name:r.network_address||"",isHexOnly:!0}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:1},name:r.terminal_identifier||"",isHexOnly:!0}),new Et({optional:!0,idBlock:{tagClass:3,tagNumber:2},name:r.private_domain_name||"",value:[new br({value:[new ar,new ir]})]}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:3},name:r.organization_name||"",isHexOnly:!0}),new xt({optional:!0,name:r.numeric_user_identifier||"",idBlock:{tagClass:3,tagNumber:4},isHexOnly:!0}),new Et({optional:!0,name:r.personal_name||"",idBlock:{tagClass:3,tagNumber:5},value:[new xt({idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:1},isHexOnly:!0}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:2},isHexOnly:!0}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:3},isHexOnly:!0})]}),new Et({optional:!0,name:r.organizational_unit_names||"",idBlock:{tagClass:3,tagNumber:6},value:[new Sr({value:new ir})]})]})}function Zr(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Ot({optional:e,value:[new ir,new ir]})}function $r(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Dt({optional:e,value:[new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new Et({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new wr]})]})}var en=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.type=Ne(t,"type",e.defaultValues("type")),this.value=Ne(t,"value",e.defaultValues("value")),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["blockName","otherName","rfc822Name","dNSName","x400Address","directoryName","ediPartyName","uniformResourceIdentifier","iPAddress","registeredID"]);var r=Br(t,t,e.schema({names:{blockName:"blockName",otherName:"otherName",rfc822Name:"rfc822Name",dNSName:"dNSName",x400Address:"x400Address",directoryName:{names:{blockName:"directoryName"}},ediPartyName:"ediPartyName",uniformResourceIdentifier:"uniformResourceIdentifier",iPAddress:"iPAddress",registeredID:"registeredID"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for GeneralName");switch(this.type=r.result.blockName.idBlock.tagNumber,this.type){case 0:case 3:this.value=r.result.blockName;break;case 1:case 2:case 6:var n=r.result.blockName;n.idBlock.tagClass=1,n.idBlock.tagNumber=22;var a=n.toBER(!1);this.value=Cr(a).result.valueBlock.value;break;case 4:this.value=new zr({schema:r.result.directoryName});break;case 5:this.value=r.result.ediPartyName;break;case 7:this.value=new Vt({valueHex:r.result.blockName.valueBlock.valueHex});break;case 8:var i=r.result.blockName;i.idBlock.tagClass=1,i.idBlock.tagNumber=6;var s=i.toBER(!1);this.value=Cr(s).result.valueBlock.toString()}}},{key:"toSchema",value:function(){switch(this.type){case 0:case 3:case 5:return new Et({idBlock:{tagClass:3,tagNumber:this.type},value:[this.value]});case 1:case 2:case 6:var t=new ur({value:this.value});return t.idBlock.tagClass=3,t.idBlock.tagNumber=this.type,t;case 4:return new Et({idBlock:{tagClass:3,tagNumber:4},value:[this.value.toSchema()]});case 7:var r=this.value;return r.idBlock.tagClass=3,r.idBlock.tagNumber=this.type,r;case 8:var n=new Jt({value:this.value});return n.idBlock.tagClass=3,n.idBlock.tagNumber=this.type,n;default:return e.schema()}}},{key:"toJSON",value:function(){var e={type:this.type,value:""};if("string"==typeof this.value)e.value=this.value;else try{e.value=this.value.toJSON()}catch(e){}return e}}],[{key:"defaultValues",value:function(e){switch(e){case"type":return 9;case"value":return{};default:throw new Error("Invalid member name for GeneralName class: ".concat(e))}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"type":return r===e.defaultValues(t);case"value":return 0===Object.keys(r).length;default:throw new Error("Invalid member name for GeneralName class: ".concat(t))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new br({value:[new Et({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||"",value:[new Jt,new Et({idBlock:{tagClass:3,tagNumber:0},value:[new wr]})]}),new xt({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:1}}),new xt({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:2}}),new Et({idBlock:{tagClass:3,tagNumber:3},name:t.blockName||"",value:[Yr(t.builtInStandardAttributes||{},!1),Zr(!0),$r(!0)]}),new Et({idBlock:{tagClass:3,tagNumber:4},name:t.blockName||"",value:[zr.schema(t.directoryName||{})]}),new Et({idBlock:{tagClass:3,tagNumber:5},name:t.blockName||"",value:[new Et({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new br({value:[new sr,new ir,new tr,new Wt,new $t]})]}),new Et({idBlock:{tagClass:3,tagNumber:1},value:[new br({value:[new sr,new ir,new tr,new Wt,new $t]})]})]}),new xt({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:6}}),new xt({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:7}}),new xt({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:8}})]})}}]),e}(),tn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.accessMethod=Ne(t,"accessMethod",e.defaultValues("accessMethod")),this.accessLocation=Ne(t,"accessLocation",e.defaultValues("accessLocation")),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["accessMethod","accessLocation"]);var r=Br(t,t,e.schema({names:{accessMethod:"accessMethod",accessLocation:{names:{blockName:"accessLocation"}}}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for AccessDescription");this.accessMethod=r.result.accessMethod.valueBlock.toString(),this.accessLocation=new en({schema:r.result.accessLocation})}},{key:"toSchema",value:function(){return new Ot({value:[new Jt({value:this.accessMethod}),this.accessLocation.toSchema()]})}},{key:"toJSON",value:function(){return{accessMethod:this.accessMethod,accessLocation:this.accessLocation.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case"accessMethod":return"";case"accessLocation":return new en;default:throw new Error("Invalid member name for AccessDescription class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Jt({name:t.accessMethod||""}),en.schema(t.accessLocation||{})]})}}]),e}(),rn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.altNames=Ne(t,"altNames",e.defaultValues("altNames")),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["altNames"]);var r=Br(t,t,e.schema({names:{altNames:"altNames"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for AltName");"altNames"in r.result&&(this.altNames=Array.from(r.result.altNames,(function(e){return new en({schema:e})})))}},{key:"toSchema",value:function(){return new Ot({value:Array.from(this.altNames,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{altNames:Array.from(this.altNames,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){if("altNames"===e)return[];throw new Error("Invalid member name for AltName class: ".concat(e))}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Sr({name:t.altNames||"",value:en.schema()})]})}}]),e}(),nn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.type=Ne(t,"type",e.defaultValues("type")),this.value=Ne(t,"value",e.defaultValues("value")),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["utcTimeName","generalTimeName"]);var r=Br(t,t,e.schema({names:{utcTimeName:"utcTimeName",generalTimeName:"generalTimeName"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for Time");"utcTimeName"in r.result&&(this.type=0,this.value=r.result.utcTimeName.toDate()),"generalTimeName"in r.result&&(this.type=1,this.value=r.result.generalTimeName.toDate())}},{key:"toSchema",value:function(){var e={};return 0===this.type&&(e=new mr({valueDate:this.value})),1===this.type&&(e=new vr({valueDate:this.value})),e}},{key:"toJSON",value:function(){return{type:this.type,value:this.value}}}],[{key:"defaultValues",value:function(e){switch(e){case"type":return 0;case"value":return new Date(0,0,0);default:throw new Error("Invalid member name for Time class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Ne(e,"names",{});return new br({optional:t,value:[new mr({name:r.utcTimeName||""}),new vr({name:r.generalTimeName||""})]})}}]),e}(),an=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.attributes=Ne(t,"attributes",e.defaultValues("attributes")),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["attributes"]);var r=Br(t,t,e.schema({names:{attributes:"attributes"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for SubjectDirectoryAttributes");this.attributes=Array.from(r.result.attributes,(function(e){return new Lr({schema:e})}))}},{key:"toSchema",value:function(){return new Ot({value:Array.from(this.attributes,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{attributes:Array.from(this.attributes,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){if("attributes"===e)return[];throw new Error("Invalid member name for SubjectDirectoryAttributes class: ".concat(e))}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Sr({name:t.attributes||"",value:Lr.schema()})]})}}]),e}(),sn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),"notBefore"in t&&(this.notBefore=Ne(t,"notBefore",e.defaultValues("notBefore"))),"notAfter"in t&&(this.notAfter=Ne(t,"notAfter",e.defaultValues("notAfter"))),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["notBefore","notAfter"]);var r=Br(t,t,e.schema({names:{notBefore:"notBefore",notAfter:"notAfter"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PrivateKeyUsagePeriod");if("notBefore"in r.result){var n=new vr;n.fromBuffer(r.result.notBefore.valueBlock.valueHex),this.notBefore=n.toDate()}if("notAfter"in r.result){var a=new vr({valueHex:r.result.notAfter.valueBlock.valueHex});a.fromBuffer(r.result.notAfter.valueBlock.valueHex),this.notAfter=a.toDate()}}},{key:"toSchema",value:function(){var e=[];return"notBefore"in this&&e.push(new xt({idBlock:{tagClass:3,tagNumber:0},valueHex:new vr({valueDate:this.notBefore}).valueBlock.valueHex})),"notAfter"in this&&e.push(new xt({idBlock:{tagClass:3,tagNumber:1},valueHex:new vr({valueDate:this.notAfter}).valueBlock.valueHex})),new Ot({value:e})}},{key:"toJSON",value:function(){var e={};return"notBefore"in this&&(e.notBefore=this.notBefore),"notAfter"in this&&(e.notAfter=this.notAfter),e}}],[{key:"defaultValues",value:function(e){switch(e){case"notBefore":case"notAfter":return new Date;default:throw new Error("Invalid member name for PrivateKeyUsagePeriod class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new xt({name:t.notBefore||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new xt({name:t.notAfter||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}}]),e}(),on=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.cA=Ne(t,"cA",!1),"pathLenConstraint"in t&&(this.pathLenConstraint=Ne(t,"pathLenConstraint",0)),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["cA","pathLenConstraint"]);var r=Br(t,t,e.schema({names:{cA:"cA",pathLenConstraint:"pathLenConstraint"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for BasicConstraints");"cA"in r.result&&(this.cA=r.result.cA.valueBlock.value),"pathLenConstraint"in r.result&&(r.result.pathLenConstraint.valueBlock.isHexOnly?this.pathLenConstraint=r.result.pathLenConstraint:this.pathLenConstraint=r.result.pathLenConstraint.valueBlock.valueDec)}},{key:"toSchema",value:function(){var t=[];return this.cA!==e.defaultValues("cA")&&t.push(new Ut({value:this.cA})),"pathLenConstraint"in this&&(this.pathLenConstraint instanceof Kt?t.push(this.pathLenConstraint):t.push(new Kt({value:this.pathLenConstraint}))),new Ot({value:t})}},{key:"toJSON",value:function(){var t={};return this.cA!==e.defaultValues("cA")&&(t.cA=this.cA),"pathLenConstraint"in this&&(this.pathLenConstraint instanceof Kt?t.pathLenConstraint=this.pathLenConstraint.toJSON():t.pathLenConstraint=this.pathLenConstraint),t}}],[{key:"defaultValues",value:function(e){if("cA"===e)return!1;throw new Error("Invalid member name for BasicConstraints class: ".concat(e))}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Ut({optional:!0,name:t.cA||""}),new Kt({optional:!0,name:t.pathLenConstraint||""})]})}}]),e}(),un=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),"distributionPoint"in t&&(this.distributionPoint=Ne(t,"distributionPoint",e.defaultValues("distributionPoint"))),this.onlyContainsUserCerts=Ne(t,"onlyContainsUserCerts",e.defaultValues("onlyContainsUserCerts")),this.onlyContainsCACerts=Ne(t,"onlyContainsCACerts",e.defaultValues("onlyContainsCACerts")),"onlySomeReasons"in t&&(this.onlySomeReasons=Ne(t,"onlySomeReasons",e.defaultValues("onlySomeReasons"))),this.indirectCRL=Ne(t,"indirectCRL",e.defaultValues("indirectCRL")),this.onlyContainsAttributeCerts=Ne(t,"onlyContainsAttributeCerts",e.defaultValues("onlyContainsAttributeCerts")),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["distributionPoint","distributionPointNames","onlyContainsUserCerts","onlyContainsCACerts","onlySomeReasons","indirectCRL","onlyContainsAttributeCerts"]);var r=Br(t,t,e.schema({names:{distributionPoint:"distributionPoint",distributionPointNames:"distributionPointNames",onlyContainsUserCerts:"onlyContainsUserCerts",onlyContainsCACerts:"onlyContainsCACerts",onlySomeReasons:"onlySomeReasons",indirectCRL:"indirectCRL",onlyContainsAttributeCerts:"onlyContainsAttributeCerts"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for IssuingDistributionPoint");if("distributionPoint"in r.result)switch(!0){case 0===r.result.distributionPoint.idBlock.tagNumber:this.distributionPoint=Array.from(r.result.distributionPointNames,(function(e){return new en({schema:e})}));break;case 1===r.result.distributionPoint.idBlock.tagNumber:this.distributionPoint=new zr({schema:new Ot({value:r.result.distributionPoint.valueBlock.value})});break;default:throw new Error("Unknown tagNumber for distributionPoint: {$asn1.result.distributionPoint.idBlock.tagNumber}")}if("onlyContainsUserCerts"in r.result){var n=new Uint8Array(r.result.onlyContainsUserCerts.valueBlock.valueHex);this.onlyContainsUserCerts=0!==n[0]}if("onlyContainsCACerts"in r.result){var a=new Uint8Array(r.result.onlyContainsCACerts.valueBlock.valueHex);this.onlyContainsCACerts=0!==a[0]}if("onlySomeReasons"in r.result){var i=new Uint8Array(r.result.onlySomeReasons.valueBlock.valueHex);this.onlySomeReasons=i[0]}if("indirectCRL"in r.result){var s=new Uint8Array(r.result.indirectCRL.valueBlock.valueHex);this.indirectCRL=0!==s[0]}if("onlyContainsAttributeCerts"in r.result){var o=new Uint8Array(r.result.onlyContainsAttributeCerts.valueBlock.valueHex);this.onlyContainsAttributeCerts=0!==o[0]}}},{key:"toSchema",value:function(){var t,r=[];"distributionPoint"in this&&(this.distributionPoint instanceof Array?t=new Et({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,(function(e){return e.toSchema()}))}):((t=this.distributionPoint.toSchema()).idBlock.tagClass=3,t.idBlock.tagNumber=1),r.push(new Et({idBlock:{tagClass:3,tagNumber:0},value:[t]})));if(this.onlyContainsUserCerts!==e.defaultValues("onlyContainsUserCerts")&&r.push(new xt({idBlock:{tagClass:3,tagNumber:1},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsCACerts!==e.defaultValues("onlyContainsCACerts")&&r.push(new xt({idBlock:{tagClass:3,tagNumber:2},valueHex:new Uint8Array([255]).buffer})),"onlySomeReasons"in this){var n=new ArrayBuffer(1);new Uint8Array(n)[0]=this.onlySomeReasons,r.push(new xt({idBlock:{tagClass:3,tagNumber:3},valueHex:n}))}return this.indirectCRL!==e.defaultValues("indirectCRL")&&r.push(new xt({idBlock:{tagClass:3,tagNumber:4},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsAttributeCerts!==e.defaultValues("onlyContainsAttributeCerts")&&r.push(new xt({idBlock:{tagClass:3,tagNumber:5},valueHex:new Uint8Array([255]).buffer})),new Ot({value:r})}},{key:"toJSON",value:function(){var t={};return"distributionPoint"in this&&(this.distributionPoint instanceof Array?t.distributionPoint=Array.from(this.distributionPoint,(function(e){return e.toJSON()})):t.distributionPoint=this.distributionPoint.toJSON()),this.onlyContainsUserCerts!==e.defaultValues("onlyContainsUserCerts")&&(t.onlyContainsUserCerts=this.onlyContainsUserCerts),this.onlyContainsCACerts!==e.defaultValues("onlyContainsCACerts")&&(t.onlyContainsCACerts=this.onlyContainsCACerts),"onlySomeReasons"in this&&(t.onlySomeReasons=this.onlySomeReasons),this.indirectCRL!==e.defaultValues("indirectCRL")&&(t.indirectCRL=this.indirectCRL),this.onlyContainsAttributeCerts!==e.defaultValues("onlyContainsAttributeCerts")&&(t.onlyContainsAttributeCerts=this.onlyContainsAttributeCerts),t}}],[{key:"defaultValues",value:function(e){switch(e){case"distributionPoint":return[];case"onlyContainsUserCerts":case"onlyContainsCACerts":case"indirectCRL":case"onlyContainsAttributeCerts":return!1;case"onlySomeReasons":return 0;default:throw new Error("Invalid member name for IssuingDistributionPoint class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Et({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new br({value:[new Et({name:t.distributionPoint||"",idBlock:{tagClass:3,tagNumber:0},value:[new Sr({name:t.distributionPointNames||"",value:en.schema()})]}),new Et({name:t.distributionPoint||"",idBlock:{tagClass:3,tagNumber:1},value:zr.schema().valueBlock.value})]})]}),new xt({name:t.onlyContainsUserCerts||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new xt({name:t.onlyContainsCACerts||"",optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new xt({name:t.onlySomeReasons||"",optional:!0,idBlock:{tagClass:3,tagNumber:3}}),new xt({name:t.indirectCRL||"",optional:!0,idBlock:{tagClass:3,tagNumber:4}}),new xt({name:t.onlyContainsAttributeCerts||"",optional:!0,idBlock:{tagClass:3,tagNumber:5}})]})}}]),e}(),ln=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.names=Ne(t,"names",e.defaultValues("names")),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["names","generalNames"]);var r=Br(t,t,e.schema({names:{blockName:"names",generalNames:"generalNames"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for GeneralNames");this.names=Array.from(r.result.generalNames,(function(e){return new en({schema:e})}))}},{key:"toSchema",value:function(){return new Ot({value:Array.from(this.names,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{names:Array.from(this.names,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){if("names"===e)return[];throw new Error("Invalid member name for GeneralNames class: ".concat(e))}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Ne(e,"names",{});return new Ot({optional:t,name:r.blockName||"",value:[new Sr({name:r.generalNames||"",value:en.schema()})]})}}]),e}(),cn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.base=Ne(t,"base",e.defaultValues("base")),this.minimum=Ne(t,"minimum",e.defaultValues("minimum")),"maximum"in t&&(this.maximum=Ne(t,"maximum",e.defaultValues("maximum"))),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["base","minimum","maximum"]);var r=Br(t,t,e.schema({names:{base:{names:{blockName:"base"}},minimum:"minimum",maximum:"maximum"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for GeneralSubtree");this.base=new en({schema:r.result.base}),"minimum"in r.result&&(r.result.minimum.valueBlock.isHexOnly?this.minimum=r.result.minimum:this.minimum=r.result.minimum.valueBlock.valueDec),"maximum"in r.result&&(r.result.maximum.valueBlock.isHexOnly?this.maximum=r.result.maximum:this.maximum=r.result.maximum.valueBlock.valueDec)}},{key:"toSchema",value:function(){var e=[];if(e.push(this.base.toSchema()),0!==this.minimum){var t=0;t=this.minimum instanceof Kt?this.minimum:new Kt({value:this.minimum}),e.push(new Et({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if("maximum"in this){var r=0;r=this.maximum instanceof Kt?this.maximum:new Kt({value:this.maximum}),e.push(new Et({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[r]}))}return new Ot({value:e})}},{key:"toJSON",value:function(){var e={base:this.base.toJSON()};return 0!==this.minimum&&("number"==typeof this.minimum?e.minimum=this.minimum:e.minimum=this.minimum.toJSON()),"maximum"in this&&("number"==typeof this.maximum?e.maximum=this.maximum:e.maximum=this.maximum.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case"base":return new en;case"minimum":case"maximum":return 0;default:throw new Error("Invalid member name for GeneralSubtree class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[en.schema(t.base||{}),new Et({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Kt({name:t.minimum||""})]}),new Et({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Kt({name:t.maximum||""})]})]})}}]),e}(),hn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),"permittedSubtrees"in t&&(this.permittedSubtrees=Ne(t,"permittedSubtrees",e.defaultValues("permittedSubtrees"))),"excludedSubtrees"in t&&(this.excludedSubtrees=Ne(t,"excludedSubtrees",e.defaultValues("excludedSubtrees"))),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["permittedSubtrees","excludedSubtrees"]);var r=Br(t,t,e.schema({names:{permittedSubtrees:"permittedSubtrees",excludedSubtrees:"excludedSubtrees"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for NameConstraints");"permittedSubtrees"in r.result&&(this.permittedSubtrees=Array.from(r.result.permittedSubtrees,(function(e){return new cn({schema:e})}))),"excludedSubtrees"in r.result&&(this.excludedSubtrees=Array.from(r.result.excludedSubtrees,(function(e){return new cn({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return"permittedSubtrees"in this&&e.push(new Et({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.permittedSubtrees,(function(e){return e.toSchema()}))})),"excludedSubtrees"in this&&e.push(new Et({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.excludedSubtrees,(function(e){return e.toSchema()}))})),new Ot({value:e})}},{key:"toJSON",value:function(){var e={};return"permittedSubtrees"in this&&(e.permittedSubtrees=Array.from(this.permittedSubtrees,(function(e){return e.toJSON()}))),"excludedSubtrees"in this&&(e.excludedSubtrees=Array.from(this.excludedSubtrees,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case"permittedSubtrees":case"excludedSubtrees":return[];default:throw new Error("Invalid member name for NameConstraints class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Et({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Sr({name:t.permittedSubtrees||"",value:cn.schema()})]}),new Et({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Sr({name:t.excludedSubtrees||"",value:cn.schema()})]})]})}}]),e}(),fn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),"distributionPoint"in t&&(this.distributionPoint=Ne(t,"distributionPoint",e.defaultValues("distributionPoint"))),"reasons"in t&&(this.reasons=Ne(t,"reasons",e.defaultValues("reasons"))),"cRLIssuer"in t&&(this.cRLIssuer=Ne(t,"cRLIssuer",e.defaultValues("cRLIssuer"))),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["distributionPoint","distributionPointNames","reasons","cRLIssuer","cRLIssuerNames"]);var r=Br(t,t,e.schema({names:{distributionPoint:"distributionPoint",distributionPointNames:"distributionPointNames",reasons:"reasons",cRLIssuer:"cRLIssuer",cRLIssuerNames:"cRLIssuerNames"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for DistributionPoint");"distributionPoint"in r.result&&(0===r.result.distributionPoint.idBlock.tagNumber&&(this.distributionPoint=Array.from(r.result.distributionPointNames,(function(e){return new en({schema:e})}))),1===r.result.distributionPoint.idBlock.tagNumber&&(this.distributionPoint=new zr({schema:new Ot({value:r.result.distributionPoint.valueBlock.value})}))),"reasons"in r.result&&(this.reasons=new jt({valueHex:r.result.reasons.valueBlock.valueHex})),"cRLIssuer"in r.result&&(this.cRLIssuer=Array.from(r.result.cRLIssuerNames,(function(e){return new en({schema:e})})))}},{key:"toSchema",value:function(){var e,t=[];"distributionPoint"in this&&(e=this.distributionPoint instanceof Array?new Et({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,(function(e){return e.toSchema()}))}):new Et({idBlock:{tagClass:3,tagNumber:1},value:[this.distributionPoint.toSchema()]}),t.push(new Et({idBlock:{tagClass:3,tagNumber:0},value:[e]})));return"reasons"in this&&t.push(new xt({idBlock:{tagClass:3,tagNumber:1},valueHex:this.reasons.valueBlock.valueHex})),"cRLIssuer"in this&&t.push(new Et({idBlock:{tagClass:3,tagNumber:2},value:Array.from(this.cRLIssuer,(function(e){return e.toSchema()}))})),new Ot({value:t})}},{key:"toJSON",value:function(){var e={};return"distributionPoint"in this&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,(function(e){return e.toJSON()})):e.distributionPoint=this.distributionPoint.toJSON()),"reasons"in this&&(e.reasons=this.reasons.toJSON()),"cRLIssuer"in this&&(e.cRLIssuer=Array.from(this.cRLIssuer,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case"distributionPoint":case"cRLIssuer":return[];case"reasons":return new jt;default:throw new Error("Invalid member name for DistributionPoint class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Et({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new br({value:[new Et({name:t.distributionPoint||"",optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Sr({name:t.distributionPointNames||"",value:en.schema()})]}),new Et({name:t.distributionPoint||"",optional:!0,idBlock:{tagClass:3,tagNumber:1},value:zr.schema().valueBlock.value})]})]}),new xt({name:t.reasons||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new Et({name:t.cRLIssuer||"",optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[new Sr({name:t.cRLIssuerNames||"",value:en.schema()})]})]})}}]),e}(),mn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.distributionPoints=Ne(t,"distributionPoints",e.defaultValues("distributionPoints")),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["distributionPoints"]);var r=Br(t,t,e.schema({names:{distributionPoints:"distributionPoints"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for CRLDistributionPoints");this.distributionPoints=Array.from(r.result.distributionPoints,(function(e){return new fn({schema:e})}))}},{key:"toSchema",value:function(){return new Ot({value:Array.from(this.distributionPoints,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{distributionPoints:Array.from(this.distributionPoints,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){if("distributionPoints"===e)return[];throw new Error("Invalid member name for CRLDistributionPoints class: ".concat(e))}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Sr({name:t.distributionPoints||"",value:fn.schema()})]})}}]),e}(),vn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.policyQualifierId=Ne(t,"policyQualifierId",e.defaultValues("policyQualifierId")),this.qualifier=Ne(t,"qualifier",e.defaultValues("qualifier")),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["policyQualifierId","qualifier"]);var r=Br(t,t,e.schema({names:{policyQualifierId:"policyQualifierId",qualifier:"qualifier"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PolicyQualifierInfo");this.policyQualifierId=r.result.policyQualifierId.valueBlock.toString(),this.qualifier=r.result.qualifier}},{key:"toSchema",value:function(){return new Ot({value:[new Jt({value:this.policyQualifierId}),this.qualifier]})}},{key:"toJSON",value:function(){return{policyQualifierId:this.policyQualifierId,qualifier:this.qualifier.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case"policyQualifierId":return"";case"qualifier":return new wr;default:throw new Error("Invalid member name for PolicyQualifierInfo class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Jt({name:t.policyQualifierId||""}),new wr({name:t.qualifier||""})]})}}]),e}(),gn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.policyIdentifier=Ne(t,"policyIdentifier",e.defaultValues("policyIdentifier")),"policyQualifiers"in t&&(this.policyQualifiers=Ne(t,"policyQualifiers",e.defaultValues("policyQualifiers"))),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["policyIdentifier","policyQualifiers"]);var r=Br(t,t,e.schema({names:{policyIdentifier:"policyIdentifier",policyQualifiers:"policyQualifiers"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PolicyInformation");this.policyIdentifier=r.result.policyIdentifier.valueBlock.toString(),"policyQualifiers"in r.result&&(this.policyQualifiers=Array.from(r.result.policyQualifiers,(function(e){return new vn({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(new Jt({value:this.policyIdentifier})),"policyQualifiers"in this&&e.push(new Ot({value:Array.from(this.policyQualifiers,(function(e){return e.toSchema()}))})),new Ot({value:e})}},{key:"toJSON",value:function(){var e={policyIdentifier:this.policyIdentifier};return"policyQualifiers"in this&&(e.policyQualifiers=Array.from(this.policyQualifiers,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case"policyIdentifier":return"";case"policyQualifiers":return[];default:throw new Error("Invalid member name for PolicyInformation class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Jt({name:t.policyIdentifier||""}),new Ot({optional:!0,value:[new Sr({name:t.policyQualifiers||"",value:vn.schema()})]})]})}}]),e}(),dn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.certificatePolicies=Ne(t,"certificatePolicies",e.defaultValues("certificatePolicies")),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["certificatePolicies"]);var r=Br(t,t,e.schema({names:{certificatePolicies:"certificatePolicies"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for CertificatePolicies");this.certificatePolicies=Array.from(r.result.certificatePolicies,(function(e){return new gn({schema:e})}))}},{key:"toSchema",value:function(){return new Ot({value:Array.from(this.certificatePolicies,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{certificatePolicies:Array.from(this.certificatePolicies,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){if("certificatePolicies"===e)return[];throw new Error("Invalid member name for CertificatePolicies class: ".concat(e))}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Sr({name:t.certificatePolicies||"",value:gn.schema()})]})}}]),e}(),yn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.issuerDomainPolicy=Ne(t,"issuerDomainPolicy",e.defaultValues("issuerDomainPolicy")),this.subjectDomainPolicy=Ne(t,"subjectDomainPolicy",e.defaultValues("subjectDomainPolicy")),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["issuerDomainPolicy","subjectDomainPolicy"]);var r=Br(t,t,e.schema({names:{issuerDomainPolicy:"issuerDomainPolicy",subjectDomainPolicy:"subjectDomainPolicy"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PolicyMapping");this.issuerDomainPolicy=r.result.issuerDomainPolicy.valueBlock.toString(),this.subjectDomainPolicy=r.result.subjectDomainPolicy.valueBlock.toString()}},{key:"toSchema",value:function(){return new Ot({value:[new Jt({value:this.issuerDomainPolicy}),new Jt({value:this.subjectDomainPolicy})]})}},{key:"toJSON",value:function(){return{issuerDomainPolicy:this.issuerDomainPolicy,subjectDomainPolicy:this.subjectDomainPolicy}}}],[{key:"defaultValues",value:function(e){switch(e){case"issuerDomainPolicy":case"subjectDomainPolicy":return"";default:throw new Error("Invalid member name for PolicyMapping class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Jt({name:t.issuerDomainPolicy||""}),new Jt({name:t.subjectDomainPolicy||""})]})}}]),e}(),pn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.mappings=Ne(t,"mappings",e.defaultValues("mappings")),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["mappings"]);var r=Br(t,t,e.schema({names:{mappings:"mappings"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PolicyMappings");this.mappings=Array.from(r.result.mappings,(function(e){return new yn({schema:e})}))}},{key:"toSchema",value:function(){return new Ot({value:Array.from(this.mappings,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{mappings:Array.from(this.mappings,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){if("mappings"===e)return[];throw new Error("Invalid member name for PolicyMappings class: ".concat(e))}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Sr({name:t.mappings||"",value:yn.schema()})]})}}]),e}(),kn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),"keyIdentifier"in t&&(this.keyIdentifier=Ne(t,"keyIdentifier",e.defaultValues("keyIdentifier"))),"authorityCertIssuer"in t&&(this.authorityCertIssuer=Ne(t,"authorityCertIssuer",e.defaultValues("authorityCertIssuer"))),"authorityCertSerialNumber"in t&&(this.authorityCertSerialNumber=Ne(t,"authorityCertSerialNumber",e.defaultValues("authorityCertSerialNumber"))),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["keyIdentifier","authorityCertIssuer","authorityCertSerialNumber"]);var r=Br(t,t,e.schema({names:{keyIdentifier:"keyIdentifier",authorityCertIssuer:"authorityCertIssuer",authorityCertSerialNumber:"authorityCertSerialNumber"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for AuthorityKeyIdentifier");"keyIdentifier"in r.result&&(this.keyIdentifier=new Vt({valueHex:r.result.keyIdentifier.valueBlock.valueHex})),"authorityCertIssuer"in r.result&&(this.authorityCertIssuer=Array.from(r.result.authorityCertIssuer,(function(e){return new en({schema:e})}))),"authorityCertSerialNumber"in r.result&&(this.authorityCertSerialNumber=new Kt({valueHex:r.result.authorityCertSerialNumber.valueBlock.valueHex}))}},{key:"toSchema",value:function(){var e=[];return"keyIdentifier"in this&&e.push(new xt({idBlock:{tagClass:3,tagNumber:0},valueHex:this.keyIdentifier.valueBlock.valueHex})),"authorityCertIssuer"in this&&e.push(new Et({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.authorityCertIssuer,(function(e){return e.toSchema()}))})),"authorityCertSerialNumber"in this&&e.push(new xt({idBlock:{tagClass:3,tagNumber:2},valueHex:this.authorityCertSerialNumber.valueBlock.valueHex})),new Ot({value:e})}},{key:"toJSON",value:function(){var e={};return"keyIdentifier"in this&&(e.keyIdentifier=this.keyIdentifier.toJSON()),"authorityCertIssuer"in this&&(e.authorityCertIssuer=Array.from(this.authorityCertIssuer,(function(e){return e.toJSON()}))),"authorityCertSerialNumber"in this&&(e.authorityCertSerialNumber=this.authorityCertSerialNumber.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case"keyIdentifier":return new Vt;case"authorityCertIssuer":return[];case"authorityCertSerialNumber":return new Kt;default:throw new Error("Invalid member name for AuthorityKeyIdentifier class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new xt({name:t.keyIdentifier||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new Et({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Sr({name:t.authorityCertIssuer||"",value:en.schema()})]}),new xt({name:t.authorityCertSerialNumber||"",optional:!0,idBlock:{tagClass:3,tagNumber:2}})]})}}]),e}(),bn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),"requireExplicitPolicy"in t&&(this.requireExplicitPolicy=Ne(t,"requireExplicitPolicy",e.defaultValues("requireExplicitPolicy"))),"inhibitPolicyMapping"in t&&(this.inhibitPolicyMapping=Ne(t,"inhibitPolicyMapping",e.defaultValues("inhibitPolicyMapping"))),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["requireExplicitPolicy","inhibitPolicyMapping"]);var r=Br(t,t,e.schema({names:{requireExplicitPolicy:"requireExplicitPolicy",inhibitPolicyMapping:"inhibitPolicyMapping"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PolicyConstraints");if("requireExplicitPolicy"in r.result){var n=r.result.requireExplicitPolicy;n.idBlock.tagClass=1,n.idBlock.tagNumber=2;var a=Cr(n.toBER(!1));this.requireExplicitPolicy=a.result.valueBlock.valueDec}if("inhibitPolicyMapping"in r.result){var i=r.result.inhibitPolicyMapping;i.idBlock.tagClass=1,i.idBlock.tagNumber=2;var s=Cr(i.toBER(!1));this.inhibitPolicyMapping=s.result.valueBlock.valueDec}}},{key:"toSchema",value:function(){var e=[];if("requireExplicitPolicy"in this){var t=new Kt({value:this.requireExplicitPolicy});t.idBlock.tagClass=3,t.idBlock.tagNumber=0,e.push(t)}if("inhibitPolicyMapping"in this){var r=new Kt({value:this.inhibitPolicyMapping});r.idBlock.tagClass=3,r.idBlock.tagNumber=1,e.push(r)}return new Ot({value:e})}},{key:"toJSON",value:function(){var e={};return"requireExplicitPolicy"in this&&(e.requireExplicitPolicy=this.requireExplicitPolicy),"inhibitPolicyMapping"in this&&(e.inhibitPolicyMapping=this.inhibitPolicyMapping),e}}],[{key:"defaultValues",value:function(e){switch(e){case"requireExplicitPolicy":case"inhibitPolicyMapping":return 0;default:throw new Error("Invalid member name for PolicyConstraints class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new xt({name:t.requireExplicitPolicy||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new xt({name:t.inhibitPolicyMapping||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}}]),e}(),wn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.keyPurposes=Ne(t,"keyPurposes",e.defaultValues("keyPurposes")),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["keyPurposes"]);var r=Br(t,t,e.schema({names:{keyPurposes:"keyPurposes"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for ExtKeyUsage");this.keyPurposes=Array.from(r.result.keyPurposes,(function(e){return e.valueBlock.toString()}))}},{key:"toSchema",value:function(){return new Ot({value:Array.from(this.keyPurposes,(function(e){return new Jt({value:e})}))})}},{key:"toJSON",value:function(){return{keyPurposes:Array.from(this.keyPurposes)}}}],[{key:"defaultValues",value:function(e){if("keyPurposes"===e)return[];throw new Error("Invalid member name for ExtKeyUsage class: ".concat(e))}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Sr({name:t.keyPurposes||"",value:new Jt})]})}}]),e}(),Sn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.accessDescriptions=Ne(t,"accessDescriptions",e.defaultValues("accessDescriptions")),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["accessDescriptions"]);var r=Br(t,t,e.schema({names:{accessDescriptions:"accessDescriptions"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for InfoAccess");this.accessDescriptions=Array.from(r.result.accessDescriptions,(function(e){return new tn({schema:e})}))}},{key:"toSchema",value:function(){return new Ot({value:Array.from(this.accessDescriptions,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{accessDescriptions:Array.from(this.accessDescriptions,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){if("accessDescriptions"===e)return[];throw new Error("Invalid member name for InfoAccess class: ".concat(e))}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Sr({name:t.accessDescriptions||"",value:tn.schema()})]})}}]),e}(),Nn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.clear();for(var r=0,n=Object.keys(t);r<n.length;r++){var i=n[r];switch(i){case"length":this.length=t.length;break;case"stub":for(var s=0;s<this._view.length;s++)this._view[s]=t.stub;break;case"view":this.fromUint8Array(t.view);break;case"buffer":this.fromArrayBuffer(t.buffer);break;case"string":this.fromString(t.string);break;case"hexstring":this.fromHexString(t.hexstring)}}}return s(e,[{key:"buffer",get:function(){return this._buffer},set:function(e){this._buffer=e.slice(0),this._view=new Uint8Array(this._buffer)}},{key:"view",get:function(){return this._view},set:function(e){this._buffer=new ArrayBuffer(e.length),this._view=new Uint8Array(this._buffer),this._view.set(e)}},{key:"length",get:function(){return this._buffer.byteLength},set:function(e){this._buffer=new ArrayBuffer(e),this._view=new Uint8Array(this._buffer)}},{key:"clear",value:function(){this._buffer=new ArrayBuffer(0),this._view=new Uint8Array(this._buffer)}},{key:"fromArrayBuffer",value:function(e){this.buffer=e}},{key:"fromUint8Array",value:function(e){this._buffer=new ArrayBuffer(e.length),this._view=new Uint8Array(this._buffer),this._view.set(e)}},{key:"fromString",value:function(e){var t=e.length;this.length=t;for(var r=0;r<t;r++)this.view[r]=e.charCodeAt(r)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.view.length-e,r="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(var n=e;n<e+t;n++)r+=String.fromCharCode(this.view[n]);return r}},{key:"fromHexString",value:function(e){var t=e.length;this.buffer=new ArrayBuffer(t>>1),this.view=new Uint8Array(this.buffer);var r=new Map;r.set("0",0),r.set("1",1),r.set("2",2),r.set("3",3),r.set("4",4),r.set("5",5),r.set("6",6),r.set("7",7),r.set("8",8),r.set("9",9),r.set("A",10),r.set("a",10),r.set("B",11),r.set("b",11),r.set("C",12),r.set("c",12),r.set("D",13),r.set("d",13),r.set("E",14),r.set("e",14),r.set("F",15),r.set("f",15);for(var n=0,a=0,i=0;i<t;i++)i%2?(a|=r.get(e.charAt(i)),this.view[n]=a,n++):a=r.get(e.charAt(i))<<4}},{key:"toHexString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.view.length-e,r="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(var n=e;n<e+t;n++){var a=this.view[n].toString(16).toUpperCase();r=r+(1==a.length?"0":"")+a}return r}},{key:"copy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._buffer.byteLength-t;if(0===t&&0===this._buffer.byteLength)return new e;if(t<0||t>this._buffer.byteLength-1)throw new Error("Wrong start position: ".concat(t));var n=new e;return n._buffer=this._buffer.slice(t,t+r),n._view=new Uint8Array(n._buffer),n}},{key:"slice",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._buffer.byteLength;if(0===t&&0===this._buffer.byteLength)return new e;if(t<0||t>this._buffer.byteLength-1)throw new Error("Wrong start position: ".concat(t));var n=new e;return n._buffer=this._buffer.slice(t,r),n._view=new Uint8Array(n._buffer),n}},{key:"realloc",value:function(e){var t=new ArrayBuffer(e),r=new Uint8Array(t);e>this._view.length?r.set(this._view):r.set(new Uint8Array(this._buffer,0,e)),this._buffer=t.slice(0),this._view=new Uint8Array(this._buffer)}},{key:"append",value:function(e){var t=this._buffer.byteLength,r=e._buffer.byteLength,n=e._view.slice();this.realloc(t+r),this._view.set(n,t)}},{key:"insert",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._buffer.byteLength-t;return!(t>this._buffer.byteLength-1)&&(r>this._buffer.byteLength-t&&(r=this._buffer.byteLength-t),r>e._buffer.byteLength&&(r=e._buffer.byteLength),r==e._buffer.byteLength?this._view.set(e._view,t):this._view.set(e._view.slice(0,r),t),!0)}},{key:"isEqual",value:function(e){if(this._buffer.byteLength!=e._buffer.byteLength)return!1;for(var t=0;t<e._buffer.byteLength;t++)if(this.view[t]!=e.view[t])return!1;return!0}},{key:"isEqualView",value:function(e){if(e.length!=this.view.length)return!1;for(var t=0;t<e.length;t++)if(this.view[t]!=e[t])return!1;return!0}},{key:"findPattern",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];null==t&&(t=n?this.buffer.byteLength:0),t>this.buffer.byteLength&&(t=this.buffer.byteLength),n?(null==r&&(r=t),r>t&&(r=t)):(null==r&&(r=this.buffer.byteLength-t),r>this.buffer.byteLength-t&&(r=this.buffer.byteLength-t));var a=e.buffer.byteLength;if(a>r)return-1;for(var i=[],s=0;s<a;s++)i.push(e.view[s]);for(var o=0;o<=r-a;o++){for(var u=!0,l=n?t-a-o:t+o,c=0;c<a;c++)if(this.view[c+l]!=i[c]){u=!1;break}if(u)return n?t-a-o:t+a+o}return-1}},{key:"findFirstIn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];null==t&&(t=n?this.buffer.byteLength:0),t>this.buffer.byteLength&&(t=this.buffer.byteLength),n?(null==r&&(r=t),r>t&&(r=t)):(null==r&&(r=this.buffer.byteLength-t),r>this.buffer.byteLength-t&&(r=this.buffer.byteLength-t));for(var a={id:-1,position:n?0:t+r,length:0},i=0;i<e.length;i++){var s=this.findPattern(e[i],t,r,n);if(-1!=s){var o=!1,u=e[i].length;n?s-u>=a.position-a.length&&(o=!0):s-u<=a.position-a.length&&(o=!0),o&&(a.position=s,a.id=i,a.length=u)}}return a}},{key:"findAllIn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.buffer.byteLength-t,n=[];if(null==t&&(t=0),t>this.buffer.byteLength-1)return n;null==r&&(r=this.buffer.byteLength-t),r>this.buffer.byteLength-t&&(r=this.buffer.byteLength-t);for(var a={id:-1,position:t};;){var i=a.position;if(-1==(a=this.findFirstIn(e,a.position,r)).id)break;r-=a.position-i,n.push({id:a.id,position:a.position})}return n}},{key:"findAllPatternIn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.buffer.byteLength-t;null==t&&(t=0),t>this.buffer.byteLength&&(t=this.buffer.byteLength),null==r&&(r=this.buffer.byteLength-t),r>this.buffer.byteLength-t&&(r=this.buffer.byteLength-t);var n=[],a=e.buffer.byteLength;if(a>r)return-1;for(var i=Array.from(e.view),s=0;s<=r-a;s++){for(var o=!0,u=t+s,l=0;l<a;l++)if(this.view[l+u]!=i[l]){o=!1;break}o&&(n.push(t+a+s),s+=a-1)}return n}},{key:"findFirstNotIn",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];null==r&&(r=a?this.buffer.byteLength:0),r>this.buffer.byteLength&&(r=this.buffer.byteLength),a?(null==n&&(n=r),n>r&&(n=r)):(null==n&&(n=this.buffer.byteLength-r),n>this.buffer.byteLength-r&&(n=this.buffer.byteLength-r));for(var i={left:{id:-1,position:r},right:{id:-1,position:0},value:new e},s=n;s>0;){if(i.right=this.findFirstIn(t,a?r-n+s:r+n-s,s,a),-1==i.right.id){n=s,a?r-=n:r=i.left.position,i.value=new e,i.value._buffer=this._buffer.slice(r,r+n),i.value._view=new Uint8Array(i.value._buffer);break}if(i.right.position!=(a?i.left.position-t[i.right.id].buffer.byteLength:i.left.position+t[i.right.id].buffer.byteLength)){a?(r=i.right.position+t[i.right.id].buffer.byteLength,n=i.left.position-i.right.position-t[i.right.id].buffer.byteLength):(r=i.left.position,n=i.right.position-i.left.position-t[i.right.id].buffer.byteLength),i.value=new e,i.value._buffer=this._buffer.slice(r,r+n),i.value._view=new Uint8Array(i.value._buffer);break}i.left=i.right,s-=t[i.right.id]._buffer.byteLength}if(a){var o=i.right;i.right=i.left,i.left=o}return i}},{key:"findAllNotIn",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=[];if(null==r&&(r=0),r>this.buffer.byteLength-1)return a;null==n&&(n=this.buffer.byteLength-r),n>this.buffer.byteLength-r&&(n=this.buffer.byteLength-r);var i={left:{id:-1,position:r},right:{id:-1,position:r},value:new e};do{var s=i.right.position;n-=(i=this.findFirstNotIn(t,i.right.position,n)).right.position-s,a.push({left:{id:i.left.id,position:i.left.position},right:{id:i.right.id,position:i.right.position},value:i.value})}while(-1!=i.right.id);return a}},{key:"findFirstSequence",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];null==r&&(r=a?this.buffer.byteLength:0),r>this.buffer.byteLength&&(r=this.buffer.byteLength),a?(null==n&&(n=r),n>r&&(n=r)):(null==n&&(n=this.buffer.byteLength-r),n>this.buffer.byteLength-r&&(n=this.buffer.byteLength-r));var i=this.skipNotPatterns(t,r,n,a);if(-1==i)return{position:-1,value:new e};var s=this.skipPatterns(t,i,n-(a?r-i:i-r),a);a?(r=s,n=i-s):(r=i,n=s-i);var o=new e;return o._buffer=this._buffer.slice(r,r+n),o._view=new Uint8Array(o._buffer),{position:s,value:o}}},{key:"findAllSequences",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=[];if(null==r&&(r=0),r>this.buffer.byteLength-1)return a;null==n&&(n=this.buffer.byteLength-r),n>this.buffer.byteLength-r&&(n=this.buffer.byteLength-r);var i={position:r,value:new e};do{var s=i.position;-1!=(i=this.findFirstSequence(t,i.position,n)).position&&(n-=i.position-s,a.push({position:i.position,value:i.value}))}while(-1!=i.position);return a}},{key:"findPairedPatterns",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=[];if(e.isEqual(t))return a;if(null==r&&(r=0),r>this.buffer.byteLength-1)return a;null==n&&(n=this.buffer.byteLength-r),n>this.buffer.byteLength-r&&(n=this.buffer.byteLength-r);var i=0,s=this.findAllPatternIn(e,r,n);if(0==s.length)return a;var o=this.findAllPatternIn(t,r,n);if(0==o.length)return a;for(;i<s.length&&0!=o.length;)if(s[0]!=o[0]){if(s[i]>o[0])break;for(;s[i]<o[0]&&!(++i>=s.length););a.push({left:s[i-1],right:o[0]}),s.splice(i-1,1),o.splice(0,1),i=0}else a.push({left:s[0],right:o[0]}),s.splice(0,1),o.splice(0,1);return a.sort((function(e,t){return e.left-t.left})),a}},{key:"findPairedArrays",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=[];if(null==r&&(r=0),r>this.buffer.byteLength-1)return a;null==n&&(n=this.buffer.byteLength-r),n>this.buffer.byteLength-r&&(n=this.buffer.byteLength-r);var i=0,s=this.findAllIn(e,r,n);if(0==s.length)return a;var o=this.findAllIn(t,r,n);if(0==o.length)return a;for(;i<s.length&&0!=o.length;)if(s[0].position!=o[0].position){if(s[i].position>o[0].position)break;for(;s[i].position<o[0].position&&!(++i>=s.length););a.push({left:s[i-1],right:o[0]}),s.splice(i-1,1),o.splice(0,1),i=0}else a.push({left:s[0],right:o[0]}),s.splice(0,1),o.splice(0,1);return a.sort((function(e,t){return e.left.position-t.left.position})),a}},{key:"replacePattern",value:function(e,t){var r,n,a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u={status:-1,searchPatternPositions:[],replacePatternPositions:[]};if(null==i&&(i=0),i>this.buffer.byteLength-1)return!1;if(null==s&&(s=this.buffer.byteLength-i),s>this.buffer.byteLength-i&&(s=this.buffer.byteLength-i),null==o){if(0==(n=this.findAllIn([e],i,s)).length)return u}else n=o;(r=u.searchPatternPositions).push.apply(r,g(Array.from(n,(function(e){return e.position}))));var l=e.buffer.byteLength-t.buffer.byteLength,c=new ArrayBuffer(this.view.length-n.length*l),h=new Uint8Array(c);for(h.set(new Uint8Array(this.buffer,0,i)),a=0;a<n.length;a++){var f=0==a?i:n[a-1].position;h.set(new Uint8Array(this.buffer,f,n[a].position-e.buffer.byteLength-f),f-a*l),h.set(t.view,n[a].position-e.buffer.byteLength-a*l),u.replacePatternPositions.push(n[a].position-e.buffer.byteLength-a*l)}return a--,h.set(new Uint8Array(this.buffer,n[a].position,this.buffer.byteLength-n[a].position),n[a].position-e.buffer.byteLength+t.buffer.byteLength-a*l),this.buffer=c,this.view=new Uint8Array(this.buffer),u.status=1,u}},{key:"skipPatterns",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];null==t&&(t=n?this.buffer.byteLength:0),t>this.buffer.byteLength&&(t=this.buffer.byteLength),n?(null==r&&(r=t),r>t&&(r=t)):(null==r&&(r=this.buffer.byteLength-t),r>this.buffer.byteLength-t&&(r=this.buffer.byteLength-t));for(var a=t,i=0;i<e.length;i++){for(var s=e[i].buffer.byteLength,o=n?a-s:a,u=!0,l=0;l<s;l++)if(this.view[l+o]!=e[i].view[l]){u=!1;break}if(u)if(i=-1,n){if((a-=s)<=0)return a}else if((a+=s)>=t+r)return a}return a}},{key:"skipNotPatterns",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];null==t&&(t=n?this.buffer.byteLength:0),t>this.buffer.byteLength&&(t=this.buffer.byteLength),n?(null==r&&(r=t),r>t&&(r=t)):(null==r&&(r=this.buffer.byteLength-t),r>this.buffer.byteLength-t&&(r=this.buffer.byteLength-t));for(var a=-1,i=0;i<r;i++){for(var s=0;s<e.length;s++){for(var o=e[s].buffer.byteLength,u=n?t-i-o:t+i,l=!0,c=0;c<o;c++)if(this.view[c+u]!=e[s].view[c]){l=!1;break}if(l){a=n?t-i:t+i;break}}if(-1!=a)break}return a}}]),e}(),An=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.stream=new Nn,this._length=0,this.backward=!1,this._start=0,this.appendBlock=0,this.prevLength=0,this.prevStart=0;for(var r=0,n=Object.keys(t);r<n.length;r++){var i=n[r];switch(i){case"stream":this.stream=t.stream;break;case"backward":this.backward=t.backward,this._start=this.stream.buffer.byteLength;break;case"length":this._length=t.length;break;case"start":this._start=t.start;break;case"appendBlock":this.appendBlock=t.appendBlock;break;case"view":this.stream=new Nn({view:t.view});break;case"buffer":this.stream=new Nn({buffer:t.buffer});break;case"string":this.stream=new Nn({string:t.string});break;case"hexstring":this.stream=new Nn({hexstring:t.hexstring})}}}return s(e,[{key:"stream",get:function(){return this._stream},set:function(e){this._stream=e,this.prevLength=this._length,this._length=e._buffer.byteLength,this.prevStart=this._start,this._start=0}},{key:"length",get:function(){return this.appendBlock?this.start:this._length},set:function(e){this.prevLength=this._length,this._length=e}},{key:"start",get:function(){return this._start},set:function(e){e>this.stream.buffer.byteLength||(this.prevStart=this._start,this.prevLength=this._length,this._length-=this.backward?this._start-e:e-this._start,this._start=e)}},{key:"buffer",get:function(){return this._stream._buffer.slice(0,this._length)}},{key:"resetPosition",value:function(){this._start=this.prevStart,this._length=this.prevLength}},{key:"findPattern",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(null==t||t>this.length)&&(t=this.length);var r=this.stream.findPattern(e,this.start,this.length,this.backward);if(-1==r)return r;if(this.backward){if(r<this.start-e.buffer.byteLength-t)return-1}else if(r>this.start+e.buffer.byteLength+t)return-1;return this.start=r,r}},{key:"findFirstIn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(null==t||t>this.length)&&(t=this.length);var r=this.stream.findFirstIn(e,this.start,this.length,this.backward);if(-1==r.id)return r;if(this.backward){if(r.position<this.start-e[r.id].buffer.byteLength-t)return{id:-1,position:this.backward?0:this.start+this.length}}else if(r.position>this.start+e[r.id].buffer.byteLength+t)return{id:-1,position:this.backward?0:this.start+this.length};return this.start=r.position,r}},{key:"findAllIn",value:function(e){var t=this.backward?this.start-this.length:this.start;return this.stream.findAllIn(e,t,this.length)}},{key:"findFirstNotIn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(null==t||t>this._length)&&(t=this._length);var r=this._stream.findFirstNotIn(e,this._start,this._length,this.backward);if(-1==r.left.id&&-1==r.right.id)return r;if(this.backward){if(-1!=r.right.id&&r.right.position<this._start-e[r.right.id]._buffer.byteLength-t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new Nn}}else if(-1!=r.left.id&&r.left.position>this._start+e[r.left.id]._buffer.byteLength+t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new Nn};return this.backward?-1==r.left.id?this.start=0:this.start=r.left.position:-1==r.right.id?this.start=this._start+this._length:this.start=r.right.position,r}},{key:"findAllNotIn",value:function(e){var t=this.backward?this._start-this._length:this._start;return this._stream.findAllNotIn(e,t,this._length)}},{key:"findFirstSequence",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(null==t||t>this._length)&&(t=this._length),(null==r||r>t)&&(r=t);var n=this._stream.findFirstSequence(e,this._start,t,this.backward);if(0==n.value.buffer.byteLength)return n;if(this.backward){if(n.position<this._start-n.value._buffer.byteLength-r)return{position:-1,value:new Nn}}else if(n.position>this._start+n.value._buffer.byteLength+r)return{position:-1,value:new Nn};return this.start=n.position,n}},{key:"findAllSequences",value:function(e){var t=this.backward?this.start-this.length:this.start;return this.stream.findAllSequences(e,t,this.length)}},{key:"findPairedPatterns",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(null==r||r>this.length)&&(r=this.length);var n=this.backward?this.start-this.length:this.start,a=this.stream.findPairedPatterns(e,t,n,this.length);if(a.length)if(this.backward){if(a[0].right<this.start-t.buffer.byteLength-r)return[]}else if(a[0].left>this.start+e.buffer.byteLength+r)return[];return a}},{key:"findPairedArrays",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(null==r||r>this.length)&&(r=this.length);var n=this.backward?this.start-this.length:this.start,a=this.stream.findPairedArrays(e,t,n,this.length);if(a.length)if(this.backward){if(a[0].right.position<this.start-t[a[0].right.id].buffer.byteLength-r)return[]}else if(a[0].left.position>this.start+e[a[0].left.id].buffer.byteLength+r)return[];return a}},{key:"replacePattern",value:function(e,t){var r=this.backward?this.start-this.length:this.start;return this.stream.replacePattern(e,t,r,this.length)}},{key:"skipPatterns",value:function(e){var t=this.stream.skipPatterns(e,this.start,this.length,this.backward);return this.start=t,t}},{key:"skipNotPatterns",value:function(e){var t=this.stream.skipNotPatterns(e,this.start,this.length,this.backward);return-1==t?-1:(this.start=t,t)}},{key:"append",value:function(e){this._start+e._buffer.byteLength>this._stream._buffer.byteLength&&(e._buffer.byteLength>this.appendBlock&&(this.appendBlock=e._buffer.byteLength+1e3),this._stream.realloc(this._stream._buffer.byteLength+this.appendBlock)),this._stream._view.set(e._view,this._start),this._length+=2*e._buffer.byteLength,this.start=this._start+e._buffer.byteLength,this.prevLength-=2*e._buffer.byteLength}},{key:"appendView",value:function(e){this._start+e.length>this._stream._buffer.byteLength&&(e.length>this.appendBlock&&(this.appendBlock=e.length+1e3),this._stream.realloc(this._stream._buffer.byteLength+this.appendBlock)),this._stream._view.set(e,this._start),this._length+=2*e.length,this.start=this._start+e.length,this.prevLength-=2*e.length}},{key:"appendChar",value:function(e){this._start+1>this._stream._buffer.byteLength&&(1>this.appendBlock&&(this.appendBlock=1e3),this._stream.realloc(this._stream._buffer.byteLength+this.appendBlock)),this._stream._view[this._start]=e,this._length+=2,this.start=this._start+1,this.prevLength-=2}},{key:"appendUint16",value:function(e){this._start+2>this._stream._buffer.byteLength&&(2>this.appendBlock&&(this.appendBlock=1e3),this._stream.realloc(this._stream._buffer.byteLength+this.appendBlock));var t=new Uint16Array([e]),r=new Uint8Array(t.buffer);this._stream._view[this._start]=r[1],this._stream._view[this._start+1]=r[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}},{key:"appendUint24",value:function(e){this._start+3>this._stream._buffer.byteLength&&(3>this.appendBlock&&(this.appendBlock=1e3),this._stream.realloc(this._stream._buffer.byteLength+this.appendBlock));var t=new Uint32Array([e]),r=new Uint8Array(t.buffer);this._stream._view[this._start]=r[2],this._stream._view[this._start+1]=r[1],this._stream._view[this._start+2]=r[0],this._length+=6,this.start=this._start+3,this.prevLength-=6}},{key:"appendUint32",value:function(e){this._start+4>this._stream._buffer.byteLength&&(4>this.appendBlock&&(this.appendBlock=1e3),this._stream.realloc(this._stream._buffer.byteLength+this.appendBlock));var t=new Uint32Array([e]),r=new Uint8Array(t.buffer);this._stream._view[this._start]=r[3],this._stream._view[this._start+1]=r[2],this._stream._view[this._start+2]=r[1],this._stream._view[this._start+3]=r[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}},{key:"getBlock",value:function(e){var t,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this._length<=0)return[];if(this._length<e&&(e=this._length),this.backward){var n=this._stream._buffer.slice(this._length-e,this._length),a=new Uint8Array(n);t=new Array(e);for(var i=0;i<e;i++)t[e-1-i]=a[i]}else{var s=this._stream._buffer.slice(this._start,this._start+e);t=Array.from(new Uint8Array(s))}return r&&(this.start+=this.backward?-1*e:e),t}},{key:"getUint16",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.getBlock(2,e);if(t.length<2)return 0;var r=new Uint16Array(1),n=new Uint8Array(r.buffer);return n[0]=t[1],n[1]=t[0],r[0]}},{key:"getInt16",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.getBlock(2,e);if(t.length<2)return 0;var r=new Int16Array(1),n=new Uint8Array(r.buffer);return n[0]=t[1],n[1]=t[0],r[0]}},{key:"getUint24",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.getBlock(3,e);if(t.length<3)return 0;for(var r=new Uint32Array(1),n=new Uint8Array(r.buffer),a=3;a>=1;a--)n[3-a]=t[a-1];return r[0]}},{key:"getUint32",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.getBlock(4,e);if(t.length<4)return 0;for(var r=new Uint32Array(1),n=new Uint8Array(r.buffer),a=3;a>=0;a--)n[3-a]=t[a];return r[0]}},{key:"getInt32",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.getBlock(4,e);if(t.length<4)return 0;for(var r=new Int32Array(1),n=new Uint8Array(r.buffer),a=3;a>=0;a--)n[3-a]=t[a];return r[0]}}]),e}(),Cn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.version=Ne(t,"version",e.defaultValues("version")),this.logID=Ne(t,"logID",e.defaultValues("logID")),this.timestamp=Ne(t,"timestamp",e.defaultValues("timestamp")),this.extensions=Ne(t,"extensions",e.defaultValues("extensions")),this.hashAlgorithm=Ne(t,"hashAlgorithm",e.defaultValues("hashAlgorithm")),this.signatureAlgorithm=Ne(t,"signatureAlgorithm",e.defaultValues("signatureAlgorithm")),this.signature=Ne(t,"signature",e.defaultValues("signature")),"schema"in t&&this.fromSchema(t.schema),"stream"in t&&this.fromStream(t.stream)}var t;return s(e,[{key:"fromSchema",value:function(e){if(e instanceof Nr==!1)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestamp");var t=new An({stream:new Nn({buffer:e.data})});this.fromStream(t)}},{key:"fromStream",value:function(e){var t=e.getUint16();if(this.version=e.getBlock(1)[0],0===this.version){this.logID=new Uint8Array(e.getBlock(32)).buffer.slice(0),this.timestamp=new Date(Be(new Uint8Array(e.getBlock(8)),8));var r=e.getUint16();switch(this.extensions=new Uint8Array(e.getBlock(r)).buffer.slice(0),e.getBlock(1)[0]){case 0:this.hashAlgorithm="none";break;case 1:this.hashAlgorithm="md5";break;case 2:this.hashAlgorithm="sha1";break;case 3:this.hashAlgorithm="sha224";break;case 4:this.hashAlgorithm="sha256";break;case 5:this.hashAlgorithm="sha384";break;case 6:this.hashAlgorithm="sha512";break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}switch(e.getBlock(1)[0]){case 0:this.signatureAlgorithm="anonymous";break;case 1:this.signatureAlgorithm="rsa";break;case 2:this.signatureAlgorithm="dsa";break;case 3:this.signatureAlgorithm="ecdsa";break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}var n=e.getUint16(),a=Cr(new Uint8Array(e.getBlock(n)).buffer.slice(0));if(-1===a.offset)throw new Error("Object's stream was not correct for SignedCertificateTimestamp");if(this.signature=a.result,t!==47+r+n)throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}}},{key:"toSchema",value:function(){var e=this.toStream();return new Nr({data:e.stream.buffer})}},{key:"toStream",value:function(){var e=new An;e.appendUint16(47+this.extensions.byteLength+this.signature.valueBeforeDecode.byteLength),e.appendChar(this.version),e.appendView(new Uint8Array(this.logID));var t,r,n=new ArrayBuffer(8),a=new Uint8Array(n),i=xe(this.timestamp.valueOf(),8);switch(a.set(new Uint8Array(i),8-i.byteLength),e.appendView(a),e.appendUint16(this.extensions.byteLength),this.extensions.byteLength&&e.appendView(new Uint8Array(this.extensions)),this.hashAlgorithm.toLowerCase()){case"none":t=0;break;case"md5":t=1;break;case"sha1":t=2;break;case"sha224":t=3;break;case"sha256":t=4;break;case"sha384":t=5;break;case"sha512":t=6;break;default:throw new Error("Incorrect data for hashAlgorithm: ".concat(this.hashAlgorithm))}switch(e.appendChar(t),this.signatureAlgorithm.toLowerCase()){case"anonymous":r=0;break;case"rsa":r=1;break;case"dsa":r=2;break;case"ecdsa":r=3;break;default:throw new Error("Incorrect data for signatureAlgorithm: ".concat(this.signatureAlgorithm))}e.appendChar(r);var s=this.signature.toBER(!1);return e.appendUint16(s.byteLength),e.appendView(new Uint8Array(s)),e}},{key:"toJSON",value:function(){return{version:this.version,logID:Ae(this.logID),timestamp:this.timestamp,extensions:Ae(this.extensions),hashAlgorithm:this.hashAlgorithm,signatureAlgorithm:this.signatureAlgorithm,signature:this.signature.toJSON()}}},{key:"verify",value:(t=n(regeneratorRuntime.mark((function e(t,r){var n,a,i,s,o,u,l,c,h,f,m,v,g=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=g.length>2&&void 0!==g[2]?g[2]:0,a=Te(Ve(this.logID)),i=null,o=new An,u=p(t),e.prev=5,u.s();case 7:if((l=u.n()).done){e.next=14;break}if((c=l.value).log_id!==a){e.next=12;break}return i=c.key,e.abrupt("break",14);case 12:e.next=7;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(5),u.e(e.t0);case 19:return e.prev=19,u.f(),e.finish(19);case 22:if(null!==i){e.next=24;break}throw new Error("Public key not found for CT with logId: ".concat(a));case 24:if(-1!==(h=Cr(_e(He(i)))).offset){e.next=27;break}throw new Error("Incorrect key value for CT Log with logId: ".concat(a));case 27:return s=new Rr({schema:h.result}),o.appendChar(0),o.appendChar(0),f=new ArrayBuffer(8),m=new Uint8Array(f),v=xe(this.timestamp.valueOf(),8),m.set(new Uint8Array(v),8-v.byteLength),o.appendView(m),o.appendUint16(n),0===n&&o.appendUint24(r.byteLength),o.appendView(new Uint8Array(r)),o.appendUint16(this.extensions.byteLength),0!==this.extensions.byteLength&&o.appendView(new Uint8Array(this.extensions)),e.abrupt("return",Gr().subtle.verifyWithPublicKey(o._stream._buffer.slice(0,o._length),{valueBlock:{valueHex:this.signature.toBER(!1)}},s,{algorithmId:""},"SHA-256"));case 41:case"end":return e.stop()}}),e,this,[[5,16,19,22]])}))),function(e,r){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case"version":return 0;case"logID":case"extensions":return new ArrayBuffer(0);case"timestamp":return new Date(0);case"hashAlgorithm":case"signatureAlgorithm":return"";case"signature":return new wr;default:throw new Error("Invalid member name for SignedCertificateTimestamp class: ".concat(e))}}}]),e}(),Bn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.timestamps=Ne(t,"timestamps",e.defaultValues("timestamps")),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(e){if(e instanceof Vt==!1)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");var t=new An({stream:new Nn({buffer:e.valueBlock.valueHex})});if(t.getUint16()!==t.length)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");for(;t.length;)this.timestamps.push(new Cn({stream:t}))}},{key:"toSchema",value:function(){var e,t=new An,r=0,n=[],a=p(this.timestamps);try{for(a.s();!(e=a.n()).done;){var i=e.value.toStream();n.push(i),r+=i.stream.buffer.byteLength}}catch(e){a.e(e)}finally{a.f()}t.appendUint16(r);for(var s=0,o=n;s<o.length;s++){var u=o[s];t.appendView(u.stream.view)}return new Vt({valueHex:t.stream.buffer.slice(0)})}},{key:"toJSON",value:function(){return{timestamps:Array.from(this.timestamps,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){if("timestamps"===e)return[];throw new Error("Invalid member name for SignedCertificateTimestampList class: ".concat(e))}},{key:"compareWithDefault",value:function(e,t){if("timestamps"===e)return 0===t.length;throw new Error("Invalid member name for SignedCertificateTimestampList class: ".concat(e))}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return"optional"in t==!1&&(t.optional=!1),new Vt({name:t.blockName||"SignedCertificateTimestampList",optional:t.optional})}}]),e}(),xn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.templateID=Ne(t,"templateID",e.defaultValues("templateID")),"templateMajorVersion"in t&&(this.templateMajorVersion=Ne(t,"templateMajorVersion",e.defaultValues("templateMajorVersion"))),"templateMinorVersion"in t&&(this.templateMinorVersion=Ne(t,"templateMinorVersion",e.defaultValues("templateMinorVersion"))),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["templateID","templateMajorVersion","templateMinorVersion"]);var r=Br(t,t,e.schema({names:{templateID:"templateID",templateMajorVersion:"templateMajorVersion",templateMinorVersion:"templateMinorVersion"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for CertificateTemplate");this.templateID=r.result.templateID.valueBlock.toString(),"templateMajorVersion"in r.result&&(this.templateMajorVersion=r.result.templateMajorVersion.valueBlock.valueDec),"templateMinorVersion"in r.result&&(this.templateMinorVersion=r.result.templateMinorVersion.valueBlock.valueDec)}},{key:"toSchema",value:function(){var e=[];return e.push(new Jt({value:this.templateID})),"templateMajorVersion"in this&&e.push(new Kt({value:this.templateMajorVersion})),"templateMinorVersion"in this&&e.push(new Kt({value:this.templateMinorVersion})),new Ot({value:e})}},{key:"toJSON",value:function(){var e={extnID:this.templateID};return"templateMajorVersion"in this&&(e.templateMajorVersion=this.templateMajorVersion),"templateMinorVersion"in this&&(e.templateMinorVersion=this.templateMinorVersion),e}}],[{key:"defaultValues",value:function(e){switch(e){case"templateID":return"";case"templateMajorVersion":case"templateMinorVersion":return 0;default:throw new Error("Invalid member name for CertificateTemplate class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Jt({name:t.templateID||""}),new Kt({name:t.templateMajorVersion||"",optional:!0}),new Kt({name:t.templateMinorVersion||"",optional:!0})]})}}]),e}(),In=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.certificateIndex=Ne(t,"certificateIndex",e.defaultValues("certificateIndex")),this.keyIndex=Ne(t,"keyIndex",e.defaultValues("keyIndex")),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(e){if(e.constructor.blockName()!==Kt.blockName())throw new Error("Object's schema was not verified against input data for CAVersion");var t=e.valueBlock.valueHex.slice(0),r=new Uint8Array(t);switch(!0){case t.byteLength<4:var n=new ArrayBuffer(4);new Uint8Array(n).set(r,4-t.byteLength),t=n.slice(0);break;case t.byteLength>4:var a=new ArrayBuffer(4);new Uint8Array(a).set(r.slice(0,4)),t=a.slice(0)}var i=t.slice(0,2),s=new Uint8Array(i),o=s[0];s[0]=s[1],s[1]=o;var u=new Uint16Array(i);this.keyIndex=u[0];var l=t.slice(2),c=new Uint8Array(l);o=c[0],c[0]=c[1],c[1]=o;var h=new Uint16Array(l);this.certificateIndex=h[0]}},{key:"toSchema",value:function(){var e=new ArrayBuffer(2);new Uint16Array(e)[0]=this.certificateIndex;var t=new Uint8Array(e),r=t[0];t[0]=t[1],t[1]=r;var n=new ArrayBuffer(2);new Uint16Array(n)[0]=this.keyIndex;var a=new Uint8Array(n);return r=a[0],a[0]=a[1],a[1]=r,new Kt({valueHex:Ie(n,e)})}},{key:"toJSON",value:function(){return{certificateIndex:this.certificateIndex,keyIndex:this.keyIndex}}}],[{key:"defaultValues",value:function(e){switch(e){case"certificateIndex":case"keyIndex":return 0;default:throw new Error("Invalid member name for CAVersion class: ".concat(e))}}},{key:"schema",value:function(){return new Kt}}]),e}(),En=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.id=Ne(t,"id",e.defaultValues("id")),"type"in t&&(this.type=Ne(t,"type",e.defaultValues("type"))),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["id","type"]);var r=Br(t,t,e.schema({names:{id:"id",type:"type"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for QCStatement");this.id=r.result.id.valueBlock.toString(),"type"in r.result&&(this.type=r.result.type)}},{key:"toSchema",value:function(){var e=[new Jt({value:this.id})];return"type"in this&&e.push(this.type),new Ot({value:e})}},{key:"toJSON",value:function(){var e={id:this.id};return"type"in this&&(e.type=this.type.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case"id":return"";case"type":return new Tt;default:throw new Error("Invalid member name for QCStatement class: ".concat(e))}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"id":return""===t;case"type":return t instanceof Tt;default:throw new Error("Invalid member name for QCStatement class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Jt({name:t.id||""}),new wr({name:t.type||"",optional:!0})]})}}]),e}(),Pn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.values=Ne(t,"values",e.defaultValues("values")),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["values"]);var r=Br(t,t,e.schema({names:{values:"values"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for QCStatements");this.values=Array.from(r.result.values,(function(e){return new En({schema:e})}))}},{key:"toSchema",value:function(){return new Ot({value:Array.from(this.values,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{extensions:Array.from(this.values,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){if("values"===e)return[];throw new Error("Invalid member name for QCStatements class: ".concat(e))}},{key:"compareWithDefault",value:function(e,t){if("values"===e)return 0===t.length;throw new Error("Invalid member name for QCStatements class: ".concat(e))}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Sr({name:t.values||"",value:En.schema(t.value||{})})]})}}]),e}(),Rn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.extnID=Ne(t,"extnID",e.defaultValues("extnID")),this.critical=Ne(t,"critical",e.defaultValues("critical")),this.extnValue="extnValue"in t?new Vt({valueHex:t.extnValue}):e.defaultValues("extnValue"),"parsedValue"in t&&(this.parsedValue=Ne(t,"parsedValue",e.defaultValues("parsedValue"))),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["extnID","critical","extnValue"]);var r=Br(t,t,e.schema({names:{extnID:"extnID",critical:"critical",extnValue:"extnValue"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for Extension");if(this.extnID=r.result.extnID.valueBlock.toString(),"critical"in r.result&&(this.critical=r.result.critical.valueBlock.value),this.extnValue=r.result.extnValue,-1!==(r=Cr(this.extnValue.valueBlock.valueHex)).offset)switch(this.extnID){case"2.5.29.9":try{this.parsedValue=new an({schema:r.result})}catch(e){this.parsedValue=new an,this.parsedValue.parsingError="Incorrectly formated SubjectDirectoryAttributes"}break;case"2.5.29.14":case"2.5.29.15":case"2.5.29.20":case"2.5.29.27":case"2.5.29.21":case"2.5.29.24":case"2.5.29.54":case"1.3.6.1.4.1.311.20.2":case"1.3.6.1.4.1.311.21.2":this.parsedValue=r.result;break;case"2.5.29.16":try{this.parsedValue=new sn({schema:r.result})}catch(e){this.parsedValue=new sn,this.parsedValue.parsingError="Incorrectly formated PrivateKeyUsagePeriod"}break;case"2.5.29.17":case"2.5.29.18":try{this.parsedValue=new rn({schema:r.result})}catch(e){this.parsedValue=new rn,this.parsedValue.parsingError="Incorrectly formated AltName"}break;case"2.5.29.19":try{this.parsedValue=new on({schema:r.result})}catch(e){this.parsedValue=new on,this.parsedValue.parsingError="Incorrectly formated BasicConstraints"}break;case"2.5.29.28":try{this.parsedValue=new un({schema:r.result})}catch(e){this.parsedValue=new un,this.parsedValue.parsingError="Incorrectly formated IssuingDistributionPoint"}break;case"2.5.29.29":try{this.parsedValue=new ln({schema:r.result})}catch(e){this.parsedValue=new ln,this.parsedValue.parsingError="Incorrectly formated GeneralNames"}break;case"2.5.29.30":try{this.parsedValue=new hn({schema:r.result})}catch(e){this.parsedValue=new hn,this.parsedValue.parsingError="Incorrectly formated NameConstraints"}break;case"2.5.29.31":case"2.5.29.46":try{this.parsedValue=new mn({schema:r.result})}catch(e){this.parsedValue=new mn,this.parsedValue.parsingError="Incorrectly formated CRLDistributionPoints"}break;case"2.5.29.32":case"1.3.6.1.4.1.311.21.10":try{this.parsedValue=new dn({schema:r.result})}catch(e){this.parsedValue=new dn,this.parsedValue.parsingError="Incorrectly formated CertificatePolicies"}break;case"2.5.29.33":try{this.parsedValue=new pn({schema:r.result})}catch(e){this.parsedValue=new pn,this.parsedValue.parsingError="Incorrectly formated CertificatePolicies"}break;case"2.5.29.35":try{this.parsedValue=new kn({schema:r.result})}catch(e){this.parsedValue=new kn,this.parsedValue.parsingError="Incorrectly formated AuthorityKeyIdentifier"}break;case"2.5.29.36":try{this.parsedValue=new bn({schema:r.result})}catch(e){this.parsedValue=new bn,this.parsedValue.parsingError="Incorrectly formated PolicyConstraints"}break;case"2.5.29.37":try{this.parsedValue=new wn({schema:r.result})}catch(e){this.parsedValue=new wn,this.parsedValue.parsingError="Incorrectly formated ExtKeyUsage"}break;case"1.3.6.1.5.5.7.1.1":case"1.3.6.1.5.5.7.1.11":try{this.parsedValue=new Sn({schema:r.result})}catch(e){this.parsedValue=new Sn,this.parsedValue.parsingError="Incorrectly formated InfoAccess"}break;case"1.3.6.1.4.1.11129.2.4.2":try{this.parsedValue=new Bn({schema:r.result})}catch(e){this.parsedValue=new Bn,this.parsedValue.parsingError="Incorrectly formated SignedCertificateTimestampList"}break;case"1.3.6.1.4.1.311.21.7":try{this.parsedValue=new xn({schema:r.result})}catch(e){this.parsedValue=new xn,this.parsedValue.parsingError="Incorrectly formated CertificateTemplate"}break;case"1.3.6.1.4.1.311.21.1":try{this.parsedValue=new In({schema:r.result})}catch(e){this.parsedValue=new In,this.parsedValue.parsingError="Incorrectly formated CAVersion"}break;case"1.3.6.1.5.5.7.1.3":try{this.parsedValue=new Pn({schema:r.result})}catch(e){this.parsedValue=new Pn,this.parsedValue.parsingError="Incorrectly formated QCStatements"}}}},{key:"toSchema",value:function(){var t=[];return t.push(new Jt({value:this.extnID})),this.critical!==e.defaultValues("critical")&&t.push(new Ut({value:this.critical})),t.push(this.extnValue),new Ot({value:t})}},{key:"toJSON",value:function(){var t={extnID:this.extnID,extnValue:this.extnValue.toJSON()};return this.critical!==e.defaultValues("critical")&&(t.critical=this.critical),"parsedValue"in this&&"toJSON"in this.parsedValue&&(t.parsedValue=this.parsedValue.toJSON()),t}}],[{key:"defaultValues",value:function(e){switch(e){case"extnID":return"";case"critical":return!1;case"extnValue":return new Vt;case"parsedValue":return{};default:throw new Error("Invalid member name for Extension class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[new Jt({name:t.extnID||""}),new Ut({name:t.critical||"",optional:!0}),new Vt({name:t.extnValue||""})]})}}]),e}(),Ln=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.extensions=Ne(t,"extensions",e.defaultValues("extensions")),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["extensions"]);var r=Br(t,t,e.schema({names:{extensions:"extensions"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for Extensions");this.extensions=Array.from(r.result.extensions,(function(e){return new Rn({schema:e})}))}},{key:"toSchema",value:function(){return new Ot({value:Array.from(this.extensions,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{extensions:Array.from(this.extensions,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){if("extensions"===e)return[];throw new Error("Invalid member name for Extensions class: ".concat(e))}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Ne(e,"names",{});return new Ot({optional:t,name:r.blockName||"",value:[new Sr({name:r.extensions||"",value:Rn.schema(r.extension||{})})]})}}]),e}();function Un(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"tbsCertificate",value:[new Et({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Kt({name:t.tbsCertificateVersion||"tbsCertificate.version"})]}),new Kt({name:t.tbsCertificateSerialNumber||"tbsCertificate.serialNumber"}),xr.schema(t.signature||{names:{blockName:"tbsCertificate.signature"}}),zr.schema(t.issuer||{names:{blockName:"tbsCertificate.issuer"}}),new Ot({name:t.tbsCertificateValidity||"tbsCertificate.validity",value:[nn.schema(t.notBefore||{names:{utcTimeName:"tbsCertificate.notBefore",generalTimeName:"tbsCertificate.notBefore"}}),nn.schema(t.notAfter||{names:{utcTimeName:"tbsCertificate.notAfter",generalTimeName:"tbsCertificate.notAfter"}})]}),zr.schema(t.subject||{names:{blockName:"tbsCertificate.subject"}}),Rr.schema(t.subjectPublicKeyInfo||{names:{blockName:"tbsCertificate.subjectPublicKeyInfo"}}),new xt({name:t.tbsCertificateIssuerUniqueID||"tbsCertificate.issuerUniqueID",optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new xt({name:t.tbsCertificateSubjectUniqueID||"tbsCertificate.subjectUniqueID",optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new Et({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[Ln.schema(t.extensions||{names:{blockName:"tbsCertificate.extensions"}})]})]})}var On=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.tbs=Ne(t,"tbs",e.defaultValues("tbs")),this.version=Ne(t,"version",e.defaultValues("version")),this.serialNumber=Ne(t,"serialNumber",e.defaultValues("serialNumber")),this.signature=Ne(t,"signature",e.defaultValues("signature")),this.issuer=Ne(t,"issuer",e.defaultValues("issuer")),this.notBefore=Ne(t,"notBefore",e.defaultValues("notBefore")),this.notAfter=Ne(t,"notAfter",e.defaultValues("notAfter")),this.subject=Ne(t,"subject",e.defaultValues("subject")),this.subjectPublicKeyInfo=Ne(t,"subjectPublicKeyInfo",e.defaultValues("subjectPublicKeyInfo")),"issuerUniqueID"in t&&(this.issuerUniqueID=Ne(t,"issuerUniqueID",e.defaultValues("issuerUniqueID"))),"subjectUniqueID"in t&&(this.subjectUniqueID=Ne(t,"subjectUniqueID",e.defaultValues("subjectUniqueID"))),"extensions"in t&&(this.extensions=Ne(t,"extensions",e.defaultValues("extensions"))),this.signatureAlgorithm=Ne(t,"signatureAlgorithm",e.defaultValues("signatureAlgorithm")),this.signatureValue=Ne(t,"signatureValue",e.defaultValues("signatureValue")),"schema"in t&&this.fromSchema(t.schema)}return s(e,[{key:"fromSchema",value:function(t){Me(t,["tbsCertificate","tbsCertificate.extensions","tbsCertificate.version","tbsCertificate.serialNumber","tbsCertificate.signature","tbsCertificate.issuer","tbsCertificate.notBefore","tbsCertificate.notAfter","tbsCertificate.subject","tbsCertificate.subjectPublicKeyInfo","tbsCertificate.issuerUniqueID","tbsCertificate.subjectUniqueID","signatureAlgorithm","signatureValue"]);var r=Br(t,t,e.schema({names:{tbsCertificate:{names:{extensions:{names:{extensions:"tbsCertificate.extensions"}}}}}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for Certificate");this.tbs=r.result.tbsCertificate.valueBeforeDecode,"tbsCertificate.version"in r.result&&(this.version=r.result["tbsCertificate.version"].valueBlock.valueDec),this.serialNumber=r.result["tbsCertificate.serialNumber"],this.signature=new xr({schema:r.result["tbsCertificate.signature"]}),this.issuer=new zr({schema:r.result["tbsCertificate.issuer"]}),this.notBefore=new nn({schema:r.result["tbsCertificate.notBefore"]}),this.notAfter=new nn({schema:r.result["tbsCertificate.notAfter"]}),this.subject=new zr({schema:r.result["tbsCertificate.subject"]}),this.subjectPublicKeyInfo=new Rr({schema:r.result["tbsCertificate.subjectPublicKeyInfo"]}),"tbsCertificate.issuerUniqueID"in r.result&&(this.issuerUniqueID=r.result["tbsCertificate.issuerUniqueID"].valueBlock.valueHex),"tbsCertificate.subjectUniqueID"in r.result&&(this.subjectUniqueID=r.result["tbsCertificate.subjectUniqueID"].valueBlock.valueHex),"tbsCertificate.extensions"in r.result&&(this.extensions=Array.from(r.result["tbsCertificate.extensions"],(function(e){return new Rn({schema:e})}))),this.signatureAlgorithm=new xr({schema:r.result.signatureAlgorithm}),this.signatureValue=r.result.signatureValue}},{key:"encodeTBS",value:function(){var t=[];return"version"in this&&this.version!==e.defaultValues("version")&&t.push(new Et({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Kt({value:this.version})]})),t.push(this.serialNumber),t.push(this.signature.toSchema()),t.push(this.issuer.toSchema()),t.push(new Ot({value:[this.notBefore.toSchema(),this.notAfter.toSchema()]})),t.push(this.subject.toSchema()),t.push(this.subjectPublicKeyInfo.toSchema()),"issuerUniqueID"in this&&t.push(new xt({optional:!0,idBlock:{tagClass:3,tagNumber:1},valueHex:this.issuerUniqueID})),"subjectUniqueID"in this&&t.push(new xt({optional:!0,idBlock:{tagClass:3,tagNumber:2},valueHex:this.subjectUniqueID})),"extensions"in this&&t.push(new Et({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[new Ot({value:Array.from(this.extensions,(function(e){return e.toSchema()}))})]})),new Ot({value:t})}},{key:"toSchema",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r={};if(!1===t){if(0===this.tbs.length)return e.schema().value[0];r=Cr(this.tbs).result}else r=this.encodeTBS();return new Ot({value:[r,this.signatureAlgorithm.toSchema(),this.signatureValue]})}},{key:"toJSON",value:function(){var t={tbs:Ae(this.tbs,0,this.tbs.byteLength),serialNumber:this.serialNumber.toJSON(),signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),notBefore:this.notBefore.toJSON(),notAfter:this.notAfter.toJSON(),subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return"version"in this&&this.version!==e.defaultValues("version")&&(t.version=this.version),"issuerUniqueID"in this&&(t.issuerUniqueID=Ae(this.issuerUniqueID,0,this.issuerUniqueID.byteLength)),"subjectUniqueID"in this&&(t.subjectUniqueID=Ae(this.subjectUniqueID,0,this.subjectUniqueID.byteLength)),"extensions"in this&&(t.extensions=Array.from(this.extensions,(function(e){return e.toJSON()}))),t}},{key:"getPublicKey",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return Gr().subtle.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}},{key:"getKeyHash",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SHA-1",t=Jr();return void 0===t?Promise.reject("Unable to create WebCrypto object"):t.digest({name:e},new Uint8Array(this.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHex))}},{key:"sign",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"SHA-1";if(void 0===e)return Promise.reject("Need to provide a private key for signing");var n,a=Promise.resolve(),i=Gr();return a=(a=(a=(a=(a=a.then((function(){return i.subtle.getSignatureParameters(e,r)}))).then((function(e){n=e.parameters,t.signature=e.signatureAlgorithm,t.signatureAlgorithm=e.signatureAlgorithm}))).then((function(){t.tbs=t.encodeTBS().toBER(!1)}))).then((function(){return i.subtle.signWithPrivateKey(t.tbs,e,n)}))).then((function(e){t.signatureValue=new jt({valueHex:e})}))}},{key:"verify",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t={};return null!==e?t=e.subjectPublicKeyInfo:this.issuer.isEqual(this.subject)&&(t=this.subjectPublicKeyInfo),t instanceof Rr==!1?Promise.reject("Please provide issuer certificate as a parameter"):Gr().subtle.verifyWithPublicKey(this.tbs,this.signatureValue,t,this.signatureAlgorithm)}}],[{key:"defaultValues",value:function(e){switch(e){case"tbs":case"issuerUniqueID":case"subjectUniqueID":return new ArrayBuffer(0);case"version":return 0;case"serialNumber":return new Kt;case"signature":case"signatureAlgorithm":return new xr;case"issuer":case"subject":return new zr;case"notBefore":case"notAfter":return new nn;case"subjectPublicKeyInfo":return new Rr;case"extensions":return[];case"signatureValue":return new jt;default:throw new Error("Invalid member name for Certificate class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne(e,"names",{});return new Ot({name:t.blockName||"",value:[Un(t.tbsCertificate),xr.schema(t.signatureAlgorithm||{names:{blockName:"signatureAlgorithm"}}),new jt({name:t.signatureValue||"signatureValue"})]})}}]),e}();function Dn(){if("undefined"==typeof BigInt)throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function Tn(e){if(e.idBlock.isConstructed)for(var t=0;t<e.valueBlock.value.length;t++)Tn(e.valueBlock.value[t])&&(e.lenBlock.isIndefiniteForm=!0);return!!e.lenBlock.isIndefiniteForm}function Hn(e){for(var t=0,r=0,n=0;n<e.length;n++){t+=e[n].byteLength}for(var a=new ArrayBuffer(t),i=new Uint8Array(a),s=0;s<e.length;s++){var o=e[s];i.set(new Uint8Array(o),r),r+=o.byteLength}return a}var Vn=[new Uint8Array([1])],_n="0123456789",jn="name",Mn="valueBeforeDecode",Kn="blockLength",Fn="error",Xn="warnings",Gn="valueHex",Jn="isHexOnly",qn="idBlock",Wn="tagClass",Qn="tagNumber",zn="isConstructed",Yn="lenBlock",Zn="isIndefiniteForm",$n="longFormUsed",ea="length",ta="optional",ra="primitiveSchema",na="value",aa="valueDate",ia="unusedBits",sa="valueDec",oa="isFirstSid",ua="",la=new ArrayBuffer(0),ca=function(){function e(){a(this,e),this.items=[]}return s(e,[{key:"write",value:function(e){this.items.push(e)}},{key:"final",value:function(){return Hn(this.items)}}]),e}(),ha=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.blockLength=Ne(t,Kn,0),this.error=Ne(t,Fn,ua),this.warnings=Ne(t,Xn,[]),this.valueBeforeDecode=Mn in t?t.valueBeforeDecode.slice(0):la}return s(e,[{key:"toJSON",value:function(){return{blockName:this.constructor.blockName(),blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:Ae(this.valueBeforeDecode,0,this.valueBeforeDecode.byteLength)}}}],[{key:"blockName",value:function(){return"baseBlock"}}]),e}(),fa=function(e){return function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).isHexOnly=Ne(n,Jn,!1),e.valueHex=Gn in n?n.valueHex.slice(0):la,e}return s(r,[{key:"fromBER",value:function(e,t,r){return!1===Ce(this,e,t,r)?-1:0===new Uint8Array(e,t,r).length?(this.warnings.push("Zero buffer length"),t):(this.valueHex=e.slice(t,t+r),this.blockLength=r,t+r)}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!0!==this.isHexOnly?(this.error='Flag "isHexOnly" is not set, abort',la):!0===e?new ArrayBuffer(this.valueHex.byteLength):this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.blockName=this.constructor.blockName(),e.isHexOnly=this.isHexOnly,e.valueHex=Ae(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"hexBlock"}}]),r}(e)},ma=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),e=t.call(this),qn in n?(e.isHexOnly=Ne(n.idBlock,Jn,!1),e.valueHex=Ne(n.idBlock,Gn,la),e.tagClass=Ne(n.idBlock,Wn,-1),e.tagNumber=Ne(n.idBlock,Qn,-1),e.isConstructed=Ne(n.idBlock,zn,!1)):(e.tagClass=-1,e.tagNumber=-1,e.isConstructed=!1),e}return s(r,[{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=0;switch(this.tagClass){case 1:n|=0;break;case 2:n|=64;break;case 3:n|=128;break;case 4:n|=192;break;default:return this.error="Unknown tag class",la}if(this.isConstructed&&(n|=32),this.tagNumber<31&&!this.isHexOnly){if(e=new ArrayBuffer(1),t=new Uint8Array(e),!r){var a=this.tagNumber;n|=a&=31,t[0]=n}return e}if(!1===this.isHexOnly){var i=xe(this.tagNumber,7),s=new Uint8Array(i),o=i.byteLength;if(e=new ArrayBuffer(o+1),(t=new Uint8Array(e))[0]=31|n,!r){for(var u=0;u<o-1;u++)t[u+1]=128|s[u];t[o]=s[o-1]}return e}if(e=new ArrayBuffer(this.valueHex.byteLength+1),(t=new Uint8Array(e))[0]=31|n,!1===r){for(var l=new Uint8Array(this.valueHex),c=0;c<l.length-1;c++)t[c+1]=128|l[c];t[this.valueHex.byteLength]=l[l.length-1]}return e}},{key:"fromBER",value:function(e,t,r){if(!1===Ce(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);if(0===n.length)return this.error="Zero buffer length",-1;switch(192&n[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=32==(32&n[0]),this.isHexOnly=!1;var a=31&n[0];if(31!==a)this.tagNumber=a,this.blockLength=1;else{var i=1;this.valueHex=new ArrayBuffer(255);for(var s=255,o=new Uint8Array(this.valueHex);128&n[i];){if(o[i-1]=127&n[i],++i>=n.length)return this.error="End of input reached before message was fully decoded",-1;if(i===s){s+=255;for(var u=new ArrayBuffer(s),l=new Uint8Array(u),c=0;c<o.length;c++)l[c]=o[c];this.valueHex=new ArrayBuffer(s),o=new Uint8Array(this.valueHex)}}this.blockLength=i+1,o[i-1]=127&n[i];for(var h=new ArrayBuffer(i),f=new Uint8Array(h),m=0;m<i;m++)f[m]=o[m];this.valueHex=new ArrayBuffer(i),(o=new Uint8Array(this.valueHex)).set(f),this.blockLength<=9?this.tagNumber=Be(o,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.blockName=this.constructor.blockName(),e.tagClass=this.tagClass,e.tagNumber=this.tagNumber,e.isConstructed=this.isConstructed,e}}],[{key:"blockName",value:function(){return"identificationBlock"}}]),r}(fa(ha)),va=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),e=t.call(this),Yn in n?(e.isIndefiniteForm=Ne(n.lenBlock,Zn,!1),e.longFormUsed=Ne(n.lenBlock,$n,!1),e.length=Ne(n.lenBlock,ea,0)):(e.isIndefiniteForm=!1,e.longFormUsed=!1,e.length=0),e}return s(r,[{key:"fromBER",value:function(e,t,r){if(!1===Ce(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);if(0===n.length)return this.error="Zero buffer length",-1;if(255===n[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===n[0],!0===this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(128&n[0]),!1===this.longFormUsed)return this.length=n[0],this.blockLength=1,t+this.blockLength;var a=127&n[0];if(a>8)return this.error="Too big integer",-1;if(a+1>n.length)return this.error="End of input reached before message was fully decoded",-1;for(var i=new Uint8Array(a),s=0;s<a;s++)i[s]=n[s+1];return 0===i[a-1]&&this.warnings.push("Needlessly long encoded length"),this.length=Be(i,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=a+1,t+this.blockLength}},{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return e=new ArrayBuffer(1),!1===r&&((t=new Uint8Array(e))[0]=128),e;if(!0===this.longFormUsed){var n=xe(this.length,8);if(n.byteLength>127)return this.error="Too big length",la;if(e=new ArrayBuffer(n.byteLength+1),!0===r)return e;var a=new Uint8Array(n);(t=new Uint8Array(e))[0]=128|n.byteLength;for(var i=0;i<n.byteLength;i++)t[i+1]=a[i];return e}return e=new ArrayBuffer(1),!1===r&&((t=new Uint8Array(e))[0]=this.length),e}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.blockName=this.constructor.blockName(),e.isIndefiniteForm=this.isIndefiniteForm,e.longFormUsed=this.longFormUsed,e.length=this.length,e}}],[{key:"blockName",value:function(){return"lengthBlock"}}]),r}(ha),ga=function(e){o(r,e);var t=h(r);function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),t.call(this,e)}return s(r,[{key:"fromBER",value:function(e,t,r){throw TypeError('User need to make a specific function in a class which extends "ValueBlock"')}},{key:"toBER",value:function(){throw TypeError('User need to make a specific function in a class which extends "ValueBlock"')}}],[{key:"blockName",value:function(){return"valueBlock"}}]),r}(ha),da=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ga;return a(this,r),e=t.call(this,n),jn in n&&(e.name=n.name),ta in n&&(e.optional=n.optional),ra in n&&(e.primitiveSchema=n.primitiveSchema),e.idBlock=new ma(n),e.lenBlock=new va(n),e.valueBlock=new i(n),e}return s(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0,r=t||new ca;t||Tn(this);var n=this.idBlock.toBER(e);if(r.write(n),this.lenBlock.isIndefiniteForm)r.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,r),r.write(new ArrayBuffer(2));else{var a=this.valueBlock.toBER(!0);this.lenBlock.length=a.byteLength;var i=this.lenBlock.toBER(e);r.write(i);var s=e?new ArrayBuffer(this.lenBlock.length):this.valueBlock.toBER(e);r.write(s,r)}if(!t)return r.final()}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.idBlock=this.idBlock.toJSON(),e.lenBlock=this.lenBlock.toJSON(),e.valueBlock=this.valueBlock.toJSON(),jn in this&&(e.name=this.name),ta in this&&(e.optional=this.optional),ra in this&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}},{key:"toString",value:function(){return"".concat(this.constructor.blockName()," : ").concat(Ae(this.valueBlock.valueHex))}}],[{key:"blockName",value:function(){return"BaseBlock"}}]),r}(ha),ya=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).valueHex=Gn in n?n.valueHex.slice(0):la,e.isHexOnly=Ne(n,Jn,!0),e}return s(r,[{key:"fromBER",value:function(e,t,r){if(!1===Ce(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);if(0===n.length)return this.warnings.push("Zero buffer length"),t;this.valueHex=new ArrayBuffer(n.length);for(var a=new Uint8Array(this.valueHex),i=0;i<n.length;i++)a[i]=n[i];return this.blockLength=r,t+r}},{key:"toBER",value:function(){return this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.valueHex=Ae(this.valueHex,0,this.valueHex.byteLength),e.isHexOnly=this.isHexOnly,e}}],[{key:"blockName",value:function(){return"PrimitiveValueBlock"}}]),r}(ga),pa=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n,ya)).idBlock.isConstructed=!1,e}return s(r,null,[{key:"blockName",value:function(){return"PRIMITIVE"}}]),r}(da),ka=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).value=Ne(n,na,[]),e.isIndefiniteForm=Ne(n,Zn,!1),e}return s(r,[{key:"fromBER",value:function(e,t,r){var n=t,a=r;if(!1===Ce(this,e,t,r))return-1;if(0===new Uint8Array(e,t,r).length)return this.warnings.push("Zero buffer length"),t;for(var i,s,o=t;i=this.isIndefiniteForm,s=r,(!0===i?1:s)>0;){var u=hi(e,o,r);if(-1===u.offset)return this.error=u.result.error,this.warnings.concat(u.result.warnings),-1;if(o=u.offset,this.blockLength+=u.result.blockLength,r-=u.result.blockLength,this.value.push(u.result),!0===this.isIndefiniteForm&&u.result.constructor.blockName()===Sa.blockName())break}return!0===this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.blockName()===Sa.blockName()?this.value.pop():this.warnings.push("No EndOfContent block encoded")),this.valueBeforeDecode=e.slice(n,n+a),o}},{key:"toBER",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0,r=t||new ca,n=0;n<this.value.length;n++)this.value[n].toBER(e,r);if(!t)return r.final()}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}e.isIndefiniteForm=this.isIndefiniteForm,e.value=[];for(var t=0;t<this.value.length;t++)e.value.push(this.value[t].toJSON());return e}}],[{key:"blockName",value:function(){return"ConstructedValueBlock"}}]),r}(ga),ba=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n,ka)).idBlock.isConstructed=!0,e}return s(r,[{key:"fromBER",value:function(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"toString",value:function(){var e,t=[],r=p(this.valueBlock.value);try{for(r.s();!(e=r.n()).done;){var n=e.value;t.push(n.toString().split("\n").map((function(e){return"  ".concat(e)})).join("\n"))}}catch(e){r.e(e)}finally{r.f()}var a=3===this.idBlock.tagClass?"[".concat(this.idBlock.tagNumber,"]"):this.constructor.blockName();return t.length?"".concat(a," :\n").concat(t.join("\n")):"".concat(a," :")}}],[{key:"blockName",value:function(){return"CONSTRUCTED"}}]),r}(da),wa=function(e){o(r,e);var t=h(r);function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),t.call(this,e)}return s(r,[{key:"fromBER",value:function(e,t,r){return t}},{key:"toBER",value:function(){return la}}],[{key:"blockName",value:function(){return"EndOfContentValueBlock"}}]),r}(ga),Sa=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n,wa)).idBlock.tagClass=1,e.idBlock.tagNumber=0,e}return s(r,null,[{key:"blockName",value:function(){return"EndOfContent"}}]),r}(da),Na=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(a(this,r),(e=t.call(this,n)).value=Ne(n,na,!1),e.isHexOnly=Ne(n,Jn,!1),Gn in n)e.valueHex=n.valueHex.slice(0);else if(e.valueHex=new ArrayBuffer(1),!0===e.value){var i=new Uint8Array(e.valueHex);i[0]=255}return e}return s(r,[{key:"fromBER",value:function(e,t,r){if(!1===Ce(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,this.valueHex=new ArrayBuffer(n.length);for(var a=new Uint8Array(this.valueHex),i=0;i<n.length;i++)a[i]=n[i];return 0!==Pe.call(this)?this.value=!0:this.value=!1,this.blockLength=r,t+r}},{key:"toBER",value:function(){return this.valueHex}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e.isHexOnly=this.isHexOnly,e.valueHex=Ae(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"BooleanValueBlock"}}]),r}(ga),Aa=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n,Na)).idBlock.tagClass=1,e.idBlock.tagNumber=1,e}return s(r,[{key:"toString",value:function(){return"".concat(this.constructor.blockName()," : ").concat(this.valueBlock.value)}}],[{key:"blockName",value:function(){return"BOOLEAN"}}]),r}(da),Ca=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=16,e}return s(r,null,[{key:"blockName",value:function(){return"SEQUENCE"}}]),r}(ba),Ba=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=17,e}return s(r,null,[{key:"blockName",value:function(){return"SET"}}]),r}(ba),xa=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n,ha)).idBlock.tagClass=1,e.idBlock.tagNumber=5,e}return s(r,[{key:"fromBER",value:function(e,t,r){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+r}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0,r=new ArrayBuffer(2);if(!e){var n=new Uint8Array(r);n[0]=5,n[1]=0}return t&&t.write(r),r}},{key:"toString",value:function(){return"".concat(this.constructor.blockName())}}],[{key:"blockName",value:function(){return"NULL"}}]),r}(da),Ia=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).isConstructed=Ne(n,zn,!1),e}return s(r,[{key:"fromBER",value:function(e,t,n){var a=0;if(!0===this.isConstructed){if(this.isHexOnly=!1,-1===(a=ka.prototype.fromBER.call(this,e,t,n)))return a;for(var i=0;i<this.value.length;i++){var s=this.value[i].constructor.blockName();if(s===Sa.blockName()){if(!0===this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(s!==Ea.blockName())return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,a=m(u(r.prototype),"fromBER",this).call(this,e,t,n),this.blockLength=n;return a}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if(!0===this.isConstructed)return ka.prototype.toBER.call(this,e,t);var r=new ArrayBuffer(this.valueHex.byteLength);return!0===e||0===this.valueHex.byteLength?r:r=this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.isConstructed=this.isConstructed,e.isHexOnly=this.isHexOnly,e.valueHex=Ae(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"OctetStringValueBlock"}}]),r}(fa(ka)),Ea=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n,Ia)).idBlock.tagClass=1,e.idBlock.tagNumber=4,e}return s(r,[{key:"fromBER",value:function(e,t,n){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===n)return 0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){var a=e.slice(t,t+n);try{var i=fi(a);-1!==i.offset&&i.offset===n&&(this.valueBlock.value=[i.result])}catch(e){}}return m(u(r.prototype),"fromBER",this).call(this,e,t,n)}},{key:"isEqual",value:function(e){return e instanceof r!=!1&&JSON.stringify(this)===JSON.stringify(e)}},{key:"toString",value:function(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?ba.prototype.toString.call(this):"".concat(this.constructor.blockName()," : ").concat(Ae(this.valueBlock.valueHex))}}],[{key:"blockName",value:function(){return"OCTET STRING"}}]),r}(da),Pa=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).unusedBits=Ne(n,ia,0),e.isConstructed=Ne(n,zn,!1),e.blockLength=e.valueHex.byteLength,e}return s(r,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;var n=-1;if(!0===this.isConstructed){if(-1===(n=ka.prototype.fromBER.call(this,e,t,r)))return n;for(var a=0;a<this.value.length;a++){var i=this.value[a].constructor.blockName();if(i===Sa.blockName()){if(!0===this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(i!==Ra.blockName())return this.error="BIT STRING may consists of BIT STRINGs only",-1;if(this.unusedBits>0&&this.value[a].valueBlock.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;if(this.unusedBits=this.value[a].valueBlock.unusedBits,this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1}return n}if(!1===Ce(this,e,t,r))return-1;var s=new Uint8Array(e,t,r);if(this.unusedBits=s[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){var o=e.slice(t+1,t+r);try{var u=fi(o);-1!==u.offset&&u.offset===r-1&&(this.value=[u.result])}catch(e){}}this.valueHex=new ArrayBuffer(s.length-1);for(var l=new Uint8Array(this.valueHex),c=0;c<r-1;c++)l[c]=s[c+1];return this.blockLength=s.length,t+r}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if(!0===this.isConstructed)return ka.prototype.toBER.call(this,e,t);if(!0===e)return new ArrayBuffer(this.valueHex.byteLength+1);if(0===this.valueHex.byteLength)return la;var r=new Uint8Array(this.valueHex),n=new ArrayBuffer(this.valueHex.byteLength+1),a=new Uint8Array(n);a[0]=this.unusedBits;for(var i=0;i<this.valueHex.byteLength;i++)a[i+1]=r[i];return n}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.unusedBits=this.unusedBits,e.isConstructed=this.isConstructed,e.isHexOnly=this.isHexOnly,e.valueHex=Ae(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"BitStringValueBlock"}}]),r}(fa(ka)),Ra=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n,Pa)).idBlock.tagClass=1,e.idBlock.tagNumber=3,e}return s(r,[{key:"fromBER",value:function(e,t,n){return 0===n?t:(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,m(u(r.prototype),"fromBER",this).call(this,e,t,n))}},{key:"isEqual",value:function(e){return e instanceof r!=!1&&JSON.stringify(this)===JSON.stringify(e)}},{key:"toString",value:function(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return ba.prototype.toString.call(this);var e,t=[],r=p(new Uint8Array(this.valueBlock.valueHex));try{for(r.s();!(e=r.n()).done;){var n=e.value;t.push(n.toString(2).padStart(8,"0"))}}catch(e){r.e(e)}finally{r.f()}return"".concat(this.constructor.blockName()," : ").concat(t.join(""))}}],[{key:"blockName",value:function(){return"BIT STRING"}}]),r}(da),La=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),e=t.call(this,n),na in n&&(e.valueDec=n.value),e}return s(r,[{key:"valueHex",get:function(){return this._valueHex},set:function(e){this._valueHex=e.slice(0),e.byteLength>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,e.byteLength>0&&(this._valueDec=Pe.call(this)))}},{key:"valueDec",get:function(){return this._valueDec},set:function(e){this._valueDec=e,this.isHexOnly=!1,this._valueHex=Re(e)}},{key:"fromDER",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=this.fromBER(e,t,r);if(-1===a)return a;var i=new Uint8Array(this._valueHex);if(0===i[0]&&0!=(128&i[1])){var s=new ArrayBuffer(this._valueHex.byteLength-1),o=new Uint8Array(s);o.set(new Uint8Array(this._valueHex,1,this._valueHex.byteLength-1)),this._valueHex=s.slice(0)}else if(0!==n&&this._valueHex.byteLength<n){n-this._valueHex.byteLength>1&&(n=this._valueHex.byteLength+1);var u=new ArrayBuffer(n),l=new Uint8Array(u);l.set(i,n-this._valueHex.byteLength),this._valueHex=u.slice(0)}return a}},{key:"toDER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new Uint8Array(this._valueHex);switch(!0){case 0!=(128&t[0]):var r=new ArrayBuffer(this._valueHex.byteLength+1),n=new Uint8Array(r);n[0]=0,n.set(t,1),this._valueHex=r.slice(0);break;case 0===t[0]&&0==(128&t[1]):var a=new ArrayBuffer(this._valueHex.byteLength-1),i=new Uint8Array(a);i.set(new Uint8Array(this._valueHex,1,this._valueHex.byteLength-1)),this._valueHex=a.slice(0)}return this.toBER(e)}},{key:"fromBER",value:function(e,t,n){var a=m(u(r.prototype),"fromBER",this).call(this,e,t,n);return-1===a?a:(this.blockLength=n,t+n)}},{key:"toBER",value:function(){return this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.valueDec=this.valueDec,e}},{key:"toString",value:function(){function e(e,t){for(var r=new Uint8Array([0]),n=new Uint8Array(e),a=new Uint8Array(t),i=n.slice(0),s=i.length-1,o=a.slice(0),u=o.length-1,l=0,c=0,h=u<s?s:u;h>=0;h--,c++){if(!0==c<o.length)l=i[s-c]+o[u-c]+r[0];else l=i[s-c]+r[0];if(r[0]=l/10,!0==c>=i.length)i=Ee(new Uint8Array([l%10]),i);else i[s-c]=l%10}return r[0]>0&&(i=Ee(r,i)),i.slice(0)}function t(e){if(e>=Vn.length)for(var t=Vn.length;t<=e;t++){for(var r=new Uint8Array([0]),n=Vn[t-1].slice(0),a=n.length-1;a>=0;a--){var i=new Uint8Array([(n[a]<<1)+r[0]]);r[0]=i[0]/10,n[a]=i[0]%10}r[0]>0&&(n=Ee(r,n)),Vn.push(n)}return Vn[e]}function r(e,t){for(var r,n=0,a=new Uint8Array(e),i=new Uint8Array(t),s=a.slice(0),o=s.length-1,u=i.slice(0),l=u.length-1,c=0,h=l;h>=0;h--,c++)if(!0==(r=s[o-c]-u[l-c]-n)<0)n=1,s[o-c]=r+10;else n=0,s[o-c]=r;if(n>0)for(var f=o-l+1;f>=0;f--,c++){if(!((r=s[o-c]-n)<0)){n=0,s[o-c]=r;break}n=1,s[o-c]=r+10}return s.slice()}for(var n,a=8*this._valueHex.byteLength-1,i=new Uint8Array(8*this._valueHex.byteLength/3),s=0,o=new Uint8Array(this._valueHex),u="",l=!1,c=this._valueHex.byteLength-1;c>=0;c--){n=o[c];for(var h=0;h<8;h++){if(1==(1&n))if(s===a)i=r(t(s),i),u="-";else i=e(i,t(s));s++,n>>=1}}for(var f=0;f<i.length;f++)i[f]&&(l=!0),l&&(u+=_n.charAt(i[f]));return!1===l&&(u+=_n.charAt(0)),u}}],[{key:"blockName",value:function(){return"IntegerValueBlock"}}]),r}(fa(ga)),Ua=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n,La)).idBlock.tagClass=1,e.idBlock.tagNumber=2,e}return s(r,[{key:"isEqual",value:function(e){return e instanceof r?this.valueBlock.isHexOnly&&e.valueBlock.isHexOnly?Le(this.valueBlock.valueHex,e.valueBlock.valueHex):this.valueBlock.isHexOnly===e.valueBlock.isHexOnly&&this.valueBlock.valueDec===e.valueBlock.valueDec:e instanceof ArrayBuffer&&Le(this.valueBlock.valueHex,e)}},{key:"convertToDER",value:function(){var e=new r({valueHex:this.valueBlock.valueHex});return e.valueBlock.toDER(),e}},{key:"convertFromDER",value:function(){var e=this.valueBlock.valueHex.byteLength%2?this.valueBlock.valueHex.byteLength+1:this.valueBlock.valueHex.byteLength,t=new r({valueHex:this.valueBlock.valueHex});return t.valueBlock.fromDER(t.valueBlock.valueHex,0,t.valueBlock.valueHex.byteLength,e),t}},{key:"toString",value:function(){Dn();var e=Ae(this.valueBlock.valueHex),t=BigInt("0x".concat(e));return"".concat(this.constructor.blockName()," : ").concat(t.toString())}}],[{key:"blockName",value:function(){return"INTEGER"}}]),r}(da),Oa=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=10,e}return s(r,null,[{key:"blockName",value:function(){return"ENUMERATED"}}]),r}(Ua),Da=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).valueDec=Ne(n,sa,-1),e.isFirstSid=Ne(n,oa,!1),e}return s(r,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;if(!1===Ce(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);this.valueHex=new ArrayBuffer(r);for(var a=new Uint8Array(this.valueHex),i=0;i<r&&(a[i]=127&n[i],this.blockLength++,0!=(128&n[i]));i++);for(var s=new ArrayBuffer(this.blockLength),o=new Uint8Array(s),u=0;u<this.blockLength;u++)o[u]=a[u];return this.valueHex=s.slice(0),a=new Uint8Array(this.valueHex),0!=(128&n[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===a[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Be(a,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}},{key:"valueBigInt",set:function(e){Dn();for(var t=BigInt(e).toString(2);t.length%7;)t="0"+t;for(var r=new Uint8Array(t.length/7),n=0;n<r.length;n++)r[n]=parseInt(t.slice(7*n,7*n+7),2)+(n+1<r.length?128:0);this.fromBER(r.buffer,0,r.length)}},{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isHexOnly){if(!0===r)return new ArrayBuffer(this.valueHex.byteLength);var n=new Uint8Array(this.valueHex);e=new ArrayBuffer(this.blockLength),t=new Uint8Array(e);for(var a=0;a<this.blockLength-1;a++)t[a]=128|n[a];return t[this.blockLength-1]=n[this.blockLength-1],e}var i=xe(this.valueDec,7);if(0===i.byteLength)return this.error="Error during encoding SID value",la;if(e=new ArrayBuffer(i.byteLength),!1===r){var s=new Uint8Array(i);t=new Uint8Array(e);for(var o=0;o<i.byteLength-1;o++)t[o]=128|s[o];t[i.byteLength-1]=s[i.byteLength-1]}return e}},{key:"toString",value:function(){var e="";if(!0===this.isHexOnly)e=Ae(this.valueHex,0,this.valueHex.byteLength);else if(this.isFirstSid){var t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.valueDec=this.valueDec,e.isFirstSid=this.isFirstSid,e}}],[{key:"blockName",value:function(){return"sidBlock"}}]),r}(fa(ha)),Ta=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).fromString(Ne(n,na,ua)),e}return s(r,[{key:"fromBER",value:function(e,t,r){for(var n=t;r>0;){var a=new Da;if(-1===(n=a.fromBER(e,n,r)))return this.blockLength=0,this.error=a.error,n;0===this.value.length&&(a.isFirstSid=!0),this.blockLength+=a.blockLength,r-=a.blockLength,this.value.push(a)}return n}},{key:"toBER",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=[],r=0;r<this.value.length;r++){var n=this.value[r].toBER(e);if(0===n.byteLength)return this.error=this.value[r].error,la;t.push(n)}return Hn(t)}},{key:"fromString",value:function(e){this.value=[];var t=0,r=0,n="",a=!1;do{if(n=-1===(r=e.indexOf(".",t))?e.substr(t):e.substr(t,r-t),t=r+1,a){var i=this.value[0],s=0;switch(i.valueDec){case 0:break;case 1:s=40;break;case 2:s=80;break;default:return this.value=[],!1}var o=parseInt(n,10);if(isNaN(o))return!0;i.valueDec=o+s,a=!1}else{var u=new Da;if(n>Number.MAX_SAFE_INTEGER){Dn();var l=BigInt(n);u.valueBigInt=l}else if(u.valueDec=parseInt(n,10),isNaN(u.valueDec))return!0;0===this.value.length&&(u.isFirstSid=!0,a=!0),this.value.push(u)}}while(-1!==r);return!0}},{key:"toString",value:function(){for(var e="",t=!1,r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var n=this.value[r].toString();0!==r&&(e="".concat(e,".")),t?(n="{".concat(n,"}"),this.value[r].isFirstSid?e="2.{".concat(n," - 80}"):e+=n):e+=n}return e}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}e.value=this.toString(),e.sidArray=[];for(var t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}],[{key:"blockName",value:function(){return"ObjectIdentifierValueBlock"}}]),r}(ga),Ha=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n,Ta)).idBlock.tagClass=1,e.idBlock.tagNumber=6,e}return s(r,[{key:"toString",value:function(){return"".concat(this.constructor.blockName()," : ").concat(this.valueBlock.toString())}}],[{key:"blockName",value:function(){return"OBJECT IDENTIFIER"}}]),r}(da),Va=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).isHexOnly=!0,e.value="",e}return s(r,[{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"Utf8StringValueBlock"}}]),r}(fa(ha)),_a=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),e=t.call(this,n,Va),na in n&&e.fromString(n.value),e.idBlock.tagClass=1,e.idBlock.tagNumber=12,e}return s(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.valueBlock.value=String.fromCharCode.apply(null,new Uint8Array(e));try{this.valueBlock.value=decodeURIComponent(escape(this.valueBlock.value))}catch(e){this.warnings.push('Error during "decodeURIComponent": '.concat(e,", using raw string"))}}},{key:"fromString",value:function(e){var t=unescape(encodeURIComponent(e)),r=t.length;this.valueBlock.valueHex=new ArrayBuffer(r);for(var n=new Uint8Array(this.valueBlock.valueHex),a=0;a<r;a++)n[a]=t.charCodeAt(a);this.valueBlock.value=e}},{key:"toString",value:function(){return"".concat(this.constructor.blockName()," : ").concat(this.valueBlock.value)}}],[{key:"blockName",value:function(){return"UTF8String"}}]),r}(da),ja=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).valueDec=Ne(n,sa,-1),e}return s(r,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;if(!1===Ce(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);this.valueHex=new ArrayBuffer(r);for(var a=new Uint8Array(this.valueHex),i=0;i<r&&(a[i]=127&n[i],this.blockLength++,0!=(128&n[i]));i++);for(var s=new ArrayBuffer(this.blockLength),o=new Uint8Array(s),u=0;u<this.blockLength;u++)o[u]=a[u];return this.valueHex=s.slice(0),a=new Uint8Array(this.valueHex),0!=(128&n[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===a[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Be(a,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}},{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isHexOnly){if(!0===r)return new ArrayBuffer(this.valueHex.byteLength);var n=new Uint8Array(this.valueHex);e=new ArrayBuffer(this.blockLength),t=new Uint8Array(e);for(var a=0;a<this.blockLength-1;a++)t[a]=128|n[a];return t[this.blockLength-1]=n[this.blockLength-1],e}var i=xe(this.valueDec,7);if(0===i.byteLength)return this.error="Error during encoding SID value",la;if(e=new ArrayBuffer(i.byteLength),!1===r){var s=new Uint8Array(i);t=new Uint8Array(e);for(var o=0;o<i.byteLength-1;o++)t[o]=128|s[o];t[i.byteLength-1]=s[i.byteLength-1]}return e}},{key:"toString",value:function(){return!0===this.isHexOnly?Ae(this.valueHex,0,this.valueHex.byteLength):this.valueDec.toString()}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.valueDec=this.valueDec,e}}],[{key:"blockName",value:function(){return"relativeSidBlock"}}]),r}(fa(ha)),Ma=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).fromString(Ne(n,na,ua)),e}return s(r,[{key:"fromBER",value:function(e,t,r){for(var n=t;r>0;){var a=new ja;if(-1===(n=a.fromBER(e,n,r)))return this.blockLength=0,this.error=a.error,n;this.blockLength+=a.blockLength,r-=a.blockLength,this.value.push(a)}return n}},{key:"toBER",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=[],r=0;r<this.value.length;r++){var n=this.value[r].toBER(e);if(0===n.byteLength)return this.error=this.value[r].error,la;t.push(n)}return Hn(t)}},{key:"fromString",value:function(e){this.value=[];var t=0,r=0,n="";do{n=-1===(r=e.indexOf(".",t))?e.substr(t):e.substr(t,r-t),t=r+1;var a=new ja;if(a.valueDec=parseInt(n,10),isNaN(a.valueDec))return!0;this.value.push(a)}while(-1!==r);return!0}},{key:"toString",value:function(){for(var e="",t=!1,r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var n=this.value[r].toString();0!==r&&(e="".concat(e,".")),e+=t?n="{".concat(n,"}"):n}return e}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}e.value=this.toString(),e.sidArray=[];for(var t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}],[{key:"blockName",value:function(){return"RelativeObjectIdentifierValueBlock"}}]),r}(ga),Ka=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n,Ma)).idBlock.tagClass=1,e.idBlock.tagNumber=13,e}return s(r,null,[{key:"blockName",value:function(){return"RelativeObjectIdentifier"}}]),r}(da),Fa=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).isHexOnly=!0,e.value="",e}return s(r,[{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"BmpStringValueBlock"}}]),r}(fa(ha)),Xa=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),e=t.call(this,n,Fa),na in n&&e.fromString(n.value),e.idBlock.tagClass=1,e.idBlock.tagNumber=30,e}return s(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){for(var t=e.slice(0),r=new Uint8Array(t),n=0;n<r.length;n+=2){var a=r[n];r[n]=r[n+1],r[n+1]=a}this.valueBlock.value=String.fromCharCode.apply(null,new Uint16Array(t))}},{key:"fromString",value:function(e){var t=e.length;this.valueBlock.valueHex=new ArrayBuffer(2*t);for(var r=new Uint8Array(this.valueBlock.valueHex),n=0;n<t;n++){var a=xe(e.charCodeAt(n),8),i=new Uint8Array(a);if(!(i.length>2))for(var s=2-i.length,o=i.length-1;o>=0;o--)r[2*n+o+s]=i[o]}this.valueBlock.value=e}},{key:"toString",value:function(){return"".concat(this.constructor.blockName()," : ").concat(this.valueBlock.value)}}],[{key:"blockName",value:function(){return"BMPString"}}]),r}(da),Ga=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).isHexOnly=!0,e.value="",e}return s(r,[{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"UniversalStringValueBlock"}}]),r}(fa(ha)),Ja=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),e=t.call(this,n,Ga),na in n&&e.fromString(n.value),e.idBlock.tagClass=1,e.idBlock.tagNumber=28,e}return s(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){for(var t=e.slice(0),r=new Uint8Array(t),n=0;n<r.length;n+=4)r[n]=r[n+3],r[n+1]=r[n+2],r[n+2]=0,r[n+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}},{key:"fromString",value:function(e){var t=e.length;this.valueBlock.valueHex=new ArrayBuffer(4*t);for(var r=new Uint8Array(this.valueBlock.valueHex),n=0;n<t;n++){var a=xe(e.charCodeAt(n),8),i=new Uint8Array(a);if(!(i.length>4))for(var s=4-i.length,o=i.length-1;o>=0;o--)r[4*n+o+s]=i[o]}this.valueBlock.value=e}},{key:"toString",value:function(){return"".concat(this.constructor.blockName()," : ").concat(this.valueBlock.value)}}],[{key:"blockName",value:function(){return"UniversalString"}}]),r}(da),qa=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).value="",e.isHexOnly=!0,e}return s(r,[{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"SimpleStringValueBlock"}}]),r}(fa(ha)),Wa=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),e=t.call(this,n,qa),na in n&&e.fromString(n.value),e}return s(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.valueBlock.value=String.fromCharCode.apply(null,new Uint8Array(e))}},{key:"fromString",value:function(e){var t=e.length;this.valueBlock.valueHex=new ArrayBuffer(t);for(var r=new Uint8Array(this.valueBlock.valueHex),n=0;n<t;n++)r[n]=e.charCodeAt(n);this.valueBlock.value=e}},{key:"toString",value:function(){return"".concat(this.constructor.blockName()," : ").concat(this.valueBlock.value)}}],[{key:"blockName",value:function(){return"SIMPLESTRING"}}]),r}(da),Qa=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=18,e}return s(r,null,[{key:"blockName",value:function(){return"NumericString"}}]),r}(Wa),za=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=19,e}return s(r,null,[{key:"blockName",value:function(){return"PrintableString"}}]),r}(Wa),Ya=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=20,e}return s(r,null,[{key:"blockName",value:function(){return"TeletexString"}}]),r}(Wa),Za=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=21,e}return s(r,null,[{key:"blockName",value:function(){return"VideotexString"}}]),r}(Wa),$a=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=22,e}return s(r,null,[{key:"blockName",value:function(){return"IA5String"}}]),r}(Wa),ei=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=25,e}return s(r,null,[{key:"blockName",value:function(){return"GraphicString"}}]),r}(Wa),ti=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=26,e}return s(r,null,[{key:"blockName",value:function(){return"VisibleString"}}]),r}(Wa),ri=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=27,e}return s(r,null,[{key:"blockName",value:function(){return"GeneralString"}}]),r}(Wa),ni=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=29,e}return s(r,null,[{key:"blockName",value:function(){return"CharacterString"}}]),r}(Wa),ai=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(a(this,r),(e=t.call(this,n)).year=0,e.month=0,e.day=0,e.hour=0,e.minute=0,e.second=0,na in n){e.fromString(n.value),e.valueBlock.valueHex=new ArrayBuffer(n.value.length);for(var i=new Uint8Array(e.valueBlock.valueHex),s=0;s<n.value.length;s++)i[s]=n.value.charCodeAt(s)}return aa in n&&(e.fromDate(n.valueDate),e.valueBlock.valueHex=e.toBuffer()),e.idBlock.tagClass=1,e.idBlock.tagNumber=23,e}return s(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.fromString(String.fromCharCode.apply(null,new Uint8Array(e)))}},{key:"toBuffer",value:function(){for(var e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t}},{key:"fromDate",value:function(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}},{key:"fromString",value:function(e){var t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/gi.exec(e);if(null!==t){var r=parseInt(t[1],10);this.year=r>=50?1900+r:2e3+r,this.month=parseInt(t[2],10),this.day=parseInt(t[3],10),this.hour=parseInt(t[4],10),this.minute=parseInt(t[5],10),this.second=parseInt(t[6],10)}else this.error="Wrong input string for conversion"}},{key:"toString",value:function(){var e=new Array(7);return e[0]=Ue(this.year<2e3?this.year-1900:this.year-2e3,2),e[1]=Ue(this.month,2),e[2]=Ue(this.day,2),e[3]=Ue(this.hour,2),e[4]=Ue(this.minute,2),e[5]=Ue(this.second,2),e[6]="Z",e.join("")}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.year=this.year,e.month=this.month,e.day=this.day,e.hour=this.hour,e.minute=this.minute,e.second=this.second,e}}],[{key:"blockName",value:function(){return"UTCTime"}}]),r}(ti),ii=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(a(this,r),(e=t.call(this,n)).year=0,e.month=0,e.day=0,e.hour=0,e.minute=0,e.second=0,e.millisecond=0,na in n){e.fromString(n.value),e.valueBlock.valueHex=new ArrayBuffer(n.value.length);for(var i=new Uint8Array(e.valueBlock.valueHex),s=0;s<n.value.length;s++)i[s]=n.value.charCodeAt(s)}return aa in n&&(e.fromDate(n.valueDate),e.valueBlock.valueHex=e.toBuffer()),e.idBlock.tagClass=1,e.idBlock.tagNumber=24,e}return s(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.fromString(String.fromCharCode.apply(null,new Uint8Array(e)))}},{key:"toBuffer",value:function(){for(var e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t}},{key:"fromDate",value:function(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds(),this.millisecond=e.getUTCMilliseconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}},{key:"fromString",value:function(e){var t,r=!1,n="",a="",i=0,s=0,o=0;if("Z"===e[e.length-1])n=e.substr(0,e.length-1),r=!0;else{var u=new Number(e[e.length-1]);if(isNaN(u.valueOf()))throw new Error("Wrong input string for conversion");n=e}if(r){if(-1!==n.indexOf("+"))throw new Error("Wrong input string for conversion");if(-1!==n.indexOf("-"))throw new Error("Wrong input string for conversion")}else{var l=1,c=n.indexOf("+"),h="";if(-1===c&&(c=n.indexOf("-"),l=-1),-1!==c){if(h=n.substr(c+1),n=n.substr(0,c),2!==h.length&&4!==h.length)throw new Error("Wrong input string for conversion");var f=new Number(h.substr(0,2));if(isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");if(s=l*f,4===h.length){if(f=new Number(h.substr(2,2)),isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");o=l*f}}}var m=n.indexOf(".");if(-1===m&&(m=n.indexOf(",")),-1!==m){var v=new Number("0".concat(n.substr(m)));if(isNaN(v.valueOf()))throw new Error("Wrong input string for conversion");i=v.valueOf(),a=n.substr(0,m)}else a=n;switch(!0){case 8===a.length:if(t=/(\d{4})(\d{2})(\d{2})/gi,-1!==m)throw new Error("Wrong input string for conversion");break;case 10===a.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})/gi,-1!==m){var g=60*i;this.minute=Math.floor(g),g=60*(g-this.minute),this.second=Math.floor(g),g=1e3*(g-this.second),this.millisecond=Math.floor(g)}break;case 12===a.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==m){var d=60*i;this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case 14===a.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==m){var y=1e3*i;this.millisecond=Math.floor(y)}break;default:throw new Error("Wrong input string for conversion")}var p=t.exec(a);if(null===p)throw new Error("Wrong input string for conversion");for(var k=1;k<p.length;k++)switch(k){case 1:this.year=parseInt(p[k],10);break;case 2:this.month=parseInt(p[k],10);break;case 3:this.day=parseInt(p[k],10);break;case 4:this.hour=parseInt(p[k],10)+s;break;case 5:this.minute=parseInt(p[k],10)+o;break;case 6:this.second=parseInt(p[k],10);break;default:throw new Error("Wrong input string for conversion")}if(!1===r){var b=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=b.getUTCFullYear(),this.month=b.getUTCMonth(),this.day=b.getUTCDay(),this.hour=b.getUTCHours(),this.minute=b.getUTCMinutes(),this.second=b.getUTCSeconds(),this.millisecond=b.getUTCMilliseconds()}}},{key:"toString",value:function(){var e=[];return e.push(Ue(this.year,4)),e.push(Ue(this.month,2)),e.push(Ue(this.day,2)),e.push(Ue(this.hour,2)),e.push(Ue(this.minute,2)),e.push(Ue(this.second,2)),0!==this.millisecond&&(e.push("."),e.push(Ue(this.millisecond,3))),e.push("Z"),e.join("")}},{key:"toJSON",value:function(){var e={};try{e=m(u(r.prototype),"toJSON",this).call(this)}catch(e){}return e.year=this.year,e.month=this.month,e.day=this.day,e.hour=this.hour,e.minute=this.minute,e.second=this.second,e.millisecond=this.millisecond,e}}],[{key:"blockName",value:function(){return"GeneralizedTime"}}]),r}(ti),si=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=31,e}return s(r,null,[{key:"blockName",value:function(){return"DATE"}}]),r}(_a),oi=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=32,e}return s(r,null,[{key:"blockName",value:function(){return"TimeOfDay"}}]),r}(_a),ui=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=33,e}return s(r,null,[{key:"blockName",value:function(){return"DateTime"}}]),r}(_a),li=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=34,e}return s(r,null,[{key:"blockName",value:function(){return"Duration"}}]),r}(_a),ci=function(e){o(r,e);var t=h(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=14,e}return s(r,null,[{key:"blockName",value:function(){return"TIME"}}]),r}(_a);function hi(e,t,r){var n=t;var a=new da({},Object),i=new ha;if(!1===Ce(i,e,t,r))return a.error=i.error,{offset:-1,result:a};if(0===new Uint8Array(e,t,r).length)return a.error="Zero buffer length",{offset:-1,result:a};var s=a.idBlock.fromBER(e,t,r);if(a.warnings.concat(a.idBlock.warnings),-1===s)return a.error=a.idBlock.error,{offset:-1,result:a};if(t=s,r-=a.idBlock.blockLength,s=a.lenBlock.fromBER(e,t,r),a.warnings.concat(a.lenBlock.warnings),-1===s)return a.error=a.lenBlock.error,{offset:-1,result:a};if(t=s,r-=a.lenBlock.blockLength,!1===a.idBlock.isConstructed&&!0===a.lenBlock.isIndefiniteForm)return a.error="Indefinite length form used for primitive encoding form",{offset:-1,result:a};var o=da;if(1===a.idBlock.tagClass){if(a.idBlock.tagNumber>=37&&!1===a.idBlock.isHexOnly)return a.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:a};switch(a.idBlock.tagNumber){case 0:if(!0===a.idBlock.isConstructed&&a.lenBlock.length>0)return a.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:a};o=Sa;break;case 1:o=Aa;break;case 2:o=Ua;break;case 3:o=Ra;break;case 4:o=Ea;break;case 5:o=xa;break;case 6:o=Ha;break;case 10:o=Oa;break;case 12:o=_a;break;case 13:o=Ka;break;case 14:o=ci;break;case 15:return a.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:a};case 16:o=Ca;break;case 17:o=Ba;break;case 18:o=Qa;break;case 19:o=za;break;case 20:o=Ya;break;case 21:o=Za;break;case 22:o=$a;break;case 23:o=ai;break;case 24:o=ii;break;case 25:o=ei;break;case 26:o=ti;break;case 27:o=ri;break;case 28:o=Ja;break;case 29:o=ni;break;case 30:o=Xa;break;case 31:o=si;break;case 32:o=oi;break;case 33:o=ui;break;case 34:o=li;break;default:var u;(u=!0===a.idBlock.isConstructed?new ba:new pa).idBlock=a.idBlock,u.lenBlock=a.lenBlock,u.warnings=a.warnings,a=u}}else o=!0===a.idBlock.isConstructed?ba:pa;return a=function(e,t){if(e instanceof t)return e;var r=new t;return r.idBlock=e.idBlock,r.lenBlock=e.lenBlock,r.warnings=e.warnings,r.valueBeforeDecode=e.valueBeforeDecode.slice(0),r}(a,o),s=a.fromBER(e,t,!0===a.lenBlock.isIndefiniteForm?r:a.lenBlock.length),a.valueBeforeDecode=e.slice(n,n+a.blockLength),{offset:s,result:a}}function fi(e){if(0===e.byteLength){var t=new da({},Object);return t.error="Input buffer has zero length",{offset:-1,result:t}}return hi(e,0,e.byteLength)}var mi=function(){function e(){a(this,e)}return s(e,null,[{key:"isArrayBuffer",value:function(e){return"[object ArrayBuffer]"===Object.prototype.toString.call(e)}},{key:"toArrayBuffer",value:function(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e).slice().buffer}},{key:"toUint8Array",value:function(e){return this.toView(e,Uint8Array)}},{key:"toView",value:function(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}},{key:"isBufferSource",value:function(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}},{key:"isArrayBufferView",value:function(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}},{key:"isEqual",value:function(t,r){var n=e.toUint8Array(t),a=e.toUint8Array(r);if(n.length!==a.byteLength)return!1;for(var i=0;i<n.length;i++)if(n[i]!==a[i])return!1;return!0}},{key:"concat",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Array.isArray(t[0])){var n,a=t[0],i=0,s=p(a);try{for(s.s();!(n=s.n()).done;){var o=n.value;i+=o.byteLength}}catch(e){s.e(e)}finally{s.f()}var u,l=new Uint8Array(i),c=0,h=p(a);try{for(h.s();!(u=h.n()).done;){var f=u.value,m=this.toUint8Array(f);l.set(m,c),c+=m.length}}catch(e){h.e(e)}finally{h.f()}return t[1]?this.toView(l,t[1]):l.buffer}return this.concat(t)}}]),e}(),vi=function(){function e(){a(this,e)}return s(e,null,[{key:"fromString",value:function(e){for(var t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r.buffer}},{key:"toString",value:function(e){for(var t=mi.toUint8Array(e),r="",n=0;n<t.length;n++)r+=String.fromCharCode(t[n]);return decodeURIComponent(escape(r))}}]),e}(),gi=function(){function e(){a(this,e)}return s(e,null,[{key:"toString",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=mi.toArrayBuffer(e),n=new DataView(r),a="",i=0;i<r.byteLength;i+=2){var s=n.getUint16(i,t);a+=String.fromCharCode(s)}return a}},{key:"fromString",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=new ArrayBuffer(2*e.length),n=new DataView(r),a=0;a<e.length;a++)n.setUint16(2*a,e.charCodeAt(a),t);return r}}]),e}(),di=function(){function e(){a(this,e)}return s(e,null,[{key:"isHex",value:function(e){return"string"==typeof e&&/^[a-z0-9]+$/i.test(e)}},{key:"isBase64",value:function(e){return"string"==typeof e&&/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},{key:"isBase64Url",value:function(e){return"string"==typeof e&&/^[a-zA-Z0-9-_]+$/i.test(e)}},{key:"ToString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",r=mi.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);case"utf16le":return gi.toString(r,!0);case"utf16":case"utf16be":return gi.toString(r);default:throw new Error("Unknown type of encoding '".concat(t,"'"))}}},{key:"FromString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return gi.fromString(e,!0);case"utf16":case"utf16be":return gi.fromString(e);default:throw new Error("Unknown type of encoding '".concat(t,"'"))}}},{key:"ToBase64",value:function(e){var t=mi.toUint8Array(e);if("undefined"!=typeof btoa){var r=this.ToString(t,"binary");return btoa(r)}return Buffer.from(t).toString("base64")}},{key:"FromBase64",value:function(t){var r=this.formatString(t);if(!r)return new ArrayBuffer(0);if(!e.isBase64(r))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return"undefined"!=typeof atob?this.FromBinary(atob(r)):new Uint8Array(Buffer.from(r,"base64")).buffer}},{key:"FromBase64Url",value:function(t){var r=this.formatString(t);if(!r)return new ArrayBuffer(0);if(!e.isBase64Url(r))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(r.replace(/\-/g,"+").replace(/\_/g,"/")))}},{key:"ToBase64Url",value:function(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}},{key:"FromUtf8String",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.DEFAULT_UTF8_ENCODING;switch(r){case"ascii":return this.FromBinary(t);case"utf8":return vi.fromString(t);case"utf16":case"utf16be":return gi.fromString(t);case"utf16le":case"usc2":return gi.fromString(t,!0);default:throw new Error("Unknown type of encoding '".concat(r,"'"))}}},{key:"ToUtf8String",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.DEFAULT_UTF8_ENCODING;switch(r){case"ascii":return this.ToBinary(t);case"utf8":return vi.toString(t);case"utf16":case"utf16be":return gi.toString(t);case"utf16le":case"usc2":return gi.toString(t,!0);default:throw new Error("Unknown type of encoding '".concat(r,"'"))}}},{key:"FromBinary",value:function(e){for(var t=e.length,r=new Uint8Array(t),n=0;n<t;n++)r[n]=e.charCodeAt(n);return r.buffer}},{key:"ToBinary",value:function(e){for(var t=mi.toUint8Array(e),r="",n=0;n<t.length;n++)r+=String.fromCharCode(t[n]);return r}},{key:"ToHex",value:function(e){for(var t=mi.toUint8Array(e),r=[],n=t.length,a=0;a<n;a++){var i=t[a].toString(16).padStart(2,"0");r.push(i)}return r.join("")}},{key:"FromHex",value:function(t){var r=this.formatString(t);if(!r)return new ArrayBuffer(0);if(!e.isHex(r))throw new TypeError("Argument 'hexString' is not HEX encoded");r.length%2&&(r="0".concat(r));for(var n=new Uint8Array(r.length/2),a=0;a<r.length;a+=2){var i=r.slice(a,a+2);n[a/2]=parseInt(i,16)}return n.buffer}},{key:"ToUtf16String",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return gi.toString(e,t)}},{key:"FromUtf16String",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return gi.fromString(e,t)}},{key:"Base64Padding",value:function(e){var t=4-e.length%4;if(t<4)for(var r=0;r<t;r++)e+="=";return e}},{key:"formatString",value:function(e){return(null==e?void 0:e.replace(/[\n\r\t ]/g,""))||""}}]),e}();di.DEFAULT_UTF8_ENCODING="utf8";var yi=null,pi=function(){function e(){a(this,e)}return s(e,null,[{key:"setEngine",value:function(e,t){yi=Object.assign(t,{name:e}),Xr(e,t,new Kr({name:e,crypto:t,subtle:t.subtle}))}},{key:"crypto",get:function(){if(!yi)throw new O(U.CRYPTOGRAPHIC_NO_MODULE);return yi}},{key:"isNodePlugin",value:function(){return"undefined"==typeof self&&"undefined"==typeof window}}]),e}();pi.isNodePlugin()||pi.setEngine("W3 WebCrypto module",self.crypto);var ki,bi=function(){function e(){a(this,e)}return s(e,[{key:"getAlgorithmName",value:function(){return this.namespaceURI}}]),e}(),wi=function(e){o(i,e);var t,r=h(i);function i(){return a(this,i),r.apply(this,arguments)}return s(i,[{key:"Digest",value:(t=n(regeneratorRuntime.mark((function e(t){var r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"string"==typeof t?r=H.FromString(t,"utf8"):ArrayBuffer.isView(t)?r=new Uint8Array(t.buffer):t instanceof ArrayBuffer?r=new Uint8Array(t):(n=(new XMLSerializer).serializeToString(t),r=H.FromString(n,"utf8")),e.next=3,pi.crypto.subtle.digest(this.algorithm,r);case 3:return a=e.sent,e.abrupt("return",new Uint8Array(a));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),i}(bi),Si=function(e){o(u,e);var t,r,i=h(u);function u(){return a(this,u),i.apply(this,arguments)}return s(u,[{key:"Sign",value:(r=n(regeneratorRuntime.mark((function e(t,r,n){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=H.FromString(t,"utf8"),e.abrupt("return",pi.crypto.subtle.sign(n,r,a));case 2:case"end":return e.stop()}}),e)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"Verify",value:(t=n(regeneratorRuntime.mark((function e(t,r,n,a){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=H.FromString(t,"utf8"),e.abrupt("return",pi.crypto.subtle.verify(a||this.algorithm,r,n,i));case 2:case"end":return e.stop()}}),e,this)}))),function(e,r,n,a){return t.apply(this,arguments)})}]),u}(bi),Ni="SHA-1",Ai="SHA-256",Ci="SHA-384",Bi="SHA-512",xi="http://www.w3.org/2000/09/xmldsig#sha1",Ii="http://www.w3.org/2001/04/xmlenc#sha256",Ei="http://www.w3.org/2001/04/xmldsig-more#sha384",Pi="http://www.w3.org/2001/04/xmlenc#sha512",Ri=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.apply(this,arguments)).algorithm={name:Ni},e.namespaceURI=xi,e}return s(r)}(wi),Li=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.apply(this,arguments)).algorithm={name:Ai},e.namespaceURI=Ii,e}return s(r)}(wi),Ui=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.apply(this,arguments)).algorithm={name:Ci},e.namespaceURI=Ei,e}return s(r)}(wi),Oi=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.apply(this,arguments)).algorithm={name:Bi},e.namespaceURI=Pi,e}return s(r)}(wi),Di="ECDSA",Ti="http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha1",Hi="http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha256",Vi="http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha384",_i="http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha512",ji=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.apply(this,arguments)).algorithm={name:Di,hash:{name:Ni}},e.namespaceURI=Ti,e}return s(r)}(Si),Mi=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.apply(this,arguments)).algorithm={name:Di,hash:{name:Ai}},e.namespaceURI=Hi,e}return s(r)}(Si),Ki=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.apply(this,arguments)).algorithm={name:Di,hash:{name:Ci}},e.namespaceURI=Vi,e}return s(r)}(Si),Fi=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.apply(this,arguments)).algorithm={name:Di,hash:{name:Bi}},e.namespaceURI=_i,e}return s(r)}(Si),Xi="HMAC",Gi="http://www.w3.org/2000/09/xmldsig#hmac-sha1",Ji="http://www.w3.org/2001/04/xmldsig-more#hmac-sha256",qi="http://www.w3.org/2001/04/xmldsig-more#hmac-sha384",Wi="http://www.w3.org/2001/04/xmldsig-more#hmac-sha512",Qi=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.apply(this,arguments)).algorithm={name:Xi,hash:{name:Ni}},e.namespaceURI=Gi,e}return s(r)}(Si),zi=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.apply(this,arguments)).algorithm={name:Xi,hash:{name:Ai}},e.namespaceURI=Ji,e}return s(r)}(Si),Yi=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.apply(this,arguments)).algorithm={name:Xi,hash:{name:Ci}},e.namespaceURI=qi,e}return s(r)}(Si),Zi=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.apply(this,arguments)).algorithm={name:Xi,hash:{name:Bi}},e.namespaceURI=Wi,e}return s(r)}(Si),$i="RSASSA-PKCS1-v1_5",es="http://www.w3.org/2000/09/xmldsig#rsa-sha1",ts="http://www.w3.org/2001/04/xmldsig-more#rsa-sha256",rs="http://www.w3.org/2001/04/xmldsig-more#rsa-sha384",ns="http://www.w3.org/2001/04/xmldsig-more#rsa-sha512",as=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.apply(this,arguments)).algorithm={name:$i,hash:{name:Ni}},e.namespaceURI=es,e}return s(r)}(Si),is=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.apply(this,arguments)).algorithm={name:$i,hash:{name:Ai}},e.namespaceURI=ts,e}return s(r)}(Si),ss=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.apply(this,arguments)).algorithm={name:$i,hash:{name:Ci}},e.namespaceURI=rs,e}return s(r)}(Si),os=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.apply(this,arguments)).algorithm={name:$i,hash:{name:Bi}},e.namespaceURI=ns,e}return s(r)}(Si),us="RSA-PSS",ls="http://www.w3.org/2007/05/xmldsig-more#rsa-pss",cs=function(e){o(r,e);var t=h(r);function r(e){var n;return a(this,r),(n=t.call(this)).algorithm={name:us,hash:{name:Ni}},n.namespaceURI=ls,e&&(n.algorithm.saltLength=e),n}return s(r)}(Si),hs=function(e){o(r,e);var t=h(r);function r(e){var n;return a(this,r),(n=t.call(this,e)).algorithm.hash.name=Ni,n}return s(r)}(cs),fs=function(e){o(r,e);var t=h(r);function r(e){var n;return a(this,r),(n=t.call(this,e)).algorithm.hash.name=Ai,n}return s(r)}(cs),ms=function(e){o(r,e);var t=h(r);function r(e){var n;return a(this,r),(n=t.call(this,e)).algorithm.hash.name=Ci,n}return s(r)}(cs),vs=function(e){o(r,e);var t=h(r);function r(e){var n;return a(this,r),(n=t.call(this,e)).algorithm.hash.name=Bi,n}return s(r)}(cs),gs="http://www.w3.org/2007/05/xmldsig-more#sha1-rsa-MGF1",ds=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.call(this)).algorithm={name:us,hash:{name:Ni}},e.namespaceURI=gs,e}return s(r)}(Si),ys=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.call(this)).algorithm.hash.name=Ni,e.algorithm.saltLength=20,e}return s(r)}(ds),ps=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.call(this)).algorithm.hash.name=Ai,e.algorithm.saltLength=32,e}return s(r)}(ds),ks=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.call(this)).algorithm.hash.name=Ci,e.algorithm.saltLength=48,e}return s(r)}(ds),bs=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.call(this)).algorithm.hash.name=Bi,e.algorithm.saltLength=64,e}return s(r)}(ds);!function(e){e[e.BeforeDocElement=0]="BeforeDocElement",e[e.InsideDocElement=1]="InsideDocElement",e[e.AfterDocElement=2]="AfterDocElement"}(ki||(ki={}));var ws=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new re;a(this,e),this.propagatedNamespaces=new re,this.result=[],this.visibleNamespaces=new re,this.inclusiveNamespacesPrefixList=[],this.state=ki.BeforeDocElement,this.withComments=t,this.exclusive=r,this.propagatedNamespaces=n}return s(e,[{key:"InclusiveNamespacesPrefixList",get:function(){return this.inclusiveNamespacesPrefixList.join(" ")},set:function(e){this.inclusiveNamespacesPrefixList=e.split(" ")}},{key:"Canonicalize",value:function(e){if(!e)throw new O(U.CRYPTOGRAPHIC,"Parameter 1 is not Node");return this.WriteNode(e),this.result.join("")}},{key:"WriteNode",value:function(e){switch(e.nodeType){case T.Document:case T.DocumentFragment:this.WriteDocumentNode(e);break;case T.Element:this.WriteElementNode(e);break;case T.CDATA:case T.SignificantWhitespace:case T.Text:z(e.parentNode)||this.WriteTextNode(e);break;case T.Whitespace:this.state===ki.InsideDocElement&&this.WriteTextNode(e);break;case T.Comment:this.WriteCommentNode(e);break;case T.ProcessingInstruction:this.WriteProcessingInstructionNode(e);break;case T.EntityReference:for(var t=0;t<e.childNodes.length;t++)this.WriteNode(e.childNodes[t]);break;case T.Attribute:case T.EndElement:case T.EndEntity:throw new O(U.CRYPTOGRAPHIC,"Attribute node is impossible here");case T.DocumentType:case T.Entity:case T.Notation:case T.XmlDeclaration:}}},{key:"WriteDocumentNode",value:function(e){this.state=ki.BeforeDocElement;for(var t=e.firstChild;null!=t;t=t.nextSibling)this.WriteNode(t)}},{key:"WriteCommentNode",value:function(e){this.withComments&&(this.state===ki.AfterDocElement?this.result.push(String.fromCharCode(10)+"\x3c!--"):this.result.push("\x3c!--"),this.result.push(this.NormalizeString(e.nodeValue,T.Comment)),this.state===ki.BeforeDocElement?this.result.push("--\x3e"+String.fromCharCode(10)):this.result.push("--\x3e"))}},{key:"WriteTextNode",value:function(e){this.result.push(this.NormalizeString(e.nodeValue,e.nodeType))}},{key:"WriteProcessingInstructionNode",value:function(e){var t=e.nodeName||e.tagName;"xml"!==t&&(this.state===ki.AfterDocElement?this.result.push("\n<?"):this.result.push("<?"),this.result.push(t),e.nodeValue&&(this.result.push(" "),this.result.push(this.NormalizeString(e.nodeValue,T.ProcessingInstruction))),this.state===ki.BeforeDocElement?this.result.push("?>\n"):this.result.push("?>"))}},{key:"WriteElementNode",value:function(e){var t=this.state;this.state===ki.BeforeDocElement&&(this.state=ki.InsideDocElement),this.result.push("<"),this.result.push(e.nodeName);var r=this.WriteNamespacesAxis(e);this.WriteAttributesAxis(e),this.result.push(">");for(var n=e.firstChild;null!=n;n=n.nextSibling)this.WriteNode(n);for(this.result.push("</"),this.result.push(e.nodeName),this.result.push(">"),t===ki.BeforeDocElement&&(this.state=ki.AfterDocElement);r--;)this.visibleNamespaces.Pop()}},{key:"WriteNamespacesAxis",value:function(e){for(var t=this,r=[],n=0,a=0;a<e.attributes.length;a++){var i=e.attributes[a];if(Cs(i)){if("xmlns"===i.localName&&!i.prefix&&!i.nodeValue){var s={prefix:i.prefix,namespace:i.nodeValue};r.push(s),this.visibleNamespaces.Add(s),n++}var o,u=null;(o=/xmlns:([\w\.-]+)/.exec(i.nodeName))&&(u=o[1]);var l=!0;if(this.exclusive&&!this.IsNamespaceInclusive(e,u)){var c=As(e,u);if(c>1)l=!1;else if(0===c)continue}if(!this.IsNamespaceRendered(u,i.nodeValue)&&l){var h={prefix:u,namespace:i.nodeValue};r.push(h),this.visibleNamespaces.Add(h),n++}}else if(i.prefix&&!this.IsNamespaceRendered(i.prefix,i.namespaceURI)){var f={prefix:i.prefix,namespace:i.namespaceURI};r.push(f),this.visibleNamespaces.Add(f),n++}}if(!this.IsNamespaceRendered(e.prefix,e.namespaceURI)&&"http://www.w3.org/2000/xmlns/"!==e.namespaceURI){var m={prefix:e.prefix,namespace:e.namespaceURI};r.push(m),this.visibleNamespaces.Add(m),n++}r.sort(Ss);var v=null;return r.forEach((function(e){e.prefix!==v&&(v=e.prefix,t.result.push(" xmlns"),e.prefix&&t.result.push(":"+e.prefix),t.result.push('="'),t.result.push(e.namespace),t.result.push('"'))})),n}},{key:"WriteAttributesAxis",value:function(e){for(var t=this,r=[],n=0;n<e.attributes.length;n++){var a=e.attributes[n];Cs(a)||r.push(a)}r.sort(Ns),r.forEach((function(e){null!=e&&(t.result.push(" "),t.result.push(e.nodeName),t.result.push('="'),t.result.push(t.NormalizeString(e.nodeValue,T.Attribute)),t.result.push('"'))}))}},{key:"NormalizeString",value:function(e,t){var r=[];if(e)for(var n=0;n<e.length;n++){var a=e[n];"<"!==a||t!==T.Attribute&&!this.IsTextNode(t)?">"===a&&this.IsTextNode(t)?r.push("&gt;"):"&"!==a||t!==T.Attribute&&!this.IsTextNode(t)?'"'===a&&t===T.Attribute?r.push("&quot;"):"\t"===a&&t===T.Attribute?r.push("&#x9;"):"\n"===a&&t===T.Attribute?r.push("&#xA;"):"\r"===a?r.push("&#xD;"):r.push(a):r.push("&amp;"):r.push("&lt;")}return r.join("")}},{key:"IsTextNode",value:function(e){switch(e){case T.Text:case T.CDATA:case T.SignificantWhitespace:case T.Whitespace:return!0}return!1}},{key:"IsNamespaceInclusive",value:function(e,t){var r=t||null;return e.prefix!==r&&-1!==this.inclusiveNamespacesPrefixList.indexOf(r||"")}},{key:"IsNamespaceRendered",value:function(e,t){if(t=t||"",!(e=e||"")&&!t)return!0;if("xml"===e&&"http://www.w3.org/XML/1998/namespace"===t)return!0;var r=this.visibleNamespaces.GetPrefix(e);return!!r&&r.namespace===t}}]),e}();function Ss(e,t){return e==t?0:e?t?e.prefix?t.prefix?e.prefix<t.prefix?-1:e.prefix>t.prefix?1:0:1:-1:1:-1}function Ns(e,t){if(!e.namespaceURI&&t.namespaceURI)return-1;if(!t.namespaceURI&&e.namespaceURI)return 1;var r=e.namespaceURI+e.localName,n=t.namespaceURI+t.localName;return r===n?0:r<n?-1:1}function As(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=t||null;if(e.prefix===n)return++r;if(e.attributes)for(var a=0;a<e.attributes.length;a++){var i=e.attributes[a];if(!Cs(i)&&t&&e.attributes[a].prefix===t)return++r}for(var s=e.firstChild;s;s=s.nextSibling)if(s.nodeType===T.Element){var o=s,u=As(o,t,r);if(s.nodeType===T.Element&&u)return++r+u}return r}function Cs(e){return!(null===e||e.nodeType!==T.Attribute||"xmlns"!==e.nodeName&&!/xmlns:/.test(e.nodeName))}var Bs="http://www.w3.org/TR/2001/REC-xml-c14n-20010315",xs="http://www.w3.org/2001/04/xmlenc#sha256",Is="ds",Es={CanonicalizationMethod:"CanonicalizationMethod",DigestMethod:"DigestMethod",DigestValue:"DigestValue",DSAKeyValue:"DSAKeyValue",DomainParameters:"DomainParameters",EncryptedKey:"EncryptedKey",HMACOutputLength:"HMACOutputLength",RSAPSSParams:"RSAPSSParams",MaskGenerationFunction:"MaskGenerationFunction",SaltLength:"SaltLength",KeyInfo:"KeyInfo",KeyName:"KeyName",KeyValue:"KeyValue",Modulus:"Modulus",Exponent:"Exponent",Manifest:"Manifest",Object:"Object",Reference:"Reference",RetrievalMethod:"RetrievalMethod",RSAKeyValue:"RSAKeyValue",ECDSAKeyValue:"ECDSAKeyValue",NamedCurve:"NamedCurve",PublicKey:"PublicKey",Signature:"Signature",SignatureMethod:"SignatureMethod",SignatureValue:"SignatureValue",SignedInfo:"SignedInfo",Transform:"Transform",Transforms:"Transforms",X509Data:"X509Data",PGPData:"PGPData",SPKIData:"SPKIData",SPKIexp:"SPKIexp",MgmtData:"MgmtData",X509IssuerSerial:"X509IssuerSerial",X509IssuerName:"X509IssuerName",X509SerialNumber:"X509SerialNumber",X509SKI:"X509SKI",X509SubjectName:"X509SubjectName",X509Certificate:"X509Certificate",X509CRL:"X509CRL",XPath:"XPath",X:"X",Y:"Y"},Ps={Algorithm:"Algorithm",Encoding:"Encoding",Id:"Id",MimeType:"MimeType",Type:"Type",URI:"URI"},Rs={XmlDsigBase64Transform:"http://www.w3.org/2000/09/xmldsig#base64",XmlDsigC14NTransform:"http://www.w3.org/TR/2001/REC-xml-c14n-20010315",XmlDsigC14NWithCommentsTransform:"http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments",XmlDsigEnvelopedSignatureTransform:"http://www.w3.org/2000/09/xmldsig#enveloped-signature",XmlDsigXPathTransform:"http://www.w3.org/TR/1999/REC-xpath-19991116",XmlDsigXsltTransform:"http://www.w3.org/TR/1999/REC-xslt-19991116",XmlDsigExcC14NTransform:"http://www.w3.org/2001/10/xml-exc-c14n#",XmlDsigExcC14NWithCommentsTransform:"http://www.w3.org/2001/10/xml-exc-c14n#WithComments",XmlDecryptionTransform:"http://www.w3.org/2002/07/decrypt#XML",XmlLicenseTransform:"urn:mpeg:mpeg21:2003:01-REL-R-NS:licenseTransform"},Ls="http://www.w3.org/2000/09/xmldsig#",Us=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ee);Us=k([C({localName:"xmldsig",namespaceURI:Ls,prefix:Is})],Us);var Os=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(te);Os=k([C({localName:"xmldsig_collection",namespaceURI:Ls,prefix:Is})],Os);var Ds=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(Us),Ts=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(Us);k([x({localName:Ps.Algorithm,required:!0,defaultValue:Bs})],Ts.prototype,"Algorithm",void 0),Ts=k([C({localName:Es.CanonicalizationMethod})],Ts);var Hs=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(Us);k([x({localName:Ps.Id,defaultValue:""})],Hs.prototype,"Id",void 0),k([x({localName:Ps.MimeType,defaultValue:""})],Hs.prototype,"MimeType",void 0),k([x({localName:Ps.Encoding,defaultValue:""})],Hs.prototype,"Encoding",void 0),Hs=k([C({localName:Es.Object})],Hs);var Vs=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(Os);Vs=k([C({localName:"xmldsig_objects",parser:Hs})],Vs);var _s=function(e){o(r,e);var t=h(r);function r(e){var n;return a(this,r),n=t.call(this),e&&(n.Algorithm=e),n}return s(r)}(Us);k([x({localName:Ps.Algorithm,required:!0,defaultValue:xs})],_s.prototype,"Algorithm",void 0),_s=k([C({localName:Es.DigestMethod})],_s);var js=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r,[{key:"OnLoadXml",value:function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes.item(t);if(r.nodeType===T.Element){var n=null;switch(r.localName){case Es.KeyValue:n=bo;break;case Es.X509Data:n=Co;break;case Es.SPKIData:n=Bo}if(n){var a=new n;a.LoadXml(r),this.Add(a)}}}}}]),r}(Os);k([x({localName:Ps.Id,defaultValue:""})],js.prototype,"Id",void 0),js=k([C({localName:Es.KeyInfo})],js);var Ms=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.apply(this,arguments)).innerXml=null,e}return s(r,[{key:"GetOutput",value:function(){throw new O(U.METHOD_NOT_IMPLEMENTED)}},{key:"LoadInnerXml",value:function(e){if(!e)throw new O(U.PARAM_REQUIRED,"node");this.innerXml=e}},{key:"GetInnerXml",value:function(){return this.innerXml}}]),r}(Us);k([x({localName:Ps.Algorithm,defaultValue:""})],Ms.prototype,"Algorithm",void 0),k([B({localName:Es.XPath,defaultValue:""})],Ms.prototype,"XPath",void 0);var Ks=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.apply(this,arguments)).Algorithm=Rs.XmlDsigBase64Transform,e}return s(r,[{key:"GetOutput",value:function(){if(!this.innerXml)throw new O(U.PARAM_REQUIRED,"innerXml");return H.FromString(this.innerXml.textContent||"","base64")}}]),r}(Ms=k([C({localName:Es.Transform})],Ms)),Fs=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.apply(this,arguments)).Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315",e.xmlCanonicalizer=new ws(!1,!1),e}return s(r,[{key:"GetOutput",value:function(){if(!this.innerXml)throw new O(U.PARAM_REQUIRED,"innerXml");return this.xmlCanonicalizer.Canonicalize(this.innerXml)}}]),r}(Ms),Xs=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.apply(this,arguments)).Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments",e.xmlCanonicalizer=new ws(!0,!1),e}return s(r)}(Fs),Gs=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.apply(this,arguments)).Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature",e}return s(r,[{key:"GetOutput",value:function(){var e;if(!this.innerXml)throw new O(U.PARAM_REQUIRED,"innerXml");for(var t=this.innerXml.firstChild,r=[];t;)Q(t)&&t.localName===Es.Signature&&t.namespaceURI===Ls&&r.push(t),t=t.nextSibling;for(var n=0,a=r;n<a.length;n++){var i=a[n];null===(e=i.parentNode)||void 0===e||e.removeChild(i)}return this.innerXml}}]),r}(Ms),Js=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.apply(this,arguments)).Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#",e.xmlCanonicalizer=new ws(!1,!0),e}return s(r,[{key:"InclusiveNamespacesPrefixList",get:function(){return this.xmlCanonicalizer.InclusiveNamespacesPrefixList},set:function(e){this.xmlCanonicalizer.InclusiveNamespacesPrefixList=e}},{key:"LoadXml",value:function(e){if(m(u(r.prototype),"LoadXml",this).call(this,e),this.Element&&this.Element.childNodes)for(var t=0;t<this.Element.childNodes.length;t++){var n=this.Element.childNodes[t];if(n&&1===n.nodeType&&"InclusiveNamespaces"===n.localName)this.setInclusiveNamespacesElement(n)}}},{key:"GetOutput",value:function(){if(!this.innerXml)throw new O(U.PARAM_REQUIRED,"innerXml");return this.xmlCanonicalizer.Canonicalize(this.innerXml)}},{key:"setInclusiveNamespacesElement",value:function(e){var t=e.getAttribute("PrefixList");t&&t.length>0&&(this.xmlCanonicalizer.InclusiveNamespacesPrefixList=t)}}]),r}(Ms),qs=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.apply(this,arguments)).Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#WithComments",e.xmlCanonicalizer=new ws(!0,!0),e}return s(r)}(Js);function Ws(e){return e.parentNode?Ws(e.parentNode):e}var Qs=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.apply(this,arguments)).Algorithm=Rs.XmlDsigXPathTransform,e}return s(r,[{key:"GetOutput",value:function(){if(!this.innerXml)throw new O(U.PARAM_REQUIRED,"innerXml");this.Filter(Ws(this.innerXml),this.XPath)}},{key:"Filter",value:function(e,t){for(var r=this,n=e.childNodes,a=[],i=0;n&&i<n.length;i++){var s=n.item(i);a.push(s)}a.forEach((function(e){r.Evaluate(e,t)?e.parentNode&&e.parentNode.removeChild(e):r.Filter(e,t)}))}},{key:"GetEvaluator",value:function(e){return"undefined"!=typeof self?null==e.ownerDocument?e:e.ownerDocument:require("xpath")}},{key:"Evaluate",value:function(e,t){try{var r=this.GetEvaluator(e),n=this.GetXml().firstChild,a="boolean(".concat(t,")");return!r.evaluate(a,e,{lookupNamespaceURI:function(e){return n.lookupNamespaceURI(e)}},("undefined"==typeof self?require("xpath"):self).XPathResult.ANY_TYPE,null).booleanValue}catch(e){return!1}}}]),r}(Ms);k([B({localName:Es.XPath,namespaceURI:Ls,prefix:Is,required:!0})],Qs.prototype,"XPath",void 0);var zs=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r,[{key:"OnLoadXml",value:function(e){m(u(r.prototype),"OnLoadXml",this).call(this,e),this.items=this.GetIterator().map((function(e){switch(e.Algorithm){case Rs.XmlDsigEnvelopedSignatureTransform:return Ys(e,Gs);case Rs.XmlDsigC14NTransform:return Ys(e,Fs);case Rs.XmlDsigC14NWithCommentsTransform:return Ys(e,Xs);case Rs.XmlDsigExcC14NTransform:return Ys(e,Js);case Rs.XmlDsigExcC14NWithCommentsTransform:return Ys(e,qs);case Rs.XmlDsigBase64Transform:return Ys(e,Ks);case Rs.XmlDsigXPathTransform:return Ys(e,Qs);default:throw new O(U.CRYPTOGRAPHIC_UNKNOWN_TRANSFORM,e.Algorithm)}}))}}]),r}(Os);function Ys(e,t){var r=new t;return r.LoadXml(e.Element),r}zs=k([C({localName:Es.Transforms,parser:Ms})],zs);var Zs=function(e){o(r,e);var t=h(r);function r(e){var n;return a(this,r),(n=t.call(this)).DigestMethod=new _s,e&&(n.Uri=e),n}return s(r)}(Us);k([x({defaultValue:""})],Zs.prototype,"Id",void 0),k([x({localName:Ps.URI})],Zs.prototype,"Uri",void 0),k([x({localName:Ps.Type,defaultValue:""})],Zs.prototype,"Type",void 0),k([B({parser:zs})],Zs.prototype,"Transforms",void 0),k([B({required:!0,parser:_s})],Zs.prototype,"DigestMethod",void 0),k([B({required:!0,localName:Es.DigestValue,namespaceURI:Ls,prefix:Is,converter:Y})],Zs.prototype,"DigestValue",void 0),Zs=k([C({localName:Es.Reference})],Zs);var $s=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(Os);$s=k([C({localName:"References",parser:Zs})],$s);var eo=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r,[{key:"OnLoadXml",value:function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes.item(t);if(r.nodeType===T.Element&&r.nodeName!==Es.HMACOutputLength){var n=void 0;if(r.localName===Es.RSAPSSParams)n=ko;if(n){var a=new n;a.LoadXml(r),this.Add(a)}}}}}]),r}(Os);eo=k([C({localName:"Other"})],eo);var to=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(Us);k([x({localName:Ps.Algorithm,required:!0,defaultValue:""})],to.prototype,"Algorithm",void 0),k([B({localName:Es.HMACOutputLength,namespaceURI:Ls,prefix:Is,converter:Z})],to.prototype,"HMACOutputLength",void 0),k([B({parser:eo,noRoot:!0,minOccurs:0})],to.prototype,"Any",void 0),to=k([C({localName:Es.SignatureMethod})],to);var ro=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(Us);k([x({localName:Ps.Id,defaultValue:""})],ro.prototype,"Id",void 0),k([B({parser:Ts,required:!0})],ro.prototype,"CanonicalizationMethod",void 0),k([B({parser:to,required:!0})],ro.prototype,"SignatureMethod",void 0),k([B({parser:$s,minOccurs:1,noRoot:!0})],ro.prototype,"References",void 0),ro=k([C({localName:Es.SignedInfo})],ro);var no=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(Us);k([x({localName:Ps.Id,defaultValue:""})],no.prototype,"Id",void 0),k([B({parser:ro,required:!0})],no.prototype,"SignedInfo",void 0),k([B({localName:Es.SignatureValue,namespaceURI:Ls,prefix:Is,required:!0,converter:Y,defaultValue:null})],no.prototype,"SignatureValue",void 0),k([B({parser:js})],no.prototype,"KeyInfo",void 0),k([B({parser:Vs,noRoot:!0})],no.prototype,"ObjectList",void 0),no=k([C({localName:Es.Signature})],no);var ao="http://www.w3.org/2001/04/xmldsig-more#",io="ecdsa",so=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ee);k([B({localName:Es.X,namespaceURI:ao,prefix:io,required:!0,converter:Y})],so.prototype,"X",void 0),k([B({localName:Es.Y,namespaceURI:ao,prefix:io,required:!0,converter:Y})],so.prototype,"Y",void 0),so=k([C({localName:Es.PublicKey,namespaceURI:ao,prefix:io})],so);var oo=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ee);k([x({localName:Ps.URI,required:!0})],oo.prototype,"Uri",void 0),oo=k([C({localName:Es.NamedCurve,namespaceURI:ao,prefix:io})],oo);var uo=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ee);k([B({parser:oo})],uo.prototype,"NamedCurve",void 0),uo=k([C({localName:Es.DomainParameters,namespaceURI:ao,prefix:io})],uo);var lo,co=function(e){o(u,e);var t,r,i=h(u);function u(){var e;return a(this,u),(e=i.apply(this,arguments)).name=Es.ECDSAKeyValue,e.key=null,e.jwk=null,e.keyUsage=null,e}return s(u,[{key:"NamedCurve",get:function(){return ho(this.DomainParameters.NamedCurve.Uri)}},{key:"importKey",value:(r=n(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("ECDSA"===t.algorithm.name.toUpperCase()){e.next=2;break}throw new O(U.ALGORITHM_WRONG_NAME,t.algorithm.name);case 2:return e.next=4,pi.crypto.subtle.exportKey("jwk",t);case 4:return r=e.sent,this.key=t,this.jwk=r,this.PublicKey=new so,this.PublicKey.X=H.FromString(r.x,"base64url"),this.PublicKey.Y=H.FromString(r.y,"base64url"),this.DomainParameters||(this.DomainParameters=new uo),this.DomainParameters.NamedCurve||(this.DomainParameters.NamedCurve=new oo),this.DomainParameters.NamedCurve.Uri=ho(r.crv),this.keyUsage=t.usages,e.abrupt("return",this);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"exportKey",value:(t=n(regeneratorRuntime.mark((function e(t){var r,n,a,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.key){e.next=2;break}return e.abrupt("return",this.key);case 2:return r=H.ToBase64Url(this.PublicKey.X),n=H.ToBase64Url(this.PublicKey.Y),a=fo(this.DomainParameters.NamedCurve.Uri),i={kty:"EC",crv:a,x:r,y:n,ext:!0},this.keyUsage=["verify"],e.next=9,pi.crypto.subtle.importKey("jwk",i,{name:"ECDSA",namedCurve:a},!0,this.keyUsage);case 9:return s=e.sent,this.key=s,e.abrupt("return",this.key);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),u}(Ds);function ho(e){switch(e){case"P-256":return"urn:oid:1.2.840.10045.3.1.7";case"P-384":return"urn:oid:1.3.132.0.34";case"P-521":return"urn:oid:1.3.132.0.35"}throw new O(U.CRYPTOGRAPHIC,"Unknown NamedCurve")}function fo(e){switch(e){case"urn:oid:1.2.840.10045.3.1.7":return"P-256";case"urn:oid:1.3.132.0.34":return"P-384";case"urn:oid:1.3.132.0.35":return"P-521"}throw new O(U.CRYPTOGRAPHIC,"Unknown NamedCurve OID")}k([B({parser:uo})],co.prototype,"DomainParameters",void 0),k([B({parser:so,required:!0})],co.prototype,"PublicKey",void 0),co=k([C({localName:Es.ECDSAKeyValue,namespaceURI:ao,prefix:io})],co);var mo={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},vo=function(e){o(l,e);var t,r,i=h(l);function l(){var e;return a(this,l),(e=i.apply(this,arguments)).key=null,e.jwk=null,e.keyUsage=[],e}return s(l,[{key:"importKey",value:(r=n(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=t.algorithm.name.toUpperCase())===$i.toUpperCase()||r===us.toUpperCase()){e.next=3;break}throw new O(U.ALGORITHM_WRONG_NAME,t.algorithm.name);case 3:return this.key=t,e.next=6,pi.crypto.subtle.exportKey("jwk",t);case 6:return n=e.sent,this.jwk=n,this.Modulus=H.FromBase64Url(n.n),this.Exponent=H.FromBase64Url(n.e),this.keyUsage=t.usages,e.abrupt("return",this);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"exportKey",value:(t=n(regeneratorRuntime.mark((function e(){var t,r,n,a,i,s=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:mo,!this.key){e.next=3;break}return e.abrupt("return",this.key);case 3:if(this.Modulus){e.next=5;break}throw new O(U.CRYPTOGRAPHIC,"RsaKeyValue has no Modulus");case 5:if(r=H.ToBase64Url(this.Modulus),this.Exponent){e.next=8;break}throw new O(U.CRYPTOGRAPHIC,"RsaKeyValue has no Exponent");case 8:n=H.ToBase64Url(this.Exponent),e.t0=t.name.toUpperCase(),e.next=e.t0===$i.toUpperCase()?12:e.t0===us.toUpperCase()?14:16;break;case 12:return a="R",e.abrupt("break",17);case 14:return a="P",e.abrupt("break",17);case 16:throw new O(U.ALGORITHM_NOT_SUPPORTED,t.name);case 17:e.t1=t.hash.name.toUpperCase(),e.next=e.t1===Ni?20:e.t1===Ai?22:e.t1===Ci?24:e.t1===Bi?26:28;break;case 20:return a+="S1",e.abrupt("break",28);case 22:return a+="S256",e.abrupt("break",28);case 24:return a+="S384",e.abrupt("break",28);case 26:return a+="S512",e.abrupt("break",28);case 28:return i={kty:"RSA",alg:a,n:r,e:n,ext:!0},e.abrupt("return",pi.crypto.subtle.importKey("jwk",i,t,!0,this.keyUsage));case 30:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"LoadXml",value:function(e){m(u(l.prototype),"LoadXml",this).call(this,e),this.keyUsage=["verify"]}}]),l}(Ds);k([B({localName:Es.Modulus,prefix:Is,namespaceURI:Ls,required:!0,converter:Y})],vo.prototype,"Modulus",void 0),k([B({localName:Es.Exponent,prefix:Is,namespaceURI:Ls,required:!0,converter:Y})],vo.prototype,"Exponent",void 0),vo=k([C({localName:Es.RSAKeyValue})],vo);var go="http://www.w3.org/2007/05/xmldsig-more#",yo="pss",po=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ee);k([B({parser:_s})],po.prototype,"DigestMethod",void 0),k([x({localName:Ps.Algorithm,defaultValue:"http://www.w3.org/2007/05/xmldsig-more#MGF1"})],po.prototype,"Algorithm",void 0),po=k([C({localName:Es.MaskGenerationFunction,prefix:yo,namespaceURI:go})],po);var ko=lo=function(e){o(r,e);var t=h(r);function r(e){var n;return a(this,r),n=t.call(this),e&&n.FromAlgorithm(e),n}return s(r,[{key:"FromAlgorithm",value:function(e){this.DigestMethod=new _s;var t=Eo.GetHashAlgorithm(e.hash);this.DigestMethod.Algorithm=t.namespaceURI,e.saltLength&&(this.SaltLength=e.saltLength)}}],[{key:"FromAlgorithm",value:function(e){return new lo(e)}}]),r}(ee);k([B({parser:_s})],ko.prototype,"DigestMethod",void 0),k([B({parser:po})],ko.prototype,"MGF",void 0),k([B({converter:Z,prefix:yo,namespaceURI:go})],ko.prototype,"SaltLength",void 0),k([B({converter:Z})],ko.prototype,"TrailerField",void 0),ko=lo=k([C({localName:Es.RSAPSSParams,prefix:yo,namespaceURI:go})],ko);var bo=function(e){o(u,e);var t,r,i=h(u);function u(e){var t;return a(this,u),t=i.call(this),e&&(t.Value=e),t}return s(u,[{key:"Value",get:function(){return this.value},set:function(e){this.element=null,this.value=e}},{key:"importKey",value:(r=n(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.algorithm.name.toUpperCase(),e.next=e.t0===us.toUpperCase()||e.t0===$i.toUpperCase()?3:e.t0===Di.toUpperCase()?7:11;break;case 3:return this.Value=new vo,e.next=6,this.Value.importKey(t);case 6:case 10:return e.abrupt("break",12);case 7:return this.Value=new co,e.next=10,this.Value.importKey(t);case 11:throw new O(U.ALGORITHM_NOT_SUPPORTED,t.algorithm.name);case 12:return e.abrupt("return",this);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"exportKey",value:(t=n(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.Value){e.next=2;break}throw new O(U.NULL_REFERENCE);case 2:return e.abrupt("return",this.Value.exportKey(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"OnGetXml",value:function(e){if(!this.Value)throw new O(U.CRYPTOGRAPHIC,"KeyValue has empty value");var t=this.Value.GetXml();t&&e.appendChild(t)}},{key:"OnLoadXml",value:function(e){for(var t=0,r=[vo,co];t<r.length;t++){var n=r[t];try{for(var a=new n,i=0;i<e.childNodes.length;i++){var s=e.childNodes.item(i);if(Q(s))return a.LoadXml(s),void(this.value=a)}}catch(e){}}throw new O(U.CRYPTOGRAPHIC,"Unsupported KeyValue in use")}}]),u}(Ds);bo=k([C({localName:Es.KeyValue})],bo);var wo,So={"2.5.4.3":{short:"CN",long:"CommonName"},"2.5.4.6":{short:"C",long:"Country"},"2.5.4.5":{long:"DeviceSerialNumber"},"0.9.2342.19200300.100.1.25":{short:"DC",long:"DomainComponent"},"1.2.840.113549.1.9.1":{short:"E",long:"EMail"},"2.5.4.42":{short:"G",long:"GivenName"},"2.5.4.43":{short:"I",long:"Initials"},"2.5.4.7":{short:"L",long:"Locality"},"2.5.4.10":{short:"O",long:"Organization"},"2.5.4.11":{short:"OU",long:"OrganizationUnit"},"2.5.4.8":{short:"ST",long:"State"},"2.5.4.9":{short:"Street",long:"StreetAddress"},"2.5.4.4":{short:"SN",long:"SurName"},"2.5.4.12":{short:"T",long:"Title"},"1.2.840.113549.1.9.8":{long:"UnstructuredAddress"},"1.2.840.113549.1.9.2":{long:"UnstructuredName"}},No=function(){function e(t){if(a(this,e),this.publicKey=null,t){var r=new Uint8Array(t);this.LoadRaw(r),this.raw=r}}var t,r;return s(e,[{key:"SerialNumber",get:function(){return this.simpl.serialNumber.valueBlock.toString()}},{key:"Issuer",get:function(){return this.NameToString(this.simpl.issuer)}},{key:"Subject",get:function(){return this.NameToString(this.simpl.subject)}},{key:"Thumbprint",value:(r=n(regeneratorRuntime.mark((function e(){var t,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:"SHA-1",e.abrupt("return",pi.crypto.subtle.digest(t,this.raw));case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"PublicKey",get:function(){return this.publicKey}},{key:"GetRaw",value:function(){return this.raw}},{key:"exportKey",value:(t=n(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=9;break}return(r={algorithm:t,usages:["verify"]}).algorithm.name.toUpperCase()===Di&&(r.algorithm.namedCurve=this.simpl.subjectPublicKeyInfo.toJSON().crv),this.isHashedAlgorithm(r.algorithm)&&"string"==typeof r.algorithm.hash&&(r.algorithm.hash={name:r.algorithm.hash}),e.next=6,this.simpl.getPublicKey({algorithm:r});case 6:return n=e.sent,this.publicKey=n,e.abrupt("return",n);case 9:if("1.2.840.113549.1.1.1"!==this.simpl.subjectPublicKeyInfo.algorithm.algorithmId){e.next=15;break}return e.next=12,this.simpl.getPublicKey({algorithm:{algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}}},usages:["verify"]});case 12:this.publicKey=e.sent,e.next=18;break;case 15:return e.next=17,this.simpl.getPublicKey();case 17:this.publicKey=e.sent;case 18:return e.abrupt("return",this.publicKey);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"NameToString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",r=[];return e.typesAndValues.forEach((function(e){var t=e.type,n=So[t.toString()],a=n?n.short:null;r.push("".concat(a||t,"=").concat(e.value.valueBlock.value))})),r.join(t+" ")}},{key:"LoadRaw",value:function(e){this.raw=new Uint8Array(e);var t=fi(this.raw.buffer);this.simpl=new On({schema:t.result})}},{key:"isHashedAlgorithm",value:function(e){return!!e.hash}}]),e}(),Ao=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(Us);k([B({localName:Es.X509IssuerName,namespaceURI:Ls,prefix:Is,required:!0})],Ao.prototype,"X509IssuerName",void 0),k([B({localName:Es.X509SerialNumber,namespaceURI:Ls,prefix:Is,required:!0})],Ao.prototype,"X509SerialNumber",void 0),Ao=k([C({localName:Es.X509IssuerSerial})],Ao),function(e){e[e.None=0]="None",e[e.EndCertOnly=1]="EndCertOnly",e[e.ExcludeRoot=2]="ExcludeRoot",e[e.WholeChain=3]="WholeChain"}(wo||(wo={}));var Co=function(e){o(l,e);var t,r,i=h(l);function l(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wo.None;if(a(this,l),(t=i.call(this)).x509crl=null,t.SubjectKeyIdList=[],t.key=null,e)if(e instanceof Uint8Array)t.AddCertificate(new No(e));else if(e instanceof No)switch(r){case wo.None:case wo.EndCertOnly:t.AddCertificate(e);break;case wo.ExcludeRoot:t.AddCertificatesChainFrom(e,!1);break;case wo.WholeChain:t.AddCertificatesChainFrom(e,!0)}return t}return s(l,[{key:"Key",get:function(){return this.key}},{key:"importKey",value:(r=n(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new O(U.METHOD_NOT_SUPPORTED);case 1:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"exportKey",value:(t=n(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.Certificates.length){e.next=2;break}throw new O(U.NULL_REFERENCE);case 2:return e.next=4,this.Certificates[0].exportKey(t);case 4:return r=e.sent,this.key=r,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"Certificates",get:function(){return this.X509CertificateList}},{key:"CRL",get:function(){return this.x509crl},set:function(e){this.x509crl=e}},{key:"IssuerSerials",get:function(){return this.IssuerSerialList}},{key:"SubjectKeyIds",get:function(){return this.SubjectKeyIdList}},{key:"SubjectNames",get:function(){return this.SubjectNameList}},{key:"AddCertificate",value:function(e){if(!e)throw new O(U.PARAM_REQUIRED,"certificate");this.X509CertificateList||(this.X509CertificateList=[]),this.X509CertificateList.push(e)}},{key:"AddIssuerSerial",value:function(e,t){if(null==e)throw new O(U.PARAM_REQUIRED,"issuerName");null==this.IssuerSerialList&&(this.IssuerSerialList=[]);var r={issuerName:e,serialNumber:t};this.IssuerSerialList.push(r)}},{key:"AddSubjectKeyId",value:function(e){var t;(this.SubjectKeyIdList&&(this.SubjectKeyIdList=[]),"string"==typeof e)?null!=e&&(t=H.FromBase64(e),this.SubjectKeyIdList.push(t)):this.SubjectKeyIdList.push(e)}},{key:"AddSubjectName",value:function(e){null==this.SubjectNameList&&(this.SubjectNameList=[]),this.SubjectNameList.push(e)}},{key:"GetXml",value:function(){var e=this.CreateDocument(),t=this.CreateElement(e),r=this.GetPrefix();if(null!=this.IssuerSerialList&&this.IssuerSerialList.length>0&&this.IssuerSerialList.forEach((function(n){var a=e.createElementNS(Ls,r+Es.X509IssuerSerial),i=e.createElementNS(Ls,r+Es.X509IssuerName);i.textContent=n.issuerName,a.appendChild(i);var s=e.createElementNS(Ls,r+Es.X509SerialNumber);s.textContent=n.serialNumber,a.appendChild(s),t.appendChild(a)})),null!=this.SubjectKeyIdList&&this.SubjectKeyIdList.length>0&&this.SubjectKeyIdList.forEach((function(n){var a=e.createElementNS(Ls,r+Es.X509SKI);a.textContent=H.ToBase64(n),t.appendChild(a)})),null!=this.SubjectNameList&&this.SubjectNameList.length>0&&this.SubjectNameList.forEach((function(n){var a=e.createElementNS(Ls,r+Es.X509SubjectName);a.textContent=n,t.appendChild(a)})),null!=this.X509CertificateList&&this.X509CertificateList.length>0&&this.X509CertificateList.forEach((function(n){var a=e.createElementNS(Ls,r+Es.X509Certificate);a.textContent=H.ToBase64(n.GetRaw()),t.appendChild(a)})),null!=this.x509crl){var n=e.createElementNS(Ls,r+Es.X509CRL);n.textContent=H.ToBase64(this.x509crl),t.appendChild(n)}return t}},{key:"LoadXml",value:function(e){var t=this;m(u(l.prototype),"LoadXml",this).call(this,e),this.IssuerSerialList&&(this.IssuerSerialList=[]),this.SubjectKeyIdList&&(this.SubjectKeyIdList=[]),this.SubjectNameList&&(this.SubjectNameList=[]),this.X509CertificateList&&(this.X509CertificateList=[]),this.x509crl=null;var r=this.GetChildren(Es.X509IssuerSerial);r&&r.forEach((function(e){var r=Us.GetChild(e,Es.X509IssuerName,Ls,!0),n=Us.GetChild(e,Es.X509SerialNumber,Ls,!0);r&&r.textContent&&n&&n.textContent&&t.AddIssuerSerial(r.textContent,n.textContent)})),(r=this.GetChildren(Es.X509SKI))&&r.forEach((function(e){if(e.textContent){var r=H.FromBase64(e.textContent);t.AddSubjectKeyId(r)}})),null!=(r=this.GetChildren(Es.X509SubjectName))&&r.forEach((function(e){e.textContent&&t.AddSubjectName(e.textContent)})),(r=this.GetChildren(Es.X509Certificate))&&r.forEach((function(e){if(e.textContent){var r=H.FromBase64(e.textContent);t.AddCertificate(new No(r))}}));var n=this.GetChild(Es.X509CRL,!1);n&&n.textContent&&(this.x509crl=H.FromBase64(n.textContent))}},{key:"AddCertificatesChainFrom",value:function(e,t){throw new O(U.METHOD_NOT_IMPLEMENTED)}}]),l}(Ds);Co=k([C({localName:Es.X509Data})],Co);var Bo=function(e){o(u,e);var t,r,i=h(u);function u(){return a(this,u),i.apply(this,arguments)}return s(u,[{key:"importKey",value:(r=n(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pi.crypto.subtle.exportKey("spki",t);case 2:return r=e.sent,this.SPKIexp=new Uint8Array(r),this.Key=t,e.abrupt("return",this);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"exportKey",value:(t=n(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pi.crypto.subtle.importKey("spki",this.SPKIexp,t,!0,["verify"]);case 2:return r=e.sent,this.Key=r,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),u}(Ds);k([B({localName:Es.SPKIexp,namespaceURI:Ls,prefix:Is,required:!0,converter:Y})],Bo.prototype,"SPKIexp",void 0),Bo=k([C({localName:Es.SPKIData})],Bo);var xo={};xo[es]=as,xo[ts]=is,xo[rs]=ss,xo[ns]=os,xo[Ti]=ji,xo[Hi]=Mi,xo[Vi]=Ki,xo[_i]=Fi,xo[Gi]=Qi,xo[Ji]=zi,xo[qi]=Yi,xo[Wi]=Zi,xo[gs]=ys,xo["http://www.w3.org/2007/05/xmldsig-more#sha256-rsa-MGF1"]=ps,xo["http://www.w3.org/2007/05/xmldsig-more#sha384-rsa-MGF1"]=ks,xo["http://www.w3.org/2007/05/xmldsig-more#sha512-rsa-MGF1"]=bs;var Io={};Io[xi]=Ri,Io[Ii]=Li,Io[Ei]=Ui,Io[Pi]=Oi;var Eo=function(){function e(){a(this,e)}return s(e,null,[{key:"CreateFromName",value:function(e){var t;switch(e){case Rs.XmlDsigBase64Transform:t=new Ks;break;case Rs.XmlDsigC14NTransform:t=new Fs;break;case Rs.XmlDsigC14NWithCommentsTransform:t=new Xs;break;case Rs.XmlDsigEnvelopedSignatureTransform:t=new Gs;break;case Rs.XmlDsigXPathTransform:case Rs.XmlDsigXsltTransform:throw new O(U.ALGORITHM_NOT_SUPPORTED,e);case Rs.XmlDsigExcC14NTransform:t=new Js;break;case Rs.XmlDsigExcC14NWithCommentsTransform:t=new qs;break;case Rs.XmlDecryptionTransform:default:throw new O(U.ALGORITHM_NOT_SUPPORTED,e)}return t}},{key:"CreateSignatureAlgorithm",value:function(e){var t=xo[e.Algorithm]||null;if(t)return new t;if(e.Algorithm===ls){var r;if(e.Any.Some((function(e){return e instanceof ko&&(r=e),!!r})),r)switch(r.DigestMethod.Algorithm){case xi:return new hs(r.SaltLength);case Ii:return new fs(r.SaltLength);case Ei:return new ms(r.SaltLength);case Pi:return new vs(r.SaltLength)}throw new O(U.CRYPTOGRAPHIC,"Cannot get params for RSA-PSS algoriithm")}throw new Error("signature algorithm '".concat(e.Algorithm,"' is not supported"))}},{key:"CreateHashAlgorithm",value:function(e){var t=Io[e];if(t)return new t;throw new Error("hash algorithm '"+e+"' is not supported")}},{key:"GetHashAlgorithm",value:function(e){var t="string"==typeof e?{name:e}:e;switch(t.name.toUpperCase()){case Ni:return new Ri;case Ai:return new Li;case Ci:return new Ui;case Bi:return new Oi;default:throw new O(U.ALGORITHM_NOT_SUPPORTED,t.name)}}},{key:"GetSignatureAlgorithm",value:function(e){"string"==typeof e.hash&&(e.hash={name:e.hash});var t,r=e.hash.name;if(!r)throw new Error("Signing algorithm doesn't have name for hash");switch(e.name.toUpperCase()){case $i.toUpperCase():switch(r.toUpperCase()){case Ni:t=new as;break;case Ai:t=new is;break;case Ci:t=new ss;break;case Bi:t=new os;break;default:throw new O(U.ALGORITHM_NOT_SUPPORTED,"".concat(e.name,":").concat(r))}break;case us.toUpperCase():var n=e.saltLength;switch(r.toUpperCase()){case Ni:t=n?new hs(n):new ys;break;case Ai:t=n?new fs(n):new ps;break;case Ci:t=n?new ms(n):new ks;break;case Bi:t=n?new vs(n):new bs;break;default:throw new O(U.ALGORITHM_NOT_SUPPORTED,"".concat(e.name,":").concat(r))}e.saltLength=t.algorithm.saltLength;break;case Di:switch(r.toUpperCase()){case Ni:t=new ji;break;case Ai:t=new Mi;break;case Ci:t=new Ki;break;case Bi:t=new Fi;break;default:throw new O(U.ALGORITHM_NOT_SUPPORTED,"".concat(e.name,":").concat(r))}break;case Xi:switch(r.toUpperCase()){case Ni:t=new Qi;break;case Ai:t=new zi;break;case Ci:t=new Yi;break;case Bi:t=new Zi;break;default:throw new O(U.ALGORITHM_NOT_SUPPORTED,"".concat(e.name,":").concat(r))}break;default:throw new O(U.ALGORITHM_NOT_SUPPORTED,e.name)}return t}}]),e}(),Po=function(){function e(t){if(a(this,e),this.signature=new no,t&&t.nodeType===T.Document)this.document=t;else if(t&&t.nodeType===T.Element){var r=(new XMLSerializer).serializeToString(t);this.document=(new DOMParser).parseFromString(r,V)}}var t,r,i,o,u,l,c,h;return s(e,[{key:"XmlSignature",get:function(){return this.signature}},{key:"Signature",get:function(){return this.XmlSignature.SignatureValue}},{key:"Sign",value:(h=n(regeneratorRuntime.mark((function e(t,r,n){var a,i,s,o,u,l,c,h,f,m,v=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=v.length>3&&void 0!==v[3]?v[3]:{},z(n)?n=n.cloneNode(!0).documentElement:Q(n)&&(n=n.cloneNode(!0)),o=q({},t),r.algorithm.hash&&(o.hash=r.algorithm.hash),i=Eo.GetSignatureAlgorithm(o),e.next=7,this.ApplySignOptions(this.XmlSignature,t,r,a);case 7:return s=this.XmlSignature.SignedInfo,e.next=10,this.DigestReferences(n);case 10:if(s.SignatureMethod.Algorithm=i.namespaceURI,!(i instanceof cs)){e.next=18;break}"string"==typeof(u=q({},r.algorithm,o)).hash&&(u.hash={name:u.hash}),l=new ko(u),this.XmlSignature.SignedInfo.SignatureMethod.Any.Add(l),e.next=33;break;case 18:if(Xi.toUpperCase()!==t.name.toUpperCase()){e.next=33;break}c=0,h=r.algorithm,e.t0=h.hash.name.toUpperCase(),e.next=e.t0===Ni?24:e.t0===Ai?26:e.t0===Ci?28:e.t0===Bi?30:32;break;case 24:return c=h.length||160,e.abrupt("break",32);case 26:return c=h.length||256,e.abrupt("break",32);case 28:return c=h.length||384,e.abrupt("break",32);case 30:return c=h.length||512,e.abrupt("break",32);case 32:this.XmlSignature.SignedInfo.SignatureMethod.HMACOutputLength=c;case 33:return f=this.TransformSignedInfo(n),e.next=36,i.Sign(f,r,o);case 36:return m=e.sent,this.Key=r,this.XmlSignature.SignatureValue=new Uint8Array(m),Q(n)&&(this.document=n.ownerDocument),e.abrupt("return",this.XmlSignature);case 41:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return h.apply(this,arguments)})},{key:"Verify",value:(c=n(regeneratorRuntime.mark((function e(t){var r,n,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&("algorithm"in t&&"usages"in t&&"type"in t?n=t:(n=t.key,r=t.content)),r){e.next=6;break}if((a=this.document)&&a.documentElement){e.next=5;break}throw new O(U.NULL_PARAM,"SignedXml","document");case 5:r=a.documentElement;case 6:return(z(r)||Q(r))&&(r=r.cloneNode(!0)),e.next=9,this.ValidateReferences(r);case 9:if(!e.sent){e.next=22;break}if(!n){e.next=15;break}e.t0=[n],e.next=18;break;case 15:return e.next=17,this.GetPublicKeys();case 17:e.t0=e.sent;case 18:return i=e.t0,e.abrupt("return",this.ValidateSignatureValue(i));case 22:return e.abrupt("return",!1);case 23:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"GetXml",value:function(){return this.signature.GetXml()}},{key:"LoadXml",value:function(e){this.signature=no.LoadXml(e)}},{key:"toString",value:function(){var e=this.XmlSignature;if(e.SignedInfo.References&&e.SignedInfo.References.Some((function(e){return e.Transforms&&e.Transforms.Some((function(e){return e instanceof Gs}))}))){var t=this.document.documentElement.cloneNode(!0),r=this.XmlSignature.GetXml();if(!r)throw new O(U.XML_EXCEPTION,"Cannot get Xml element from Signature");var n=r.cloneNode(!0);return t.appendChild(n),(new XMLSerializer).serializeToString(t)}return this.XmlSignature.toString()}},{key:"GetPublicKeys",value:(l=n(regeneratorRuntime.mark((function e(){var t,r,n,a,i,s,o,u,l,c,h,f,m,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],r=Eo.CreateSignatureAlgorithm(this.XmlSignature.SignedInfo.SignatureMethod),n=p(this.XmlSignature.KeyInfo.GetIterator()),e.prev=3,n.s();case 5:if((a=n.n()).done){e.next=35;break}if(!((i=a.value)instanceof Co)){e.next=29;break}s=p(i.Certificates),e.prev=9,s.s();case 11:if((o=s.n()).done){e.next=19;break}return u=o.value,e.next=15,u.exportKey();case 15:l=e.sent,t.push(l);case 17:e.next=11;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(9),s.e(e.t0);case 24:return e.prev=24,s.f(),e.finish(24);case 27:e.next=33;break;case 29:return e.next=31,i.exportKey();case 31:c=e.sent,t.push(c);case 33:e.next=5;break;case 35:e.next=40;break;case 37:e.prev=37,e.t1=e.catch(3),n.e(e.t1);case 40:return e.prev=40,n.f(),e.finish(40);case 43:if(!r.algorithm.name.startsWith("RSA")){e.next=58;break}h=0;case 45:if(!(h<t.length)){e.next=58;break}if(!(f=t[h]).algorithm.name.startsWith("RSA")){e.next=55;break}return e.next=50,pi.crypto.subtle.exportKey("spki",f);case 50:return m=e.sent,e.next=53,pi.crypto.subtle.importKey("spki",m,r.algorithm,!0,["verify"]);case 53:v=e.sent,t[h]=v;case 55:h++,e.next=45;break;case 58:return e.abrupt("return",t);case 59:case"end":return e.stop()}}),e,this,[[3,37,40,43],[9,21,24,27]])}))),function(){return l.apply(this,arguments)})},{key:"GetSignatureNamespaces",value:function(){var e={};return this.XmlSignature.NamespaceURI&&(e[this.XmlSignature.Prefix||""]=this.XmlSignature.NamespaceURI),e}},{key:"CopyNamespaces",value:function(e,t,r){var n;this.InjectNamespaces((Uo(e,n={}),n),t,r)}},{key:"InjectNamespaces",value:function(e,t,r){for(var n in e){var a=e[n];r&&""===n||t.setAttribute("xmlns"+(n?":"+n:""),a)}}},{key:"DigestReference",value:(u=n(regeneratorRuntime.mark((function e(t,r,n){var a,i,s,o,u,l,c,h,f,m,v,g,d,y;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.contentHandler){e.next=5;break}return e.next=3,this.contentHandler(r,this);case 3:(a=e.sent)&&(t=z(a)?a.documentElement:a);case 5:if(!r.Uri){e.next=30;break}if(r.Uri.indexOf("#xpointer")?"#"===r.Uri[0]&&(i=r.Uri.substring(1)):(s=(s=(s=r.Uri).substring(9).replace(/[\r\n\t\s]/g,"")).length<2||"("!==s[0]||")"!==s[s.length-1]?"":s.substring(1,s.length-1)).length>6&&0===s.indexOf("id(")&&")"===s[s.length-1]&&(i=s.substring(4,s.length-2)),!i){e.next=30;break}o=null,u=[this.XmlSignature.KeyInfo.GetXml()],this.XmlSignature.ObjectList.ForEach((function(e){u.push(e.GetXml())})),l=0,c=u;case 12:if(!(l<c.length)){e.next=27;break}if(!(h=c[l])){e.next=24;break}if(!(o=Ro(h,i))){e.next=24;break}return f=o.cloneNode(!0),Q(t)&&this.CopyNamespaces(t,f,!1),this.Parent&&(m=this.Parent instanceof ee?this.Parent.GetXml():this.Parent,this.CopyNamespaces(m,f,!0)),this.CopyNamespaces(o,f,!1),this.InjectNamespaces(this.GetSignatureNamespaces(),f,!0),t=f,e.abrupt("break",27);case 24:l++,e.next=12;break;case 27:if(!o&&t&&Q(t)&&(o=ee.GetElementById(t,i))&&(v=o.cloneNode(!0),this.CopyNamespaces(o,v,!1),this.CopyNamespaces(t,v,!1),t=v),null!=o){e.next=30;break}throw new O(U.CRYPTOGRAPHIC,"Cannot get object by reference: ".concat(i));case 30:if(g=null,!r.Transforms||!r.Transforms.Count){e.next=37;break}if(!mi.isBufferSource(t)){e.next=34;break}throw new Error("Transformation for argument 'source' of type BufferSource is not implemented");case 34:g=this.ApplyTransforms(r.Transforms,t),e.next=51;break;case 37:if(!r.Uri||"#"===r.Uri[0]){e.next=47;break}if(!Q(t)){e.next=44;break}if(t.ownerDocument){e.next=41;break}throw new Error("Cannot get ownerDocument from the XML document");case 41:g=(new XMLSerializer).serializeToString(t.ownerDocument),e.next=45;break;case 44:g=mi.toArrayBuffer(t);case 45:e.next=51;break;case 47:d=new Fs,mi.isBufferSource(t)&&(t=F(di.ToUtf8String(t)).documentElement),d.LoadInnerXml(t),g=d.GetOutput();case 51:if(r.DigestMethod.Algorithm){e.next=53;break}throw new O(U.NULL_PARAM,"Reference","DigestMethod");case 53:return y=Eo.CreateHashAlgorithm(r.DigestMethod.Algorithm),e.abrupt("return",y.Digest(g));case 55:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return u.apply(this,arguments)})},{key:"DigestReferences",value:(o=n(regeneratorRuntime.mark((function e(t){var r,n,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=p(this.XmlSignature.SignedInfo.References.GetIterator()),e.prev=1,r.s();case 3:if((n=r.n()).done){e.next=14;break}if(!(a=n.value).DigestValue){e.next=7;break}return e.abrupt("continue",12);case 7:return a.DigestMethod.Algorithm||(a.DigestMethod.Algorithm=(new Li).namespaceURI),e.next=10,this.DigestReference(t,a,!1);case 10:i=e.sent,a.DigestValue=i;case 12:e.next=3;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[1,16,19,22]])}))),function(e){return o.apply(this,arguments)})},{key:"TransformSignedInfo",value:function(e){var t=Eo.CreateFromName(this.XmlSignature.SignedInfo.CanonicalizationMethod.Algorithm),r=this.XmlSignature.SignedInfo.GetXml();if(!r)throw new O(U.XML_EXCEPTION,"Cannot get Xml element from SignedInfo");var n=r.cloneNode(!0);if(this.CopyNamespaces(r,n,!1),e&&!mi.isBufferSource(e)&&(e.nodeType===T.Document?this.CopyNamespaces(e.documentElement,n,!1):this.CopyNamespaces(e,n,!1)),this.Parent){var a=this.Parent instanceof ee?this.Parent.GetXml():this.Parent;a&&this.CopyNamespaces(a,n,!1)}var i=J(r);for(var s in i){var o=i[s];s!==n.prefix&&n.setAttribute("xmlns"+(s?":"+s:""),o)}return t.LoadInnerXml(n),t.GetOutput()}},{key:"ResolveTransform",value:function(e){if("string"==typeof e)switch(e){case"enveloped":return new Gs;case"c14n":return new Fs;case"c14n-com":return new Xs;case"exc-c14n":return new Js;case"exc-c14n-com":return new qs;case"base64":return new Ks;default:throw new O(U.CRYPTOGRAPHIC_UNKNOWN_TRANSFORM,e)}if("xpath"===e.name){var t=new Qs;t.XPath=e.selector;var r=t.GetXml();if(r&&e.namespaces)for(var n=0,a=Object.entries(e.namespaces);n<a.length;n++){var i=v(a[n],2),s=i[0],o=i[1];r.firstChild.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:".concat(s),o)}return t}throw new O(U.CRYPTOGRAPHIC_UNKNOWN_TRANSFORM,e.name)}},{key:"ApplyTransforms",value:function(e,t){var r=null;if(e.Sort((function(e,t){var r=[Fs,Xs,Js,qs];return r.some((function(t){return e instanceof t}))?1:r.some((function(e){return t instanceof e}))?-1:0})).ForEach((function(e){e.LoadInnerXml(t),e instanceof Qs?e.GetOutput():r=e.GetOutput()})),1===e.Count&&e.Item(0)instanceof Gs){var n=new Fs;n.LoadInnerXml(t),r=n.GetOutput()}return r}},{key:"ApplySignOptions",value:(i=n(regeneratorRuntime.mark((function e(t,r,n,a){var i,s,o,u,l=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.id&&(this.XmlSignature.Id=a.id),!a.keyValue||n.algorithm.name.toUpperCase()===Xi){e.next=8;break}return t.KeyInfo||(t.KeyInfo=new js),i=t.KeyInfo,s=new bo,i.Add(s),e.next=8,s.importKey(a.keyValue);case 8:a.x509&&(t.KeyInfo||(t.KeyInfo=new js),o=t.KeyInfo,a.x509.forEach((function(e){var t=H.FromBase64(e),r=new Co(t);o.Add(r)}))),a.references&&a.references.forEach((function(e){var r=new Zs;e.id&&(r.Id=e.id),null!==e.uri&&void 0!==e.uri&&(r.Uri=e.uri),e.type&&(r.Type=e.type);var n=Eo.GetHashAlgorithm(e.hash);if(r.DigestMethod.Algorithm=n.namespaceURI,e.transforms&&e.transforms.length){var a=new zs;e.transforms.forEach((function(e){a.Add(l.ResolveTransform(e))})),r.Transforms=a}t.SignedInfo.References||(t.SignedInfo.References=new $s),t.SignedInfo.References.Add(r)})),t.SignedInfo.References.Count||(u=new Zs,t.SignedInfo.References.Add(u));case 11:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return i.apply(this,arguments)})},{key:"ValidateReferences",value:(r=n(regeneratorRuntime.mark((function e(t){var r,n,a,i,s,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=p(this.XmlSignature.SignedInfo.References.GetIterator()),e.prev=1,r.s();case 3:if((n=r.n()).done){e.next=15;break}return a=n.value,e.next=7,this.DigestReference(t,a,!1);case 7:if(i=e.sent,s=H.ToBase64(i),o=H.ToString(a.DigestValue,"base64"),s===o){e.next=13;break}throw u="Invalid digest for uri '".concat(a.Uri,"'. Calculated digest is ").concat(s," but the xml to validate supplies digest ").concat(o),new O(U.CRYPTOGRAPHIC,u);case 13:e.next=3;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(1),r.e(e.t0);case 20:return e.prev=20,r.f(),e.finish(20);case 23:return e.abrupt("return",!0);case 24:case"end":return e.stop()}}),e,this,[[1,17,20,23]])}))),function(e){return r.apply(this,arguments)})},{key:"ValidateSignatureValue",value:(t=n(regeneratorRuntime.mark((function e(t){var r,n,a,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.TransformSignedInfo(this.document),r=Eo.CreateSignatureAlgorithm(this.XmlSignature.SignedInfo.SignatureMethod),a=p(t),e.prev=3,a.s();case 5:if((i=a.n()).done){e.next=14;break}return s=i.value,e.next=9,r.Verify(n,s,this.Signature);case 9:if(!e.sent){e.next=12;break}return e.abrupt("return",!0);case 12:e.next=5;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),a.e(e.t0);case 19:return e.prev=19,a.f(),e.finish(19);case 22:return e.abrupt("return",!1);case 23:case"end":return e.stop()}}),e,this,[[3,16,19,22]])}))),function(e){return t.apply(this,arguments)})}]),e}();function Ro(e,t){if(e.nodeType!==T.Element)return null;if(e.hasAttribute("Id")&&e.getAttribute("Id")===t)return e;if(e.childNodes&&e.childNodes.length)for(var r=0;r<e.childNodes.length;r++){var n=Ro(e.childNodes[r],t);if(n)return n}return null}function Lo(e,t,r){t in e||(e[t]=r)}function Uo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Q(e)){e.namespaceURI&&"http://www.w3.org/XML/1998/namespace"!==e.namespaceURI&&Lo(t,e.prefix?e.prefix:"",e.namespaceURI);for(var r=0;r<e.attributes.length;r++){var n=e.attributes.item(r);n&&"xmlns"===n.prefix&&Lo(t,n.localName?n.localName:"",n.value)}e.parentNode&&Uo(e.parentNode,t)}}var Oo=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([B({parser:_s,required:!0})],Oo.prototype,"DigestMethod",void 0),k([B({localName:Es.DigestValue,namespaceURI:Ls,prefix:Is,converter:Y,required:!0})],Oo.prototype,"DigestValue",void 0),Oo=k([C({localName:ne.ElementNames.DigestAlgAndValue})],Oo);var Do=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(Ao);Do=k([C({localName:ne.ElementNames.IssuerSerial,namespaceURI:ne.NamespaceURI,prefix:ne.DefaultPrefix})],Do);var To=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([B({localName:ne.ElementNames.CertDigest,parser:Oo,required:!0})],To.prototype,"CertDigest",void 0),k([B({parser:Do,required:!0})],To.prototype,"IssuerSerial",void 0),k([x({localName:ne.AttributeNames.URI})],To.prototype,"Uri",void 0),To=k([C({localName:ne.ElementNames.Cert})],To);var Ho=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ie),Vo=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(Ho=k([C({localName:"CertIDList",parser:To})],Ho));Vo=k([C({localName:ne.ElementNames.SigningCertificate})],Vo);var _o=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([x({localName:ne.AttributeNames.Id,defaultValue:""})],_o.prototype,"Id",void 0),k([B({localName:ne.ElementNames.CertRefs,parser:Ho,required:!0})],_o.prototype,"CertRefs",void 0),_o=k([C({localName:ne.ElementNames.CompleteCertificateRefs})],_o);var jo=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZWN]|"[^"]*"|'[^']*'/g,Mo=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,Ko=/[^-+\dA-Z]/g;var Fo={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},Xo={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]};function Go(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;for(e=String(e);e.length<t;)e="0"+e;return e}function Jo(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate());t.setDate(t.getDate()-(t.getDay()+6)%7+3);var r=new Date(t.getFullYear(),0,4);r.setDate(r.getDate()-(r.getDay()+6)%7+3);var n=t.getTimezoneOffset()-r.getTimezoneOffset();t.setHours(t.getHours()-n);var a=(t.getTime()-r.getTime())/6048e5;return 1+Math.floor(a)}function qo(e){var t=e.getDay();return 0===t&&(t=7),t}function Wo(e){return null===e?"null":void 0===e?"undefined":"object"!==t(e)?t(e):Array.isArray(e)?"array":{}.toString.call(e).slice(8,-1).toLowerCase()}var Qo=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r,[{key:"OnLoadXml",value:function(e){e.textContent&&(this.Value=new Date(e.textContent))}},{key:"OnGetXml",value:function(e){this.Format?e.textContent=function(e,t,r,n){if(1!==arguments.length||"string"!==Wo(e)||/\d/.test(e)||(t=e,e=void 0),(e=e||new Date)instanceof Date||(e=new Date(e)),isNaN(e))throw TypeError("Invalid date");var a=(t=String(Fo[t]||t||Fo.default)).slice(0,4);"UTC:"!==a&&"GMT:"!==a||(t=t.slice(4),r=!0,"GMT:"===a&&(n=!0));var i=r?"getUTC":"get",s=e[i+"Date"](),o=e[i+"Day"](),u=e[i+"Month"](),l=e[i+"FullYear"](),c=e[i+"Hours"](),h=e[i+"Minutes"](),f=e[i+"Seconds"](),m=e[i+"Milliseconds"](),v=r?0:e.getTimezoneOffset(),g=Jo(e),d=qo(e),y={d:s,dd:Go(s),ddd:Xo.dayNames[o],dddd:Xo.dayNames[o+7],m:u+1,mm:Go(u+1),mmm:Xo.monthNames[u],mmmm:Xo.monthNames[u+12],yy:String(l).slice(2),yyyy:l,h:c%12||12,hh:Go(c%12||12),H:c,HH:Go(c),M:h,MM:Go(h),s:f,ss:Go(f),l:Go(m,3),L:Go(Math.round(m/10)),t:c<12?Xo.timeNames[0]:Xo.timeNames[1],tt:c<12?Xo.timeNames[2]:Xo.timeNames[3],T:c<12?Xo.timeNames[4]:Xo.timeNames[5],TT:c<12?Xo.timeNames[6]:Xo.timeNames[7],Z:n?"GMT":r?"UTC":(String(e).match(Mo)||[""]).pop().replace(Ko,""),o:(v>0?"-":"+")+Go(100*Math.floor(Math.abs(v)/60)+Math.abs(v)%60,4),W:g,N:d};return t.replace(jo,(function(e){return e in y?y[e]:e.slice(1,e.length-1)}))}(this.Value,this.Format):e.textContent=this.Value.toISOString()}}]),r}(ae);k([I({defaultValue:new Date,required:!0})],Qo.prototype,"Value",void 0),Qo=k([C({localName:"XadesDateTime",namespaceURI:ne.NamespaceURI,prefix:ne.DefaultPrefix})],Qo);var zo=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(se);zo=k([C({localName:ne.ElementNames.OtherRef})],zo);var Yo=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ie);Yo=k([C({localName:ne.ElementNames.OtherRefs})],Yo);var Zo=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([B({localName:ne.ElementNames.ByName,namespaceURI:ne.NamespaceURI,prefix:ne.DefaultPrefix,required:!0})],Zo.prototype,"ByName",void 0),k([B({localName:ne.ElementNames.ByKey,namespaceURI:ne.NamespaceURI,prefix:ne.DefaultPrefix,converter:Y,required:!0})],Zo.prototype,"ByKey",void 0),Zo=k([C({localName:ne.ElementNames.OCSPIdentifier})],Zo);var $o=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([x({localName:ne.AttributeNames.URI,defaultValue:""})],$o.prototype,"URI",void 0),k([B({parser:Zo,required:!0})],$o.prototype,"ResponderID",void 0),k([B({localName:ne.ElementNames.IssueTime,parser:Qo,required:!0})],$o.prototype,"ProducedAt",void 0),$o=k([C({localName:ne.ElementNames.OCSPIdentifier})],$o);var eu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([B({parser:$o})],eu.prototype,"OCSPIdentifier",void 0),k([B({parser:Oo,required:!0})],eu.prototype,"DigestAlgAndValue",void 0),eu=k([C({localName:ne.ElementNames.OCSPRef})],eu);var tu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ie);tu=k([C({localName:ne.ElementNames.OCSPRefs})],tu);var ru=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([x({localName:ne.AttributeNames.URI,defaultValue:""})],ru.prototype,"URI",void 0),k([B({localName:ne.ElementNames.Issuer,namespaceURI:ne.NamespaceURI,prefix:ne.DefaultPrefix,required:!0})],ru.prototype,"Issuer",void 0),k([B({localName:ne.ElementNames.IssueTime,parser:Qo,required:!0})],ru.prototype,"IssueTime",void 0),k([B({localName:ne.ElementNames.Number,namespaceURI:ne.NamespaceURI,prefix:ne.DefaultPrefix,converter:Z})],ru.prototype,"Number",void 0),ru=k([C({localName:ne.ElementNames.CRLIdentifier})],ru);var nu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([B({parser:Oo,required:!0})],nu.prototype,"DigestAlgAndValue",void 0),k([B({parser:ru})],nu.prototype,"CRLIdentifier",void 0),nu=k([C({localName:ne.ElementNames.CRLRef})],nu);var au=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ie);au=k([C({localName:ne.ElementNames.CRLRefs})],au);var iu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([x({localName:ne.AttributeNames.Id,defaultValue:""})],iu.prototype,"Id",void 0),k([B({parser:au})],iu.prototype,"CRLRefs",void 0),k([B({parser:tu})],iu.prototype,"OCSPRefs",void 0),k([B({parser:Yo})],iu.prototype,"OtherRefs",void 0),iu=k([C({localName:ne.ElementNames.CompleteRevocationRefs})],iu);var su=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([B({parser:no,required:!0})],su.prototype,"Signature",void 0),su=k([C({localName:ne.ElementNames.CounterSignature})],su);var ou=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([x({localName:ne.AttributeNames.ObjectReference,required:!0})],ou.prototype,"ObjectReference",void 0),k([B({localName:ne.ElementNames.Description,namespaceURI:ne.NamespaceURI,prefix:ne.DefaultPrefix})],ou.prototype,"Description",void 0),k([B({parser:ye})],ou.prototype,"ObjectIdentifier",void 0),k([B({localName:ne.ElementNames.MimeType,namespaceURI:ne.NamespaceURI,prefix:ne.DefaultPrefix})],ou.prototype,"MimeType",void 0),k([B({localName:ne.ElementNames.Encoding,namespaceURI:ne.NamespaceURI,prefix:ne.DefaultPrefix})],ou.prototype,"Encoding",void 0),ou=k([C({localName:ne.ElementNames.DataObjectFormat})],ou);var uu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([x({localName:ne.AttributeNames.URI,defaultValue:"",required:!0})],uu.prototype,"Uri",void 0),k([x({localName:ne.AttributeNames.ReferencedData,defaultValue:!1})],uu.prototype,"ReferencedData",void 0),uu=k([C({localName:ne.ElementNames.Include})],uu);var lu=function(e){o(r,e);var t=h(r);function r(){var e;return a(this,r),(e=t.apply(this,arguments)).DigestMethod=new _s,e}return s(r)}(ae);k([x({localName:ne.AttributeNames.URI,defaultValue:""})],lu.prototype,"Uri",void 0),k([x({localName:ne.AttributeNames.Id,defaultValue:""})],lu.prototype,"Id",void 0),k([B({required:!0,parser:_s})],lu.prototype,"DigestMethod",void 0),k([B({required:!0,localName:Es.DigestValue,namespaceURI:Ls,prefix:Is,converter:Y})],lu.prototype,"DigestValue",void 0),lu=k([C({localName:ne.ElementNames.ReferenceInfo})],lu);var cu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ie);cu=k([C({localName:"ReferenceInfos",parser:lu})],cu);var hu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ue);hu=k([C({localName:ne.ElementNames.EncapsulatedTimeStamp})],hu);var fu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ie);fu=k([C({localName:"EncapsulatedPKIDatas",parser:hu})],fu);var mu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(se);mu=k([C({localName:ne.ElementNames.XMLTimeStamp})],mu);var vu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ie);vu=k([C({localName:"XMLTimeStampCollection",parser:mu})],vu);var gu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([x({localName:ne.AttributeNames.Id,defaultValue:""})],gu.prototype,"Id",void 0),k([B({parser:uu})],gu.prototype,"Include",void 0),k([B({parser:cu,noRoot:!0})],gu.prototype,"ReferenceInfo",void 0),k([B({parser:Ts})],gu.prototype,"CanonicalizationMethod",void 0),k([B({parser:fu,noRoot:!0})],gu.prototype,"EncapsulatedTimeStamp",void 0),k([B({parser:vu,noRoot:!0})],gu.prototype,"XMLTimeStamp",void 0),gu=k([C({localName:"GenericTimeStamp"})],gu);var du=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([x({localName:ne.AttributeNames.Id,defaultValue:""})],du.prototype,"Id",void 0),k([B({parser:cu,noRoot:!0})],du.prototype,"ReferenceInfo",void 0),k([B({parser:Ts})],du.prototype,"CanonicalizationMethod",void 0),k([B({parser:fu,noRoot:!0})],du.prototype,"EncapsulatedTimeStamp",void 0),k([B({parser:vu,noRoot:!0})],du.prototype,"XMLTimeStamp",void 0),du=k([C({localName:ne.ElementNames.OtherTimeStamp})],du);var yu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([x({localName:ne.AttributeNames.Id,defaultValue:""})],yu.prototype,"Id",void 0),k([B({parser:uu})],yu.prototype,"Include",void 0),k([B({parser:Ts})],yu.prototype,"CanonicalizationMethod",void 0),k([B({parser:fu,noRoot:!0})],yu.prototype,"EncapsulatedTimeStamp",void 0),k([B({parser:vu,noRoot:!0})],yu.prototype,"XMLTimeStamp",void 0);var pu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(yu=k([C({localName:ne.ElementNames.XAdESTimeStamp})],yu));pu=k([C({localName:ne.ElementNames.IndividualDataObjectsTimeStamp})],pu);var ku=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ie);ku=k([C({localName:"IndividualDataObjectsTimeStampCollection",parser:pu})],ku);var bu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(yu);bu=k([C({localName:ne.ElementNames.AllDataObjectsTimeStamp})],bu);var wu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ie);wu=k([C({localName:"DataObjectFormatCollection",parser:ou})],wu);var Su=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ie);Su=k([C({localName:"CommitmentTypeIndicationCollection",parser:Se})],Su);var Nu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ie);Nu=k([C({localName:"AllDataObjectsTimeStampCollection",parser:bu})],Nu);var Au=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([x({localName:ne.AttributeNames.Id,defaultValue:""})],Au.prototype,"Id",void 0),k([B({parser:wu,noRoot:!0})],Au.prototype,"DataObjectFormats",void 0),k([B({parser:Su,noRoot:!0})],Au.prototype,"CommitmentTypeIndications",void 0),k([B({parser:Nu,noRoot:!0})],Au.prototype,"AllDataObjectsTimeStamps",void 0),k([B({parser:ku,noRoot:!0})],Au.prototype,"IndividualDataObjectsTimeStamps",void 0),Au=k([C({localName:ne.ElementNames.SignedDataObjectProperties})],Au);var Cu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ye);Cu=k([C({localName:ne.ElementNames.SigPolicyId})],Cu);var Bu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(Oo);Bu=k([C({localName:ne.ElementNames.SigPolicyHash})],Bu);var xu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(oe);xu=k([C({localName:ne.ElementNames.SigPolicyQualifier})],xu);var Iu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([I({converter:Z,required:!0})],Iu.prototype,"Value",void 0),Iu=k([C({localName:"int"})],Iu);var Eu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ie);Eu=k([C({localName:"IntegerList",parser:Iu})],Eu);var Pu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([B({localName:ne.ElementNames.Organization,namespaceURI:ne.NamespaceURI,prefix:ne.DefaultPrefix,required:!0})],Pu.prototype,"Organization",void 0),k([B({localName:ne.ElementNames.NoticeNumbers,parser:Eu,required:!0})],Pu.prototype,"NoticeNumbers",void 0),Pu=k([C({localName:ne.ElementNames.NoticeRef})],Pu);var Ru=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([B({localName:ne.ElementNames.NoticeRef,parser:Pu})],Ru.prototype,"NoticeRef",void 0),k([B({localName:ne.ElementNames.ExplicitText,namespaceURI:ne.NamespaceURI,prefix:ne.DefaultPrefix})],Ru.prototype,"ExplicitText",void 0),Ru=k([C({localName:ne.ElementNames.SPUserNotice})],Ru);var Lu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([I()],Lu.prototype,"Value",void 0),Lu=k([C({localName:ne.ElementNames.SPURI})],Lu);var Uu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ie);Uu=k([C({localName:ne.ElementNames.SigPolicyQualifiers,parser:xu})],Uu);var Ou=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([B({localName:ne.ElementNames.SigPolicyId,parser:Cu,required:!0})],Ou.prototype,"SigPolicyId",void 0),k([B({parser:zs})],Ou.prototype,"Transforms",void 0),k([B({localName:ne.ElementNames.SigPolicyHash,parser:Bu,required:!0})],Ou.prototype,"SigPolicyHash",void 0),k([B({localName:ne.ElementNames.SigPolicyQualifiers,parser:Uu})],Ou.prototype,"SigPolicyQualifiers",void 0),Ou=k([C({localName:ne.ElementNames.SignaturePolicyId})],Ou);var Du=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([B({localName:ne.ElementNames.SignaturePolicyId,namespaceURI:ne.NamespaceURI,prefix:ne.DefaultPrefix,parser:Ou})],Du.prototype,"SignaturePolicyId",void 0),k([B({localName:ne.ElementNames.SignaturePolicyImplied,namespaceURI:ne.NamespaceURI,prefix:ne.DefaultPrefix,converter:{set:function(e){return!0},get:function(e){return""}},defaultValue:!1})],Du.prototype,"SignaturePolicyImplied",void 0),Du=k([C({localName:ne.ElementNames.SignaturePolicyIdentifier})],Du);var Tu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([B({localName:ne.ElementNames.City,defaultValue:"",namespaceURI:ne.NamespaceURI,prefix:ne.DefaultPrefix})],Tu.prototype,"City",void 0),k([B({localName:ne.ElementNames.StateOrProvince,defaultValue:"",namespaceURI:ne.NamespaceURI,prefix:ne.DefaultPrefix})],Tu.prototype,"StateOrProvince",void 0),k([B({localName:ne.ElementNames.PostalCode,defaultValue:"",namespaceURI:ne.NamespaceURI,prefix:ne.DefaultPrefix})],Tu.prototype,"PostalCode",void 0),k([B({localName:ne.ElementNames.CountryName,defaultValue:"",namespaceURI:ne.NamespaceURI,prefix:ne.DefaultPrefix})],Tu.prototype,"CountryName",void 0),Tu=k([C({localName:ne.ElementNames.SignatureProductionPlace})],Tu);var Hu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(se);Hu=k([C({localName:ne.ElementNames.ClaimedRole})],Hu);var Vu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ie);Vu=k([C({localName:ne.ElementNames.ClaimedRoles,parser:Hu})],Vu);var _u=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ue);_u=k([C({localName:ne.ElementNames.CertifiedRole})],_u);var ju=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ie);ju=k([C({localName:ne.ElementNames.CertifiedRoles,parser:_u})],ju);var Mu,Ku=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([B({parser:Vu})],Ku.prototype,"ClaimedRoles",void 0),k([B({parser:ju})],Ku.prototype,"CertifiedRoles",void 0),Ku=k([C({localName:ne.ElementNames.SignerRole})],Ku);var Fu=Mu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([B({localName:ne.ElementNames.CertDigest,parser:Oo,required:!0})],Fu.prototype,"CertDigest",void 0),k([B({localName:ne.ElementNames.IssuerSerialV2,namespaceURI:ne.NamespaceURI,prefix:ne.DefaultPrefix,converter:Y,required:!1})],Fu.prototype,"IssuerSerial",void 0),k([x({localName:ne.AttributeNames.URI})],Fu.prototype,"Uri",void 0),Fu=Mu=k([C({localName:ne.ElementNames.Cert,parser:Mu})],Fu);var Xu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ie),Gu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(Xu=k([C({localName:"CertIDListV2",parser:Fu})],Xu));Gu=k([C({localName:ne.ElementNames.SigningCertificateV2})],Gu);var Ju=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([x({localName:ne.AttributeNames.Id,defaultValue:""})],Ju.prototype,"Id",void 0),k([B({localName:ne.ElementNames.SigningTime,parser:Qo})],Ju.prototype,"SigningTime",void 0),k([B({parser:Vo})],Ju.prototype,"SigningCertificate",void 0),k([B({parser:Gu})],Ju.prototype,"SigningCertificateV2",void 0),k([B({parser:Du})],Ju.prototype,"SignaturePolicyIdentifier",void 0),k([B({parser:Tu})],Ju.prototype,"SignatureProductionPlace",void 0),k([B({parser:Ku})],Ju.prototype,"SignerRole",void 0),Ju=k([C({localName:ne.ElementNames.SignedSignatureProperties})],Ju);var qu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([x({localName:ne.AttributeNames.Id,defaultValue:""})],qu.prototype,"Id",void 0),k([B({parser:Ju})],qu.prototype,"SignedSignatureProperties",void 0),k([B({parser:Au})],qu.prototype,"SignedDataObjectProperties",void 0),qu=k([C({localName:ne.ElementNames.SignedProperties})],qu);var Wu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(se);Wu=k([C({localName:ne.ElementNames.UnsignedDataObjectProperty})],Wu);var Qu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ie);k([x({localName:ne.AttributeNames.Id,defaultValue:""})],Qu.prototype,"Id",void 0),Qu=k([C({localName:ne.ElementNames.UnsignedSignatureProperties,parser:Wu})],Qu);var zu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ue);zu=k([C({localName:ne.ElementNames.OtherValue})],zu);var Yu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ie);Yu=k([C({localName:ne.ElementNames.OCSPValues,parser:zu})],Yu);var Zu=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ue);Zu=k([C({localName:ne.ElementNames.EncapsulatedOCSPValue})],Zu);var $u=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ie);$u=k([C({localName:ne.ElementNames.OCSPValues,parser:Zu})],$u);var el=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ue);el=k([C({localName:ne.ElementNames.EncapsulatedCRLValue})],el);var tl=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ie);tl=k([C({localName:ne.ElementNames.CRLValues,parser:el})],tl);var rl=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([x({localName:ne.AttributeNames.Id,defaultValue:""})],rl.prototype,"Id",void 0),k([B({parser:tl})],rl.prototype,"CRLValues",void 0),k([B({parser:$u})],rl.prototype,"OCSPValues",void 0),k([B({parser:Yu})],rl.prototype,"OtherValues",void 0),rl=k([C({localName:ne.ElementNames.RevocationValues})],rl);var nl=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(yu);nl=k([C({localName:ne.ElementNames.SignatureTimeStamp})],nl);var al=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(yu);al=k([C({localName:ne.ElementNames.SigAndRefsTimeStamp})],al);var il=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(yu);il=k([C({localName:ne.ElementNames.RefsOnlyTimeStamp})],il);var sl=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(yu);sl=k([C({localName:ne.ElementNames.ArchiveTimeStamp})],sl);var ol=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(_o);ol=k([C({localName:ne.ElementNames.AttributeCertificateRefs})],ol);var ul=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(iu);ul=k([C({localName:ne.ElementNames.AttributeRevocationRefs})],ul);var ll=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(me);ll=k([C({localName:ne.ElementNames.AttrAuthoritiesCertValues})],ll);var cl=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(rl);cl=k([C({localName:ne.ElementNames.AttributeRevocationValues})],cl);var hl=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);hl=k([C({localName:"UnsignedSignatureProperty"})],hl);var fl=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r,[{key:"OnLoadXml",value:function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes.item(t);if(r.nodeType===T.Element){var n=void 0;switch(r.localName){case ne.ElementNames.CounterSignature:n=su;break;case ne.ElementNames.SignatureTimeStamp:n=nl;break;case ne.ElementNames.CompleteCertificateRefs:n=_o;break;case ne.ElementNames.CompleteRevocationRefs:n=iu;break;case ne.ElementNames.AttributeCertificateRefs:n=ol;break;case ne.ElementNames.AttributeRevocationRefs:n=ul;break;case ne.ElementNames.SigAndRefsTimeStamp:n=al;break;case ne.ElementNames.RefsOnlyTimeStamp:n=il;break;case ne.ElementNames.CertificateValues:n=me;break;case ne.ElementNames.RevocationValues:n=rl;break;case ne.ElementNames.AttrAuthoritiesCertValues:n=ll;break;case ne.ElementNames.AttributeRevocationValues:n=cl;break;case ne.ElementNames.ArchiveTimeStamp:n=sl}if(n){var a=n.LoadXml(r);this.Add(a)}}}}}]),r}(ie);k([x({localName:ne.AttributeNames.Id,defaultValue:""})],fl.prototype,"Id",void 0),fl=k([C({localName:ne.ElementNames.UnsignedSignatureProperties,parser:hl})],fl);var ml=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([x({localName:ne.AttributeNames.Id,defaultValue:""})],ml.prototype,"Id",void 0),k([B({parser:fl})],ml.prototype,"UnsignedSignatureProperties",void 0),k([B({parser:Qu})],ml.prototype,"UnsignedDataObjectProperties",void 0),ml=k([C({localName:ne.ElementNames.UnsignedProperties})],ml);var vl=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([x({localName:ne.AttributeNames.Target,required:!0})],vl.prototype,"Target",void 0),k([x({localName:ne.AttributeNames.Id,defaultValue:""})],vl.prototype,"Id",void 0),k([B({parser:qu})],vl.prototype,"SignedProperties",void 0),k([B({parser:ml})],vl.prototype,"UnsignedProperties",void 0),vl=k([C({localName:ne.ElementNames.QualifyingProperties})],vl);var gl=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(ae);k([x({localName:ne.AttributeNames.URI,required:!0})],gl.prototype,"Uri",void 0),k([x({localName:ne.AttributeNames.Id,defaultValue:""})],gl.prototype,"Id",void 0),gl=k([C({localName:ne.ElementNames.QualifyingPropertiesReference})],gl);var dl=function(e){o(r,e);var t=h(r);function r(){return a(this,r),t.apply(this,arguments)}return s(r)}(Hs);k([B({parser:vl})],dl.prototype,"QualifyingProperties",void 0),dl=k([C({localName:Es.Object})],dl);var yl=Object.freeze({__proto__:null,get Any(){return se},get AnyCollection(){return oe},get OtherCertificate(){return le},get OtherCertificateCollection(){return ce},get EncapsulatedX509Certificate(){return he},get EncapsulatedX509CertificateCollection(){return fe},get CertificateValues(){return me},get CommitmentTypeQualifier(){return pe},get CommitmentTypeQualifiers(){return ke},get ObjectReference(){return be},get ObjectReferenceCollection(){return we},get CommitmentTypeIndication(){return Se},get CompleteCertificateRefs(){return _o},get OtherRef(){return zo},get OtherRefs(){return Yo},get ResponderID(){return Zo},get OCSPIdentifier(){return $o},get OCSPRef(){return eu},get OCSPRefs(){return tu},get CRLIdentifier(){return ru},get CRLRef(){return nu},get CRLRefs(){return au},get CompleteRevocationRefs(){return iu},get CounterSignature(){return su},get DataObjectFormat(){return ou},get XadesDateTime(){return Qo},get EncapsulatedPKIData(){return ue},get Include(){return uu},get ReferenceInfo(){return lu},get ReferenceInfos(){return cu},get EncapsulatedTimeStamp(){return hu},get EncapsulatedTimeStampCollection(){return fu},get XMLTimeStamp(){return mu},get XMLTimeStampCollection(){return vu},get GenericTimeStamp(){return gu},get Identifier(){return ve},get DocumentationReference(){return ge},get DocumentationReferences(){return de},get ObjectIdentifier(){return ye},get OtherTimeStamp(){return du},get QualifyingProperties(){return vl},get QualifyingPropertiesReference(){return gl},get OtherValue(){return zu},get OtherValues(){return Yu},get EncapsulatedOCSPValue(){return Zu},get OCSPValues(){return $u},get EncapsulatedCRLValue(){return el},get CRLValues(){return tl},get RevocationValues(){return rl},get SigPolicyId(){return Cu},get SigPolicyHash(){return Bu},get SigPolicyQualifier(){return xu},get Integer(){return Iu},get IntegerList(){return Eu},get NoticeReference(){return Pu},get SPUserNotice(){return Ru},get SPURI(){return Lu},get SigPolicyQualifiers(){return Uu},get SignaturePolicyId(){return Ou},get SignaturePolicyIdentifier(){return Du},get SignatureProductionPlace(){return Tu},get IndividualDataObjectsTimeStamp(){return pu},get IndividualDataObjectsTimeStampCollection(){return ku},get AllDataObjectsTimeStamp(){return bu},get DataObjectFormatCollection(){return wu},get CommitmentTypeIndicationCollection(){return Su},get AllDataObjectsTimeStampCollection(){return Nu},get SignedDataObjectProperties(){return Au},get SignedProperties(){return qu},get SignedSignatureProperties(){return Ju},get ClaimedRole(){return Hu},get ClaimedRoles(){return Vu},get CertifiedRole(){return _u},get CertifiedRoles(){return ju},get SignerRole(){return Ku},get DigestAlgAndValueType(){return Oo},get IssuerSerial(){return Do},get Cert(){return To},get CertIDList(){return Ho},get SigningCertificate(){return Vo},get CertV2(){return Fu},get CertIDListV2(){return Xu},get SigningCertificateV2(){return Gu},get UnsignedDataObjectProperty(){return Wu},get UnsignedDataObjectProperties(){return Qu},get UnsignedProperties(){return ml},get SignatureTimeStamp(){return nl},get SigAndRefsTimeStamp(){return al},get RefsOnlyTimeStamp(){return il},get ArchiveTimeStamp(){return sl},get AttributeCertificateRefs(){return ol},get AttributeRevocationRefs(){return ul},get AttrAuthoritiesCertValues(){return ll},get AttributeRevocationValues(){return cl},get UnsignedSignatureProperty(){return hl},get UnsignedSignatureProperties(){return fl},get XAdESTimeStamp(){return yu},get DataObject(){return dl},XmlXades:ne}),pl=function(e){o(d,e);var r,i,l,c,f,v,g=h(d);function d(e){var t;return a(this,d),(t=g.call(this,e)).properties=null,t.CreateQualifyingProperties(),t}return s(d,[{key:"Properties",get:function(){return this.properties}},{key:"SignedProperties",get:function(){if(!this.Properties)throw new O(U.XML_EXCEPTION,"Properties is empty");return this.Properties.SignedProperties}},{key:"UnsignedProperties",get:function(){if(!this.Properties)throw new O(U.XML_EXCEPTION,"Properties is empty");return this.Properties.UnsignedProperties}},{key:"LoadXml",value:function(e,t){m(u(d.prototype),"LoadXml",this).call(this,e);var r=null;this.XmlSignature.ObjectList.Some((function(e){if(e.Element)for(var t=0;t<e.Element.childNodes.length;t++){var n=e.Element.childNodes.item(t);if(n.nodeType===T.Element&&n.localName===ne.ElementNames.QualifyingProperties)return r=vl.LoadXml(n),!0}return!1})),this.properties=r}},{key:"Sign",value:(v=n(regeneratorRuntime.mark((function e(t,r,n,a){var i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",m(u(d.prototype),"Sign",this).apply(this,i));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return v.apply(this,arguments)})},{key:"CreateQualifyingProperties",value:function(){var e,t;if(this.Properties)throw new O(U.XML_EXCEPTION,"Cannot create QualifyingProperties cause current signature has got one. You must create CounterSignature");var r=pi.crypto.getRandomValues(new Uint8Array(6)),n=H.ToHex(r);(e=this.XmlSignature).Id||(e.Id="id-".concat(n));var a=new dl;a.QualifyingProperties.Target="#".concat(this.XmlSignature.Id),(t=a.QualifyingProperties.SignedProperties).Id||(t.Id="xades-".concat(this.XmlSignature.Id)),this.properties=a.QualifyingProperties,this.XmlSignature.ObjectList.Add(a)}},{key:"ApplySignOptions",value:(f=n(regeneratorRuntime.mark((function e(t,r,n,a){var i,s,o,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m(u(d.prototype),"ApplySignOptions",this).call(this,t,r,n,a);case 2:if(!this.Properties){e.next=21;break}return(i=this.Properties.SignedProperties.SignedSignatureProperties).SigningTime.Value=new Date,a.signingTime&&(a.signingTime.value&&(i.SigningTime.Value=a.signingTime.value),a.signingTime.format&&(i.SigningTime.Format=a.signingTime.format)),s=q({},r,n.algorithm),o=s.hash,(l=new Zs).Type="http://uri.etsi.org/01903#SignedProperties",l.Uri="#".concat(this.Properties.SignedProperties.Id),l.DigestMethod.Algorithm=Eo.GetHashAlgorithm(o).namespaceURI,t.SignedInfo.References.Add(l),e.next=15,this.ApplySigningCertificate(a.signingCertificate);case 15:return e.next=17,this.ApplySigningCertificateV2(a.signingCertificateV2);case 17:return e.next=19,this.ApplySignaturePolicyIdentifier(a.policy);case 19:this.ApplySignatureProductionPlace(a.productionPlace),this.ApplySignerRoles(a.signerRole);case 21:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return f.apply(this,arguments)})},{key:"ApplySigningCertificate",value:(c=n(regeneratorRuntime.mark((function e(t){var r,n,a,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.Properties||!t){e.next=19;break}if((r="string"==typeof t?{certificate:t}:t).digestAlgorithm||(r.digestAlgorithm="SHA-256"),n=H.FromBase64(r.certificate),a=new No(n),!this.Properties.SignedProperties.SignedSignatureProperties.SigningCertificate.Count){e.next=8;break}throw new O(U.XML_EXCEPTION,"Signature can contain only one SigningCertificate");case 8:return(i=new To).IssuerSerial.X509IssuerName=a.Issuer,i.IssuerSerial.X509SerialNumber=a.SerialNumber,s=Eo.GetHashAlgorithm(r.digestAlgorithm),i.CertDigest.DigestMethod.Algorithm=s.namespaceURI,e.t0=Uint8Array,e.next=16,a.Thumbprint(s.algorithm.name);case 16:e.t1=e.sent,i.CertDigest.DigestValue=new e.t0(e.t1),this.Properties.SignedProperties.SignedSignatureProperties.SigningCertificate.Add(i);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"ApplySigningCertificateV2",value:(l=n(regeneratorRuntime.mark((function e(t){var r,n,a,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.Properties||!t){e.next=17;break}if((r="string"==typeof t?{certificate:t}:t).digestAlgorithm||(r.digestAlgorithm="SHA-256"),n=H.FromBase64(r.certificate),a=new No(n),!this.Properties.SignedProperties.SignedSignatureProperties.SigningCertificateV2.Count){e.next=8;break}throw new O(U.XML_EXCEPTION,"Signature can contain only one SigningCertificateV2");case 8:return i=new Fu,s=Eo.GetHashAlgorithm(r.digestAlgorithm),i.CertDigest.DigestMethod.Algorithm=s.namespaceURI,e.t0=Uint8Array,e.next=14,a.Thumbprint(s.algorithm.name);case 14:e.t1=e.sent,i.CertDigest.DigestValue=new e.t0(e.t1),this.Properties.SignedProperties.SignedSignatureProperties.SigningCertificateV2.Add(i);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"ApplySignaturePolicyIdentifier",value:(i=n(regeneratorRuntime.mark((function e(r){var n,a,i,s,o,u,l=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.Properties){e.next=33;break}if(n=this.Properties.SignedProperties.SignedSignatureProperties,!r||"object"!==t(r)){e.next=32;break}if((a=new Ou).SigPolicyId=new Cu,a.SigPolicyId.Identifier=new ve,r.identifier.qualifier&&(a.SigPolicyId.Identifier.Qualifier=r.identifier.qualifier),a.SigPolicyId.Identifier.Value=r.identifier.value,r.identifier.description&&(a.SigPolicyId.Description=r.identifier.description),r.identifier.references&&(a.SigPolicyId.DocumentationReferences=new de,r.identifier.references.forEach((function(e){var t=new ge;t.Uri=e,a.SigPolicyId.DocumentationReferences.Add(t)}))),r.transforms&&r.transforms.length&&(a.Transforms=new zs,r.transforms.forEach((function(e){a.Transforms.Add(l.ResolveTransform(e))}))),a.SigPolicyHash=new Bu,a.SigPolicyHash.DigestMethod=new _s,i=Eo.GetHashAlgorithm(r.hash),a.SigPolicyHash.DigestMethod.Algorithm=i.namespaceURI,!r.digestValue){e.next=19;break}a.SigPolicyHash.DigestValue=H.FromBase64(r.digestValue),e.next=27;break;case 19:return s=a.SigPolicyId.Identifier.GetXml().cloneNode(!0),this.CopyNamespaces(s,s,!0),this.InjectNamespaces(this.GetSignatureNamespaces(),s,!0),o=null,a.Transforms&&a.Transforms.Count?o=this.ApplyTransforms(a.Transforms,s):((u=new Fs).LoadInnerXml(s),o=u.GetOutput()),e.next=26,i.Digest(o);case 26:a.SigPolicyHash.DigestValue=e.sent;case 27:r.qualifiers&&(a.SigPolicyQualifiers=new Uu,r.qualifiers.forEach((function(e){var t=new xu;if("string"==typeof e){var r=new Lu;r.Value=e,t.Add(r)}else{var n=new Ru;e.explicitText&&(n.ExplicitText=e.explicitText),e.noticeRef&&(n.NoticeRef=new Pu,n.NoticeRef.Organization=e.noticeRef.organization,n.NoticeRef.NoticeNumbers=new Eu,e.noticeRef.noticeNumbers&&e.noticeRef.noticeNumbers.forEach((function(e){var t=new Iu;t.Value=e,n.NoticeRef.NoticeNumbers.Add(t)}))),t.Add(n)}a.SigPolicyQualifiers.Add(t)}))),n.SignaturePolicyIdentifier.SignaturePolicyId=a,n.SignaturePolicyIdentifier.SignaturePolicyImplied=!1,e.next=33;break;case 32:r&&(n.SignaturePolicyIdentifier.SignaturePolicyImplied=!0);case 33:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"ApplySignatureProductionPlace",value:function(e){if(this.Properties&&e){var t=this.Properties.SignedProperties.SignedSignatureProperties;e.city&&(t.SignatureProductionPlace.City=e.city),e.code&&(t.SignatureProductionPlace.PostalCode=e.code),e.country&&(t.SignatureProductionPlace.CountryName=e.country),e.state&&(t.SignatureProductionPlace.StateOrProvince=e.state)}}},{key:"ApplySignerRoles",value:function(e){if(this.Properties&&e){var t=this.Properties.SignedProperties.SignedSignatureProperties;e.claimed&&e.claimed.forEach((function(e){var r=new Hu;r.Value=e,t.SignerRole.ClaimedRoles.Add(r)})),e.certified&&e.certified.forEach((function(e){var r=new _u;r.Encoding="der",r.Value=H.FromBase64(e),t.SignerRole.CertifiedRoles.Add(r)}))}}},{key:"VerifySigningCertificate",value:(r=n(regeneratorRuntime.mark((function e(){var t,r,n,a,i,s,o,u,l,c,h,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=null,!this.XmlSignature||!this.Properties){e.next=34;break}if(1===(r=this.Properties.SignedProperties.SignedSignatureProperties).SigningCertificate.Count){e.next=5;break}throw new O(U.XML_EXCEPTION,"Signature has got wrong amount of SigningCertificate, MUST be one");case 5:n=Eo.GetHashAlgorithm("SHA-256"),a=r.SigningCertificate.Item(0),i=H.ToBase64(a.CertDigest.DigestValue),s=this.XmlSignature.KeyInfo,o=0;case 10:if(s.Count,t){e.next=32;break}if(!((u=s.Item(o))instanceof Co)){e.next=29;break}l=u.Certificates,c=0;case 15:if(l.length,t){e.next=29;break}if(h=l[c]){e.next=19;break}return e.abrupt("continue",26);case 19:return e.t0=Uint8Array,e.next=22,h.Thumbprint(n.algorithm);case 22:e.t1=e.sent,f=new e.t0(e.t1),H.ToBase64(f)===i&&(t=h);case 26:c++,e.next=15;break;case 29:o++,e.next=10;break;case 32:if(t&&t.Issuer===a.IssuerSerial.X509IssuerName&&t.SerialNumber===a.IssuerSerial.X509SerialNumber){e.next=34;break}throw new O(U.XML_EXCEPTION,"SigningCertificate not found");case 34:return e.abrupt("return",t);case 35:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})}]),d}(Po);return e.Application=pi,e.Convert=H,e.Parse=F,e.Select=K,e.SignedXml=pl,e.xml=yl,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
