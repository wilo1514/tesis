var XmlDSigJs=function(e){"use strict";function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=Array(t);r<t;r++)a[r]=e[r];return a}function r(e,t,r,a,n,i,s){try{var u=e[i](s),o=u.value}catch(e){return void r(e)}u.done?t(o):Promise.resolve(o).then(a,n)}function a(e){return function(){var t=this,a=arguments;return new Promise((function(n,i){var s=e.apply(t,a);function u(e){r(s,n,i,u,o,"next",e)}function o(e){r(s,n,i,u,o,"throw",e)}u(void 0)}))}}function n(e,t,r){return t=f(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,v()?Reflect.construct(t,r||[],f(e).constructor):t.apply(e,r))}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t,r){if(v())return Reflect.construct.apply(null,arguments);var a=[null];a.push.apply(a,t);var n=new(e.bind.apply(e,a));return r&&w(n,r.prototype),n}function u(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,C(a.key),a)}}function o(e,t,r){return t&&u(e.prototype,t),r&&u(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function l(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=E(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){u=!0,i=e},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw i}}}}function c(e,t,r){return(t=C(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function h(){return h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var a=S(e,t);if(a){var n=Object.getOwnPropertyDescriptor(a,t);return n.get?n.get.call(arguments.length<3?e:r):n.value}},h.apply(null,arguments)}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&w(e,t)}function v(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(v=function(){return!!e})()}function d(e){if(null==e)throw new TypeError("Cannot destructure "+e)}function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach((function(t){c(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function y(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r={};for(var a in e)if({}.hasOwnProperty.call(e,a)){if(t.includes(a))continue;r[a]=e[a]}return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.includes(r)||{}.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function k(){k=function(){return t};var e,t={},r=Object.prototype,a=r.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",o=i.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function c(e,t,r,a){var i=t&&t.prototype instanceof g?t:g,s=Object.create(i.prototype),u=new V(a||[]);return n(s,"_invoke",{value:x(e,r,u)}),s}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=c;var f="suspendedStart",m="executing",v="completed",d={};function g(){}function p(){}function y(){}var w={};l(w,s,(function(){return this}));var b=Object.getPrototypeOf,S=b&&b(b(D([])));S&&S!==r&&a.call(S,s)&&(w=S);var A=y.prototype=g.prototype=Object.create(w);function N(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function r(n,i,s,u){var o=h(e[n],e,i);if("throw"!==o.type){var l=o.arg,c=l.value;return c&&"object"==typeof c&&a.call(c,"__await")?t.resolve(c.__await).then((function(e){r("next",e,s,u)}),(function(e){r("throw",e,s,u)})):t.resolve(c).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,u)}))}u(o.arg)}var i;n(this,"_invoke",{value:function(e,a){function n(){return new t((function(t,n){r(e,a,t,n)}))}return i=i?i.then(n,n):n()}})}function x(t,r,a){var n=f;return function(i,s){if(n===m)throw Error("Generator is already running");if(n===v){if("throw"===i)throw s;return{value:e,done:!0}}for(a.method=i,a.arg=s;;){var u=a.delegate;if(u){var o=E(u,a);if(o){if(o===d)continue;return o}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(n===f)throw n=v,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);n=m;var l=h(t,r,a);if("normal"===l.type){if(n=a.done?v:"suspendedYield",l.arg===d)continue;return{value:l.arg,done:a.done}}"throw"===l.type&&(n=v,a.method="throw",a.arg=l.arg)}}}function E(t,r){var a=r.method,n=t.iterator[a];if(n===e)return r.delegate=null,"throw"===a&&t.iterator.return&&(r.method="return",r.arg=e,E(t,r),"throw"===r.method)||"return"!==a&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+a+"' method")),d;var i=h(n,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,d;var s=i.arg;return s?s.done?(r[t.resultName]=s.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,d):s:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function B(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function V(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function r(){for(;++n<t.length;)if(a.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(typeof t+" is not iterable")}return p.prototype=y,n(A,"constructor",{value:y,configurable:!0}),n(y,"constructor",{value:p,configurable:!0}),p.displayName=l(y,o,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,l(e,o,"GeneratorFunction")),e.prototype=Object.create(A),e},t.awrap=function(e){return{__await:e}},N(C.prototype),l(C.prototype,u,(function(){return this})),t.AsyncIterator=C,t.async=function(e,r,a,n,i){void 0===i&&(i=Promise);var s=new C(c(e,r,a,n),i);return t.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},N(A),l(A,o,"Generator"),l(A,s,(function(){return this})),l(A,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var a in t)r.push(a);return r.reverse(),function e(){for(;r.length;){var a=r.pop();if(a in t)return e.value=a,e.done=!1,e}return e.done=!0,e}},t.values=D,V.prototype={constructor:V,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(B),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(a,n){return u.type="throw",u.arg=t,r.next=a,n&&(r.method="next",r.arg=e),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i],u=s.completion;if("root"===s.tryLoc)return n("end");if(s.tryLoc<=this.prev){var o=a.call(s,"catchLoc"),l=a.call(s,"finallyLoc");if(o&&l){if(this.prev<s.catchLoc)return n(s.catchLoc,!0);if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else if(o){if(this.prev<s.catchLoc)return n(s.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return n(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),B(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var a=r.completion;if("throw"===a.type){var n=a.arg;B(r)}return n}}throw Error("illegal catch attempt")},delegateYield:function(t,r,a){return this.delegate={iterator:D(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=e),d}},t}function w(e,t){return w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},w(e,t)}function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,u=[],o=!0,l=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;o=!1}else for(;!(o=(a=i.call(r)).done)&&(u.push(a.value),u.length!==t);o=!0);}catch(e){l=!0,n=e}finally{try{if(!o&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(l)throw n}}return u}}(e,t)||E(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}function A(e,t,r,a){var n=h(f(1&a?e.prototype:e),t,r);return 2&a?function(e){return n.apply(r,e)}:n}function N(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||E(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function x(e){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},x(e)}function E(e,r){if(e){if("string"==typeof e)return t(e,r);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?t(e,r):void 0}}function I(e){var t="function"==typeof Map?new Map:void 0;return I=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return s(e,arguments,f(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),w(r,e)},I(e)}var B=["name","optional","primitiveSchema"],V=["value"],D=["isHexOnly"],P=["value","isIndefiniteForm"],O=["value"],R=["isConstructed"],U=["idBlock","lenBlock"],L=["unusedBits","isConstructed"],T=["idBlock","lenBlock"],H=["value"],M=["valueDec","isFirstSid"],K=["value"],_=["valueDec"],j=["value"],J=["value","valueDate"],F=["value"],q=["value","local"],X="element",G="attribute",W="content",z=1e9;function Y(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];for(var n=arguments[0],i=1;i<arguments.length;i++){var s=arguments[i];for(var u in s)s.hasOwnProperty(u)&&(n[u]=s[u])}return n}function Q(e){return function(t){var r=t;r.localName=e.localName||r.name,r.namespaceURI=e.namespaceURI||r.namespaceURI||null,r.prefix=e.prefix||r.prefix||null,r.parser=e.parser||r.parser,r.target!==r&&(r.items=Y({},r.items)),r.target=t}}function Z(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,r){var a=t.constructor,n=r;a.items||(a.items={}),a.target!==a&&(a.items=Y({},a.items)),a.target=t,e.parser?a.items[n]={parser:e.parser,required:e.required||!1,maxOccurs:e.maxOccurs||z,minOccurs:void 0===e.minOccurs?0:e.minOccurs,noRoot:e.noRoot||!1}:a.items[n]={namespaceURI:e.namespaceURI||null,required:e.required||!1,prefix:e.prefix||null,defaultValue:e.defaultValue,converter:e.converter,noRoot:e.noRoot||!1},e.localName=e.localName||e.parser&&e.parser.localName||n,a.items[n].namespaceURI=e.namespaceURI||e.parser&&e.parser.namespaceURI||null,a.items[n].prefix=e.prefix||e.parser&&e.parser.prefix||null,a.items[n].localName=e.localName,a.items[n].type=X,ee(t,n,e)}}function $(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{required:!1,namespaceURI:null};return function(t,r){var a=t.constructor,n=r;e.localName||(e.localName=r),a.items||(a.items={}),a.target!==a&&(a.items=Y({},a.items)),a.target=t,a.items[r]=e,a.items[r].type=G,ee(t,n,e)}}function ee(e,t,r){var a="_".concat(t),n={set:function(e){this[a]!==e&&(this.element=null,this[a]=e)},get:function(){if(void 0===this[a]){var e=r.defaultValue;r.parser&&((e=new r.parser).localName=r.localName),this[a]=e}return this[a]}};Object.defineProperty(e,a,{writable:!0,enumerable:!1}),Object.defineProperty(e,t,n)}var te=function(){function e(t){i(this,e),this.items=new Array,t&&(this.items=t)}return o(e,[{key:"Count",get:function(){return this.items.length}},{key:"Item",value:function(e){return this.items[e]||null}},{key:"Add",value:function(e){this.items.push(e)}},{key:"Pop",value:function(){return this.items.pop()}},{key:"RemoveAt",value:function(e){this.items=this.items.filter((function(t,r){return r!==e}))}},{key:"Clear",value:function(){this.items=new Array}},{key:"GetIterator",value:function(){return this.items}},{key:"ForEach",value:function(e){this.GetIterator().forEach(e)}},{key:"Map",value:function(t){return new e(this.GetIterator().map(t))}},{key:"Filter",value:function(t){return new e(this.GetIterator().filter(t))}},{key:"Sort",value:function(t){return new e(this.GetIterator().sort(t))}},{key:"Every",value:function(e){return this.GetIterator().every(e)}},{key:"Some",value:function(e){return this.GetIterator().some(e)}},{key:"IsEmpty",value:function(){return 0===this.Count}}])}();function re(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];for(var n=e,i=/[^%](%\d+)/g,s=null,u=[];s=i.exec(n);)u.push({arg:s[1],index:s.index});for(var o=u.length-1;o>=0;o--){var l=u[o],c=l.arg.substring(1),h=l.index+1;n=n.substring(0,h)+arguments[+c]+n.substring(h+1+c.length)}return n=n.replace("%%","%")}function ae(e,t){for(var r=e+"";r.length<t;)r="0"+r;return r}var ne,ie=o((function e(t){for(var r=arguments.length,a=new Array(r>1?r-1:0),n=1;n<r;n++)a[n-1]=arguments[n];i(this,e),this.prefix="XMLJS",this.code=t,this.name=this.constructor.name,arguments[0]=se[t];var s=re.apply(this,arguments);this.message="".concat(this.prefix).concat(ae(t,4),": ").concat(s),this.stack=new Error(this.message).stack}));!function(e){e[e.NONE=0]="NONE",e[e.NULL_REFERENCE=1]="NULL_REFERENCE",e[e.NULL_PARAM=2]="NULL_PARAM",e[e.DECORATOR_NULL_PARAM=3]="DECORATOR_NULL_PARAM",e[e.COLLECTION_LIMIT=4]="COLLECTION_LIMIT",e[e.METHOD_NOT_IMPLEMENTED=5]="METHOD_NOT_IMPLEMENTED",e[e.METHOD_NOT_SUPPORTED=6]="METHOD_NOT_SUPPORTED",e[e.PARAM_REQUIRED=7]="PARAM_REQUIRED",e[e.CONVERTER_UNSUPPORTED=8]="CONVERTER_UNSUPPORTED",e[e.ELEMENT_MALFORMED=9]="ELEMENT_MALFORMED",e[e.ELEMENT_MISSING=10]="ELEMENT_MISSING",e[e.ATTRIBUTE_MISSING=11]="ATTRIBUTE_MISSING",e[e.CONTENT_MISSING=12]="CONTENT_MISSING",e[e.CRYPTOGRAPHIC=13]="CRYPTOGRAPHIC",e[e.CRYPTOGRAPHIC_NO_MODULE=14]="CRYPTOGRAPHIC_NO_MODULE",e[e.CRYPTOGRAPHIC_UNKNOWN_TRANSFORM=15]="CRYPTOGRAPHIC_UNKNOWN_TRANSFORM",e[e.ALGORITHM_NOT_SUPPORTED=16]="ALGORITHM_NOT_SUPPORTED",e[e.ALGORITHM_WRONG_NAME=17]="ALGORITHM_WRONG_NAME",e[e.XML_EXCEPTION=18]="XML_EXCEPTION"}(ne||(ne={}));var se={};se[ne.NONE]="No description",se[ne.NULL_REFERENCE]="Null reference",se[ne.NULL_PARAM]="'%1' has empty '%2' object",se[ne.DECORATOR_NULL_PARAM]="Decorator '%1' has empty '%2' parameter",se[ne.COLLECTION_LIMIT]="Collection of '%1' in element '%2' has wrong amount of items",se[ne.METHOD_NOT_IMPLEMENTED]="Method is not implemented",se[ne.METHOD_NOT_SUPPORTED]="Method is not supported",se[ne.PARAM_REQUIRED]="Required parameter is missing '%1'",se[ne.CONVERTER_UNSUPPORTED]="Converter is not supported",se[ne.ELEMENT_MALFORMED]="Malformed element '%1'",se[ne.ELEMENT_MISSING]="Element '%1' is missing in '%2'",se[ne.ATTRIBUTE_MISSING]="Attribute '%1' is missing in '%2'",se[ne.CONTENT_MISSING]="Content is missing in '%1'",se[ne.CRYPTOGRAPHIC]="Cryptographic error: %1",se[ne.CRYPTOGRAPHIC_NO_MODULE]="WebCrypto module is not found",se[ne.CRYPTOGRAPHIC_UNKNOWN_TRANSFORM]="Unknown transform %1",se[ne.ALGORITHM_NOT_SUPPORTED]="Algorithm is not supported '%1'",se[ne.ALGORITHM_WRONG_NAME]="Algorithm wrong name in use '%1'",se[ne.XML_EXCEPTION]="XML exception: %1";var ue,oe=o((function e(){i(this,e)}),null,[{key:"ToString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",r=new Uint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);default:throw new ie(ne.CONVERTER_UNSUPPORTED)}}},{key:"FromString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);default:throw new ie(ne.CONVERTER_UNSUPPORTED)}}},{key:"ToBase64",value:function(e){if("undefined"!=typeof btoa){var t=this.ToString(e,"binary");return btoa(t)}if("undefined"!=typeof Buffer)return Buffer.from(e).toString("base64");throw new ie(ne.CONVERTER_UNSUPPORTED)}},{key:"FromBase64",value:function(e){if(e=e.replace(/\n/g,"").replace(/\r/g,"").replace(/\t/g,"").replace(/\s/g,""),"undefined"!=typeof atob)return this.FromBinary(atob(e));if("undefined"!=typeof Buffer)return new Uint8Array(Buffer.from(e,"base64"));throw new ie(ne.CONVERTER_UNSUPPORTED)}},{key:"FromBase64Url",value:function(e){return this.FromBase64(this.Base64Padding(e.replace(/\-/g,"+").replace(/\_/g,"/")))}},{key:"ToBase64Url",value:function(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}},{key:"FromUtf8String",value:function(e){for(var t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length),a=0;a<t.length;a++)r[a]=t.charCodeAt(a);return r}},{key:"ToUtf8String",value:function(e){var t=String.fromCharCode.apply(null,e);return decodeURIComponent(escape(t))}},{key:"FromBinary",value:function(e){for(var t=e.length,r=new Uint8Array(t),a=0;a<t;a++)r[a]=e.charCodeAt(a);return r}},{key:"ToBinary",value:function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}},{key:"ToHex",value:function(e){for(var t=[],r=0;r<e.length;r++){var a=e[r].toString(16);t.push(1===a.length?"0"+a:a)}return t.join("")}},{key:"FromHex",value:function(e){for(var t=new Uint8Array(e.length/2),r=0;r<e.length;r+=2){var a=e.slice(r,r+2);t[r/2]=parseInt(a,16)}return t}},{key:"ToDateTime",value:function(e){return new Date(e)}},{key:"FromDateTime",value:function(e){return e.toISOString()}},{key:"Base64Padding",value:function(e){var t=4-e.length%4;if(t<4)for(var r=0;r<t;r++)e+="=";return e}}]),le="application/xml";!function(e){e[e.None=0]="None",e[e.Element=1]="Element",e[e.Attribute=2]="Attribute",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.EntityReference=5]="EntityReference",e[e.Entity=6]="Entity",e[e.ProcessingInstruction=7]="ProcessingInstruction",e[e.Comment=8]="Comment",e[e.Document=9]="Document",e[e.DocumentType=10]="DocumentType",e[e.DocumentFragment=11]="DocumentFragment",e[e.Notation=12]="Notation",e[e.Whitespace=13]="Whitespace",e[e.SignificantWhitespace=14]="SignificantWhitespace",e[e.EndElement=15]="EndElement",e[e.EndEntity=16]="EndEntity",e[e.XmlDeclaration=17]="XmlDeclaration"}(ue||(ue={}));var ce,he=function(e,t){throw new Error("Not implemented")};if("undefined"==typeof self){ce=global;var fe=require("@xmldom/xmldom");he=require("xpath.js"),ce.XMLSerializer=fe.XMLSerializer,ce.DOMParser=fe.DOMParser,ce.DOMImplementation=fe.DOMImplementation,ce.document=(new DOMImplementation).createDocument("http://www.w3.org/1999/xhtml","html",null)}else ce=self;var me="undefined"!=typeof self?function(e,t){for(var r,a=null==e.ownerDocument?e:e.ownerDocument,n=document.createNSResolver(null==e.ownerDocument?e.documentElement:e.ownerDocument.documentElement),i=a.evaluate(t,e,n,XPathResult.ANY_TYPE,null),s=[];r=i.iterateNext();)s.push(r);return s}:he;function ve(e){return e=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n"),(new DOMParser).parseFromString(e,le)}function de(e,t){var r=me(e,t);return r&&r.length>0?r[0]:null}function ge(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(we(e)){e.namespaceURI&&"http://www.w3.org/XML/1998/namespace"!==e.namespaceURI&&!t[e.prefix||""]&&(t[e.prefix?e.prefix:""]=e.namespaceURI);for(var r=0;r<e.childNodes.length;r++){var a=e.childNodes.item(r);a&&a.nodeType===ue.Element&&ge(a,t)}}}function pe(e){var t={};return ge(e,t),t}function ye(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];for(var n=arguments[0],i=1;i<arguments.length;i++){var s=arguments[i];for(var u in s)s.hasOwnProperty(u)&&(n[u]=s[u])}return n}function ke(e,t){return e&&e.nodeType===t}function we(e){return ke(e,ue.Element)}function be(e){return ke(e,ue.Document)}var Se={get:function(e){if(e)return oe.ToBase64(e)},set:function(e){return oe.FromBase64(e)}},Ae={get:function(e){return e?e.toString():"0"},set:function(e){return Number(e)}},Ne="xml_root",Ce=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(i(this,e),this.prefix=this.GetStatic().prefix||null,this.localName=this.GetStatic().localName,this.namespaceURI=this.GetStatic().namespaceURI,t)for(var r=0,a=Object.entries(t);r<a.length;r++){var n=b(a[r],2),s=n[0],u=n[1];void 0!==u&&(this[s]=u)}}return o(e,[{key:"Element",get:function(){return this.element}},{key:"Prefix",get:function(){return this.prefix},set:function(e){this.prefix=e}},{key:"LocalName",get:function(){return this.localName}},{key:"NamespaceURI",get:function(){return this.namespaceURI||null}},{key:"HasChanged",value:function(){var e=this.GetStatic();if(e.items)for(var t in e.items)if(e.items.hasOwnProperty(t)){var r=e.items[t],a=this[t];if(r.parser&&a&&a.HasChanged())return!0}return null===this.element}},{key:"GetXml",value:function(t){if(!t&&!this.HasChanged())return this.element||null;var r=this.CreateDocument(),a=this.CreateElement(),n=this.GetStatic(),i=this.localName;if(n.items)for(var s in n.items)if(n.items.hasOwnProperty(s)){var u=this[s],o=n.items[s];switch(o.type){case W:var c=o,h=c.converter?c.converter.get(u):u;if(c.required&&null==h)throw new ie(ne.CONTENT_MISSING,i);(c.defaultValue!==u||c.required)&&(a.textContent=h);break;case G:var f=o,m=f.converter?f.converter.get(u):u;if(f.required&&null==m)throw new ie(ne.ATTRIBUTE_MISSING,f.localName,i);(f.defaultValue!==u||f.required)&&(f.namespaceURI?a.setAttributeNS(f.namespaceURI,f.localName,m):a.setAttribute(f.localName,m));break;case X:var v=o,d=null;if(v.parser){if(v.required&&!u||v.minOccurs&&!u.Count)throw new ie(ne.ELEMENT_MISSING,u.localName,i);u&&(d=u.GetXml(void 0===u.element&&(v.required||u.Count)))}else{var g=v.converter?v.converter.get(u):u;if(v.required&&void 0===g)throw new ie(ne.ELEMENT_MISSING,v.localName,i);if(u!==v.defaultValue||v.required)if(d=v.namespaceURI?r.createElementNS(v.namespaceURI,"".concat(v.prefix?v.prefix+":":"").concat(v.localName)):r.createElement("".concat(v.prefix?v.prefix+":":"").concat(v.localName)),Array.isArray(g)){var p,y=l(g);try{for(y.s();!(p=y.n()).done;){var k=p.value,w=k instanceof e?k.GetXml(!0):k;null!==w&&d.appendChild(w)}}catch(e){y.e(e)}finally{y.f()}}else g instanceof e?d.appendChild(g.GetXml(!0)):d.textContent=g}if(d)if(v.noRoot){for(var b=[],S=0;S<d.childNodes.length;S++){var A=d.childNodes.item(S);we(A)&&b.push(A)}if(b.length<v.minOccurs||b.length>v.maxOccurs)throw new ie(ne.COLLECTION_LIMIT,u.localName,n.localName);b.forEach((function(e){return a.appendChild(e.cloneNode(!0))}))}else{if(d.childNodes.length<v.minOccurs||d.childNodes.length>v.maxOccurs)throw new ie(ne.COLLECTION_LIMIT,u.localName,n.localName);a.appendChild(d)}}}return this.OnGetXml(a),this.element=a,a}},{key:"LoadXml",value:function(e){var t,r=this;"string"==typeof e?t=ve(e).documentElement:t=e;if(!t)throw new ie(ne.PARAM_REQUIRED,"element");var a=this.GetStatic(),n=this.localName;if(t.localName!==n||t.namespaceURI!=this.NamespaceURI)throw new ie(ne.ELEMENT_MALFORMED,n);if(a.items)for(var i in a.items)if(a.items.hasOwnProperty(i)){var s=a.items[i];switch(s.type){case W:var u=s;if(u.required&&!t.textContent)throw new ie(ne.CONTENT_MISSING,n);if(t.textContent){var o=u.converter?u.converter.set(t.textContent):t.textContent;r[i]=o}else r[i]=u.defaultValue;break;case G:var l=s,c=void 0,h=void 0;if(!l.localName)throw new ie(ne.PARAM_REQUIRED,"localName");if(l.namespaceURI?(c=t.hasAttributeNS.bind(t,l.namespaceURI,l.localName),h=t.getAttributeNS.bind(t,l.namespaceURI,l.localName)):(c=t.hasAttribute.bind(t,l.localName),h=t.getAttribute.bind(t,l.localName)),l.required&&!c())throw new ie(ne.ATTRIBUTE_MISSING,l.localName,n);if(c()){var f=l.converter?l.converter.set(h()):h();r[i]=f}else r[i]=l.defaultValue;break;case X:var m=s;if(m.noRoot){if(!m.parser)throw new ie(ne.XML_EXCEPTION,"Schema for '".concat(m.localName,"' with flag noRoot must have 'parser'"));var v=new m.parser;if(!(v instanceof xe))throw new ie(ne.XML_EXCEPTION,"Schema for '".concat(m.localName,"' with flag noRoot must have 'parser' like instance of XmlCollection"));if(v.OnLoadXml(t),delete v.element,v.Count<m.minOccurs||v.Count>m.maxOccurs)throw new ie(ne.COLLECTION_LIMIT,m.parser.localName,n);r[i]=v;continue}for(var d=null,g=0;g<t.childNodes.length;g++){var p=t.childNodes.item(g);if(we(p)){var y=p;if(y.localName===m.localName&&y.namespaceURI==m.namespaceURI){d=y;break}}}if(m.required&&!d)throw new ie(ne.ELEMENT_MISSING,m.parser?m.parser.localName:m.localName,n);if(m.parser){if(d){var k=new m.parser;k.localName=m.localName,k.namespaceURI=m.namespaceURI,r[i]=k,k.LoadXml(d)}}else if(d){var w=m.converter?m.converter.set(d.textContent):d.textContent;r[i]=w}else r[i]=m.defaultValue}}this.OnLoadXml(t),this.prefix=t.prefix||"",this.element=t}},{key:"toString",value:function(){var e=this.GetXml();return e?(new XMLSerializer).serializeToString(e):""}},{key:"GetElement",value:function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.element)throw new ie(ne.NULL_PARAM,this.localName);return e.GetElement(this.element,t,r)}},{key:"GetChildren",value:function(t,r){if(!this.element)throw new ie(ne.NULL_PARAM,this.localName);return e.GetChildren(this.element,t,r||this.NamespaceURI||void 0)}},{key:"GetChild",value:function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.element)throw new ie(ne.NULL_PARAM,this.localName);return e.GetChild(this.element,t,this.NamespaceURI||void 0,r)}},{key:"GetFirstChild",value:function(t,r){if(!this.element)throw new ie(ne.NULL_PARAM,this.localName);return e.GetFirstChild(this.element,t,r)}},{key:"GetAttribute",value:function(t,r){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this.element)throw new ie(ne.NULL_PARAM,this.localName);return e.GetAttribute(this.element,t,r,a)}},{key:"IsEmpty",value:function(){return void 0===this.Element}},{key:"OnLoadXml",value:function(e){}},{key:"GetStatic",value:function(){return this.constructor}},{key:"GetPrefix",value:function(){return this.Prefix?this.prefix+":":""}},{key:"OnGetXml",value:function(e){}},{key:"CreateElement",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;e||(e=this.CreateDocument()),t=t||this.localName,r=r||this.NamespaceURI;var n=((a=a||this.prefix)?"".concat(a,":"):"")+t,i=r?e.createElementNS(r,n):e.createElement(n);return e.importNode(i,!0),i}},{key:"CreateDocument",value:function(){return e.CreateDocument(this.localName,this.NamespaceURI,this.Prefix)}}],[{key:"LoadXml",value:function(e){var t=new this;return t.LoadXml(e),t}},{key:"GetElement",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=e.getElementsByTagName(t);if(r&&0===a.length)throw new ie(ne.ELEMENT_MISSING,t,e.localName);return a[0]||null}},{key:"GetAttribute",value:function(e,t,r){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e.hasAttribute(t))return e.getAttribute(t);if(a)throw new ie(ne.ATTRIBUTE_MISSING,t,e.localName);return r}},{key:"GetElementById",value:function(e,t){if(null==e||null==t)return null;var r=null;return be(e)&&(r=e.getElementById(t)),null==r&&null==(r=de(e,"//*[@*[local-name()='Id']='".concat(t,"']")))&&null==(r=de(e,"//*[@*[local-name()='ID']='".concat(t,"']")))&&(r=de(e,"//*[@*[local-name()='id']='".concat(t,"']"))),r}},{key:"CreateDocument",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ne,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a="",n="",i="";r&&(a=r+":",n=":"+r),t&&(i=" xmlns".concat(n,'="').concat(t,'"'));var s="".concat(a).concat(e),u=(new DOMParser).parseFromString("<".concat(s).concat(i,"></").concat(s,">"),le);return u}},{key:"GetChildren",value:function(e,t,r){e=be(e)?e.documentElement:e;for(var a=[],n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];!we(i)||i.localName!==t||i.namespaceURI!==r&&r||a.push(i)}return a}},{key:"GetFirstChild",value:function(e,t,r){e=be(e)?e.documentElement:e;for(var a=0;a<e.childNodes.length;a++){var n=e.childNodes[a];if(we(n)&&n.localName===t&&(n.namespaceURI===r||!r))return n}return null}},{key:"GetChild",value:function(e,t,r){for(var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];if(we(i)&&i.localName===t&&(i.namespaceURI===r||!r))return i}if(a)throw new ie(ne.ELEMENT_MISSING,t,e.localName);return null}}])}(),xe=function(e){function t(){var e;return i(this,t),(e=n(this,t,arguments)).MaxOccurs=Number.MAX_VALUE,e.MinOccurs=0,e.items=[],e}return m(t,e),o(t,[{key:"HasChanged",value:function(){var e=A(t,"HasChanged",this,3)([]),r=this.Some((function(e){return e.HasChanged()}));return e||r}},{key:"Count",get:function(){return this.items.length}},{key:"Item",value:function(e){return this.items[e]||null}},{key:"Add",value:function(e){this.items.push(e),this.element=null}},{key:"Pop",value:function(){return this.element=null,this.items.pop()}},{key:"RemoveAt",value:function(e){this.items=this.items.filter((function(t,r){return r!==e})),this.element=null}},{key:"Clear",value:function(){this.items=new Array,this.element=null}},{key:"GetIterator",value:function(){return this.items}},{key:"ForEach",value:function(e){this.GetIterator().forEach(e)}},{key:"Map",value:function(e){return new te(this.GetIterator().map(e))}},{key:"Filter",value:function(e){return new te(this.GetIterator().filter(e))}},{key:"Sort",value:function(e){return new te(this.GetIterator().sort(e))}},{key:"Every",value:function(e){return this.GetIterator().every(e)}},{key:"Some",value:function(e){return this.GetIterator().some(e)}},{key:"IsEmpty",value:function(){return 0===this.Count}},{key:"OnGetXml",value:function(e){var t,r=l(this.GetIterator());try{for(r.s();!(t=r.n()).done;){var a=t.value.GetXml();a&&e.appendChild(a)}}catch(e){r.e(e)}finally{r.f()}}},{key:"OnLoadXml",value:function(e){var t=this.GetStatic();if(!t.parser)throw new ie(ne.XML_EXCEPTION,"".concat(t.localName," doesn't have required 'parser' in @XmlElement"));for(var r=0;r<e.childNodes.length;r++){var a=e.childNodes.item(r);if(we(a)&&a.localName===t.parser.localName&&a.namespaceURI==t.namespaceURI){var n=a,i=new t.parser;i.LoadXml(n),this.Add(i)}}}}])}(Ce),Ee=function(e){function t(){return i(this,t),n(this,t,arguments)}return m(t,e),o(t,[{key:"Add",value:function(e){e.prefix=e.prefix||"",e.namespace=e.namespace||"",A(t,"Add",this,3)([e])}},{key:"GetPrefix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.Count-1,r=this.Count-1;e=e||"",t>r&&(t=r);for(var a=t;a>=0;a--){var n=this.items[a];if(n.prefix===e)return n}return null}},{key:"GetNamespace",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.Count-1,r=this.Count-1;e=e||"",t>r&&(t=r);for(var a=t;a>=0;a--){var n=this.items[a];if(n.namespace===e)return n}return null}}])}(te),Ie=function(){function e(){i(this,e)}return o(e,null,[{key:"isArrayBuffer",value:function(e){return"[object ArrayBuffer]"===Object.prototype.toString.call(e)}},{key:"toArrayBuffer",value:function(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}},{key:"toUint8Array",value:function(e){return this.toView(e,Uint8Array)}},{key:"toView",value:function(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}},{key:"isBufferSource",value:function(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}},{key:"isArrayBufferView",value:function(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}},{key:"isEqual",value:function(t,r){var a=e.toUint8Array(t),n=e.toUint8Array(r);if(a.length!==n.byteLength)return!1;for(var i=0;i<a.length;i++)if(a[i]!==n[i])return!1;return!0}},{key:"concat",value:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];var n,i=0,s=l(e=!Array.isArray(r[0])||r[1]instanceof Function?Array.isArray(r[0])&&r[1]instanceof Function?r[0]:r[r.length-1]instanceof Function?r.slice(0,r.length-1):r:r[0]);try{for(s.s();!(n=s.n()).done;){var u=n.value;i+=u.byteLength}}catch(e){s.e(e)}finally{s.f()}var o,c=new Uint8Array(i),h=0,f=l(e);try{for(f.s();!(o=f.n()).done;){var m=o.value,v=this.toUint8Array(m);c.set(v,h),h+=v.length}}catch(e){f.e(e)}finally{f.f()}return r[r.length-1]instanceof Function?this.toView(c,r[r.length-1]):c.buffer}}])}(),Be="string",Ve=/^[0-9a-f]+$/i,De=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,Pe=/^[a-zA-Z0-9-_]+$/,Oe=o((function e(){i(this,e)}),null,[{key:"fromString",value:function(e){for(var t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length),a=0;a<t.length;a++)r[a]=t.charCodeAt(a);return r.buffer}},{key:"toString",value:function(e){for(var t=Ie.toUint8Array(e),r="",a=0;a<t.length;a++)r+=String.fromCharCode(t[a]);return decodeURIComponent(escape(r))}}]),Re=o((function e(){i(this,e)}),null,[{key:"toString",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Ie.toArrayBuffer(e),a=new DataView(r),n="",i=0;i<r.byteLength;i+=2){var s=a.getUint16(i,t);n+=String.fromCharCode(s)}return n}},{key:"fromString",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=new ArrayBuffer(2*e.length),a=new DataView(r),n=0;n<e.length;n++)a.setUint16(2*n,e.charCodeAt(n),t);return r}}]),Ue=function(){function e(){i(this,e)}return o(e,null,[{key:"isHex",value:function(e){return x(e)===Be&&Ve.test(e)}},{key:"isBase64",value:function(e){return x(e)===Be&&De.test(e)}},{key:"isBase64Url",value:function(e){return x(e)===Be&&Pe.test(e)}},{key:"ToString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",r=Ie.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);case"utf16le":return Re.toString(r,!0);case"utf16":case"utf16be":return Re.toString(r);default:throw new Error("Unknown type of encoding '".concat(t,"'"))}}},{key:"FromString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return Re.fromString(e,!0);case"utf16":case"utf16be":return Re.fromString(e);default:throw new Error("Unknown type of encoding '".concat(t,"'"))}}},{key:"ToBase64",value:function(e){var t=Ie.toUint8Array(e);if("undefined"!=typeof btoa){var r=this.ToString(t,"binary");return btoa(r)}return Buffer.from(t).toString("base64")}},{key:"FromBase64",value:function(t){var r=this.formatString(t);if(!r)return new ArrayBuffer(0);if(!e.isBase64(r))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return"undefined"!=typeof atob?this.FromBinary(atob(r)):new Uint8Array(Buffer.from(r,"base64")).buffer}},{key:"FromBase64Url",value:function(t){var r=this.formatString(t);if(!r)return new ArrayBuffer(0);if(!e.isBase64Url(r))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(r.replace(/\-/g,"+").replace(/\_/g,"/")))}},{key:"ToBase64Url",value:function(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}},{key:"FromUtf8String",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.DEFAULT_UTF8_ENCODING;switch(r){case"ascii":return this.FromBinary(t);case"utf8":return Oe.fromString(t);case"utf16":case"utf16be":return Re.fromString(t);case"utf16le":case"usc2":return Re.fromString(t,!0);default:throw new Error("Unknown type of encoding '".concat(r,"'"))}}},{key:"ToUtf8String",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.DEFAULT_UTF8_ENCODING;switch(r){case"ascii":return this.ToBinary(t);case"utf8":return Oe.toString(t);case"utf16":case"utf16be":return Re.toString(t);case"utf16le":case"usc2":return Re.toString(t,!0);default:throw new Error("Unknown type of encoding '".concat(r,"'"))}}},{key:"FromBinary",value:function(e){for(var t=e.length,r=new Uint8Array(t),a=0;a<t;a++)r[a]=e.charCodeAt(a);return r.buffer}},{key:"ToBinary",value:function(e){for(var t=Ie.toUint8Array(e),r="",a=0;a<t.length;a++)r+=String.fromCharCode(t[a]);return r}},{key:"ToHex",value:function(e){for(var t=Ie.toUint8Array(e),r="",a=t.length,n=0;n<a;n++){var i=t[n];i<16&&(r+="0"),r+=i.toString(16)}return r}},{key:"FromHex",value:function(t){var r=this.formatString(t);if(!r)return new ArrayBuffer(0);if(!e.isHex(r))throw new TypeError("Argument 'hexString' is not HEX encoded");r.length%2&&(r="0".concat(r));for(var a=new Uint8Array(r.length/2),n=0;n<r.length;n+=2){var i=r.slice(n,n+2);a[n/2]=parseInt(i,16)}return a.buffer}},{key:"ToUtf16String",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Re.toString(e,t)}},{key:"FromUtf16String",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Re.fromString(e,t)}},{key:"Base64Padding",value:function(e){var t=4-e.length%4;if(t<4)for(var r=0;r<t;r++)e+="=";return e}},{key:"formatString",value:function(e){return(null==e?void 0:e.replace(/[\n\r\t ]/g,""))||""}}])}();function Le(e,t,r){var a;return e instanceof Object==!1?r:null!==(a=e[t])&&void 0!==a?a:r}function Te(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.byteLength-r,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i="",s=l(new Uint8Array(e,r,a));try{for(s.s();!(t=s.n()).done;){var u=t.value,o=u.toString(16).toUpperCase();1===o.length&&(i+="0"),i+=o,n&&(i+=" ")}}catch(e){s.e(e)}finally{s.f()}return i.trim()}function He(e,t){var r=0;if(1===e.length)return e[0];for(var a=e.length-1;a>=0;a--)r+=e[e.length-1-a]*Math.pow(2,t*a);return r}function Me(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,a=r,n=e,i=0,s=Math.pow(2,t),u=1;u<8;u++){if(e<s){var o=void 0;if(a<0)o=new ArrayBuffer(u),i=u;else{if(a<u)return new ArrayBuffer(0);o=new ArrayBuffer(a),i=a}for(var l=new Uint8Array(o),c=u-1;c>=0;c--){var h=Math.pow(2,c*t);l[i-c-1]=Math.floor(n/h),n-=l[i-c-1]*h}return o}s*=Math.pow(2,t)}return new ArrayBuffer(0)}function Ke(){for(var e=0,t=0,r=arguments.length,a=new Array(r),n=0;n<r;n++)a[n]=arguments[n];for(var i=0,s=a;i<s.length;i++){var u=s[i];e+=u.byteLength}for(var o=new ArrayBuffer(e),l=new Uint8Array(o),c=0,h=a;c<h.length;c++){var f=h[c];l.set(new Uint8Array(f),t),t+=f.byteLength}return o}function _e(){for(var e=0,t=0,r=arguments.length,a=new Array(r),n=0;n<r;n++)a[n]=arguments[n];for(var i=0,s=a;i<s.length;i++){var u=s[i];e+=u.length}for(var o=new ArrayBuffer(e),l=new Uint8Array(o),c=0,h=a;c<h.length;c++){var f=h[c];l.set(f,t),t+=f.length}return l}function je(){var e=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){var t=255===e[0]&&128&e[1],r=0===e[0]&&0==(128&e[1]);(t||r)&&this.warnings.push("Needlessly long format")}for(var a=new ArrayBuffer(this.valueHex.byteLength),n=new Uint8Array(a),i=0;i<this.valueHex.byteLength;i++)n[i]=0;n[0]=128&e[0];for(var s=He(n,8),u=new ArrayBuffer(this.valueHex.byteLength),o=new Uint8Array(u),l=0;l<this.valueHex.byteLength;l++)o[l]=e[l];return o[0]&=127,He(o,8)-s}function Je(e,t){if(e.byteLength!==t.byteLength)return!1;for(var r=new Uint8Array(e),a=new Uint8Array(t),n=0;n<r.length;n++)if(r[n]!==a[n])return!1;return!0}function Fe(e,t){var r=e.toString(10);if(t<r.length)return"";for(var a=t-r.length,n=new Array(a),i=0;i<a;i++)n[i]="0";return n.join("").concat(r)}Ue.DEFAULT_UTF8_ENCODING="utf8";var qe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Xe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";function Ge(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=0,i=0,s=0,u="",o=t?Xe:qe;if(a){for(var l=0,c=0;c<e.length;c++)if(0!==e.charCodeAt(c)){l=c;break}e=e.slice(l)}for(;n<e.length;){var h=e.charCodeAt(n++);n>=e.length&&(i=1);var f=e.charCodeAt(n++);n>=e.length&&(s=1);var m=e.charCodeAt(n++),v=h>>2,d=(3&h)<<4|f>>4,g=(15&f)<<2|m>>6,p=63&m;1===i?g=p=64:1===s&&(p=64),u+=r?64===g?"".concat(o.charAt(v)).concat(o.charAt(d)):64===p?"".concat(o.charAt(v)).concat(o.charAt(d)).concat(o.charAt(g)):"".concat(o.charAt(v)).concat(o.charAt(d)).concat(o.charAt(g)).concat(o.charAt(p)):"".concat(o.charAt(v)).concat(o.charAt(d)).concat(o.charAt(g)).concat(o.charAt(p))}return u}function We(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=t?Xe:qe;function n(e){for(var t=0;t<64;t++)if(a.charAt(t)===e)return t;return 64}function i(e){return 64===e?0:e}for(var s=0,u="";s<e.length;){var o=n(e.charAt(s++)),l=s>=e.length?0:n(e.charAt(s++)),c=s>=e.length?0:n(e.charAt(s++)),h=s>=e.length?0:n(e.charAt(s++)),f=i(o)<<2|i(l)>>4,m=(15&i(l))<<4|i(c)>>2,v=(3&i(c))<<6|i(h);u+=String.fromCharCode(f),64!==c&&(u+=String.fromCharCode(m)),64!==h&&(u+=String.fromCharCode(v))}if(r){for(var d=u.length,g=-1,p=d-1;p>=0;p--)if(0!==u.charCodeAt(p)){g=p;break}u=-1!==g?u.slice(0,g+1):""}return u}function ze(e){var t,r="",a=l(new Uint8Array(e));try{for(a.s();!(t=a.n()).done;){var n=t.value;r+=String.fromCharCode(n)}}catch(e){a.e(e)}finally{a.f()}return r}function Ye(e){for(var t=e.length,r=new ArrayBuffer(t),a=new Uint8Array(r),n=0;n<t;n++)a[n]=e.charCodeAt(n);return r}var Qe=Math.log(2);function Ze(e,t){var r,a=l(t);try{for(a.s();!(r=a.n()).done;){delete e[r.value]}}catch(e){a.e(e)}finally{a.f()}}function $e(){if("undefined"==typeof BigInt)throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function et(e){for(var t=0,r=0,a=0;a<e.length;a++){t+=e[a].byteLength}for(var n=new Uint8Array(t),i=0;i<e.length;i++){var s=e[i];n.set(new Uint8Array(s),r),r+=s.byteLength}return n.buffer}function tt(e,t,r,a){return t instanceof Uint8Array?t.byteLength?r<0?(e.error="Wrong parameter: inputOffset less than zero",!1):a<0?(e.error="Wrong parameter: inputLength less than zero",!1):!(t.byteLength-r-a<0)||(e.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):(e.error="Wrong parameter: inputBuffer has zero length",!1):(e.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}var rt=o((function e(){i(this,e),this.items=[]}),[{key:"write",value:function(e){this.items.push(e)}},{key:"final",value:function(){return et(this.items)}}]),at=[new Uint8Array([1])],nt="0123456789",it="name",st="valueHexView",ut="",ot=new ArrayBuffer(0),lt=new Uint8Array(0),ct="EndOfContent",ht="OCTET STRING",ft="BIT STRING";function mt(e){var t;return t=function(e){function t(){var e,r;i(this,t);for(var a=arguments.length,s=new Array(a),u=0;u<a;u++)s[u]=arguments[u];e=n(this,t,[].concat(s));var o=s[0]||{};return e.isHexOnly=null!==(r=o.isHexOnly)&&void 0!==r&&r,e.valueHexView=o.valueHex?Ie.toUint8Array(o.valueHex):lt,e}return m(t,e),o(t,[{key:"valueHex",get:function(){return this.valueHexView.slice().buffer},set:function(e){this.valueHexView=new Uint8Array(e)}},{key:"fromBER",value:function(e,t,r){var a=e instanceof ArrayBuffer?new Uint8Array(e):e;if(!tt(this,a,t,r))return-1;var n=t+r;return this.valueHexView=a.subarray(t,n),this.valueHexView.length?(this.blockLength=r,n):(this.warnings.push("Zero buffer length"),t)}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.isHexOnly?e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",ot)}},{key:"toJSON",value:function(){return p(p({},A(t,"toJSON",this,3)([])),{},{isHexOnly:this.isHexOnly,valueHex:Ue.ToHex(this.valueHexView)})}}])}(e),t.NAME="hexBlock",t}var vt=o((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.blockLength,a=void 0===r?0:r,n=t.error,s=void 0===n?ut:n,u=t.warnings,o=void 0===u?[]:u,l=t.valueBeforeDecode,c=void 0===l?lt:l;i(this,e),this.blockLength=a,this.error=s,this.warnings=o,this.valueBeforeDecodeView=Ie.toUint8Array(c)}),[{key:"valueBeforeDecode",get:function(){return this.valueBeforeDecodeView.slice().buffer},set:function(e){this.valueBeforeDecodeView=new Uint8Array(e)}},{key:"toJSON",value:function(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:Ue.ToHex(this.valueBeforeDecodeView)}}}],[{key:"blockName",value:function(){return this.NAME}}]);vt.NAME="baseBlock";var dt=function(e){function t(){return i(this,t),n(this,t,arguments)}return m(t,e),o(t,[{key:"fromBER",value:function(e,t,r){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}},{key:"toBER",value:function(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}])}(vt);dt.NAME="valueBlock";var gt=function(e){function t(){var e,r,a,s,u,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=o.idBlock,c=void 0===l?{}:l;return i(this,t),e=n(this,t),c?(e.isHexOnly=null!==(r=c.isHexOnly)&&void 0!==r&&r,e.valueHexView=c.valueHex?Ie.toUint8Array(c.valueHex):lt,e.tagClass=null!==(a=c.tagClass)&&void 0!==a?a:-1,e.tagNumber=null!==(s=c.tagNumber)&&void 0!==s?s:-1,e.isConstructed=null!==(u=c.isConstructed)&&void 0!==u&&u):(e.tagClass=-1,e.tagNumber=-1,e.isConstructed=!1),e}return m(t,e),o(t,[{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",ot}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){var r=new Uint8Array(1);if(!e){var a=this.tagNumber;t|=a&=31,r[0]=t}return r.buffer}if(!this.isHexOnly){var n=Me(this.tagNumber,7),i=new Uint8Array(n),s=n.byteLength,u=new Uint8Array(s+1);if(u[0]=31|t,!e){for(var o=0;o<s-1;o++)u[o+1]=128|i[o];u[s]=i[s-1]}return u.buffer}var l=new Uint8Array(this.valueHexView.byteLength+1);if(l[0]=31|t,!e){for(var c=this.valueHexView,h=0;h<c.length-1;h++)l[h+1]=128|c[h];l[this.valueHexView.byteLength]=c[c.length-1]}return l.buffer}},{key:"fromBER",value:function(e,t,r){var a=Ie.toUint8Array(e);if(!tt(this,a,t,r))return-1;var n=a.subarray(t,t+r);if(0===n.length)return this.error="Zero buffer length",-1;switch(192&n[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=32==(32&n[0]),this.isHexOnly=!1;var i=31&n[0];if(31!==i)this.tagNumber=i,this.blockLength=1;else{for(var s=1,u=this.valueHexView=new Uint8Array(255),o=255;128&n[s];){if(u[s-1]=127&n[s],++s>=n.length)return this.error="End of input reached before message was fully decoded",-1;if(s===o){o+=255;for(var l=new Uint8Array(o),c=0;c<u.length;c++)l[c]=u[c];u=this.valueHexView=new Uint8Array(o)}}this.blockLength=s+1,u[s-1]=127&n[s];for(var h=new Uint8Array(s),f=0;f<s;f++)h[f]=u[f];(u=this.valueHexView=new Uint8Array(s)).set(h),this.blockLength<=9?this.tagNumber=He(u,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}},{key:"toJSON",value:function(){return p(p({},A(t,"toJSON",this,3)([])),{},{tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed})}}])}(mt(vt));gt.NAME="identificationBlock";var pt=function(e){function t(){var e,r,a,s,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=u.lenBlock,l=void 0===o?{}:o;return i(this,t),(e=n(this,t)).isIndefiniteForm=null!==(r=l.isIndefiniteForm)&&void 0!==r&&r,e.longFormUsed=null!==(a=l.longFormUsed)&&void 0!==a&&a,e.length=null!==(s=l.length)&&void 0!==s?s:0,e}return m(t,e),o(t,[{key:"fromBER",value:function(e,t,r){var a=Ie.toUint8Array(e);if(!tt(this,a,t,r))return-1;var n=a.subarray(t,t+r);if(0===n.length)return this.error="Zero buffer length",-1;if(255===n[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===n[0],this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(128&n[0]),!1===this.longFormUsed)return this.length=n[0],this.blockLength=1,t+this.blockLength;var i=127&n[0];if(i>8)return this.error="Too big integer",-1;if(i+1>n.length)return this.error="End of input reached before message was fully decoded",-1;var s=t+1,u=a.subarray(s,s+i);return 0===u[i-1]&&this.warnings.push("Needlessly long encoded length"),this.length=He(u,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=i+1,t+this.blockLength}},{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return e=new ArrayBuffer(1),!1===r&&((t=new Uint8Array(e))[0]=128),e;if(this.longFormUsed){var a=Me(this.length,8);if(a.byteLength>127)return this.error="Too big length",ot;if(e=new ArrayBuffer(a.byteLength+1),r)return e;var n=new Uint8Array(a);(t=new Uint8Array(e))[0]=128|a.byteLength;for(var i=0;i<a.byteLength;i++)t[i+1]=n[i];return e}return e=new ArrayBuffer(1),!1===r&&((t=new Uint8Array(e))[0]=this.length),e}},{key:"toJSON",value:function(){return p(p({},A(t,"toJSON",this,3)([])),{},{isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length})}}])}(vt);pt.NAME="lengthBlock";var yt={},kt=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0,s=r.name,u=void 0===s?ut:s,o=r.optional,l=void 0!==o&&o,c=r.primitiveSchema,h=y(r,B);return i(this,t),(e=n(this,t,[h])).name=u,e.optional=l,c&&(e.primitiveSchema=c),e.idBlock=new gt(h),e.lenBlock=new pt(h),e.valueBlock=a?new a(h):new dt(h),e}return m(t,e),o(t,[{key:"fromBER",value:function(e,t,r){var a=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===a?(this.error=this.valueBlock.error,a):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),a)}},{key:"toBER",value:function(e,t){var r=t||new rt;t||wt(this);var a=this.idBlock.toBER(e);if(r.write(a),this.lenBlock.isIndefiniteForm)r.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,r),r.write(new ArrayBuffer(2));else{var n=this.valueBlock.toBER(e);this.lenBlock.length=n.byteLength;var i=this.lenBlock.toBER(e);r.write(i),r.write(n)}return t?ot:r.final()}},{key:"toJSON",value:function(){var e=p(p({},A(t,"toJSON",this,3)([])),{},{idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional});return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ascii";return"ascii"===e?this.onAsciiEncoding():Ue.ToHex(this.toBER())}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(Ue.ToHex(this.valueBlock.valueBeforeDecodeView))}},{key:"isEqual",value:function(e){return this===e||e instanceof this.constructor&&Je(this.toBER(),e.toBER())}}])}(vt);function wt(e){if(e instanceof yt.Constructed){var t,r=l(e.valueBlock.value);try{for(r.s();!(t=r.n()).done;){wt(t.value)&&(e.lenBlock.isIndefiniteForm=!0)}}catch(e){r.e(e)}finally{r.f()}}return!!e.lenBlock.isIndefiniteForm}kt.NAME="BaseBlock";var bt=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0,s=r.value,u=void 0===s?ut:s,o=y(r,V);return i(this,t),e=n(this,t,[o,a]),u&&e.fromString(u),e}return m(t,e),o(t,[{key:"getValue",value:function(){return this.valueBlock.value}},{key:"setValue",value:function(e){this.valueBlock.value=e}},{key:"fromBER",value:function(e,t,r){var a=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===a?(this.error=this.valueBlock.error,a):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),a)}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : '").concat(this.valueBlock.value,"'")}}])}(kt);bt.NAME="BaseStringBlock";var St,At=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=r.isHexOnly,s=void 0===a||a,u=y(r,D);return i(this,t),(e=n(this,t,[u])).isHexOnly=s,e}return m(t,e),o(t)}(mt(dt));At.NAME="PrimitiveValueBlock";var Nt=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t,[r,At])).idBlock.isConstructed=!1,e}return m(t,e),o(t)}(kt);function Ct(e,t){if(e instanceof t)return e;var r=new t;return r.idBlock=e.idBlock,r.lenBlock=e.lenBlock,r.warnings=e.warnings,r.valueBeforeDecodeView=e.valueBeforeDecodeView,r}function xt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length,a=t,n=new kt({},dt),i=new vt;if(!tt(i,e,t,r))return n.error=i.error,{offset:-1,result:n};var s=e.subarray(t,t+r);if(!s.length)return n.error="Zero buffer length",{offset:-1,result:n};var u=n.idBlock.fromBER(e,t,r);if(n.idBlock.warnings.length&&n.warnings.concat(n.idBlock.warnings),-1===u)return n.error=n.idBlock.error,{offset:-1,result:n};if(t=u,r-=n.idBlock.blockLength,u=n.lenBlock.fromBER(e,t,r),n.lenBlock.warnings.length&&n.warnings.concat(n.lenBlock.warnings),-1===u)return n.error=n.lenBlock.error,{offset:-1,result:n};if(t=u,r-=n.lenBlock.blockLength,!n.idBlock.isConstructed&&n.lenBlock.isIndefiniteForm)return n.error="Indefinite length form used for primitive encoding form",{offset:-1,result:n};var o=kt;if(1===n.idBlock.tagClass){if(n.idBlock.tagNumber>=37&&!1===n.idBlock.isHexOnly)return n.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:n};switch(n.idBlock.tagNumber){case 0:if(n.idBlock.isConstructed&&n.lenBlock.length>0)return n.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:n};o=yt.EndOfContent;break;case 1:o=yt.Boolean;break;case 2:o=yt.Integer;break;case 3:o=yt.BitString;break;case 4:o=yt.OctetString;break;case 5:o=yt.Null;break;case 6:o=yt.ObjectIdentifier;break;case 10:o=yt.Enumerated;break;case 12:o=yt.Utf8String;break;case 13:o=yt.RelativeObjectIdentifier;break;case 14:o=yt.TIME;break;case 15:return n.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:n};case 16:o=yt.Sequence;break;case 17:o=yt.Set;break;case 18:o=yt.NumericString;break;case 19:o=yt.PrintableString;break;case 20:o=yt.TeletexString;break;case 21:o=yt.VideotexString;break;case 22:o=yt.IA5String;break;case 23:o=yt.UTCTime;break;case 24:o=yt.GeneralizedTime;break;case 25:o=yt.GraphicString;break;case 26:o=yt.VisibleString;break;case 27:o=yt.GeneralString;break;case 28:o=yt.UniversalString;break;case 29:o=yt.CharacterString;break;case 30:o=yt.BmpString;break;case 31:o=yt.DATE;break;case 32:o=yt.TimeOfDay;break;case 33:o=yt.DateTime;break;case 34:o=yt.Duration;break;default:var l=n.idBlock.isConstructed?new yt.Constructed:new yt.Primitive;l.idBlock=n.idBlock,l.lenBlock=n.lenBlock,l.warnings=n.warnings,n=l}}else o=n.idBlock.isConstructed?yt.Constructed:yt.Primitive;return u=(n=Ct(n,o)).fromBER(e,t,n.lenBlock.isIndefiniteForm?r:n.lenBlock.length),n.valueBeforeDecodeView=e.subarray(a,a+n.blockLength),{offset:u,result:n}}function Et(e){if(!e.byteLength){var t=new kt({},dt);return t.error="Input buffer has zero length",{offset:-1,result:t}}return xt(Ie.toUint8Array(e).slice(),0,e.byteLength)}St=Nt,yt.Primitive=St,Nt.NAME="PRIMITIVE";var It,Bt=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=r.value,s=void 0===a?[]:a,u=r.isIndefiniteForm,o=void 0!==u&&u,l=y(r,P);return i(this,t),(e=n(this,t,[l])).value=s,e.isIndefiniteForm=o,e}return m(t,e),o(t,[{key:"fromBER",value:function(e,t,r){var a=Ie.toUint8Array(e);if(!tt(this,a,t,r))return-1;if(this.valueBeforeDecodeView=a.subarray(t,t+r),0===this.valueBeforeDecodeView.length)return this.warnings.push("Zero buffer length"),t;for(var n,i,s=t;n=this.isIndefiniteForm,i=r,(n?1:i)>0;){var u=xt(a,s,r);if(-1===u.offset)return this.error=u.result.error,this.warnings.concat(u.result.warnings),-1;if(s=u.offset,this.blockLength+=u.result.blockLength,r-=u.result.blockLength,this.value.push(u.result),this.isIndefiniteForm&&u.result.constructor.NAME===ct)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===ct?this.value.pop():this.warnings.push("No EndOfContent block encoded")),s}},{key:"toBER",value:function(e,t){for(var r=t||new rt,a=0;a<this.value.length;a++)this.value[a].toBER(e,r);return t?ot:r.final()}},{key:"toJSON",value:function(){var e,r=p(p({},A(t,"toJSON",this,3)([])),{},{isIndefiniteForm:this.isIndefiniteForm,value:[]}),a=l(this.value);try{for(a.s();!(e=a.n()).done;){var n=e.value;r.value.push(n.toJSON())}}catch(e){a.e(e)}finally{a.f()}return r}}])}(dt);Bt.NAME="ConstructedValueBlock";var Vt=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t,[r,Bt])).idBlock.isConstructed=!0,e}return m(t,e),o(t,[{key:"fromBER",value:function(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;var a=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===a?(this.error=this.valueBlock.error,a):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),a)}},{key:"onAsciiEncoding",value:function(){var e,t=[],r=l(this.valueBlock.value);try{for(r.s();!(e=r.n()).done;){var a=e.value;t.push(a.toString("ascii").split("\n").map((function(e){return"  ".concat(e)})).join("\n"))}}catch(e){r.e(e)}finally{r.f()}var n=3===this.idBlock.tagClass?"[".concat(this.idBlock.tagNumber,"]"):this.constructor.NAME;return t.length?"".concat(n," :\n").concat(t.join("\n")):"".concat(n," :")}}])}(kt);It=Vt,yt.Constructed=It,Vt.NAME="CONSTRUCTED";var Dt,Pt=function(e){function t(){return i(this,t),n(this,t,arguments)}return m(t,e),o(t,[{key:"fromBER",value:function(e,t,r){return t}},{key:"toBER",value:function(e){return ot}}])}(dt);Pt.override="EndOfContentValueBlock";var Ot,Rt=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t,[r,Pt])).idBlock.tagClass=1,e.idBlock.tagNumber=0,e}return m(t,e),o(t)}(kt);Dt=Rt,yt.EndOfContent=Dt,Rt.NAME=ct;var Ut=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t,[r,dt])).idBlock.tagClass=1,e.idBlock.tagNumber=5,e}return m(t,e),o(t,[{key:"fromBER",value:function(e,t,r){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+r}},{key:"toBER",value:function(e,t){var r=new ArrayBuffer(2);if(!e){var a=new Uint8Array(r);a[0]=5,a[1]=0}return t&&t.write(r),r}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME)}}])}(kt);Ot=Ut,yt.Null=Ot,Ut.NAME="NULL";var Lt,Tt=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=r.value,s=y(r,O);return i(this,t),e=n(this,t,[s]),s.valueHex?e.valueHexView=Ie.toUint8Array(s.valueHex):e.valueHexView=new Uint8Array(1),a&&(e.value=a),e}return m(t,e),o(t,[{key:"value",get:function(){var e,t=l(this.valueHexView);try{for(t.s();!(e=t.n()).done;){if(e.value>0)return!0}}catch(e){t.e(e)}finally{t.f()}return!1},set:function(e){this.valueHexView[0]=e?255:0}},{key:"fromBER",value:function(e,t,r){var a=Ie.toUint8Array(e);return tt(this,a,t,r)?(this.valueHexView=a.subarray(t,t+r),r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,je.call(this),this.blockLength=r,t+r):-1}},{key:"toBER",value:function(){return this.valueHexView.slice()}},{key:"toJSON",value:function(){return p(p({},A(t,"toJSON",this,3)([])),{},{value:this.value})}}])}(mt(dt));Tt.NAME="BooleanValueBlock";var Ht=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t,[r,Tt])).idBlock.tagClass=1,e.idBlock.tagNumber=1,e}return m(t,e),o(t,[{key:"getValue",value:function(){return this.valueBlock.value}},{key:"setValue",value:function(e){this.valueBlock.value=e}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.getValue)}}])}(kt);Lt=Ht,yt.Boolean=Lt,Ht.NAME="BOOLEAN";var Mt,Kt=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=r.isConstructed,s=void 0!==a&&a,u=y(r,R);return i(this,t),(e=n(this,t,[u])).isConstructed=s,e}return m(t,e),o(t,[{key:"fromBER",value:function(e,r,a){var n=0;if(this.isConstructed){if(this.isHexOnly=!1,-1===(n=Bt.prototype.fromBER.call(this,e,r,a)))return n;for(var i=0;i<this.value.length;i++){var s=this.value[i].constructor.NAME;if(s===ct){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(s!==ht)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,n=A(t,"fromBER",this,3)([e,r,a]),this.blockLength=a;return n}},{key:"toBER",value:function(e,t){return this.isConstructed?Bt.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}},{key:"toJSON",value:function(){return p(p({},A(t,"toJSON",this,3)([])),{},{isConstructed:this.isConstructed})}}])}(mt(Bt));Kt.NAME="OctetStringValueBlock";var _t=function(e){function t(){var e,r,a,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u=s.idBlock,o=void 0===u?{}:u,l=s.lenBlock,c=void 0===l?{}:l,h=y(s,U);return i(this,t),null!==(r=h.isConstructed)&&void 0!==r||(h.isConstructed=!!(null===(a=h.value)||void 0===a?void 0:a.length)),(e=n(this,t,[p({idBlock:p({isConstructed:h.isConstructed},o),lenBlock:p(p({},c),{},{isIndefiniteForm:!!h.isIndefiniteForm})},h),Kt])).idBlock.tagClass=1,e.idBlock.tagNumber=4,e}return m(t,e),o(t,[{key:"fromBER",value:function(e,r,a){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===a)return 0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),r;if(!this.valueBlock.isConstructed){var n=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(r,r+a);try{if(n.byteLength){var i=xt(n,0,n.byteLength);-1!==i.offset&&i.offset===a&&(this.valueBlock.value=[i.result])}}catch(e){}}return A(t,"fromBER",this,3)([e,r,a])}},{key:"onAsciiEncoding",value:function(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?Vt.prototype.onAsciiEncoding.call(this):"".concat(this.constructor.NAME," : ").concat(Ue.ToHex(this.valueBlock.valueHexView))}},{key:"getValue",value:function(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;var e,r=[],a=l(this.valueBlock.value);try{for(a.s();!(e=a.n()).done;){var n=e.value;n instanceof t&&r.push(n.valueBlock.valueHexView)}}catch(e){a.e(e)}finally{a.f()}return Ie.concat(r)}}])}(kt);Mt=_t,yt.OctetString=Mt,_t.NAME=ht;var jt,Jt=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=r.unusedBits,s=void 0===a?0:a,u=r.isConstructed,o=void 0!==u&&u,l=y(r,L);return i(this,t),(e=n(this,t,[l])).unusedBits=s,e.isConstructed=o,e.blockLength=e.valueHexView.byteLength,e}return m(t,e),o(t,[{key:"fromBER",value:function(e,t,r){if(!r)return t;var a=-1;if(this.isConstructed){if(-1===(a=Bt.prototype.fromBER.call(this,e,t,r)))return a;var n,i=l(this.value);try{for(i.s();!(n=i.n()).done;){var s=n.value,u=s.constructor.NAME;if(u===ct){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(u!==ft)return this.error="BIT STRING may consists of BIT STRINGs only",-1;var o=s.valueBlock;if(this.unusedBits>0&&o.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=o.unusedBits}}catch(e){i.e(e)}finally{i.f()}return a}var c=Ie.toUint8Array(e);if(!tt(this,c,t,r))return-1;var h=c.subarray(t,t+r);if(this.unusedBits=h[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){var f=h.subarray(1);try{if(f.byteLength){var m=xt(f,0,f.byteLength);-1!==m.offset&&m.offset===r-1&&(this.value=[m.result])}}catch(e){}}return this.valueHexView=h.subarray(1),this.blockLength=h.length,t+r}},{key:"toBER",value:function(e,t){if(this.isConstructed)return Bt.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return ot;var r=new Uint8Array(this.valueHexView.length+1);return r[0]=this.unusedBits,r.set(this.valueHexView,1),r.buffer}},{key:"toJSON",value:function(){return p(p({},A(t,"toJSON",this,3)([])),{},{unusedBits:this.unusedBits,isConstructed:this.isConstructed})}}])}(mt(Bt));Jt.NAME="BitStringValueBlock";var Ft,qt=function(e){function t(){var e,r,a,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u=s.idBlock,o=void 0===u?{}:u,l=s.lenBlock,c=void 0===l?{}:l,h=y(s,T);return i(this,t),null!==(r=h.isConstructed)&&void 0!==r||(h.isConstructed=!!(null===(a=h.value)||void 0===a?void 0:a.length)),(e=n(this,t,[p({idBlock:p({isConstructed:h.isConstructed},o),lenBlock:p(p({},c),{},{isIndefiniteForm:!!h.isIndefiniteForm})},h),Jt])).idBlock.tagClass=1,e.idBlock.tagNumber=3,e}return m(t,e),o(t,[{key:"fromBER",value:function(e,r,a){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,A(t,"fromBER",this,3)([e,r,a])}},{key:"onAsciiEncoding",value:function(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return Vt.prototype.onAsciiEncoding.call(this);var e,t=[],r=l(this.valueBlock.valueHexView);try{for(r.s();!(e=r.n()).done;){var a=e.value;t.push(a.toString(2).padStart(8,"0"))}}catch(e){r.e(e)}finally{r.f()}var n=t.join("");return"".concat(this.constructor.NAME," : ").concat(n.substring(0,n.length-this.valueBlock.unusedBits))}}])}(kt);function Xt(e,t){for(var r=new Uint8Array([0]),a=new Uint8Array(e),n=new Uint8Array(t),i=a.slice(0),s=i.length-1,u=n.slice(0),o=u.length-1,l=0,c=0,h=o<s?s:o;h>=0;h--,c++){if(!0==c<u.length)l=i[s-c]+u[o-c]+r[0];else l=i[s-c]+r[0];if(r[0]=l/10,!0==c>=i.length)i=_e(new Uint8Array([l%10]),i);else i[s-c]=l%10}return r[0]>0&&(i=_e(r,i)),i}function Gt(e){if(e>=at.length)for(var t=at.length;t<=e;t++){for(var r=new Uint8Array([0]),a=at[t-1].slice(0),n=a.length-1;n>=0;n--){var i=new Uint8Array([(a[n]<<1)+r[0]]);r[0]=i[0]/10,a[n]=i[0]%10}r[0]>0&&(a=_e(r,a)),at.push(a)}return at[e]}function Wt(e,t){for(var r,a=0,n=new Uint8Array(e),i=new Uint8Array(t),s=n.slice(0),u=s.length-1,o=i.slice(0),l=o.length-1,c=0,h=l;h>=0;h--,c++)if(!0==(r=s[u-c]-o[l-c]-a)<0)a=1,s[u-c]=r+10;else a=0,s[u-c]=r;if(a>0)for(var f=u-l+1;f>=0;f--,c++){if(!((r=s[u-c]-a)<0)){a=0,s[u-c]=r;break}a=1,s[u-c]=r+10}return s.slice()}jt=qt,yt.BitString=jt,qt.NAME=ft;var zt,Yt=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=r.value,s=y(r,H);return i(this,t),(e=n(this,t,[s]))._valueDec=0,s.valueHex&&e.setValueHex(),void 0!==a&&(e.valueDec=a),e}return m(t,e),o(t,[{key:"setValueHex",value:function(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=je.call(this)))}},{key:"valueDec",get:function(){return this._valueDec},set:function(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(function(e){for(var t=e<0?-1*e:e,r=128,a=1;a<8;a++){if(t<=r){if(e<0){var n=Me(r-t,8,a);return new Uint8Array(n)[0]|=128,n}var i=Me(t,8,a),s=new Uint8Array(i);if(128&s[0]){var u=i.slice(0),o=new Uint8Array(u);i=new ArrayBuffer(i.byteLength+1),s=new Uint8Array(i);for(var l=0;l<u.byteLength;l++)s[l+1]=o[l];s[0]=0}return i}r*=Math.pow(2,8)}return new ArrayBuffer(0)}(e))}},{key:"fromDER",value:function(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=this.fromBER(e,t,r);if(-1===n)return n;var i=this.valueHexView;return 0===i[0]&&0!=(128&i[1])?this.valueHexView=i.subarray(1):0!==a&&i.length<a&&(a-i.length>1&&(a=i.length+1),this.valueHexView=i.subarray(a-i.length)),n}},{key:"toDER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.valueHexView;switch(!0){case 0!=(128&t[0]):var r=new Uint8Array(this.valueHexView.length+1);r[0]=0,r.set(t,1),this.valueHexView=r;break;case 0===t[0]&&0==(128&t[1]):this.valueHexView=this.valueHexView.subarray(1)}return this.toBER(e)}},{key:"fromBER",value:function(e,r,a){var n=A(t,"fromBER",this,3)([e,r,a]);return-1===n||this.setValueHex(),n}},{key:"toBER",value:function(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}},{key:"toJSON",value:function(){return p(p({},A(t,"toJSON",this,3)([])),{},{valueDec:this.valueDec})}},{key:"toString",value:function(){for(var e,t=8*this.valueHexView.length-1,r=new Uint8Array(8*this.valueHexView.length/3),a=0,n=this.valueHexView,i="",s=!1,u=n.byteLength-1;u>=0;u--){e=n[u];for(var o=0;o<8;o++){if(1==(1&e))if(a===t)r=Wt(Gt(a),r),i="-";else r=Xt(r,Gt(a));a++,e>>=1}}for(var l=0;l<r.length;l++)r[l]&&(s=!0),s&&(i+=nt.charAt(r[l]));return!1===s&&(i+=nt.charAt(0)),i}}])}(mt(dt));Ft=Yt,Yt.NAME="IntegerValueBlock",Object.defineProperty(Ft.prototype,"valueHex",{set:function(e){this.valueHexView=new Uint8Array(e),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var Qt,Zt=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t,[r,Yt])).idBlock.tagClass=1,e.idBlock.tagNumber=2,e}return m(t,e),o(t,[{key:"toBigInt",value:function(){return $e(),BigInt(this.valueBlock.toString())}},{key:"convertToDER",value:function(){var e=new t({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}},{key:"convertFromDER",value:function(){return new t({valueHex:0===this.valueBlock.valueHexView[0]?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.valueBlock.toString())}}],[{key:"fromBigInt",value:function(e){$e();var r=BigInt(e),a=new rt,n=r.toString(16).replace(/^-/,""),i=new Uint8Array(Ue.FromHex(n));if(r<0){var s=new Uint8Array(i.length+(128&i[0]?1:0));s[0]|=128;var u=BigInt("0x".concat(Ue.ToHex(s)))+r,o=Ie.toUint8Array(Ue.FromHex(u.toString(16)));o[0]|=128,a.write(o)}else 128&i[0]&&a.write(new Uint8Array([0])),a.write(i);return new t({valueHex:a.final()})}}])}(kt);zt=Zt,yt.Integer=zt,Zt.NAME="INTEGER";var $t=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t,[r])).idBlock.tagClass=1,e.idBlock.tagNumber=10,e}return m(t,e),o(t)}(Zt);Qt=$t,yt.Enumerated=Qt,$t.NAME="ENUMERATED";var er=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=r.valueDec,s=void 0===a?-1:a,u=r.isFirstSid,o=void 0!==u&&u,l=y(r,M);return i(this,t),(e=n(this,t,[l])).valueDec=s,e.isFirstSid=o,e}return m(t,e),o(t,[{key:"fromBER",value:function(e,t,r){if(!r)return t;var a=Ie.toUint8Array(e);if(!tt(this,a,t,r))return-1;var n=a.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(var i=0;i<r&&(this.valueHexView[i]=127&n[i],this.blockLength++,0!=(128&n[i]));i++);for(var s=new Uint8Array(this.blockLength),u=0;u<this.blockLength;u++)s[u]=this.valueHexView[u];return this.valueHexView=s,0!=(128&n[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=He(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}},{key:"valueBigInt",set:function(e){$e();for(var t=BigInt(e).toString(2);t.length%7;)t="0"+t;for(var r=new Uint8Array(t.length/7),a=0;a<r.length;a++)r[a]=parseInt(t.slice(7*a,7*a+7),2)+(a+1<r.length?128:0);this.fromBER(r.buffer,0,r.length)}},{key:"toBER",value:function(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);for(var t=this.valueHexView,r=new Uint8Array(this.blockLength),a=0;a<this.blockLength-1;a++)r[a]=128|t[a];return r[this.blockLength-1]=t[this.blockLength-1],r.buffer}var n=Me(this.valueDec,7);if(0===n.byteLength)return this.error="Error during encoding SID value",ot;var i=new Uint8Array(n.byteLength);if(!e){for(var s=new Uint8Array(n),u=n.byteLength-1,o=0;o<u;o++)i[o]=128|s[o];i[u]=s[u]}return i}},{key:"toString",value:function(){var e="";if(this.isHexOnly)e=Ue.ToHex(this.valueHexView);else if(this.isFirstSid){var t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}},{key:"toJSON",value:function(){return p(p({},A(t,"toJSON",this,3)([])),{},{valueDec:this.valueDec,isFirstSid:this.isFirstSid})}}])}(mt(dt));er.NAME="sidBlock";var tr,rr=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=r.value,s=void 0===a?ut:a,u=y(r,K);return i(this,t),(e=n(this,t,[u])).value=[],s&&e.fromString(s),e}return m(t,e),o(t,[{key:"fromBER",value:function(e,t,r){for(var a=t;r>0;){var n=new er;if(-1===(a=n.fromBER(e,a,r)))return this.blockLength=0,this.error=n.error,a;0===this.value.length&&(n.isFirstSid=!0),this.blockLength+=n.blockLength,r-=n.blockLength,this.value.push(n)}return a}},{key:"toBER",value:function(e){for(var t=[],r=0;r<this.value.length;r++){var a=this.value[r].toBER(e);if(0===a.byteLength)return this.error=this.value[r].error,ot;t.push(a)}return et(t)}},{key:"fromString",value:function(e){this.value=[];var t=0,r=0,a="",n=!1;do{if(a=-1===(r=e.indexOf(".",t))?e.substring(t):e.substring(t,r),t=r+1,n){var i=this.value[0],s=0;switch(i.valueDec){case 0:break;case 1:s=40;break;case 2:s=80;break;default:return void(this.value=[])}var u=parseInt(a,10);if(isNaN(u))return;i.valueDec=u+s,n=!1}else{var o=new er;if(a>Number.MAX_SAFE_INTEGER){$e();var l=BigInt(a);o.valueBigInt=l}else if(o.valueDec=parseInt(a,10),isNaN(o.valueDec))return;this.value.length||(o.isFirstSid=!0,n=!0),this.value.push(o)}}while(-1!==r)}},{key:"toString",value:function(){for(var e="",t=!1,r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var a=this.value[r].toString();0!==r&&(e="".concat(e,".")),t?(a="{".concat(a,"}"),this.value[r].isFirstSid?e="2.{".concat(a," - 80}"):e+=a):e+=a}return e}},{key:"toJSON",value:function(){for(var e=p(p({},A(t,"toJSON",this,3)([])),{},{value:this.toString(),sidArray:[]}),r=0;r<this.value.length;r++)e.sidArray.push(this.value[r].toJSON());return e}}])}(dt);rr.NAME="ObjectIdentifierValueBlock";var ar=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t,[r,rr])).idBlock.tagClass=1,e.idBlock.tagNumber=6,e}return m(t,e),o(t,[{key:"getValue",value:function(){return this.valueBlock.toString()}},{key:"setValue",value:function(e){this.valueBlock.fromString(e)}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.valueBlock.toString()||"empty")}},{key:"toJSON",value:function(){return p(p({},A(t,"toJSON",this,3)([])),{},{value:this.getValue()})}}])}(kt);tr=ar,yt.ObjectIdentifier=tr,ar.NAME="OBJECT IDENTIFIER";var nr=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=r.valueDec,s=void 0===a?0:a,u=y(r,_);return i(this,t),(e=n(this,t,[u])).valueDec=s,e}return m(t,e),o(t,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;var a=Ie.toUint8Array(e);if(!tt(this,a,t,r))return-1;var n=a.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(var i=0;i<r&&(this.valueHexView[i]=127&n[i],this.blockLength++,0!=(128&n[i]));i++);for(var s=new Uint8Array(this.blockLength),u=0;u<this.blockLength;u++)s[u]=this.valueHexView[u];return this.valueHexView=s,0!=(128&n[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=He(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}},{key:"toBER",value:function(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);for(var t=this.valueHexView,r=new Uint8Array(this.blockLength),a=0;a<this.blockLength-1;a++)r[a]=128|t[a];return r[this.blockLength-1]=t[this.blockLength-1],r.buffer}var n=Me(this.valueDec,7);if(0===n.byteLength)return this.error="Error during encoding SID value",ot;var i=new Uint8Array(n.byteLength);if(!e){for(var s=new Uint8Array(n),u=n.byteLength-1,o=0;o<u;o++)i[o]=128|s[o];i[u]=s[u]}return i.buffer}},{key:"toString",value:function(){return this.isHexOnly?Ue.ToHex(this.valueHexView):this.valueDec.toString()}},{key:"toJSON",value:function(){return p(p({},A(t,"toJSON",this,3)([])),{},{valueDec:this.valueDec})}}])}(mt(vt));nr.NAME="relativeSidBlock";var ir,sr=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=r.value,s=void 0===a?ut:a,u=y(r,j);return i(this,t),(e=n(this,t,[u])).value=[],s&&e.fromString(s),e}return m(t,e),o(t,[{key:"fromBER",value:function(e,t,r){for(var a=t;r>0;){var n=new nr;if(-1===(a=n.fromBER(e,a,r)))return this.blockLength=0,this.error=n.error,a;this.blockLength+=n.blockLength,r-=n.blockLength,this.value.push(n)}return a}},{key:"toBER",value:function(e,t){for(var r=[],a=0;a<this.value.length;a++){var n=this.value[a].toBER(e);if(0===n.byteLength)return this.error=this.value[a].error,ot;r.push(n)}return et(r)}},{key:"fromString",value:function(e){this.value=[];var t=0,r=0,a="";do{a=-1===(r=e.indexOf(".",t))?e.substring(t):e.substring(t,r),t=r+1;var n=new nr;if(n.valueDec=parseInt(a,10),isNaN(n.valueDec))return!0;this.value.push(n)}while(-1!==r);return!0}},{key:"toString",value:function(){for(var e="",t=!1,r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var a=this.value[r].toString();0!==r&&(e="".concat(e,".")),e+=t?a="{".concat(a,"}"):a}return e}},{key:"toJSON",value:function(){for(var e=p(p({},A(t,"toJSON",this,3)([])),{},{value:this.toString(),sidArray:[]}),r=0;r<this.value.length;r++)e.sidArray.push(this.value[r].toJSON());return e}}])}(dt);sr.NAME="RelativeObjectIdentifierValueBlock";var ur,or=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t,[r,sr])).idBlock.tagClass=1,e.idBlock.tagNumber=13,e}return m(t,e),o(t,[{key:"getValue",value:function(){return this.valueBlock.toString()}},{key:"setValue",value:function(e){this.valueBlock.fromString(e)}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.valueBlock.toString()||"empty")}},{key:"toJSON",value:function(){return p(p({},A(t,"toJSON",this,3)([])),{},{value:this.getValue()})}}])}(kt);ir=or,yt.RelativeObjectIdentifier=ir,or.NAME="RelativeObjectIdentifier";var lr,cr=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t,[r])).idBlock.tagClass=1,e.idBlock.tagNumber=16,e}return m(t,e),o(t)}(Vt);ur=cr,yt.Sequence=ur,cr.NAME="SEQUENCE";var hr=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t,[r])).idBlock.tagClass=1,e.idBlock.tagNumber=17,e}return m(t,e),o(t)}(Vt);lr=hr,yt.Set=lr,hr.NAME="SET";var fr=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=Object.assign({},(d(r),r));return i(this,t),(e=n(this,t,[a])).isHexOnly=!0,e.value=ut,e}return m(t,e),o(t,[{key:"toJSON",value:function(){return p(p({},A(t,"toJSON",this,3)([])),{},{value:this.value})}}])}(mt(dt));fr.NAME="StringValueBlock";var mr=function(e){function t(){return i(this,t),n(this,t,arguments)}return m(t,e),o(t)}(fr);mr.NAME="SimpleStringValueBlock";var vr=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=Object.assign({},(d(e),e));return i(this,t),n(this,t,[r,mr])}return m(t,e),o(t,[{key:"fromBuffer",value:function(e){this.valueBlock.value=String.fromCharCode.apply(null,Ie.toUint8Array(e))}},{key:"fromString",value:function(e){for(var t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(t),a=0;a<t;a++)r[a]=e.charCodeAt(a);this.valueBlock.value=e}}])}(bt);vr.NAME="SIMPLE STRING";var dr,gr=function(e){function t(){return i(this,t),n(this,t,arguments)}return m(t,e),o(t,[{key:"fromBuffer",value:function(e){this.valueBlock.valueHexView=Ie.toUint8Array(e);try{this.valueBlock.value=Ue.ToUtf8String(e)}catch(t){this.warnings.push('Error during "decodeURIComponent": '.concat(t,", using raw string")),this.valueBlock.value=Ue.ToBinary(e)}}},{key:"fromString",value:function(e){this.valueBlock.valueHexView=new Uint8Array(Ue.FromUtf8String(e)),this.valueBlock.value=e}}])}(vr);gr.NAME="Utf8StringValueBlock";var pr=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t,[r])).idBlock.tagClass=1,e.idBlock.tagNumber=12,e}return m(t,e),o(t)}(gr);dr=pr,yt.Utf8String=dr,pr.NAME="UTF8String";var yr,kr=function(e){function t(){return i(this,t),n(this,t,arguments)}return m(t,e),o(t,[{key:"fromBuffer",value:function(e){this.valueBlock.value=Ue.ToUtf16String(e),this.valueBlock.valueHexView=Ie.toUint8Array(e)}},{key:"fromString",value:function(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(Ue.FromUtf16String(e))}}])}(vr);kr.NAME="BmpStringValueBlock";var wr=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=Object.assign({},(d(r),r));return i(this,t),(e=n(this,t,[a])).idBlock.tagClass=1,e.idBlock.tagNumber=30,e}return m(t,e),o(t)}(kr);yr=wr,yt.BmpString=yr,wr.NAME="BMPString";var br,Sr=function(e){function t(){return i(this,t),n(this,t,arguments)}return m(t,e),o(t,[{key:"fromBuffer",value:function(e){for(var t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),r=new Uint8Array(t),a=0;a<r.length;a+=4)r[a]=r[a+3],r[a+1]=r[a+2],r[a+2]=0,r[a+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}},{key:"fromString",value:function(e){for(var t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(4*t),a=0;a<t;a++){var n=Me(e.charCodeAt(a),8),i=new Uint8Array(n);if(!(i.length>4))for(var s=4-i.length,u=i.length-1;u>=0;u--)r[4*a+u+s]=i[u]}this.valueBlock.value=e}}])}(vr);Sr.NAME="UniversalStringValueBlock";var Ar,Nr=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=Object.assign({},(d(r),r));return i(this,t),(e=n(this,t,[a])).idBlock.tagClass=1,e.idBlock.tagNumber=28,e}return m(t,e),o(t)}(Sr);br=Nr,yt.UniversalString=br,Nr.NAME="UniversalString";var Cr,xr=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t,[r])).idBlock.tagClass=1,e.idBlock.tagNumber=18,e}return m(t,e),o(t)}(vr);Ar=xr,yt.NumericString=Ar,xr.NAME="NumericString";var Er,Ir=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t,[r])).idBlock.tagClass=1,e.idBlock.tagNumber=19,e}return m(t,e),o(t)}(vr);Cr=Ir,yt.PrintableString=Cr,Ir.NAME="PrintableString";var Br,Vr=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t,[r])).idBlock.tagClass=1,e.idBlock.tagNumber=20,e}return m(t,e),o(t)}(vr);Er=Vr,yt.TeletexString=Er,Vr.NAME="TeletexString";var Dr,Pr=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t,[r])).idBlock.tagClass=1,e.idBlock.tagNumber=21,e}return m(t,e),o(t)}(vr);Br=Pr,yt.VideotexString=Br,Pr.NAME="VideotexString";var Or,Rr=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t,[r])).idBlock.tagClass=1,e.idBlock.tagNumber=22,e}return m(t,e),o(t)}(vr);Dr=Rr,yt.IA5String=Dr,Rr.NAME="IA5String";var Ur,Lr=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t,[r])).idBlock.tagClass=1,e.idBlock.tagNumber=25,e}return m(t,e),o(t)}(vr);Or=Lr,yt.GraphicString=Or,Lr.NAME="GraphicString";var Tr,Hr=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t,[r])).idBlock.tagClass=1,e.idBlock.tagNumber=26,e}return m(t,e),o(t)}(vr);Ur=Hr,yt.VisibleString=Ur,Hr.NAME="VisibleString";var Mr,Kr=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t,[r])).idBlock.tagClass=1,e.idBlock.tagNumber=27,e}return m(t,e),o(t)}(vr);Tr=Kr,yt.GeneralString=Tr,Kr.NAME="GeneralString";var _r,jr=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t,[r])).idBlock.tagClass=1,e.idBlock.tagNumber=29,e}return m(t,e),o(t)}(vr);Mr=jr,yt.CharacterString=Mr,jr.NAME="CharacterString";var Jr,Fr=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=r.value,s=r.valueDate,u=y(r,J);if(i(this,t),(e=n(this,t,[u])).year=0,e.month=0,e.day=0,e.hour=0,e.minute=0,e.second=0,a){e.fromString(a),e.valueBlock.valueHexView=new Uint8Array(a.length);for(var o=0;o<a.length;o++)e.valueBlock.valueHexView[o]=a.charCodeAt(o)}return s&&(e.fromDate(s),e.valueBlock.valueHexView=new Uint8Array(e.toBuffer())),e.idBlock.tagClass=1,e.idBlock.tagNumber=23,e}return m(t,e),o(t,[{key:"fromBuffer",value:function(e){this.fromString(String.fromCharCode.apply(null,Ie.toUint8Array(e)))}},{key:"toBuffer",value:function(){for(var e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t),a=0;a<e.length;a++)r[a]=e.charCodeAt(a);return t}},{key:"fromDate",value:function(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}},{key:"fromString",value:function(e){var t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/gi.exec(e);if(null!==t){var r=parseInt(t[1],10);this.year=r>=50?1900+r:2e3+r,this.month=parseInt(t[2],10),this.day=parseInt(t[3],10),this.hour=parseInt(t[4],10),this.minute=parseInt(t[5],10),this.second=parseInt(t[6],10)}else this.error="Wrong input string for conversion"}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"iso";if("iso"===e){var r=new Array(7);return r[0]=Fe(this.year<2e3?this.year-1900:this.year-2e3,2),r[1]=Fe(this.month,2),r[2]=Fe(this.day,2),r[3]=Fe(this.hour,2),r[4]=Fe(this.minute,2),r[5]=Fe(this.second,2),r[6]="Z",r.join("")}return A(t,"toString",this,3)([e])}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.toDate().toISOString())}},{key:"toJSON",value:function(){return p(p({},A(t,"toJSON",this,3)([])),{},{year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second})}}])}(Hr);_r=Fr,yt.UTCTime=_r,Fr.NAME="UTCTime";var qr,Xr=function(e){function t(){var e,r,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),null!==(r=(e=n(this,t,[a])).millisecond)&&void 0!==r||(e.millisecond=0),e.idBlock.tagClass=1,e.idBlock.tagNumber=24,e}return m(t,e),o(t,[{key:"fromDate",value:function(e){A(t,"fromDate",this,3)([e]),this.millisecond=e.getUTCMilliseconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}},{key:"fromString",value:function(e){var t,r=!1,a="",n="",i=0,s=0,u=0;if("Z"===e[e.length-1])a=e.substring(0,e.length-1),r=!0;else{var o=new Number(e[e.length-1]);if(isNaN(o.valueOf()))throw new Error("Wrong input string for conversion");a=e}if(r){if(-1!==a.indexOf("+"))throw new Error("Wrong input string for conversion");if(-1!==a.indexOf("-"))throw new Error("Wrong input string for conversion")}else{var l=1,c=a.indexOf("+"),h="";if(-1===c&&(c=a.indexOf("-"),l=-1),-1!==c){if(h=a.substring(c+1),a=a.substring(0,c),2!==h.length&&4!==h.length)throw new Error("Wrong input string for conversion");var f=parseInt(h.substring(0,2),10);if(isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");if(s=l*f,4===h.length){if(f=parseInt(h.substring(2,4),10),isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");u=l*f}}}var m=a.indexOf(".");if(-1===m&&(m=a.indexOf(",")),-1!==m){var v=new Number("0".concat(a.substring(m)));if(isNaN(v.valueOf()))throw new Error("Wrong input string for conversion");i=v.valueOf(),n=a.substring(0,m)}else n=a;switch(!0){case 8===n.length:if(t=/(\d{4})(\d{2})(\d{2})/gi,-1!==m)throw new Error("Wrong input string for conversion");break;case 10===n.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})/gi,-1!==m){var d=60*i;this.minute=Math.floor(d),d=60*(d-this.minute),this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case 12===n.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==m){var g=60*i;this.second=Math.floor(g),g=1e3*(g-this.second),this.millisecond=Math.floor(g)}break;case 14===n.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==m){var p=1e3*i;this.millisecond=Math.floor(p)}break;default:throw new Error("Wrong input string for conversion")}var y=t.exec(n);if(null===y)throw new Error("Wrong input string for conversion");for(var k=1;k<y.length;k++)switch(k){case 1:this.year=parseInt(y[k],10);break;case 2:this.month=parseInt(y[k],10);break;case 3:this.day=parseInt(y[k],10);break;case 4:this.hour=parseInt(y[k],10)+s;break;case 5:this.minute=parseInt(y[k],10)+u;break;case 6:this.second=parseInt(y[k],10);break;default:throw new Error("Wrong input string for conversion")}if(!1===r){var w=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=w.getUTCFullYear(),this.month=w.getUTCMonth(),this.day=w.getUTCDay(),this.hour=w.getUTCHours(),this.minute=w.getUTCMinutes(),this.second=w.getUTCSeconds(),this.millisecond=w.getUTCMilliseconds()}}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"iso";if("iso"===e){var r=[];return r.push(Fe(this.year,4)),r.push(Fe(this.month,2)),r.push(Fe(this.day,2)),r.push(Fe(this.hour,2)),r.push(Fe(this.minute,2)),r.push(Fe(this.second,2)),0!==this.millisecond&&(r.push("."),r.push(Fe(this.millisecond,3))),r.push("Z"),r.join("")}return A(t,"toString",this,3)([e])}},{key:"toJSON",value:function(){return p(p({},A(t,"toJSON",this,3)([])),{},{millisecond:this.millisecond})}}])}(Fr);Jr=Xr,yt.GeneralizedTime=Jr,Xr.NAME="GeneralizedTime";var Gr,Wr=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t,[r])).idBlock.tagClass=1,e.idBlock.tagNumber=31,e}return m(t,e),o(t)}(pr);qr=Wr,yt.DATE=qr,Wr.NAME="DATE";var zr,Yr=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t,[r])).idBlock.tagClass=1,e.idBlock.tagNumber=32,e}return m(t,e),o(t)}(pr);Gr=Yr,yt.TimeOfDay=Gr,Yr.NAME="TimeOfDay";var Qr,Zr=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t,[r])).idBlock.tagClass=1,e.idBlock.tagNumber=33,e}return m(t,e),o(t)}(pr);zr=Zr,yt.DateTime=zr,Zr.NAME="DateTime";var $r,ea=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t,[r])).idBlock.tagClass=1,e.idBlock.tagNumber=34,e}return m(t,e),o(t)}(pr);Qr=ea,yt.Duration=Qr,ea.NAME="Duration";var ta=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t,[r])).idBlock.tagClass=1,e.idBlock.tagNumber=14,e}return m(t,e),o(t)}(pr);$r=ta,yt.TIME=$r,ta.NAME="TIME";var ra=o((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.name,a=void 0===r?ut:r,n=t.optional,s=void 0!==n&&n;i(this,e),this.name=a,this.optional=s})),aa=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=r.value,s=void 0===a?[]:a,u=y(r,F);return i(this,t),(e=n(this,t,[u])).value=s,e}return m(t,e),o(t)}(ra),na=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=r.value,s=void 0===a?new ra:a,u=r.local,o=void 0!==u&&u,l=y(r,q);return i(this,t),(e=n(this,t,[l])).value=s,e.local=o,e}return m(t,e),o(t)}(ra),ia=o((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.data,a=void 0===r?lt:r;i(this,e),this.dataView=Ie.toUint8Array(a)}),[{key:"data",get:function(){return this.dataView.slice().buffer},set:function(e){this.dataView=Ie.toUint8Array(e)}},{key:"fromBER",value:function(e,t,r){var a=t+r;return this.dataView=Ie.toUint8Array(e).subarray(t,a),a}},{key:"toBER",value:function(e){return this.dataView.slice().buffer}}]);function sa(e,t,r){if(r instanceof aa){for(var a=0;a<r.value.length;a++){if(sa(e,t,r.value[a]).verified)return{verified:!0,result:e}}var n={verified:!1,result:{error:"Wrong values for Choice type"}};return r.hasOwnProperty(it)&&(n.name=r.name),n}if(r instanceof ra)return r.hasOwnProperty(it)&&(e[r.name]=t),{verified:!0,result:e};if(e instanceof Object==!1)return{verified:!1,result:{error:"Wrong root object"}};if(t instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(r instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("idBlock"in r==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("fromBER"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("toBER"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};var i=r.idBlock.toBER(!1);if(0===i.byteLength)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(-1===r.idBlock.fromBER(i,0,i.byteLength))return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(!1===r.idBlock.hasOwnProperty("tagClass"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagClass!==t.idBlock.tagClass)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("tagNumber"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagNumber!==t.idBlock.tagNumber)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("isConstructed"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isConstructed!==t.idBlock.isConstructed)return{verified:!1,result:e};if(!("isHexOnly"in r.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isHexOnly!==t.idBlock.isHexOnly)return{verified:!1,result:e};if(r.idBlock.isHexOnly){if(st in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};var s=r.idBlock.valueHexView,u=t.idBlock.valueHexView;if(s.length!==u.length)return{verified:!1,result:e};for(var o=0;o<s.length;o++)if(s[o]!==u[1])return{verified:!1,result:e}}if(r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,ut),r.name&&(e[r.name]=t)),r instanceof yt.Constructed){var l=0,c={verified:!1,result:{error:"Unknown error"}},h=r.valueBlock.value.length;if(h>0&&r.valueBlock.value[0]instanceof na&&(h=t.valueBlock.value.length),0===h)return{verified:!0,result:e};if(0===t.valueBlock.value.length&&0!==r.valueBlock.value.length){for(var f=!0,m=0;m<r.valueBlock.value.length;m++)f=f&&(r.valueBlock.value[m].optional||!1);return f?{verified:!0,result:e}:(r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,ut),r.name&&delete e[r.name]),e.error="Inconsistent object length",{verified:!1,result:e})}for(var v=0;v<h;v++)if(v-l>=t.valueBlock.value.length){if(!1===r.valueBlock.value[v].optional){var d={verified:!1,result:e};return e.error="Inconsistent length between ASN.1 data and schema",r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,ut),r.name&&(delete e[r.name],d.name=r.name)),d}}else if(r.valueBlock.value[0]instanceof na){if(!1===(c=sa(e,t.valueBlock.value[v],r.valueBlock.value[0].value)).verified){if(!r.valueBlock.value[0].optional)return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,ut),r.name&&delete e[r.name]),c;l++}if(it in r.valueBlock.value[0]&&r.valueBlock.value[0].name.length>0){var g={};void 0===(g="local"in r.valueBlock.value[0]&&r.valueBlock.value[0].local?t:e)[r.valueBlock.value[0].name]&&(g[r.valueBlock.value[0].name]=[]),g[r.valueBlock.value[0].name].push(t.valueBlock.value[v])}}else if(!1===(c=sa(e,t.valueBlock.value[v-l],r.valueBlock.value[v])).verified){if(!r.valueBlock.value[v].optional)return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,ut),r.name&&delete e[r.name]),c;l++}if(!1===c.verified){var p={verified:!1,result:e};return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,ut),r.name&&(delete e[r.name],p.name=r.name)),p}return{verified:!0,result:e}}if(r.primitiveSchema&&st in t.valueBlock){var y=xt(t.valueBlock.valueHexView);if(-1===y.offset){var k={verified:!1,result:y.result};return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,ut),r.name&&(delete e[r.name],k.name=r.name)),k}return sa(e,y.result,r.primitiveSchema)}return{verified:!0,result:e}}var ua=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(i(this,e),"view"in t)this.fromUint8Array(t.view);else if("buffer"in t)this.fromArrayBuffer(t.buffer);else if("string"in t)this.fromString(t.string);else if("hexstring"in t)this.fromHexString(t.hexstring);else if("length"in t&&t.length>0){if(this.length=t.length,t.stub)for(var r=0;r<this._view.length;r++)this._view[r]=t.stub}else this.length=0}return o(e,[{key:"buffer",get:function(){return this._buffer},set:function(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}},{key:"view",get:function(){return this._view},set:function(e){this._buffer=new ArrayBuffer(e.length),this._view=new Uint8Array(this._buffer),this._view.set(e)}},{key:"length",get:function(){return this.view.byteLength},set:function(e){this._buffer=new ArrayBuffer(e),this._view=new Uint8Array(this._buffer)}},{key:"clear",value:function(){this._buffer=new ArrayBuffer(0),this._view=new Uint8Array(this._buffer)}},{key:"fromArrayBuffer",value:function(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}},{key:"fromUint8Array",value:function(e){this.fromArrayBuffer(new Uint8Array(e).buffer)}},{key:"fromString",value:function(e){var t=e.length;this.length=t;for(var r=0;r<t;r++)this.view[r]=e.charCodeAt(r)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.view.length-e,r="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(var a=e;a<e+t;a++)r+=String.fromCharCode(this.view[a]);return r}},{key:"fromHexString",value:function(e){var t=e.length;this.buffer=new ArrayBuffer(t>>1),this.view=new Uint8Array(this.buffer);var r=new Map;r.set("0",0),r.set("1",1),r.set("2",2),r.set("3",3),r.set("4",4),r.set("5",5),r.set("6",6),r.set("7",7),r.set("8",8),r.set("9",9),r.set("A",10),r.set("a",10),r.set("B",11),r.set("b",11),r.set("C",12),r.set("c",12),r.set("D",13),r.set("d",13),r.set("E",14),r.set("e",14),r.set("F",15),r.set("f",15);for(var a=0,n=0,i=0;i<t;i++)i%2?(n|=r.get(e.charAt(i)),this.view[a]=n,a++):n=r.get(e.charAt(i))<<4}},{key:"toHexString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.view.length-e,r="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(var a=e;a<e+t;a++){var n=this.view[a].toString(16).toUpperCase();r=r+(1==n.length?"0":"")+n}return r}},{key:"copy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.length-t;if(!t&&!this.length)return new e;if(t<0||t>this.length-1)throw new Error("Wrong start position: ".concat(t));var a=new e({buffer:this._buffer.slice(t,t+r)});return a}},{key:"slice",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.length;if(!t&&!this.length)return new e;if(t<0||t>this.length-1)throw new Error("Wrong start position: ".concat(t));var a=new e({buffer:this._buffer.slice(t,r)});return a}},{key:"realloc",value:function(e){var t=new ArrayBuffer(e),r=new Uint8Array(t);e>this._view.length?r.set(this._view):r.set(new Uint8Array(this._buffer,0,e)),this._buffer=t,this._view=new Uint8Array(this._buffer)}},{key:"append",value:function(e){var t=this.length,r=e.length,a=e._view.subarray();this.realloc(t+r),this._view.set(a,t)}},{key:"insert",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.length-t;return!(t>this.length-1)&&(r>this.length-t&&(r=this.length-t),r>e.length&&(r=e.length),r==e.length?this._view.set(e._view,t):this._view.set(e._view.subarray(0,r),t),!0)}},{key:"isEqual",value:function(e){if(this.length!=e.length)return!1;for(var t=0;t<e.length;t++)if(this.view[t]!=e.view[t])return!1;return!0}},{key:"isEqualView",value:function(e){if(e.length!=this.view.length)return!1;for(var t=0;t<e.length;t++)if(this.view[t]!=e[t])return!1;return!0}},{key:"findPattern",value:function(e,t,r,a){var n=this.prepareFindParameters(t,r,a),i=n.start,s=n.length,u=n.backward,o=e.length;if(o>s)return-1;for(var l=[],c=0;c<o;c++)l.push(e.view[c]);for(var h=0;h<=s-o;h++){for(var f=!0,m=u?i-o-h:i+h,v=0;v<o;v++)if(this.view[v+m]!=l[v]){f=!1;break}if(f)return u?i-o-h:i+o+h}return-1}},{key:"findFirstIn",value:function(e,t,r,a){for(var n=this.prepareFindParameters(t,r,a),i=n.start,s=n.length,u=n.backward,o={id:-1,position:u?0:i+s,length:0},l=0;l<e.length;l++){var c=this.findPattern(e[l],i,s,u);if(-1!=c){var h=!1,f=e[l].length;u?c-f>=o.position-o.length&&(h=!0):c-f<=o.position-o.length&&(h=!0),h&&(o.position=c,o.id=l,o.length=f)}}return o}},{key:"findAllIn",value:function(e,t,r){for(var a=this.prepareFindParameters(t,r),n=a.start,i=a.length,s=[],u={id:-1,position:n};;){var o=u.position;if(-1==(u=this.findFirstIn(e,u.position,i)).id)break;i-=u.position-o,s.push({id:u.id,position:u.position})}return s}},{key:"findAllPatternIn",value:function(e,t,r){var a=this.prepareFindParameters(t,r),n=a.start,i=a.length,s=[],u=e.length;if(u>i)return-1;for(var o=Array.from(e.view),l=0;l<=i-u;l++){for(var c=!0,h=n+l,f=0;f<u;f++)if(this.view[f+h]!=o[f]){c=!1;break}c&&(s.push(n+u+l),l+=u-1)}return s}},{key:"findFirstNotIn",value:function(t,r,a,n){for(var i=this.prepareFindParameters(r,a,n),s=i.start,u=i.length,o=i.backward,l={left:{id:-1,position:s},right:{id:-1,position:0},value:new e},c=u;c>0;){if(l.right=this.findFirstIn(t,o?s-u+c:s+u-c,c,o),-1==l.right.id){u=c,o?s-=u:s=l.left.position,l.value=new e({buffer:this._buffer.slice(s,s+u)});break}if(l.right.position!=(o?l.left.position-t[l.right.id].length:l.left.position+t[l.right.id].length)){o?(s=l.right.position+t[l.right.id].length,u=l.left.position-l.right.position-t[l.right.id].length):(s=l.left.position,u=l.right.position-l.left.position-t[l.right.id].length),l.value=new e({buffer:this._buffer.slice(s,s+u)});break}l.left=l.right,c-=t[l.right.id].length}if(o){var h=l.right;l.right=l.left,l.left=h}return l}},{key:"findAllNotIn",value:function(t,r,a){var n=this.prepareFindParameters(r,a),i=n.start,s=n.length,u=[],o={left:{id:-1,position:i},right:{id:-1,position:i},value:new e};do{var l=o.right.position;s-=(o=this.findFirstNotIn(t,o.right.position,s)).right.position-l,u.push({left:{id:o.left.id,position:o.left.position},right:{id:o.right.id,position:o.right.position},value:o.value})}while(-1!=o.right.id);return u}},{key:"findFirstSequence",value:function(t,r,a,n){var i=this.prepareFindParameters(r,a,n),s=i.start,u=i.length,o=i.backward,l=this.skipNotPatterns(t,s,u,o);if(-1==l)return{position:-1,value:new e};var c=this.skipPatterns(t,l,u-(o?s-l:l-s),o);return o?(s=c,u=l-c):(s=l,u=c-l),{position:c,value:new e({buffer:this._buffer.slice(s,s+u)})}}},{key:"findAllSequences",value:function(t,r,a){var n=this.prepareFindParameters(r,a),i=n.start,s=n.length,u=[],o={position:i,value:new e};do{var l=o.position;-1!=(o=this.findFirstSequence(t,o.position,s)).position&&(s-=o.position-l,u.push({position:o.position,value:o.value}))}while(-1!=o.position);return u}},{key:"findPairedPatterns",value:function(e,t,r,a){var n=[];if(e.isEqual(t))return n;var i=this.prepareFindParameters(r,a),s=i.start,u=i.length,o=0,l=this.findAllPatternIn(e,s,u);if(!Array.isArray(l)||0==l.length)return n;var c=this.findAllPatternIn(t,s,u);if(!Array.isArray(c)||0==c.length)return n;for(;o<l.length&&0!=c.length;)if(l[0]!=c[0]){if(l[o]>c[0])break;for(;l[o]<c[0]&&!(++o>=l.length););n.push({left:l[o-1],right:c[0]}),l.splice(o-1,1),c.splice(0,1),o=0}else n.push({left:l[0],right:c[0]}),l.splice(0,1),c.splice(0,1);return n.sort((function(e,t){return e.left-t.left})),n}},{key:"findPairedArrays",value:function(e,t,r,a){var n=this.prepareFindParameters(r,a),i=n.start,s=n.length,u=[],o=0,l=this.findAllIn(e,i,s);if(0==l.length)return u;var c=this.findAllIn(t,i,s);if(0==c.length)return u;for(;o<l.length&&0!=c.length;)if(l[0].position!=c[0].position){if(l[o].position>c[0].position)break;for(;l[o].position<c[0].position&&!(++o>=l.length););u.push({left:l[o-1],right:c[0]}),l.splice(o-1,1),c.splice(0,1),o=0}else u.push({left:l[0],right:c[0]}),l.splice(0,1),c.splice(0,1);return u.sort((function(e,t){return e.left.position-t.left.position})),u}},{key:"replacePattern",value:function(e,t,r,a){var n,i,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=[],o={status:-1,searchPatternPositions:[],replacePatternPositions:[]},l=this.prepareFindParameters(r,a),c=l.start,h=l.length;if(null==s){if(0==(u=this.findAllIn([e],c,h)).length)return o}else u=s;(n=o.searchPatternPositions).push.apply(n,N(Array.from(u,(function(e){return e.position}))));var f=e.length-t.length,m=new ArrayBuffer(this.view.length-u.length*f),v=new Uint8Array(m);for(v.set(new Uint8Array(this.buffer,0,c)),i=0;i<u.length;i++){var d=0==i?c:u[i-1].position;v.set(new Uint8Array(this.buffer,d,u[i].position-e.length-d),d-i*f),v.set(t.view,u[i].position-e.length-i*f),o.replacePatternPositions.push(u[i].position-e.length-i*f)}return i--,v.set(new Uint8Array(this.buffer,u[i].position,this.length-u[i].position),u[i].position-e.length+t.length-i*f),this.buffer=m,this.view=new Uint8Array(this.buffer),o.status=1,o}},{key:"skipPatterns",value:function(e,t,r,a){for(var n=this.prepareFindParameters(t,r,a),i=n.start,s=n.length,u=n.backward,o=i,l=0;l<e.length;l++){for(var c=e[l].length,h=u?o-c:o,f=!0,m=0;m<c;m++)if(this.view[m+h]!=e[l].view[m]){f=!1;break}if(f)if(l=-1,u){if((o-=c)<=0)return o}else if((o+=c)>=i+s)return o}return o}},{key:"skipNotPatterns",value:function(e,t,r,a){for(var n=this.prepareFindParameters(t,r,a),i=n.start,s=n.length,u=n.backward,o=-1,l=0;l<s;l++){for(var c=0;c<e.length;c++){for(var h=e[c].length,f=u?i-l-h:i+l,m=!0,v=0;v<h;v++)if(this.view[v+f]!=e[c].view[v]){m=!1;break}if(m){o=u?i-l:i+l;break}}if(-1!=o)break}return o}},{key:"prepareFindParameters",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return null===e&&(e=r?this.length:0),e>this.length&&(e=this.length),r?(null===t&&(t=e),t>e&&(t=e)):(null===t&&(t=this.length-e),t>this.length-e&&(t=this.length-e)),{start:e,length:t,backward:r}}}])}(),oa=16777216,la=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e),this._stream=new ua,this._length=0,this._start=0,this.backward=!1,this.appendBlock=0,this.prevLength=0,this.prevStart=0,this.stream="view"in t?new ua({view:t.view}):"buffer"in t?new ua({buffer:t.buffer}):"string"in t?new ua({string:t.string}):"hexstring"in t?new ua({hexstring:t.hexstring}):"stream"in t?t.stream.slice():new ua,"backward"in t&&t.backward&&(this.backward=t.backward,this._start=this.stream.length),"length"in t&&t.length>0&&(this._length=t.length),"start"in t&&t.start&&t.start>0&&(this._start=t.start),"appendBlock"in t&&t.appendBlock&&t.appendBlock>0&&(this.appendBlock=t.appendBlock)}return o(e,[{key:"stream",get:function(){return this._stream},set:function(e){this._stream=e,this.prevLength=this._length,this._length=e.length,this.prevStart=this._start,this._start=0}},{key:"length",get:function(){return this.appendBlock?this.start:this._length},set:function(e){this.prevLength=this._length,this._length=e}},{key:"start",get:function(){return this._start},set:function(e){e>this.stream.length||(this.prevStart=this._start,this.prevLength=this._length,this._length-=this.backward?this._start-e:e-this._start,this._start=e)}},{key:"buffer",get:function(){return this._stream.buffer.slice(0,this._length)}},{key:"resetPosition",value:function(){this._start=this.prevStart,this._length=this.prevLength}},{key:"findPattern",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(null==t||t>this.length)&&(t=this.length);var r=this.stream.findPattern(e,this.start,this.length,this.backward);if(-1==r)return r;if(this.backward){if(r<this.start-e.length-t)return-1}else if(r>this.start+e.length+t)return-1;return this.start=r,r}},{key:"findFirstIn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(null==t||t>this.length)&&(t=this.length);var r=this.stream.findFirstIn(e,this.start,this.length,this.backward);if(-1==r.id)return r;if(this.backward){if(r.position<this.start-e[r.id].length-t)return{id:-1,position:this.backward?0:this.start+this.length}}else if(r.position>this.start+e[r.id].length+t)return{id:-1,position:this.backward?0:this.start+this.length};return this.start=r.position,r}},{key:"findAllIn",value:function(e){var t=this.backward?this.start-this.length:this.start;return this.stream.findAllIn(e,t,this.length)}},{key:"findFirstNotIn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(null==t||t>this._length)&&(t=this._length);var r=this._stream.findFirstNotIn(e,this._start,this._length,this.backward);if(-1==r.left.id&&-1==r.right.id)return r;if(this.backward){if(-1!=r.right.id&&r.right.position<this._start-e[r.right.id].length-t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new ua}}else if(-1!=r.left.id&&r.left.position>this._start+e[r.left.id].length+t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new ua};return this.backward?-1==r.left.id?this.start=0:this.start=r.left.position:-1==r.right.id?this.start=this._start+this._length:this.start=r.right.position,r}},{key:"findAllNotIn",value:function(e){var t=this.backward?this._start-this._length:this._start;return this._stream.findAllNotIn(e,t,this._length)}},{key:"findFirstSequence",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(null==t||t>this._length)&&(t=this._length),(null==r||r>t)&&(r=t);var a=this._stream.findFirstSequence(e,this._start,t,this.backward);if(0==a.value.length)return a;if(this.backward){if(a.position<this._start-a.value.length-r)return{position:-1,value:new ua}}else if(a.position>this._start+a.value.length+r)return{position:-1,value:new ua};return this.start=a.position,a}},{key:"findAllSequences",value:function(e){var t=this.backward?this.start-this.length:this.start;return this.stream.findAllSequences(e,t,this.length)}},{key:"findPairedPatterns",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(null==r||r>this.length)&&(r=this.length);var a=this.backward?this.start-this.length:this.start,n=this.stream.findPairedPatterns(e,t,a,this.length);if(n.length)if(this.backward){if(n[0].right<this.start-t.length-r)return[]}else if(n[0].left>this.start+e.length+r)return[];return n}},{key:"findPairedArrays",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(null==r||r>this.length)&&(r=this.length);var a=this.backward?this.start-this.length:this.start,n=this.stream.findPairedArrays(e,t,a,this.length);if(n.length)if(this.backward){if(n[0].right.position<this.start-t[n[0].right.id].length-r)return[]}else if(n[0].left.position>this.start+e[n[0].left.id].length+r)return[];return n}},{key:"replacePattern",value:function(e,t){var r=this.backward?this.start-this.length:this.start;return this.stream.replacePattern(e,t,r,this.length)}},{key:"skipPatterns",value:function(e){var t=this.stream.skipPatterns(e,this.start,this.length,this.backward);return this.start=t,t}},{key:"skipNotPatterns",value:function(e){var t=this.stream.skipNotPatterns(e,this.start,this.length,this.backward);return-1==t?-1:(this.start=t,t)}},{key:"append",value:function(e){this.beforeAppend(e.length),this._stream.view.set(e.view,this._start),this._length+=2*e.length,this.start=this._start+e.length,this.prevLength-=2*e.length}},{key:"appendView",value:function(e){this.beforeAppend(e.length),this._stream.view.set(e,this._start),this._length+=2*e.length,this.start=this._start+e.length,this.prevLength-=2*e.length}},{key:"appendChar",value:function(e){this.beforeAppend(1),this._stream.view[this._start]=e,this._length+=2,this.start=this._start+1,this.prevLength-=2}},{key:"appendUint16",value:function(e){this.beforeAppend(2);var t=new Uint16Array([e]),r=new Uint8Array(t.buffer);this.stream.view[this._start]=r[1],this._stream.view[this._start+1]=r[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}},{key:"appendUint24",value:function(e){this.beforeAppend(3);var t=new Uint32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[2],this._stream.view[this._start+1]=r[1],this._stream.view[this._start+2]=r[0],this._length+=6,this.start=this._start+3,this.prevLength-=6}},{key:"appendUint32",value:function(e){this.beforeAppend(4);var t=new Uint32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[3],this._stream.view[this._start+1]=r[2],this._stream.view[this._start+2]=r[1],this._stream.view[this._start+3]=r[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}},{key:"appendInt16",value:function(e){this.beforeAppend(2);var t=new Int16Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[1],this._stream.view[this._start+1]=r[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}},{key:"appendInt32",value:function(e){this.beforeAppend(4);var t=new Int32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[3],this._stream.view[this._start+1]=r[2],this._stream.view[this._start+2]=r[1],this._stream.view[this._start+3]=r[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}},{key:"getBlock",value:function(e){var t,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this._length<=0)return new Uint8Array(0);if(this._length<e&&(e=this._length),this.backward){var a=this._stream.view.subarray(this._length-e,this._length);t=new Uint8Array(e);for(var n=0;n<e;n++)t[e-1-n]=a[n]}else t=this._stream.view.subarray(this._start,this._start+e);return r&&(this.start+=this.backward?-1*e:e),t}},{key:"getUint16",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.getBlock(2,e);return t.length<2?0:t[0]<<8|t[1]}},{key:"getInt16",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.getUint16(e),r=32768;return t&r?-(r-(t^r)):t}},{key:"getUint24",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.getBlock(4,e);return t.length<3?0:t[0]<<16|t[1]<<8|t[2]}},{key:"getUint32",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.getBlock(4,e);return t.length<4?0:t[0]*oa+(t[1]<<16)+(t[2]<<8)+t[3]}},{key:"getInt32",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.getUint32(e),r=2147483648;return t&r?-(r-(t^r)):t}},{key:"beforeAppend",value:function(t){this._start+t>this._stream.length&&(t>this.appendBlock&&(this.appendBlock=t+e.APPEND_BLOCK),this._stream.realloc(this._stream.length+this.appendBlock))}}])}();function ca(e){return e instanceof Uint8Array||null!=e&&"object"===x(e)&&"Uint8Array"===e.constructor.name}function ha(e){if(!ca(e))throw new Error("Uint8Array expected");for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];if(r.length>0&&!r.includes(e.length))throw new Error("Uint8Array expected of length ".concat(r,", not of length=").concat(e.length))}function fa(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}la.APPEND_BLOCK=1e3;var ma=function(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)},va=function(e,t){return e<<32-t|e>>>t},da=function(e,t){return e<<t|e>>>32-t>>>0};function ga(e){return"string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got ".concat(x(e)));return new Uint8Array((new TextEncoder).encode(e))}(e)),ha(e),e}new Uint8Array(new Uint32Array([287454020]).buffer)[0];var pa=o((function e(){i(this,e)}),[{key:"clone",value:function(){return this._cloneInto()}}]);function ya(e){var t=function(t){return e().update(ga(t)).digest()},r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=function(){return e()},t}var ka=function(e,t,r){return e&t^~e&r},wa=function(e,t,r){return e&t^e&r^t&r},ba=function(e){function t(e,r,a,s){var u;return i(this,t),(u=n(this,t)).blockLen=e,u.outputLen=r,u.padOffset=a,u.isLE=s,u.finished=!1,u.length=0,u.pos=0,u.destroyed=!1,u.buffer=new Uint8Array(e),u.view=ma(u.buffer),u}return m(t,e),o(t,[{key:"update",value:function(e){fa(this);for(var t=this.view,r=this.buffer,a=this.blockLen,n=(e=ga(e)).length,i=0;i<n;){var s=Math.min(a-this.pos,n-i);if(s!==a)r.set(e.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===a&&(this.process(t,0),this.pos=0);else for(var u=ma(e);a<=n-i;i+=a)this.process(u,i)}return this.length+=e.length,this.roundClean(),this}},{key:"digestInto",value:function(e){fa(this),function(e,t){ha(e);var r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least ".concat(r))}(e,this),this.finished=!0;var t=this.buffer,r=this.view,a=this.blockLen,n=this.isLE,i=this.pos;t[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>a-i&&(this.process(r,0),i=0);for(var s=i;s<a;s++)t[s]=0;!function(e,t,r,a){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,a);var n=BigInt(32),i=BigInt(4294967295),s=Number(r>>n&i),u=Number(r&i),o=a?4:0,l=a?0:4;e.setUint32(t+o,s,a),e.setUint32(t+l,u,a)}(r,a-8,BigInt(8*this.length),n),this.process(r,0);var u=ma(e),o=this.outputLen;if(o%4)throw new Error("_sha2: outputLen should be aligned to 32bit");var l=o/4,c=this.get();if(l>c.length)throw new Error("_sha2: outputLen bigger than state");for(var h=0;h<l;h++)u.setUint32(4*h,c[h],n)}},{key:"digest",value:function(){var e=this.buffer,t=this.outputLen;this.digestInto(e);var r=e.slice(0,t);return this.destroy(),r}},{key:"_cloneInto",value:function(e){var t;e||(e=new this.constructor),(t=e).set.apply(t,N(this.get()));var r=this.blockLen,a=this.buffer,n=this.length,i=this.finished,s=this.destroyed,u=this.pos;return e.length=n,e.pos=u,e.finished=i,e.destroyed=s,n%r&&e.buffer.set(a),e}}])}(pa),Sa=new Uint32Array([1732584193,4023233417,2562383102,271733878,3285377520]),Aa=new Uint32Array(80),Na=function(e){function t(){var e;return i(this,t),(e=n(this,t,[64,20,8,!1])).A=0|Sa[0],e.B=0|Sa[1],e.C=0|Sa[2],e.D=0|Sa[3],e.E=0|Sa[4],e}return m(t,e),o(t,[{key:"get",value:function(){return[this.A,this.B,this.C,this.D,this.E]}},{key:"set",value:function(e,t,r,a,n){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|a,this.E=0|n}},{key:"process",value:function(e,t){for(var r=0;r<16;r++,t+=4)Aa[r]=e.getUint32(t,!1);for(var a=16;a<80;a++)Aa[a]=da(Aa[a-3]^Aa[a-8]^Aa[a-14]^Aa[a-16],1);for(var n=this.A,i=this.B,s=this.C,u=this.D,o=this.E,l=0;l<80;l++){var c=void 0,h=void 0;l<20?(c=ka(i,s,u),h=1518500249):l<40?(c=i^s^u,h=1859775393):l<60?(c=wa(i,s,u),h=2400959708):(c=i^s^u,h=3395469782);var f=da(n,5)+c+o+h+Aa[l]|0;o=u,u=s,s=da(i,30),i=n,n=f}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,u=u+this.D|0,o=o+this.E|0,this.set(n,i,s,u,o)}},{key:"roundClean",value:function(){Aa.fill(0)}},{key:"destroy",value:function(){this.set(0,0,0,0,0),this.buffer.fill(0)}}])}(ba),Ca=ya((function(){return new Na})),xa=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ea=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ia=new Uint32Array(64),Ba=function(e){function t(){var e;return i(this,t),(e=n(this,t,[64,32,8,!1])).A=0|Ea[0],e.B=0|Ea[1],e.C=0|Ea[2],e.D=0|Ea[3],e.E=0|Ea[4],e.F=0|Ea[5],e.G=0|Ea[6],e.H=0|Ea[7],e}return m(t,e),o(t,[{key:"get",value:function(){return[this.A,this.B,this.C,this.D,this.E,this.F,this.G,this.H]}},{key:"set",value:function(e,t,r,a,n,i,s,u){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|a,this.E=0|n,this.F=0|i,this.G=0|s,this.H=0|u}},{key:"process",value:function(e,t){for(var r=0;r<16;r++,t+=4)Ia[r]=e.getUint32(t,!1);for(var a=16;a<64;a++){var n=Ia[a-15],i=Ia[a-2],s=va(n,7)^va(n,18)^n>>>3,u=va(i,17)^va(i,19)^i>>>10;Ia[a]=u+Ia[a-7]+s+Ia[a-16]|0}for(var o=this.A,l=this.B,c=this.C,h=this.D,f=this.E,m=this.F,v=this.G,d=this.H,g=0;g<64;g++){var p=d+(va(f,6)^va(f,11)^va(f,25))+ka(f,m,v)+xa[g]+Ia[g]|0,y=(va(o,2)^va(o,13)^va(o,22))+wa(o,l,c)|0;d=v,v=m,m=f,f=h+p|0,h=c,c=l,l=o,o=p+y|0}o=o+this.A|0,l=l+this.B|0,c=c+this.C|0,h=h+this.D|0,f=f+this.E|0,m=m+this.F|0,v=v+this.G|0,d=d+this.H|0,this.set(o,l,c,h,f,m,v,d)}},{key:"roundClean",value:function(){Ia.fill(0)}},{key:"destroy",value:function(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}])}(ba),Va=ya((function(){return new Ba})),Da=BigInt(Math.pow(2,32)-1),Pa=BigInt(32);function Oa(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?{h:Number(e&Da),l:Number(e>>Pa&Da)}:{h:0|Number(e>>Pa&Da),l:0|Number(e&Da)}}var Ra={fromBig:Oa,split:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=new Uint32Array(e.length),a=new Uint32Array(e.length),n=0;n<e.length;n++){var i=Oa(e[n],t),s=i.h,u=i.l,o=[s,u];r[n]=o[0],a[n]=o[1]}return[r,a]},toBig:function(e,t){return BigInt(e>>>0)<<Pa|BigInt(t>>>0)},shrSH:function(e,t,r){return e>>>r},shrSL:function(e,t,r){return e<<32-r|t>>>r},rotrSH:function(e,t,r){return e>>>r|t<<32-r},rotrSL:function(e,t,r){return e<<32-r|t>>>r},rotrBH:function(e,t,r){return e<<64-r|t>>>r-32},rotrBL:function(e,t,r){return e>>>r-32|t<<64-r},rotr32H:function(e,t){return t},rotr32L:function(e,t){return e},rotlSH:function(e,t,r){return e<<r|t>>>32-r},rotlSL:function(e,t,r){return t<<r|e>>>32-r},rotlBH:function(e,t,r){return t<<r-32|e>>>64-r},rotlBL:function(e,t,r){return e<<r-32|t>>>64-r},add:function(e,t,r,a){var n=(t>>>0)+(a>>>0);return{h:e+r+(n/Math.pow(2,32)|0)|0,l:0|n}},add3L:function(e,t,r){return(e>>>0)+(t>>>0)+(r>>>0)},add3H:function(e,t,r,a){return t+r+a+(e/Math.pow(2,32)|0)|0},add4L:function(e,t,r,a){return(e>>>0)+(t>>>0)+(r>>>0)+(a>>>0)},add4H:function(e,t,r,a,n){return t+r+a+n+(e/Math.pow(2,32)|0)|0},add5H:function(e,t,r,a,n,i){return t+r+a+n+i+(e/Math.pow(2,32)|0)|0},add5L:function(e,t,r,a,n){return(e>>>0)+(t>>>0)+(r>>>0)+(a>>>0)+(n>>>0)}},Ua=Ra,La=b(Ua.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map((function(e){return BigInt(e)}))),2),Ta=La[0],Ha=La[1],Ma=new Uint32Array(80),Ka=new Uint32Array(80),_a=function(e){function t(){var e;return i(this,t),(e=n(this,t,[128,64,16,!1])).Ah=1779033703,e.Al=-205731576,e.Bh=-1150833019,e.Bl=-2067093701,e.Ch=1013904242,e.Cl=-23791573,e.Dh=-1521486534,e.Dl=1595750129,e.Eh=1359893119,e.El=-1377402159,e.Fh=-1694144372,e.Fl=725511199,e.Gh=528734635,e.Gl=-79577749,e.Hh=1541459225,e.Hl=327033209,e}return m(t,e),o(t,[{key:"get",value:function(){return[this.Ah,this.Al,this.Bh,this.Bl,this.Ch,this.Cl,this.Dh,this.Dl,this.Eh,this.El,this.Fh,this.Fl,this.Gh,this.Gl,this.Hh,this.Hl]}},{key:"set",value:function(e,t,r,a,n,i,s,u,o,l,c,h,f,m,v,d){this.Ah=0|e,this.Al=0|t,this.Bh=0|r,this.Bl=0|a,this.Ch=0|n,this.Cl=0|i,this.Dh=0|s,this.Dl=0|u,this.Eh=0|o,this.El=0|l,this.Fh=0|c,this.Fl=0|h,this.Gh=0|f,this.Gl=0|m,this.Hh=0|v,this.Hl=0|d}},{key:"process",value:function(e,t){for(var r=0;r<16;r++,t+=4)Ma[r]=e.getUint32(t),Ka[r]=e.getUint32(t+=4);for(var a=16;a<80;a++){var n=0|Ma[a-15],i=0|Ka[a-15],s=Ua.rotrSH(n,i,1)^Ua.rotrSH(n,i,8)^Ua.shrSH(n,i,7),u=Ua.rotrSL(n,i,1)^Ua.rotrSL(n,i,8)^Ua.shrSL(n,i,7),o=0|Ma[a-2],l=0|Ka[a-2],c=Ua.rotrSH(o,l,19)^Ua.rotrBH(o,l,61)^Ua.shrSH(o,l,6),h=Ua.rotrSL(o,l,19)^Ua.rotrBL(o,l,61)^Ua.shrSL(o,l,6),f=Ua.add4L(u,h,Ka[a-7],Ka[a-16]),m=Ua.add4H(f,s,c,Ma[a-7],Ma[a-16]);Ma[a]=0|m,Ka[a]=0|f}for(var v=this.Ah,d=this.Al,g=this.Bh,p=this.Bl,y=this.Ch,k=this.Cl,w=this.Dh,b=this.Dl,S=this.Eh,A=this.El,N=this.Fh,C=this.Fl,x=this.Gh,E=this.Gl,I=this.Hh,B=this.Hl,V=0;V<80;V++){var D=Ua.rotrSH(S,A,14)^Ua.rotrSH(S,A,18)^Ua.rotrBH(S,A,41),P=Ua.rotrSL(S,A,14)^Ua.rotrSL(S,A,18)^Ua.rotrBL(S,A,41),O=S&N^~S&x,R=A&C^~A&E,U=Ua.add5L(B,P,R,Ha[V],Ka[V]),L=Ua.add5H(U,I,D,O,Ta[V],Ma[V]),T=0|U,H=Ua.rotrSH(v,d,28)^Ua.rotrBH(v,d,34)^Ua.rotrBH(v,d,39),M=Ua.rotrSL(v,d,28)^Ua.rotrBL(v,d,34)^Ua.rotrBL(v,d,39),K=v&g^v&y^g&y,_=d&p^d&k^p&k;I=0|x,B=0|E,x=0|N,E=0|C,N=0|S,C=0|A;var j=Ua.add(0|w,0|b,0|L,0|T);S=j.h,A=j.l,w=0|y,b=0|k,y=0|g,k=0|p,g=0|v,p=0|d;var J=Ua.add3L(T,M,_);v=Ua.add3H(J,L,H,K),d=0|J}var F=Ua.add(0|this.Ah,0|this.Al,0|v,0|d);v=F.h,d=F.l;var q=Ua.add(0|this.Bh,0|this.Bl,0|g,0|p);g=q.h,p=q.l;var X=Ua.add(0|this.Ch,0|this.Cl,0|y,0|k);y=X.h,k=X.l;var G=Ua.add(0|this.Dh,0|this.Dl,0|w,0|b);w=G.h,b=G.l;var W=Ua.add(0|this.Eh,0|this.El,0|S,0|A);S=W.h,A=W.l;var z=Ua.add(0|this.Fh,0|this.Fl,0|N,0|C);N=z.h,C=z.l;var Y=Ua.add(0|this.Gh,0|this.Gl,0|x,0|E);x=Y.h,E=Y.l;var Q=Ua.add(0|this.Hh,0|this.Hl,0|I,0|B);I=Q.h,B=Q.l,this.set(v,d,g,p,y,k,w,b,S,A,N,C,x,E,I,B)}},{key:"roundClean",value:function(){Ma.fill(0),Ka.fill(0)}},{key:"destroy",value:function(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}])}(ba),ja=function(e){function t(){var e;return i(this,t),(e=n(this,t)).Ah=-876896931,e.Al=-1056596264,e.Bh=1654270250,e.Bl=914150663,e.Ch=-1856437926,e.Cl=812702999,e.Dh=355462360,e.Dl=-150054599,e.Eh=1731405415,e.El=-4191439,e.Fh=-1900787065,e.Fl=1750603025,e.Gh=-619958771,e.Gl=1694076839,e.Hh=1203062813,e.Hl=-1090891868,e.outputLen=48,e}return m(t,e),o(t)}(_a),Ja=ya((function(){return new _a})),Fa=ya((function(){return new ja})),qa=new ArrayBuffer(0),Xa="",Ga=function(e){function t(){var e;return i(this,t),(e=n(this,t,arguments)).name=t.NAME,e}return m(t,e),o(t,null,[{key:"isType",value:function(e,t){if("string"==typeof t){if("Array"===t&&Array.isArray(e))return!0;if("ArrayBuffer"===t&&e instanceof ArrayBuffer)return!0;if("ArrayBufferView"===t&&ArrayBuffer.isView(e))return!0;if(x(e)===t)return!0}else if(e instanceof t)return!0;return!1}},{key:"assert",value:function(e,r){for(var a=arguments.length,n=new Array(a>2?a-2:0),i=2;i<a;i++)n[i-2]=arguments[i];for(var s=0,u=n;s<u.length;s++){var o=u[s];if(this.isType(e,o))return}var l=n.map((function(e){return e instanceof Function&&"name"in e?e.name:"".concat(e)}));throw new t("Parameter '".concat(r,"' is not of type ").concat(l.length>1?"(".concat(l.join(" or "),")"):l[0]))}}])}(I(TypeError));Ga.NAME="ArgumentError";var Wa=function(e){function t(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2?arguments[2]:void 0;return i(this,t),(r=n(this,t)).name=t.NAME,r.field=e,a&&(r.target=a),r.message=s||"Absent mandatory parameter '".concat(e,"' ").concat(a?" in '".concat(a,"'"):Xa),r}return m(t,e),o(t,null,[{key:"assert",value:function(){for(var e,r,a=null,n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];"string"==typeof i[0]?(a=i[0],e=i[1],r=i.slice(2)):(e=i[0],r=i.slice(1)),Ga.assert(e,"parameters","object");var u,o=l(r);try{for(o.s();!(u=o.n()).done;){var c=u.value,h=e[c];if(null==h)throw new t(c,a)}}catch(e){o.e(e)}finally{o.f()}}},{key:"assertEmpty",value:function(e,r,a){if(null==e)throw new t(r,a)}}])}(I(TypeError));Wa.NAME="ParameterError";var za=function(e){function t(e){var r;return i(this,t),(r=n(this,t,[e])).name="AsnError",r}return m(t,e),o(t,null,[{key:"assertSchema",value:function(e,t){if(!e.verified)throw new Error("Object's schema was not verified against input data for ".concat(t))}},{key:"assert",value:function(e,r){if(-1===e.offset)throw new t("Error during parsing of ASN.1 data. Data is not correct for '".concat(r,"'."))}}])}(I(Error)),Ya=o((function e(){i(this,e)}),[{key:"className",get:function(){return this.constructor.CLASS_NAME}},{key:"toString",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"hex";try{e=this.toSchema()}catch(t){e=this.toSchema(!0)}return Ue.ToString(e.toBER(),t)}}],[{key:"blockName",value:function(){return this.CLASS_NAME}},{key:"fromBER",value:function(e){var t=Et(e);za.assert(t,this.name);try{return new this({schema:t.result})}catch(e){throw new za("Cannot create '".concat(this.CLASS_NAME,"' from ASN.1 object"))}}},{key:"defaultValues",value:function(e){throw new Error("Invalid member name for ".concat(this.CLASS_NAME," class: ").concat(e))}},{key:"schema",value:function(){throw new Error("Method '".concat(this.CLASS_NAME,".schema' should be overridden"))}}]);function Qa(e){for(var t=!1,r=Xa,a=e.trim(),n=0;n<a.length;n++)32===a.charCodeAt(n)?!1===t&&(t=!0):(t&&(r+=" ",t=!1),r+=a[n]);return r.toLowerCase()}Ya.CLASS_NAME="PkiObject";var Za="type",$a="value",en=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).type=Le(r,Za,t.defaultValues(Za)),e.value=Le(r,$a,t.defaultValues($a)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,[Za,"typeValue"]);var r=sa(e,e,t.schema({names:{type:Za,value:"typeValue"}}));za.assertSchema(r,this.className),this.type=r.result.type.valueBlock.toString(),this.value=r.result.typeValue}},{key:"toSchema",value:function(){return new cr({value:[new ar({value:this.type}),this.value]})}},{key:"toJSON",value:function(){var e={type:this.type};return 0!==Object.keys(this.value).length?e.value=this.value.toJSON():e.value=this.value,e}},{key:"isEqual",value:function(e){var r=[pr.blockName(),wr.blockName(),Nr.blockName(),xr.blockName(),Ir.blockName(),Vr.blockName(),Pr.blockName(),Rr.blockName(),Lr.blockName(),Hr.blockName(),Kr.blockName(),jr.blockName()];if(e instanceof ArrayBuffer)return Ie.isEqual(this.value.valueBeforeDecodeView,e);if(e.constructor.blockName()===t.blockName()){if(this.type!==e.type)return!1;var a,n=[!1,!1],i=this.value.constructor.blockName(),s=l(r);try{for(s.s();!(a=s.n()).done;){var u=a.value;i===u&&(n[0]=!0),e.value.constructor.blockName()===u&&(n[1]=!0)}}catch(e){s.e(e)}finally{s.f()}if(n[0]!==n[1])return!1;if(n[0]&&n[1]){var o=Qa(this.value.valueBlock.value),c=Qa(e.value.valueBlock.value);if(0!==o.localeCompare(c))return!1}else if(!Ie.isEqual(this.value.valueBeforeDecodeView,e.value.valueBeforeDecodeView))return!1;return!0}return!1}}],[{key:"defaultValues",value:function(e){switch(e){case Za:return Xa;case $a:return{};default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new ar({name:t.type||Xa}),new ra({name:t.value||Xa})]})}}])}(Ya);en.CLASS_NAME="AttributeTypeAndValue";var tn="typesAndValues",rn="valueBeforeDecode",an=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).typesAndValues=Le(r,tn,t.defaultValues(tn)),e.valueBeforeDecode=Le(r,rn,t.defaultValues(rn)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,["RDN",tn]);var r=sa(e,e,t.schema({names:{blockName:"RDN",repeatedSet:tn}}));za.assertSchema(r,this.className),tn in r.result&&(this.typesAndValues=Array.from(r.result.typesAndValues,(function(e){return new en({schema:e})}))),this.valueBeforeDecode=r.result.RDN.valueBeforeDecodeView.slice().buffer}},{key:"toSchema",value:function(){if(0===this.valueBeforeDecode.byteLength)return new cr({value:[new hr({value:Array.from(this.typesAndValues,(function(e){return e.toSchema()}))})]});var e=Et(this.valueBeforeDecode);if(za.assert(e,"RelativeDistinguishedNames"),!(e.result instanceof cr))throw new Error("ASN.1 result should be SEQUENCE");return e.result}},{key:"toJSON",value:function(){return{typesAndValues:Array.from(this.typesAndValues,(function(e){return e.toJSON()}))}}},{key:"isEqual",value:function(e){if(e instanceof t){if(this.typesAndValues.length!==e.typesAndValues.length)return!1;var r,a=l(this.typesAndValues.entries());try{for(a.s();!(r=a.n()).done;){var n=b(r.value,2),i=n[0];if(!1===n[1].isEqual(e.typesAndValues[i]))return!1}}catch(e){a.e(e)}finally{a.f()}return!0}return e instanceof ArrayBuffer&&Je(this.valueBeforeDecode,e)}}],[{key:"defaultValues",value:function(e){switch(e){case tn:return[];case rn:return qa;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case tn:return 0===r.length;case rn:return 0===r.byteLength;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new na({name:t.repeatedSequence||Xa,value:new hr({value:[new na({name:t.repeatedSet||Xa,value:en.schema(t.typeAndValue||{})})]})})]})}}])}(Ya);an.CLASS_NAME="RelativeDistinguishedNames";var nn="type",sn="value";function un(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Le(e,"names",{});return new cr({optional:t,value:[new Vt({optional:!0,idBlock:{tagClass:2,tagNumber:1},name:r.country_name||Xa,value:[new aa({value:[new xr,new Ir]})]}),new Vt({optional:!0,idBlock:{tagClass:2,tagNumber:2},name:r.administration_domain_name||Xa,value:[new aa({value:[new xr,new Ir]})]}),new Nt({optional:!0,idBlock:{tagClass:3,tagNumber:0},name:r.network_address||Xa,isHexOnly:!0}),new Nt({optional:!0,idBlock:{tagClass:3,tagNumber:1},name:r.terminal_identifier||Xa,isHexOnly:!0}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:2},name:r.private_domain_name||Xa,value:[new aa({value:[new xr,new Ir]})]}),new Nt({optional:!0,idBlock:{tagClass:3,tagNumber:3},name:r.organization_name||Xa,isHexOnly:!0}),new Nt({optional:!0,name:r.numeric_user_identifier||Xa,idBlock:{tagClass:3,tagNumber:4},isHexOnly:!0}),new Vt({optional:!0,name:r.personal_name||Xa,idBlock:{tagClass:3,tagNumber:5},value:[new Nt({idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new Nt({optional:!0,idBlock:{tagClass:3,tagNumber:1},isHexOnly:!0}),new Nt({optional:!0,idBlock:{tagClass:3,tagNumber:2},isHexOnly:!0}),new Nt({optional:!0,idBlock:{tagClass:3,tagNumber:3},isHexOnly:!0})]}),new Vt({optional:!0,name:r.organizational_unit_names||Xa,idBlock:{tagClass:3,tagNumber:6},value:[new na({value:new Ir})]})]})}function on(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new cr({optional:e,value:[new Ir,new Ir]})}function ln(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new hr({optional:e,value:[new Nt({optional:!0,idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ra]})]})}var cn=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).type=Le(r,nn,t.defaultValues(nn)),e.value=Le(r,sn,t.defaultValues(sn)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,["blockName","otherName","rfc822Name","dNSName","x400Address","directoryName","ediPartyName","uniformResourceIdentifier","iPAddress","registeredID"]);var r=sa(e,e,t.schema({names:{blockName:"blockName",otherName:"otherName",rfc822Name:"rfc822Name",dNSName:"dNSName",x400Address:"x400Address",directoryName:{names:{blockName:"directoryName"}},ediPartyName:"ediPartyName",uniformResourceIdentifier:"uniformResourceIdentifier",iPAddress:"iPAddress",registeredID:"registeredID"}}));switch(za.assertSchema(r,this.className),this.type=r.result.blockName.idBlock.tagNumber,this.type){case 0:case 3:this.value=r.result.blockName;break;case 1:case 2:case 6:var a=r.result.blockName;a.idBlock.tagClass=1,a.idBlock.tagNumber=22;var n=Et(a.toBER(!1));za.assert(n,"GeneralName value"),this.value=n.result.valueBlock.value;break;case 4:this.value=new an({schema:r.result.directoryName});break;case 5:this.value=r.result.ediPartyName;break;case 7:this.value=new _t({valueHex:r.result.blockName.valueBlock.valueHex});break;case 8:var i=r.result.blockName;i.idBlock.tagClass=1,i.idBlock.tagNumber=6;var s=Et(i.toBER(!1));za.assert(s,"GeneralName registeredID"),this.value=s.result.valueBlock.toString()}}},{key:"toSchema",value:function(){switch(this.type){case 0:case 3:case 5:return new Vt({idBlock:{tagClass:3,tagNumber:this.type},value:[this.value]});case 1:case 2:case 6:var e=new Rr({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e;case 4:return new Vt({idBlock:{tagClass:3,tagNumber:4},value:[this.value.toSchema()]});case 7:var r=this.value;return r.idBlock.tagClass=3,r.idBlock.tagNumber=this.type,r;case 8:var a=new ar({value:this.value});return a.idBlock.tagClass=3,a.idBlock.tagNumber=this.type,a;default:return t.schema()}}},{key:"toJSON",value:function(){var e={type:this.type,value:Xa};if("string"==typeof this.value)e.value=this.value;else try{e.value=this.value.toJSON()}catch(e){}return e}}],[{key:"defaultValues",value:function(e){switch(e){case nn:return 9;case sn:return{};default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case nn:return r===t.defaultValues(e);case sn:return 0===Object.keys(r).length;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new aa({value:[new Vt({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||Xa,value:[new ar,new Vt({idBlock:{tagClass:3,tagNumber:0},value:[new ra]})]}),new Nt({name:t.blockName||Xa,idBlock:{tagClass:3,tagNumber:1}}),new Nt({name:t.blockName||Xa,idBlock:{tagClass:3,tagNumber:2}}),new Vt({idBlock:{tagClass:3,tagNumber:3},name:t.blockName||Xa,value:[un(t.builtInStandardAttributes||{},!1),on(!0),ln(!0)]}),new Vt({idBlock:{tagClass:3,tagNumber:4},name:t.blockName||Xa,value:[an.schema(t.directoryName||{})]}),new Vt({idBlock:{tagClass:3,tagNumber:5},name:t.blockName||Xa,value:[new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new aa({value:[new Vr,new Ir,new Nr,new pr,new wr]})]}),new Vt({idBlock:{tagClass:3,tagNumber:1},value:[new aa({value:[new Vr,new Ir,new Nr,new pr,new wr]})]})]}),new Nt({name:t.blockName||Xa,idBlock:{tagClass:3,tagNumber:6}}),new Nt({name:t.blockName||Xa,idBlock:{tagClass:3,tagNumber:7}}),new Nt({name:t.blockName||Xa,idBlock:{tagClass:3,tagNumber:8}})]})}}])}(Ya);cn.CLASS_NAME="GeneralName";var hn="accessMethod",fn="accessLocation",mn=[hn,fn],vn=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).accessMethod=Le(r,hn,t.defaultValues(hn)),e.accessLocation=Le(r,fn,t.defaultValues(fn)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,mn);var r=sa(e,e,t.schema({names:{accessMethod:hn,accessLocation:{names:{blockName:fn}}}}));za.assertSchema(r,this.className),this.accessMethod=r.result.accessMethod.valueBlock.toString(),this.accessLocation=new cn({schema:r.result.accessLocation})}},{key:"toSchema",value:function(){return new cr({value:[new ar({value:this.accessMethod}),this.accessLocation.toSchema()]})}},{key:"toJSON",value:function(){return{accessMethod:this.accessMethod,accessLocation:this.accessLocation.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case hn:return Xa;case fn:return new cn;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new ar({name:t.accessMethod||Xa}),cn.schema(t.accessLocation||{})]})}}])}(Ya);vn.CLASS_NAME="AccessDescription";var dn="seconds",gn="millis",pn="micros",yn=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),e=n(this,t),dn in r&&(e.seconds=Le(r,dn,t.defaultValues(dn))),gn in r&&(e.millis=Le(r,gn,t.defaultValues(gn))),pn in r&&(e.micros=Le(r,pn,t.defaultValues(pn))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,[dn,gn,pn]);var r=sa(e,e,t.schema({names:{seconds:dn,millis:gn,micros:pn}}));if(za.assertSchema(r,this.className),"seconds"in r.result&&(this.seconds=r.result.seconds.valueBlock.valueDec),"millis"in r.result){var a=new Zt({valueHex:r.result.millis.valueBlock.valueHex});this.millis=a.valueBlock.valueDec}if("micros"in r.result){var n=new Zt({valueHex:r.result.micros.valueBlock.valueHex});this.micros=n.valueBlock.valueDec}}},{key:"toSchema",value:function(){var e=[];if(void 0!==this.seconds&&e.push(new Zt({value:this.seconds})),void 0!==this.millis){var t=new Zt({value:this.millis});e.push(new Nt({idBlock:{tagClass:3,tagNumber:0},valueHex:t.valueBlock.valueHexView}))}if(void 0!==this.micros){var r=new Zt({value:this.micros});e.push(new Nt({idBlock:{tagClass:3,tagNumber:1},valueHex:r.valueBlock.valueHexView}))}return new cr({value:e})}},{key:"toJSON",value:function(){var e={};return void 0!==this.seconds&&(e.seconds=this.seconds),void 0!==this.millis&&(e.millis=this.millis),void 0!==this.micros&&(e.micros=this.micros),e}}],[{key:"defaultValues",value:function(e){switch(e){case dn:case gn:case pn:return 0;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case dn:case gn:case pn:return r===t.defaultValues(e);default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,optional:!0,value:[new Zt({optional:!0,name:t.seconds||Xa}),new Nt({name:t.millis||Xa,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new Nt({name:t.micros||Xa,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}}])}(Ya);yn.CLASS_NAME="Accuracy";var kn="algorithmId",wn="algorithmParams",bn="algorithm",Sn="params",An=[bn,Sn],Nn=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).algorithmId=Le(r,kn,t.defaultValues(kn)),wn in r&&(e.algorithmParams=Le(r,wn,t.defaultValues(wn))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,An);var r=sa(e,e,t.schema({names:{algorithmIdentifier:bn,algorithmParams:Sn}}));za.assertSchema(r,this.className),this.algorithmId=r.result.algorithm.valueBlock.toString(),Sn in r.result&&(this.algorithmParams=r.result.params)}},{key:"toSchema",value:function(){var e=[];return e.push(new ar({value:this.algorithmId})),!this.algorithmParams||this.algorithmParams instanceof ra||e.push(this.algorithmParams),new cr({value:e})}},{key:"toJSON",value:function(){var e={algorithmId:this.algorithmId};return!this.algorithmParams||this.algorithmParams instanceof ra||(e.algorithmParams=this.algorithmParams.toJSON()),e}},{key:"isEqual",value:function(e){return e instanceof t&&(this.algorithmId===e.algorithmId&&(this.algorithmParams?!!e.algorithmParams&&JSON.stringify(this.algorithmParams)===JSON.stringify(e.algorithmParams):!e.algorithmParams))}}],[{key:"defaultValues",value:function(e){switch(e){case kn:return Xa;case wn:return new ra;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case kn:return r===Xa;case wn:return r instanceof ra;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,optional:t.optional||!1,value:[new ar({name:t.algorithmIdentifier||Xa}),new ra({name:t.algorithmParams||Xa,optional:!0})]})}}])}(Ya);Nn.CLASS_NAME="AlgorithmIdentifier";var Cn="altNames",xn=[Cn],En=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).altNames=Le(r,Cn,t.defaultValues(Cn)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,xn);var r=sa(e,e,t.schema({names:{altNames:Cn}}));za.assertSchema(r,this.className),Cn in r.result&&(this.altNames=Array.from(r.result.altNames,(function(e){return new cn({schema:e})})))}},{key:"toSchema",value:function(){return new cr({value:Array.from(this.altNames,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{altNames:Array.from(this.altNames,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===Cn?[]:A(t,"defaultValues",this,2)([e])}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new na({name:t.altNames||Xa,value:cn.schema()})]})}}])}(Ya);En.CLASS_NAME="AltName";var In="type",Bn="values",Vn=[In,Bn],Dn=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).type=Le(r,In,t.defaultValues(In)),e.values=Le(r,Bn,t.defaultValues(Bn)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Vn);var r=sa(e,e,t.schema({names:{type:In,values:Bn}}));za.assertSchema(r,this.className),this.type=r.result.type.valueBlock.toString(),this.values=r.result.values}},{key:"toSchema",value:function(){return new cr({value:[new ar({value:this.type}),new hr({value:this.values})]})}},{key:"toJSON",value:function(){return{type:this.type,values:Array.from(this.values,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){switch(e){case In:return Xa;case Bn:return[];default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case In:return r===Xa;case Bn:return 0===r.length;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new ar({name:t.type||Xa}),new hr({name:t.setName||Xa,value:[new na({name:t.values||Xa,value:new ra})]})]})}}])}(Ya);Dn.CLASS_NAME="Attribute";var Pn="notBeforeTime",On="notAfterTime",Rn=[Pn,On],Un=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).notBeforeTime=Le(r,Pn,t.defaultValues(Pn)),e.notAfterTime=Le(r,On,t.defaultValues(On)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Rn);var r=sa(e,e,t.schema({names:{notBeforeTime:Pn,notAfterTime:On}}));za.assertSchema(r,this.className),this.notBeforeTime=r.result.notBeforeTime.toDate(),this.notAfterTime=r.result.notAfterTime.toDate()}},{key:"toSchema",value:function(){return new cr({value:[new Xr({valueDate:this.notBeforeTime}),new Xr({valueDate:this.notAfterTime})]})}},{key:"toJSON",value:function(){return{notBeforeTime:this.notBeforeTime,notAfterTime:this.notAfterTime}}}],[{key:"defaultValues",value:function(e){switch(e){case Pn:case On:return new Date(0,0,0);default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Xr({name:t.notBeforeTime||Xa}),new Xr({name:t.notAfterTime||Xa})]})}}])}(Ya);Un.CLASS_NAME="AttCertValidityPeriod";var Ln="names",Tn="generalNames",Hn=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).names=Le(r,Ln,t.defaultValues(Ln)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,[Ln,Tn]);var r=sa(e,e,t.schema({names:{blockName:Ln,generalNames:Tn}}));za.assertSchema(r,this.className),this.names=Array.from(r.result.generalNames,(function(e){return new cn({schema:e})}))}},{key:"toSchema",value:function(){return new cr({value:Array.from(this.names,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{names:Array.from(this.names,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return"names"===e?[]:A(t,"defaultValues",this,2)([e])}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Le(e,Ln,{});return new cr({optional:t,name:r.blockName||Xa,value:[new na({name:r.generalNames||Xa,value:cn.schema()})]})}}])}(Ya);Hn.CLASS_NAME="GeneralNames";var Mn="2.5.29.14",Kn="2.5.29.15",_n="2.5.29.17",jn="2.5.29.18",Jn="2.5.29.19",Fn="2.5.29.28",qn="2.5.29.29",Xn="2.5.29.30",Gn="2.5.29.31",Wn="2.5.29.46",zn="2.5.29.32",Yn="2.5.29.32.0",Qn="2.5.29.33",Zn="2.5.29.35",$n="2.5.29.36",ei="2.5.29.54",ti="1.3.6.1.5.5.7.1.1",ri="1.2.840.113549.1.7.1",ai="1.2.840.113549.1.7.2",ni="1.2.840.113549.1.7.3",ii="1.2.840.113549.1.7.6",si="1.2.840.113549.1.9.16.1.4",ui="1.2.840.113549.1.9.22.1",oi="1.2.840.113549.1.9.22.3",li="1.2.840.113549.1.9.23.1",ci="".concat("1.3.6.1.5.5.7",".48"),hi="".concat(ci,".1.1"),fi="keyIdentifier",mi="authorityCertIssuer",vi="authorityCertSerialNumber",di=[fi,mi,vi],gi=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),e=n(this,t),fi in r&&(e.keyIdentifier=Le(r,fi,t.defaultValues(fi))),mi in r&&(e.authorityCertIssuer=Le(r,mi,t.defaultValues(mi))),vi in r&&(e.authorityCertSerialNumber=Le(r,vi,t.defaultValues(vi))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,di);var r=sa(e,e,t.schema({names:{keyIdentifier:fi,authorityCertIssuer:mi,authorityCertSerialNumber:vi}}));za.assertSchema(r,this.className),fi in r.result&&(this.keyIdentifier=new _t({valueHex:r.result.keyIdentifier.valueBlock.valueHex})),mi in r.result&&(this.authorityCertIssuer=Array.from(r.result.authorityCertIssuer,(function(e){return new cn({schema:e})}))),vi in r.result&&(this.authorityCertSerialNumber=new Zt({valueHex:r.result.authorityCertSerialNumber.valueBlock.valueHex}))}},{key:"toSchema",value:function(){var e=[];return this.keyIdentifier&&e.push(new Nt({idBlock:{tagClass:3,tagNumber:0},valueHex:this.keyIdentifier.valueBlock.valueHexView})),this.authorityCertIssuer&&e.push(new Vt({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.authorityCertIssuer,(function(e){return e.toSchema()}))})),this.authorityCertSerialNumber&&e.push(new Nt({idBlock:{tagClass:3,tagNumber:2},valueHex:this.authorityCertSerialNumber.valueBlock.valueHexView})),new cr({value:e})}},{key:"toJSON",value:function(){var e={};return this.keyIdentifier&&(e.keyIdentifier=this.keyIdentifier.toJSON()),this.authorityCertIssuer&&(e.authorityCertIssuer=Array.from(this.authorityCertIssuer,(function(e){return e.toJSON()}))),this.authorityCertSerialNumber&&(e.authorityCertSerialNumber=this.authorityCertSerialNumber.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case fi:return new _t;case mi:return[];case vi:return new Zt;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Nt({name:t.keyIdentifier||Xa,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new na({name:t.authorityCertIssuer||Xa,value:cn.schema()})]}),new Nt({name:t.authorityCertSerialNumber||Xa,optional:!0,idBlock:{tagClass:3,tagNumber:2}})]})}}])}(Ya);gi.CLASS_NAME="AuthorityKeyIdentifier";var pi="pathLenConstraint",yi="cA",ki=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).cA=Le(r,yi,!1),pi in r&&(e.pathLenConstraint=Le(r,pi,0)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,[yi,pi]);var r=sa(e,e,t.schema({names:{cA:yi,pathLenConstraint:pi}}));za.assertSchema(r,this.className),yi in r.result&&(this.cA=r.result.cA.valueBlock.value),pi in r.result&&(r.result.pathLenConstraint.valueBlock.isHexOnly?this.pathLenConstraint=r.result.pathLenConstraint:this.pathLenConstraint=r.result.pathLenConstraint.valueBlock.valueDec)}},{key:"toSchema",value:function(){var e=[];return this.cA!==t.defaultValues(yi)&&e.push(new Ht({value:this.cA})),pi in this&&(this.pathLenConstraint instanceof Zt?e.push(this.pathLenConstraint):e.push(new Zt({value:this.pathLenConstraint}))),new cr({value:e})}},{key:"toJSON",value:function(){var e={};return this.cA!==t.defaultValues(yi)&&(e.cA=this.cA),pi in this&&(this.pathLenConstraint instanceof Zt?e.pathLenConstraint=this.pathLenConstraint.toJSON():e.pathLenConstraint=this.pathLenConstraint),e}}],[{key:"defaultValues",value:function(e){return e!==yi&&A(t,"defaultValues",this,2)([e])}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Ht({optional:!0,name:t.cA||Xa}),new Zt({optional:!0,name:t.pathLenConstraint||Xa})]})}}])}(Ya);ki.CLASS_NAME="BasicConstraints";var wi="certificateIndex",bi="keyIndex",Si=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).certificateIndex=Le(r,wi,t.defaultValues(wi)),e.keyIndex=Le(r,bi,t.defaultValues(bi)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){if(e.constructor.blockName()!==Zt.blockName())throw new Error("Object's schema was not verified against input data for CAVersion");var t=e.valueBlock.valueHex.slice(0),r=new Uint8Array(t);switch(!0){case t.byteLength<4:var a=new ArrayBuffer(4);new Uint8Array(a).set(r,4-t.byteLength),t=a.slice(0);break;case t.byteLength>4:var n=new ArrayBuffer(4);new Uint8Array(n).set(r.slice(0,4)),t=n.slice(0)}var i=t.slice(0,2),s=new Uint8Array(i),u=s[0];s[0]=s[1],s[1]=u;var o=new Uint16Array(i);this.keyIndex=o[0];var l=t.slice(2),c=new Uint8Array(l);u=c[0],c[0]=c[1],c[1]=u;var h=new Uint16Array(l);this.certificateIndex=h[0]}},{key:"toSchema",value:function(){var e=new ArrayBuffer(2);new Uint16Array(e)[0]=this.certificateIndex;var t=new Uint8Array(e),r=t[0];t[0]=t[1],t[1]=r;var a=new ArrayBuffer(2);new Uint16Array(a)[0]=this.keyIndex;var n=new Uint8Array(a);return r=n[0],n[0]=n[1],n[1]=r,new Zt({valueHex:Ke(a,e)})}},{key:"toJSON",value:function(){return{certificateIndex:this.certificateIndex,keyIndex:this.keyIndex}}}],[{key:"defaultValues",value:function(e){switch(e){case wi:case bi:return 0;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){return new Zt}}])}(Ya);Si.CLASS_NAME="CAVersion";var Ai="policyQualifierId",Ni="qualifier",Ci=[Ai,Ni],xi=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).policyQualifierId=Le(r,Ai,t.defaultValues(Ai)),e.qualifier=Le(r,Ni,t.defaultValues(Ni)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Ci);var r=sa(e,e,t.schema({names:{policyQualifierId:Ai,qualifier:Ni}}));za.assertSchema(r,this.className),this.policyQualifierId=r.result.policyQualifierId.valueBlock.toString(),this.qualifier=r.result.qualifier}},{key:"toSchema",value:function(){return new cr({value:[new ar({value:this.policyQualifierId}),this.qualifier]})}},{key:"toJSON",value:function(){return{policyQualifierId:this.policyQualifierId,qualifier:this.qualifier.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case Ai:return Xa;case Ni:return new ra;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new ar({name:t.policyQualifierId||Xa}),new ra({name:t.qualifier||Xa})]})}}])}(Ya);xi.CLASS_NAME="PolicyQualifierInfo";var Ei="policyIdentifier",Ii="policyQualifiers",Bi=[Ei,Ii],Vi=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).policyIdentifier=Le(r,Ei,t.defaultValues(Ei)),Ii in r&&(e.policyQualifiers=Le(r,Ii,t.defaultValues(Ii))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Bi);var r=sa(e,e,t.schema({names:{policyIdentifier:Ei,policyQualifiers:Ii}}));za.assertSchema(r,this.className),this.policyIdentifier=r.result.policyIdentifier.valueBlock.toString(),Ii in r.result&&(this.policyQualifiers=Array.from(r.result.policyQualifiers,(function(e){return new xi({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(new ar({value:this.policyIdentifier})),this.policyQualifiers&&e.push(new cr({value:Array.from(this.policyQualifiers,(function(e){return e.toSchema()}))})),new cr({value:e})}},{key:"toJSON",value:function(){var e={policyIdentifier:this.policyIdentifier};return this.policyQualifiers&&(e.policyQualifiers=Array.from(this.policyQualifiers,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case Ei:return Xa;case Ii:return[];default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new ar({name:t.policyIdentifier||Xa}),new cr({optional:!0,value:[new na({name:t.policyQualifiers||Xa,value:xi.schema()})]})]})}}])}(Ya);Vi.CLASS_NAME="PolicyInformation";var Di="certificatePolicies",Pi=[Di],Oi=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).certificatePolicies=Le(r,Di,t.defaultValues(Di)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Pi);var r=sa(e,e,t.schema({names:{certificatePolicies:Di}}));za.assertSchema(r,this.className),this.certificatePolicies=Array.from(r.result.certificatePolicies,(function(e){return new Vi({schema:e})}))}},{key:"toSchema",value:function(){return new cr({value:Array.from(this.certificatePolicies,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{certificatePolicies:Array.from(this.certificatePolicies,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===Di?[]:A(t,"defaultValues",this,2)([e])}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new na({name:t.certificatePolicies||Xa,value:Vi.schema()})]})}}])}(Ya);Oi.CLASS_NAME="CertificatePolicies";var Ri="templateID",Ui="templateMajorVersion",Li="templateMinorVersion",Ti=[Ri,Ui,Li],Hi=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).templateID=Le(r,Ri,t.defaultValues(Ri)),Ui in r&&(e.templateMajorVersion=Le(r,Ui,t.defaultValues(Ui))),Li in r&&(e.templateMinorVersion=Le(r,Li,t.defaultValues(Li))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Ti);var r=sa(e,e,t.schema({names:{templateID:Ri,templateMajorVersion:Ui,templateMinorVersion:Li}}));za.assertSchema(r,this.className),this.templateID=r.result.templateID.valueBlock.toString(),Ui in r.result&&(this.templateMajorVersion=r.result.templateMajorVersion.valueBlock.valueDec),Li in r.result&&(this.templateMinorVersion=r.result.templateMinorVersion.valueBlock.valueDec)}},{key:"toSchema",value:function(){var e=[];return e.push(new ar({value:this.templateID})),Ui in this&&e.push(new Zt({value:this.templateMajorVersion})),Li in this&&e.push(new Zt({value:this.templateMinorVersion})),new cr({value:e})}},{key:"toJSON",value:function(){var e={templateID:this.templateID};return Ui in this&&(e.templateMajorVersion=this.templateMajorVersion),Li in this&&(e.templateMinorVersion=this.templateMinorVersion),e}}],[{key:"defaultValues",value:function(e){switch(e){case Ri:return Xa;case Ui:case Li:return 0;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new ar({name:t.templateID||Xa}),new Zt({name:t.templateMajorVersion||Xa,optional:!0}),new Zt({name:t.templateMinorVersion||Xa,optional:!0})]})}}])}(Ya),Mi="distributionPoint",Ki="distributionPointNames",_i="reasons",ji="cRLIssuer",Ji="cRLIssuerNames",Fi=[Mi,Ki,_i,ji,Ji],qi=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),e=n(this,t),Mi in r&&(e.distributionPoint=Le(r,Mi,t.defaultValues(Mi))),_i in r&&(e.reasons=Le(r,_i,t.defaultValues(_i))),ji in r&&(e.cRLIssuer=Le(r,ji,t.defaultValues(ji))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Fi);var r=sa(e,e,t.schema({names:{distributionPoint:Mi,distributionPointNames:Ki,reasons:_i,cRLIssuer:ji,cRLIssuerNames:Ji}}));za.assertSchema(r,this.className),Mi in r.result&&(0===r.result.distributionPoint.idBlock.tagNumber&&(this.distributionPoint=Array.from(r.result.distributionPointNames,(function(e){return new cn({schema:e})}))),1===r.result.distributionPoint.idBlock.tagNumber&&(this.distributionPoint=new an({schema:new cr({value:r.result.distributionPoint.valueBlock.value})}))),_i in r.result&&(this.reasons=new qt({valueHex:r.result.reasons.valueBlock.valueHex})),ji in r.result&&(this.cRLIssuer=Array.from(r.result.cRLIssuerNames,(function(e){return new cn({schema:e})})))}},{key:"toSchema",value:function(){var e,t=[];this.distributionPoint&&(e=this.distributionPoint instanceof Array?new Vt({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,(function(e){return e.toSchema()}))}):new Vt({idBlock:{tagClass:3,tagNumber:1},value:[this.distributionPoint.toSchema()]}),t.push(new Vt({idBlock:{tagClass:3,tagNumber:0},value:[e]})));return this.reasons&&t.push(new Nt({idBlock:{tagClass:3,tagNumber:1},valueHex:this.reasons.valueBlock.valueHexView})),this.cRLIssuer&&t.push(new Vt({idBlock:{tagClass:3,tagNumber:2},value:Array.from(this.cRLIssuer,(function(e){return e.toSchema()}))})),new cr({value:t})}},{key:"toJSON",value:function(){var e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,(function(e){return e.toJSON()})):e.distributionPoint=this.distributionPoint.toJSON()),this.reasons&&(e.reasons=this.reasons.toJSON()),this.cRLIssuer&&(e.cRLIssuer=Array.from(this.cRLIssuer,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case Mi:return[];case _i:return new qt;case ji:return[];default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new aa({value:[new Vt({name:t.distributionPoint||Xa,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new na({name:t.distributionPointNames||Xa,value:cn.schema()})]}),new Vt({name:t.distributionPoint||Xa,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:an.schema().valueBlock.value})]})]}),new Nt({name:t.reasons||Xa,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new Vt({name:t.cRLIssuer||Xa,optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[new na({name:t.cRLIssuerNames||Xa,value:cn.schema()})]})]})}}])}(Ya);qi.CLASS_NAME="DistributionPoint";var Xi="distributionPoints",Gi=[Xi],Wi=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).distributionPoints=Le(r,Xi,t.defaultValues(Xi)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Gi);var r=sa(e,e,t.schema({names:{distributionPoints:Xi}}));za.assertSchema(r,this.className),this.distributionPoints=Array.from(r.result.distributionPoints,(function(e){return new qi({schema:e})}))}},{key:"toSchema",value:function(){return new cr({value:Array.from(this.distributionPoints,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{distributionPoints:Array.from(this.distributionPoints,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===Xi?[]:A(t,"defaultValues",this,2)([e])}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new na({name:t.distributionPoints||Xa,value:qi.schema()})]})}}])}(Ya);Wi.CLASS_NAME="CRLDistributionPoints";var zi="keyPurposes",Yi=[zi],Qi=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).keyPurposes=Le(r,zi,t.defaultValues(zi)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Yi);var r=sa(e,e,t.schema({names:{keyPurposes:zi}}));za.assertSchema(r,this.className),this.keyPurposes=Array.from(r.result.keyPurposes,(function(e){return e.valueBlock.toString()}))}},{key:"toSchema",value:function(){return new cr({value:Array.from(this.keyPurposes,(function(e){return new ar({value:e})}))})}},{key:"toJSON",value:function(){return{keyPurposes:Array.from(this.keyPurposes)}}}],[{key:"defaultValues",value:function(e){return e===zi?[]:A(t,"defaultValues",this,2)([e])}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new na({name:t.keyPurposes||Xa,value:new ar})]})}}])}(Ya);Qi.CLASS_NAME="ExtKeyUsage";var Zi="accessDescriptions",$i=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).accessDescriptions=Le(r,Zi,t.defaultValues(Zi)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,[Zi]);var r=sa(e,e,t.schema({names:{accessDescriptions:Zi}}));za.assertSchema(r,this.className),this.accessDescriptions=Array.from(r.result.accessDescriptions,(function(e){return new vn({schema:e})}))}},{key:"toSchema",value:function(){return new cr({value:Array.from(this.accessDescriptions,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{accessDescriptions:Array.from(this.accessDescriptions,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===Zi?[]:A(t,"defaultValues",this,2)([e])}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new na({name:t.accessDescriptions||Xa,value:vn.schema()})]})}}])}(Ya);$i.CLASS_NAME="InfoAccess";var es="distributionPoint",ts="distributionPointNames",rs="onlyContainsUserCerts",as="onlyContainsCACerts",ns="onlySomeReasons",is="indirectCRL",ss="onlyContainsAttributeCerts",us=[es,ts,rs,as,ns,is,ss],os=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),e=n(this,t),es in r&&(e.distributionPoint=Le(r,es,t.defaultValues(es))),e.onlyContainsUserCerts=Le(r,rs,t.defaultValues(rs)),e.onlyContainsCACerts=Le(r,as,t.defaultValues(as)),ns in r&&(e.onlySomeReasons=Le(r,ns,t.defaultValues(ns))),e.indirectCRL=Le(r,is,t.defaultValues(is)),e.onlyContainsAttributeCerts=Le(r,ss,t.defaultValues(ss)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,us);var r=sa(e,e,t.schema({names:{distributionPoint:es,distributionPointNames:ts,onlyContainsUserCerts:rs,onlyContainsCACerts:as,onlySomeReasons:ns,indirectCRL:is,onlyContainsAttributeCerts:ss}}));if(za.assertSchema(r,this.className),es in r.result)switch(!0){case 0===r.result.distributionPoint.idBlock.tagNumber:this.distributionPoint=Array.from(r.result.distributionPointNames,(function(e){return new cn({schema:e})}));break;case 1===r.result.distributionPoint.idBlock.tagNumber:this.distributionPoint=new an({schema:new cr({value:r.result.distributionPoint.valueBlock.value})});break;default:throw new Error("Unknown tagNumber for distributionPoint: {$asn1.result.distributionPoint.idBlock.tagNumber}")}if(rs in r.result){var a=new Uint8Array(r.result.onlyContainsUserCerts.valueBlock.valueHex);this.onlyContainsUserCerts=0!==a[0]}if(as in r.result){var n=new Uint8Array(r.result.onlyContainsCACerts.valueBlock.valueHex);this.onlyContainsCACerts=0!==n[0]}if(ns in r.result){var i=new Uint8Array(r.result.onlySomeReasons.valueBlock.valueHex);this.onlySomeReasons=i[0]}if(is in r.result){var s=new Uint8Array(r.result.indirectCRL.valueBlock.valueHex);this.indirectCRL=0!==s[0]}if(ss in r.result){var u=new Uint8Array(r.result.onlyContainsAttributeCerts.valueBlock.valueHex);this.onlyContainsAttributeCerts=0!==u[0]}}},{key:"toSchema",value:function(){var e,r=[];this.distributionPoint&&(this.distributionPoint instanceof Array?e=new Vt({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,(function(e){return e.toSchema()}))}):((e=this.distributionPoint.toSchema()).idBlock.tagClass=3,e.idBlock.tagNumber=1),r.push(new Vt({idBlock:{tagClass:3,tagNumber:0},value:[e]})));if(this.onlyContainsUserCerts!==t.defaultValues(rs)&&r.push(new Nt({idBlock:{tagClass:3,tagNumber:1},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsCACerts!==t.defaultValues(as)&&r.push(new Nt({idBlock:{tagClass:3,tagNumber:2},valueHex:new Uint8Array([255]).buffer})),void 0!==this.onlySomeReasons){var a=new ArrayBuffer(1);new Uint8Array(a)[0]=this.onlySomeReasons,r.push(new Nt({idBlock:{tagClass:3,tagNumber:3},valueHex:a}))}return this.indirectCRL!==t.defaultValues(is)&&r.push(new Nt({idBlock:{tagClass:3,tagNumber:4},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsAttributeCerts!==t.defaultValues(ss)&&r.push(new Nt({idBlock:{tagClass:3,tagNumber:5},valueHex:new Uint8Array([255]).buffer})),new cr({value:r})}},{key:"toJSON",value:function(){var e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,(function(e){return e.toJSON()})):e.distributionPoint=this.distributionPoint.toJSON()),this.onlyContainsUserCerts!==t.defaultValues(rs)&&(e.onlyContainsUserCerts=this.onlyContainsUserCerts),this.onlyContainsCACerts!==t.defaultValues(as)&&(e.onlyContainsCACerts=this.onlyContainsCACerts),ns in this&&(e.onlySomeReasons=this.onlySomeReasons),this.indirectCRL!==t.defaultValues(is)&&(e.indirectCRL=this.indirectCRL),this.onlyContainsAttributeCerts!==t.defaultValues(ss)&&(e.onlyContainsAttributeCerts=this.onlyContainsAttributeCerts),e}}],[{key:"defaultValues",value:function(e){switch(e){case es:return[];case rs:case as:return!1;case ns:return 0;case is:case ss:return!1;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new aa({value:[new Vt({name:t.distributionPoint||Xa,idBlock:{tagClass:3,tagNumber:0},value:[new na({name:t.distributionPointNames||Xa,value:cn.schema()})]}),new Vt({name:t.distributionPoint||Xa,idBlock:{tagClass:3,tagNumber:1},value:an.schema().valueBlock.value})]})]}),new Nt({name:t.onlyContainsUserCerts||Xa,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new Nt({name:t.onlyContainsCACerts||Xa,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new Nt({name:t.onlySomeReasons||Xa,optional:!0,idBlock:{tagClass:3,tagNumber:3}}),new Nt({name:t.indirectCRL||Xa,optional:!0,idBlock:{tagClass:3,tagNumber:4}}),new Nt({name:t.onlyContainsAttributeCerts||Xa,optional:!0,idBlock:{tagClass:3,tagNumber:5}})]})}}])}(Ya);os.CLASS_NAME="IssuingDistributionPoint";var ls="base",cs="minimum",hs="maximum",fs=[ls,cs,hs],ms=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).base=Le(r,ls,t.defaultValues(ls)),e.minimum=Le(r,cs,t.defaultValues(cs)),hs in r&&(e.maximum=Le(r,hs,t.defaultValues(hs))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,fs);var r=sa(e,e,t.schema({names:{base:{names:{blockName:ls}},minimum:cs,maximum:hs}}));za.assertSchema(r,this.className),this.base=new cn({schema:r.result.base}),cs in r.result&&(r.result.minimum.valueBlock.isHexOnly?this.minimum=r.result.minimum:this.minimum=r.result.minimum.valueBlock.valueDec),hs in r.result&&(r.result.maximum.valueBlock.isHexOnly?this.maximum=r.result.maximum:this.maximum=r.result.maximum.valueBlock.valueDec)}},{key:"toSchema",value:function(){var e=[];if(e.push(this.base.toSchema()),0!==this.minimum){var t=0;t=this.minimum instanceof Zt?this.minimum:new Zt({value:this.minimum}),e.push(new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(hs in this){var r=0;r=this.maximum instanceof Zt?this.maximum:new Zt({value:this.maximum}),e.push(new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[r]}))}return new cr({value:e})}},{key:"toJSON",value:function(){var e={base:this.base.toJSON()};return 0!==this.minimum&&("number"==typeof this.minimum?e.minimum=this.minimum:e.minimum=this.minimum.toJSON()),void 0!==this.maximum&&("number"==typeof this.maximum?e.maximum=this.maximum:e.maximum=this.maximum.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case ls:return new cn;case cs:case hs:return 0;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[cn.schema(t.base||{}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Zt({name:t.minimum||Xa})]}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Zt({name:t.maximum||Xa})]})]})}}])}(Ya);ms.CLASS_NAME="GeneralSubtree";var vs="permittedSubtrees",ds="excludedSubtrees",gs=[vs,ds],ps=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),e=n(this,t),vs in r&&(e.permittedSubtrees=Le(r,vs,t.defaultValues(vs))),ds in r&&(e.excludedSubtrees=Le(r,ds,t.defaultValues(ds))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,gs);var r=sa(e,e,t.schema({names:{permittedSubtrees:vs,excludedSubtrees:ds}}));za.assertSchema(r,this.className),vs in r.result&&(this.permittedSubtrees=Array.from(r.result.permittedSubtrees,(function(e){return new ms({schema:e})}))),ds in r.result&&(this.excludedSubtrees=Array.from(r.result.excludedSubtrees,(function(e){return new ms({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return this.permittedSubtrees&&e.push(new Vt({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.permittedSubtrees,(function(e){return e.toSchema()}))})),this.excludedSubtrees&&e.push(new Vt({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.excludedSubtrees,(function(e){return e.toSchema()}))})),new cr({value:e})}},{key:"toJSON",value:function(){var e={};return this.permittedSubtrees&&(e.permittedSubtrees=Array.from(this.permittedSubtrees,(function(e){return e.toJSON()}))),this.excludedSubtrees&&(e.excludedSubtrees=Array.from(this.excludedSubtrees,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case vs:case ds:return[];default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new na({name:t.permittedSubtrees||Xa,value:ms.schema()})]}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new na({name:t.excludedSubtrees||Xa,value:ms.schema()})]})]})}}])}(Ya);ps.CLASS_NAME="NameConstraints";var ys="requireExplicitPolicy",ks="inhibitPolicyMapping",ws=[ys,ks],bs=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),e=n(this,t),ys in r&&(e.requireExplicitPolicy=Le(r,ys,t.defaultValues(ys))),ks in r&&(e.inhibitPolicyMapping=Le(r,ks,t.defaultValues(ks))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,ws);var r=sa(e,e,t.schema({names:{requireExplicitPolicy:ys,inhibitPolicyMapping:ks}}));if(za.assertSchema(r,this.className),ys in r.result){var a=r.result.requireExplicitPolicy;a.idBlock.tagClass=1,a.idBlock.tagNumber=2;var n=Et(a.toBER(!1));za.assert(n,"Integer"),this.requireExplicitPolicy=n.result.valueBlock.valueDec}if(ks in r.result){var i=r.result.inhibitPolicyMapping;i.idBlock.tagClass=1,i.idBlock.tagNumber=2;var s=Et(i.toBER(!1));za.assert(s,"Integer"),this.inhibitPolicyMapping=s.result.valueBlock.valueDec}}},{key:"toSchema",value:function(){var e=[];if(ys in this){var t=new Zt({value:this.requireExplicitPolicy});t.idBlock.tagClass=3,t.idBlock.tagNumber=0,e.push(t)}if(ks in this){var r=new Zt({value:this.inhibitPolicyMapping});r.idBlock.tagClass=3,r.idBlock.tagNumber=1,e.push(r)}return new cr({value:e})}},{key:"toJSON",value:function(){var e={};return ys in this&&(e.requireExplicitPolicy=this.requireExplicitPolicy),ks in this&&(e.inhibitPolicyMapping=this.inhibitPolicyMapping),e}}],[{key:"defaultValues",value:function(e){switch(e){case ys:case ks:return 0;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Nt({name:t.requireExplicitPolicy||Xa,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new Nt({name:t.inhibitPolicyMapping||Xa,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}}])}(Ya);bs.CLASS_NAME="PolicyConstraints";var Ss="issuerDomainPolicy",As="subjectDomainPolicy",Ns=[Ss,As],Cs=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).issuerDomainPolicy=Le(r,Ss,t.defaultValues(Ss)),e.subjectDomainPolicy=Le(r,As,t.defaultValues(As)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Ns);var r=sa(e,e,t.schema({names:{issuerDomainPolicy:Ss,subjectDomainPolicy:As}}));za.assertSchema(r,this.className),this.issuerDomainPolicy=r.result.issuerDomainPolicy.valueBlock.toString(),this.subjectDomainPolicy=r.result.subjectDomainPolicy.valueBlock.toString()}},{key:"toSchema",value:function(){return new cr({value:[new ar({value:this.issuerDomainPolicy}),new ar({value:this.subjectDomainPolicy})]})}},{key:"toJSON",value:function(){return{issuerDomainPolicy:this.issuerDomainPolicy,subjectDomainPolicy:this.subjectDomainPolicy}}}],[{key:"defaultValues",value:function(e){switch(e){case Ss:case As:return Xa;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new ar({name:t.issuerDomainPolicy||Xa}),new ar({name:t.subjectDomainPolicy||Xa})]})}}])}(Ya);Cs.CLASS_NAME="PolicyMapping";var xs="mappings",Es=[xs],Is=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).mappings=Le(r,xs,t.defaultValues(xs)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Es);var r=sa(e,e,t.schema({names:{mappings:xs}}));za.assertSchema(r,this.className),this.mappings=Array.from(r.result.mappings,(function(e){return new Cs({schema:e})}))}},{key:"toSchema",value:function(){return new cr({value:Array.from(this.mappings,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{mappings:Array.from(this.mappings,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===xs?[]:A(t,"defaultValues",this,2)([e])}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new na({name:t.mappings||Xa,value:Cs.schema()})]})}}])}(Ya);Is.CLASS_NAME="PolicyMappings";var Bs="notBefore",Vs="notAfter",Ds=[Bs,Vs],Ps=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),e=n(this,t),Bs in r&&(e.notBefore=Le(r,Bs,t.defaultValues(Bs))),Vs in r&&(e.notAfter=Le(r,Vs,t.defaultValues(Vs))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Ds);var r=sa(e,e,t.schema({names:{notBefore:Bs,notAfter:Vs}}));if(za.assertSchema(r,this.className),Bs in r.result){var a=new Xr;a.fromBuffer(r.result.notBefore.valueBlock.valueHex),this.notBefore=a.toDate()}if(Vs in r.result){var n=new Xr({valueHex:r.result.notAfter.valueBlock.valueHex});n.fromBuffer(r.result.notAfter.valueBlock.valueHex),this.notAfter=n.toDate()}}},{key:"toSchema",value:function(){var e=[];return Bs in this&&e.push(new Nt({idBlock:{tagClass:3,tagNumber:0},valueHex:new Xr({valueDate:this.notBefore}).valueBlock.valueHexView})),Vs in this&&e.push(new Nt({idBlock:{tagClass:3,tagNumber:1},valueHex:new Xr({valueDate:this.notAfter}).valueBlock.valueHexView})),new cr({value:e})}},{key:"toJSON",value:function(){var e={};return this.notBefore&&(e.notBefore=this.notBefore),this.notAfter&&(e.notAfter=this.notAfter),e}}],[{key:"defaultValues",value:function(e){switch(e){case Bs:case Vs:return new Date;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Nt({name:t.notBefore||Xa,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new Nt({name:t.notAfter||Xa,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}}])}(Ya);Ps.CLASS_NAME="PrivateKeyUsagePeriod";var Os="id",Rs="type",Us="values",Ls=[Os,Rs],Ts=[Us],Hs=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).id=Le(r,Os,t.defaultValues(Os)),Rs in r&&(e.type=Le(r,Rs,t.defaultValues(Rs))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Ls);var r=sa(e,e,t.schema({names:{id:Os,type:Rs}}));za.assertSchema(r,this.className),this.id=r.result.id.valueBlock.toString(),Rs in r.result&&(this.type=r.result.type)}},{key:"toSchema",value:function(){var e=[new ar({value:this.id})];return Rs in this&&e.push(this.type),new cr({value:e})}},{key:"toJSON",value:function(){var e={id:this.id};return this.type&&(e.type=this.type.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Os:return Xa;case Rs:return new Ut;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case Os:return r===Xa;case Rs:return r instanceof Ut;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new ar({name:t.id||Xa}),new ra({name:t.type||Xa,optional:!0})]})}}])}(Ya);Hs.CLASS_NAME="QCStatement";var Ms,Ks=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).values=Le(r,Us,t.defaultValues(Us)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Ts);var r=sa(e,e,t.schema({names:{values:Us}}));za.assertSchema(r,this.className),this.values=Array.from(r.result.values,(function(e){return new Hs({schema:e})}))}},{key:"toSchema",value:function(){return new cr({value:Array.from(this.values,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{values:Array.from(this.values,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===Us?[]:A(t,"defaultValues",this,2)([e])}},{key:"compareWithDefault",value:function(e,r){return e===Us?0===r.length:A(t,"defaultValues",this,2)([e])}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new na({name:t.values||Xa,value:Hs.schema(t.value||{})})]})}}])}(Ya);Ks.CLASS_NAME="QCStatements";var _s=o((function e(){i(this,e)}),null,[{key:"register",value:function(e,t,r){this.namedCurves[e.toLowerCase()]=this.namedCurves[t]={name:e,id:t,size:r}}},{key:"find",value:function(e){return this.namedCurves[e.toLowerCase()]||null}}]);Ms=_s,_s.namedCurves={},Ms.register("P-256","1.2.840.10045.3.1.7",32),Ms.register("P-384","1.3.132.0.34",48),Ms.register("P-521","1.3.132.0.35",66),Ms.register("brainpoolP256r1","1.3.36.3.3.2.8.1.1.7",32),Ms.register("brainpoolP384r1","1.3.36.3.3.2.8.1.1.11",48),Ms.register("brainpoolP512r1","1.3.36.3.3.2.8.1.1.13",64);var js="x",Js="y",Fs="namedCurve",qs=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).x=Le(r,js,t.defaultValues(js)),e.y=Le(r,Js,t.defaultValues(Js)),e.namedCurve=Le(r,Fs,t.defaultValues(Fs)),r.json&&e.fromJSON(r.json),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){var t=Ie.toUint8Array(e);if(4!==t[0])throw new Error("Object's schema was not verified against input data for ECPublicKey");var r=_s.find(this.namedCurve);if(!r)throw new Error("Incorrect curve OID: ".concat(this.namedCurve));var a=r.size;if(t.byteLength!==2*a+1)throw new Error("Object's schema was not verified against input data for ECPublicKey");this.namedCurve=r.name,this.x=t.slice(1,a+1).buffer,this.y=t.slice(1+a,2*a+1).buffer}},{key:"toSchema",value:function(){return new ia({data:Ke(new Uint8Array([4]).buffer,this.x,this.y)})}},{key:"toJSON",value:function(){var e=_s.find(this.namedCurve);return{crv:e?e.name:this.namedCurve,x:Ge(ze(this.x),!0,!0,!1),y:Ge(ze(this.y),!0,!0,!1)}}},{key:"fromJSON",value:function(e){Wa.assert("json",e,"crv","x","y");var t=0,r=_s.find(e.crv);r&&(this.namedCurve=r.id,t=r.size);var a=Ye(We(e.x,!0));if(a.byteLength<t){this.x=new ArrayBuffer(t);var n=new Uint8Array(this.x),i=new Uint8Array(a);n.set(i,1)}else this.x=a.slice(0,t);var s=Ye(We(e.y,!0));if(s.byteLength<t){this.y=new ArrayBuffer(t);var u=new Uint8Array(this.y),o=new Uint8Array(s);u.set(o,1)}else this.y=s.slice(0,t)}}],[{key:"defaultValues",value:function(e){switch(e){case js:case Js:return qa;case Fs:return Xa;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case js:case Js:return r instanceof ArrayBuffer&&Je(r,t.defaultValues(e));case Fs:return"string"==typeof r&&r===t.defaultValues(e);default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){return new ia}}])}(Ya);qs.CLASS_NAME="ECPublicKey";var Xs="modulus",Gs="publicExponent",Ws=[Xs,Gs],zs=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).modulus=Le(r,Xs,t.defaultValues(Xs)),e.publicExponent=Le(r,Gs,t.defaultValues(Gs)),r.json&&e.fromJSON(r.json),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Ws);var r=sa(e,e,t.schema({names:{modulus:Xs,publicExponent:Gs}}));za.assertSchema(r,this.className),this.modulus=r.result.modulus.convertFromDER(256),this.publicExponent=r.result.publicExponent}},{key:"toSchema",value:function(){return new cr({value:[this.modulus.convertToDER(),this.publicExponent]})}},{key:"toJSON",value:function(){return{n:Ue.ToBase64Url(this.modulus.valueBlock.valueHexView),e:Ue.ToBase64Url(this.publicExponent.valueBlock.valueHexView)}}},{key:"fromJSON",value:function(e){Wa.assert("json",e,"n","e");var t,r,a,n,i=Ye(We(e.n,!0));this.modulus=new Zt({valueHex:i.slice(0,Math.pow(2,(t=i.byteLength,r=Math.log(t)/Qe,a=Math.floor(r),n=Math.round(r),a===n?a:n)))}),this.publicExponent=new Zt({valueHex:Ye(We(e.e,!0)).slice(0,3)})}}],[{key:"defaultValues",value:function(e){switch(e){case Xs:case Gs:return new Zt;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Zt({name:t.modulus||Xa}),new Zt({name:t.publicExponent||Xa})]})}}])}(Ya);zs.CLASS_NAME="RSAPublicKey";var Ys="algorithm",Qs="subjectPublicKey",Zs=[Ys,Qs],$s=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t),(e=n(this,t)).algorithm=Le(r,Ys,t.defaultValues(Ys)),e.subjectPublicKey=Le(r,Qs,t.defaultValues(Qs));var a=Le(r,"parsedKey",null);return a&&(e.parsedKey=a),r.json&&e.fromJSON(r.json),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"parsedKey",get:function(){if(void 0===this._parsedKey){switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":if("algorithmParams"in this.algorithm&&this.algorithm.algorithmParams.constructor.blockName()===ar.blockName())try{this._parsedKey=new qs({namedCurve:this.algorithm.algorithmParams.valueBlock.toString(),schema:this.subjectPublicKey.valueBlock.valueHexView})}catch(e){}break;case"1.2.840.113549.1.1.1":var e=Et(this.subjectPublicKey.valueBlock.valueHexView);if(-1!==e.offset)try{this._parsedKey=new zs({schema:e.result})}catch(e){}}this._parsedKey||(this._parsedKey=null)}return this._parsedKey||void 0},set:function(e){this._parsedKey=e}},{key:"fromSchema",value:function(e){Ze(e,Zs);var r=sa(e,e,t.schema({names:{algorithm:{names:{blockName:Ys}},subjectPublicKey:Qs}}));za.assertSchema(r,this.className),this.algorithm=new Nn({schema:r.result.algorithm}),this.subjectPublicKey=r.result.subjectPublicKey}},{key:"toSchema",value:function(){return new cr({value:[this.algorithm.toSchema(),this.subjectPublicKey]})}},{key:"toJSON",value:function(){if(!this.parsedKey)return{algorithm:this.algorithm.toJSON(),subjectPublicKey:this.subjectPublicKey.toJSON()};var e={};switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA"}var t=this.parsedKey.toJSON();return Object.assign(e,t),e}},{key:"fromJSON",value:function(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new qs({json:e}),this.algorithm=new Nn({algorithmId:"1.2.840.10045.2.1",algorithmParams:new ar({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new zs({json:e}),this.algorithm=new Nn({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new Ut});break;default:throw new Error('Invalid value for "kty" parameter: '.concat(e.kty))}this.subjectPublicKey=new qt({valueHex:this.parsedKey.toSchema().toBER(!1)})}}},{key:"importKey",value:(r=a(k().mark((function e(t){var r,a,n,i,s=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=s.length>1&&void 0!==s[1]?s[1]:po(!0),e.prev=1,t){e.next=4;break}throw new Error("Need to provide publicKey input parameter");case 4:return e.next=6,r.exportKey("spki",t);case 6:a=e.sent,n=Et(a),e.prev=8,this.fromSchema(n.result),e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(8),new Error("Error during initializing object from schema");case 15:e.next=21;break;case 17:throw e.prev=17,e.t1=e.catch(1),i=e.t1 instanceof Error?e.t1.message:"".concat(e.t1),new Error("Error during exporting public key: ".concat(i));case 21:case"end":return e.stop()}}),e,this,[[1,17],[8,12]])}))),function(e){return r.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case Ys:return new Nn;case Qs:return new qt;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[Nn.schema(t.algorithm||{}),new qt({name:t.subjectPublicKey||Xa})]})}}]);var r}(Ya);$s.CLASS_NAME="PublicKeyInfo";var eu="version",tu="privateKey",ru="namedCurve",au="publicKey",nu=[eu,tu,ru,au],iu=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).version=Le(r,eu,t.defaultValues(eu)),e.privateKey=Le(r,tu,t.defaultValues(tu)),ru in r&&(e.namedCurve=Le(r,ru,t.defaultValues(ru))),au in r&&(e.publicKey=Le(r,au,t.defaultValues(au))),r.json&&e.fromJSON(r.json),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,nu);var r=sa(e,e,t.schema({names:{version:eu,privateKey:tu,namedCurve:ru,publicKey:au}}));if(za.assertSchema(r,this.className),this.version=r.result.version.valueBlock.valueDec,this.privateKey=r.result.privateKey,ru in r.result&&(this.namedCurve=r.result.namedCurve.valueBlock.toString()),au in r.result){var a={schema:r.result.publicKey.valueBlock.valueHex};ru in this&&(a.namedCurve=this.namedCurve),this.publicKey=new qs(a)}}},{key:"toSchema",value:function(){var e=[new Zt({value:this.version}),this.privateKey];return this.namedCurve&&e.push(new Vt({idBlock:{tagClass:3,tagNumber:0},value:[new ar({value:this.namedCurve})]})),this.publicKey&&e.push(new Vt({idBlock:{tagClass:3,tagNumber:1},value:[new qt({valueHex:this.publicKey.toSchema().toBER(!1)})]})),new cr({value:e})}},{key:"toJSON",value:function(){if(!this.namedCurve||t.compareWithDefault(ru,this.namedCurve))throw new Error('Not enough information for making JSON: absent "namedCurve" value');var e=_s.find(this.namedCurve),r={crv:e?e.name:this.namedCurve,d:Ue.ToBase64Url(this.privateKey.valueBlock.valueHexView)};if(this.publicKey){var a=this.publicKey.toJSON();r.x=a.x,r.y=a.y}return r}},{key:"fromJSON",value:function(e){Wa.assert("json",e,"crv","d");var t=0,r=_s.find(e.crv);r&&(this.namedCurve=r.id,t=r.size);var a=Ue.FromBase64Url(e.d);if(a.byteLength<t){var n=new ArrayBuffer(t),i=new Uint8Array(n),s=new Uint8Array(a);i.set(s,1),this.privateKey=new _t({valueHex:n})}else this.privateKey=new _t({valueHex:a.slice(0,t)});e.x&&e.y&&(this.publicKey=new qs({json:e}))}}],[{key:"defaultValues",value:function(e){switch(e){case eu:return 1;case tu:return new _t;case ru:return Xa;case au:return new qs;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case eu:return r===t.defaultValues(e);case tu:return r.isEqual(t.defaultValues(e));case ru:return r===Xa;case au:return qs.compareWithDefault(ru,r.namedCurve)&&qs.compareWithDefault("x",r.x)&&qs.compareWithDefault("y",r.y);default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Zt({name:t.version||Xa}),new _t({name:t.privateKey||Xa}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ar({name:t.namedCurve||Xa})]}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new qt({name:t.publicKey||Xa})]})]})}}])}(Ya);iu.CLASS_NAME="ECPrivateKey";var su="prime",uu="exponent",ou="coefficient",lu=[su,uu,ou],cu=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).prime=Le(r,su,t.defaultValues(su)),e.exponent=Le(r,uu,t.defaultValues(uu)),e.coefficient=Le(r,ou,t.defaultValues(ou)),r.json&&e.fromJSON(r.json),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,lu);var r=sa(e,e,t.schema({names:{prime:su,exponent:uu,coefficient:ou}}));za.assertSchema(r,this.className),this.prime=r.result.prime.convertFromDER(),this.exponent=r.result.exponent.convertFromDER(),this.coefficient=r.result.coefficient.convertFromDER()}},{key:"toSchema",value:function(){return new cr({value:[this.prime.convertToDER(),this.exponent.convertToDER(),this.coefficient.convertToDER()]})}},{key:"toJSON",value:function(){return{r:Ue.ToBase64Url(this.prime.valueBlock.valueHexView),d:Ue.ToBase64Url(this.exponent.valueBlock.valueHexView),t:Ue.ToBase64Url(this.coefficient.valueBlock.valueHexView)}}},{key:"fromJSON",value:function(e){Wa.assert("json",e,"r","d","r"),this.prime=new Zt({valueHex:Ue.FromBase64Url(e.r)}),this.exponent=new Zt({valueHex:Ue.FromBase64Url(e.d)}),this.coefficient=new Zt({valueHex:Ue.FromBase64Url(e.t)})}}],[{key:"defaultValues",value:function(e){switch(e){case su:case uu:case ou:return new Zt;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Zt({name:t.prime||Xa}),new Zt({name:t.exponent||Xa}),new Zt({name:t.coefficient||Xa})]})}}])}(Ya);cu.CLASS_NAME="OtherPrimeInfo";var hu="version",fu="modulus",mu="publicExponent",vu="privateExponent",du="prime1",gu="prime2",pu="exponent1",yu="exponent2",ku="coefficient",wu="otherPrimeInfos",bu=[hu,fu,mu,vu,du,gu,pu,yu,ku,wu],Su=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).version=Le(r,hu,t.defaultValues(hu)),e.modulus=Le(r,fu,t.defaultValues(fu)),e.publicExponent=Le(r,mu,t.defaultValues(mu)),e.privateExponent=Le(r,vu,t.defaultValues(vu)),e.prime1=Le(r,du,t.defaultValues(du)),e.prime2=Le(r,gu,t.defaultValues(gu)),e.exponent1=Le(r,pu,t.defaultValues(pu)),e.exponent2=Le(r,yu,t.defaultValues(yu)),e.coefficient=Le(r,ku,t.defaultValues(ku)),wu in r&&(e.otherPrimeInfos=Le(r,wu,t.defaultValues(wu))),r.json&&e.fromJSON(r.json),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,bu);var r=sa(e,e,t.schema({names:{version:hu,modulus:fu,publicExponent:mu,privateExponent:vu,prime1:du,prime2:gu,exponent1:pu,exponent2:yu,coefficient:ku,otherPrimeInfo:{names:{blockName:wu}}}}));za.assertSchema(r,this.className),this.version=r.result.version.valueBlock.valueDec,this.modulus=r.result.modulus.convertFromDER(256),this.publicExponent=r.result.publicExponent,this.privateExponent=r.result.privateExponent.convertFromDER(256),this.prime1=r.result.prime1.convertFromDER(128),this.prime2=r.result.prime2.convertFromDER(128),this.exponent1=r.result.exponent1.convertFromDER(128),this.exponent2=r.result.exponent2.convertFromDER(128),this.coefficient=r.result.coefficient.convertFromDER(128),wu in r.result&&(this.otherPrimeInfos=Array.from(r.result.otherPrimeInfos,(function(e){return new cu({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(new Zt({value:this.version})),e.push(this.modulus.convertToDER()),e.push(this.publicExponent),e.push(this.privateExponent.convertToDER()),e.push(this.prime1.convertToDER()),e.push(this.prime2.convertToDER()),e.push(this.exponent1.convertToDER()),e.push(this.exponent2.convertToDER()),e.push(this.coefficient.convertToDER()),this.otherPrimeInfos&&e.push(new cr({value:Array.from(this.otherPrimeInfos,(function(e){return e.toSchema()}))})),new cr({value:e})}},{key:"toJSON",value:function(){var e={n:Ue.ToBase64Url(this.modulus.valueBlock.valueHexView),e:Ue.ToBase64Url(this.publicExponent.valueBlock.valueHexView),d:Ue.ToBase64Url(this.privateExponent.valueBlock.valueHexView),p:Ue.ToBase64Url(this.prime1.valueBlock.valueHexView),q:Ue.ToBase64Url(this.prime2.valueBlock.valueHexView),dp:Ue.ToBase64Url(this.exponent1.valueBlock.valueHexView),dq:Ue.ToBase64Url(this.exponent2.valueBlock.valueHexView),qi:Ue.ToBase64Url(this.coefficient.valueBlock.valueHexView)};return this.otherPrimeInfos&&(e.oth=Array.from(this.otherPrimeInfos,(function(e){return e.toJSON()}))),e}},{key:"fromJSON",value:function(e){Wa.assert("json",e,"n","e","d","p","q","dp","dq","qi"),this.modulus=new Zt({valueHex:Ue.FromBase64Url(e.n)}),this.publicExponent=new Zt({valueHex:Ue.FromBase64Url(e.e)}),this.privateExponent=new Zt({valueHex:Ue.FromBase64Url(e.d)}),this.prime1=new Zt({valueHex:Ue.FromBase64Url(e.p)}),this.prime2=new Zt({valueHex:Ue.FromBase64Url(e.q)}),this.exponent1=new Zt({valueHex:Ue.FromBase64Url(e.dp)}),this.exponent2=new Zt({valueHex:Ue.FromBase64Url(e.dq)}),this.coefficient=new Zt({valueHex:Ue.FromBase64Url(e.qi)}),e.oth&&(this.otherPrimeInfos=Array.from(e.oth,(function(e){return new cu({json:e})})))}}],[{key:"defaultValues",value:function(e){switch(e){case hu:return 0;case fu:case mu:case vu:case du:case gu:case pu:case yu:case ku:return new Zt;case wu:return[];default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Zt({name:t.version||Xa}),new Zt({name:t.modulus||Xa}),new Zt({name:t.publicExponent||Xa}),new Zt({name:t.privateExponent||Xa}),new Zt({name:t.prime1||Xa}),new Zt({name:t.prime2||Xa}),new Zt({name:t.exponent1||Xa}),new Zt({name:t.exponent2||Xa}),new Zt({name:t.coefficient||Xa}),new cr({optional:!0,value:[new na({name:t.otherPrimeInfosName||Xa,value:cu.schema(t.otherPrimeInfo||{})})]})]})}}])}(Ya);Su.CLASS_NAME="RSAPrivateKey";var Au="version",Nu="privateKeyAlgorithm",Cu="privateKey",xu="attributes",Eu="parsedKey",Iu=[Au,Nu,Cu,xu],Bu=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).version=Le(r,Au,t.defaultValues(Au)),e.privateKeyAlgorithm=Le(r,Nu,t.defaultValues(Nu)),e.privateKey=Le(r,Cu,t.defaultValues(Cu)),xu in r&&(e.attributes=Le(r,xu,t.defaultValues(xu))),Eu in r&&(e.parsedKey=Le(r,Eu,t.defaultValues(Eu))),r.json&&e.fromJSON(r.json),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Iu);var r=sa(e,e,t.schema({names:{version:Au,privateKeyAlgorithm:{names:{blockName:Nu}},privateKey:Cu,attributes:xu}}));switch(za.assertSchema(r,this.className),this.version=r.result.version.valueBlock.valueDec,this.privateKeyAlgorithm=new Nn({schema:r.result.privateKeyAlgorithm}),this.privateKey=r.result.privateKey,xu in r.result&&(this.attributes=Array.from(r.result.attributes,(function(e){return new Dn({schema:e})}))),this.privateKeyAlgorithm.algorithmId){case"1.2.840.113549.1.1.1":var a=Et(this.privateKey.valueBlock.valueHexView);-1!==a.offset&&(this.parsedKey=new Su({schema:a.result}));break;case"1.2.840.10045.2.1":if("algorithmParams"in this.privateKeyAlgorithm&&this.privateKeyAlgorithm.algorithmParams instanceof ar){var n=Et(this.privateKey.valueBlock.valueHexView);-1!==n.offset&&(this.parsedKey=new iu({namedCurve:this.privateKeyAlgorithm.algorithmParams.valueBlock.toString(),schema:n.result}))}}}},{key:"toSchema",value:function(){var e=[new Zt({value:this.version}),this.privateKeyAlgorithm.toSchema(),this.privateKey];return this.attributes&&e.push(new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes,(function(e){return e.toSchema()}))})),new cr({value:e})}},{key:"toJSON",value:function(){if(!this.parsedKey){var e={version:this.version,privateKeyAlgorithm:this.privateKeyAlgorithm.toJSON(),privateKey:this.privateKey.toJSON()};return this.attributes&&(e.attributes=Array.from(this.attributes,(function(e){return e.toJSON()}))),e}var t={};switch(this.privateKeyAlgorithm.algorithmId){case"1.2.840.10045.2.1":t.kty="EC";break;case"1.2.840.113549.1.1.1":t.kty="RSA"}var r=this.parsedKey.toJSON();return Object.assign(t,r),t}},{key:"fromJSON",value:function(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new iu({json:e}),this.privateKeyAlgorithm=new Nn({algorithmId:"1.2.840.10045.2.1",algorithmParams:new ar({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new Su({json:e}),this.privateKeyAlgorithm=new Nn({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new Ut});break;default:throw new Error('Invalid value for "kty" parameter: '.concat(e.kty))}this.privateKey=new _t({valueHex:this.parsedKey.toSchema().toBER(!1)})}}}],[{key:"defaultValues",value:function(e){switch(e){case Au:return 0;case Nu:return new Nn;case Cu:return new _t;case xu:return[];case Eu:return{};default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Zt({name:t.version||Xa}),Nn.schema(t.privateKeyAlgorithm||{}),new _t({name:t.privateKey||Xa}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new na({name:t.attributes||Xa,value:Dn.schema()})]})]})}}])}(Ya);Bu.CLASS_NAME="PrivateKeyInfo";var Vu="contentType",Du="contentEncryptionAlgorithm",Pu="encryptedContent",Ou=[Vu,Du,Pu],Ru=1024,Uu=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(i(this,t),(e=n(this,t)).contentType=Le(r,Vu,t.defaultValues(Vu)),e.contentEncryptionAlgorithm=Le(r,Du,t.defaultValues(Du)),Pu in r&&r.encryptedContent&&(e.encryptedContent=r.encryptedContent,1===e.encryptedContent.idBlock.tagClass&&4===e.encryptedContent.idBlock.tagNumber&&!1===e.encryptedContent.idBlock.isConstructed&&!r.disableSplit)){for(var a=new _t({idBlock:{isConstructed:!0},isConstructed:!0}),s=0,u=e.encryptedContent.valueBlock.valueHexView.slice().buffer,o=u.byteLength;o>0;){for(var l=new Uint8Array(u,s,s+Ru>u.byteLength?u.byteLength-s:Ru),c=new ArrayBuffer(l.length),h=new Uint8Array(c),f=0;f<h.length;f++)h[f]=l[f];a.valueBlock.value.push(new _t({valueHex:c})),o-=l.length,s+=l.length}e.encryptedContent=a}return r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Ou);var r=sa(e,e,t.schema({names:{contentType:Vu,contentEncryptionAlgorithm:{names:{blockName:Du}},encryptedContent:Pu}}));za.assertSchema(r,this.className),this.contentType=r.result.contentType.valueBlock.toString(),this.contentEncryptionAlgorithm=new Nn({schema:r.result.contentEncryptionAlgorithm}),Pu in r.result&&(this.encryptedContent=r.result.encryptedContent,this.encryptedContent.idBlock.tagClass=1,this.encryptedContent.idBlock.tagNumber=4)}},{key:"toSchema",value:function(){var e={isIndefiniteForm:!1},t=[];if(t.push(new ar({value:this.contentType})),t.push(this.contentEncryptionAlgorithm.toSchema()),this.encryptedContent){e.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed;var r=this.encryptedContent;r.idBlock.tagClass=3,r.idBlock.tagNumber=0,r.lenBlock.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed,t.push(r)}return new cr({lenBlock:e,value:t})}},{key:"toJSON",value:function(){var e={contentType:this.contentType,contentEncryptionAlgorithm:this.contentEncryptionAlgorithm.toJSON()};return this.encryptedContent&&(e.encryptedContent=this.encryptedContent.toJSON()),e}},{key:"getEncryptedContent",value:function(){if(!this.encryptedContent)throw new Error("Parameter 'encryptedContent' is undefined");return _t.prototype.getValue.call(this.encryptedContent)}}],[{key:"defaultValues",value:function(e){switch(e){case Vu:return Xa;case Du:return new Nn;case Pu:return new _t;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case Vu:return r===Xa;case Du:return r.algorithmId===Xa&&"algorithmParams"in r==!1;case Pu:return r.isEqual(t.defaultValues(Pu));default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new ar({name:t.contentType||Xa}),Nn.schema(t.contentEncryptionAlgorithm||{}),new aa({value:[new Vt({name:t.encryptedContent||Xa,idBlock:{tagClass:3,tagNumber:0},value:[new na({value:new _t})]}),new Nt({name:t.encryptedContent||Xa,idBlock:{tagClass:3,tagNumber:0}})]})]})}}])}(Ya);Uu.CLASS_NAME="EncryptedContentInfo";var Lu="hashAlgorithm",Tu="maskGenAlgorithm",Hu="saltLength",Mu="trailerField",Ku=[Lu,Tu,Hu,Mu],_u=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).hashAlgorithm=Le(r,Lu,t.defaultValues(Lu)),e.maskGenAlgorithm=Le(r,Tu,t.defaultValues(Tu)),e.saltLength=Le(r,Hu,t.defaultValues(Hu)),e.trailerField=Le(r,Mu,t.defaultValues(Mu)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Ku);var r=sa(e,e,t.schema({names:{hashAlgorithm:{names:{blockName:Lu}},maskGenAlgorithm:{names:{blockName:Tu}},saltLength:Hu,trailerField:Mu}}));za.assertSchema(r,this.className),Lu in r.result&&(this.hashAlgorithm=new Nn({schema:r.result.hashAlgorithm})),Tu in r.result&&(this.maskGenAlgorithm=new Nn({schema:r.result.maskGenAlgorithm})),Hu in r.result&&(this.saltLength=r.result.saltLength.valueBlock.valueDec),Mu in r.result&&(this.trailerField=r.result.trailerField.valueBlock.valueDec)}},{key:"toSchema",value:function(){var e=[];return this.hashAlgorithm.isEqual(t.defaultValues(Lu))||e.push(new Vt({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(t.defaultValues(Tu))||e.push(new Vt({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.saltLength!==t.defaultValues(Hu)&&e.push(new Vt({idBlock:{tagClass:3,tagNumber:2},value:[new Zt({value:this.saltLength})]})),this.trailerField!==t.defaultValues(Mu)&&e.push(new Vt({idBlock:{tagClass:3,tagNumber:3},value:[new Zt({value:this.trailerField})]})),new cr({value:e})}},{key:"toJSON",value:function(){var e={};return this.hashAlgorithm.isEqual(t.defaultValues(Lu))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(t.defaultValues(Tu))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.saltLength!==t.defaultValues(Hu)&&(e.saltLength=this.saltLength),this.trailerField!==t.defaultValues(Mu)&&(e.trailerField=this.trailerField),e}}],[{key:"defaultValues",value:function(e){switch(e){case Lu:return new Nn({algorithmId:"1.3.14.3.2.26",algorithmParams:new Ut});case Tu:return new Nn({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new Nn({algorithmId:"1.3.14.3.2.26",algorithmParams:new Ut}).toSchema()});case Hu:return 20;case Mu:return 1;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Vt({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[Nn.schema(t.hashAlgorithm||{})]}),new Vt({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[Nn.schema(t.maskGenAlgorithm||{})]}),new Vt({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[new Zt({name:t.saltLength||Xa})]}),new Vt({idBlock:{tagClass:3,tagNumber:3},optional:!0,value:[new Zt({name:t.trailerField||Xa})]})]})}}])}(Ya);_u.CLASS_NAME="RSASSAPSSParams";var ju="salt",Ju="iterationCount",Fu="keyLength",qu="prf",Xu=[ju,Ju,Fu,qu],Gu=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).salt=Le(r,ju,t.defaultValues(ju)),e.iterationCount=Le(r,Ju,t.defaultValues(Ju)),Fu in r&&(e.keyLength=Le(r,Fu,t.defaultValues(Fu))),qu in r&&(e.prf=Le(r,qu,t.defaultValues(qu))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Xu);var r=sa(e,e,t.schema({names:{saltPrimitive:ju,saltConstructed:{names:{blockName:ju}},iterationCount:Ju,keyLength:Fu,prf:{names:{blockName:qu,optional:!0}}}}));za.assertSchema(r,this.className),this.salt=r.result.salt,this.iterationCount=r.result.iterationCount.valueBlock.valueDec,Fu in r.result&&(this.keyLength=r.result.keyLength.valueBlock.valueDec),qu in r.result&&(this.prf=new Nn({schema:r.result.prf}))}},{key:"toSchema",value:function(){var e=[];return e.push(this.salt),e.push(new Zt({value:this.iterationCount})),Fu in this&&t.defaultValues(Fu)!==this.keyLength&&e.push(new Zt({value:this.keyLength})),this.prf&&!1===t.defaultValues(qu).isEqual(this.prf)&&e.push(this.prf.toSchema()),new cr({value:e})}},{key:"toJSON",value:function(){var e={salt:this.salt.toJSON(),iterationCount:this.iterationCount};return Fu in this&&t.defaultValues(Fu)!==this.keyLength&&(e.keyLength=this.keyLength),this.prf&&!1===t.defaultValues(qu).isEqual(this.prf)&&(e.prf=this.prf.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case ju:return{};case Ju:return-1;case Fu:return 0;case qu:return new Nn({algorithmId:"1.3.14.3.2.26",algorithmParams:new Ut});default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new aa({value:[new _t({name:t.saltPrimitive||Xa}),Nn.schema(t.saltConstructed||{})]}),new Zt({name:t.iterationCount||Xa}),new Zt({name:t.keyLength||Xa,optional:!0}),Nn.schema(t.prf||{names:{optional:!0}})]})}}])}(Ya);Gu.CLASS_NAME="PBKDF2Params";var Wu="keyDerivationFunc",zu="encryptionScheme",Yu=[Wu,zu],Qu=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).keyDerivationFunc=Le(r,Wu,t.defaultValues(Wu)),e.encryptionScheme=Le(r,zu,t.defaultValues(zu)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Yu);var r=sa(e,e,t.schema({names:{keyDerivationFunc:{names:{blockName:Wu}},encryptionScheme:{names:{blockName:zu}}}}));za.assertSchema(r,this.className),this.keyDerivationFunc=new Nn({schema:r.result.keyDerivationFunc}),this.encryptionScheme=new Nn({schema:r.result.encryptionScheme})}},{key:"toSchema",value:function(){return new cr({value:[this.keyDerivationFunc.toSchema(),this.encryptionScheme.toSchema()]})}},{key:"toJSON",value:function(){return{keyDerivationFunc:this.keyDerivationFunc.toJSON(),encryptionScheme:this.encryptionScheme.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case Wu:case zu:return new Nn;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[Nn.schema(t.keyDerivationFunc||{}),Nn.schema(t.encryptionScheme||{})]})}}])}(Ya);Qu.CLASS_NAME="PBES2Params";var Zu,$u,eo,to,ro,ao,no,io,so,uo=o((function e(t){i(this,e),this.crypto=t.crypto,this.subtle="webkitSubtle"in t.crypto?t.crypto.webkitSubtle:t.crypto.subtle,this.name=Le(t,"name",Xa)}),[{key:"encrypt",value:(so=a(k().mark((function e(){var t,r=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.subtle).encrypt.apply(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(){return so.apply(this,arguments)})},{key:"decrypt",value:(io=a(k().mark((function e(){var t,r=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.subtle).decrypt.apply(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(){return io.apply(this,arguments)})},{key:"sign",value:function(){var e;return(e=this.subtle).sign.apply(e,arguments)}},{key:"verify",value:(no=a(k().mark((function e(){var t,r=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.subtle).verify.apply(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(){return no.apply(this,arguments)})},{key:"digest",value:(ao=a(k().mark((function e(){var t,r=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.subtle).digest.apply(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(){return ao.apply(this,arguments)})},{key:"generateKey",value:(ro=a(k().mark((function e(){var t,r=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.subtle).generateKey.apply(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(){return ro.apply(this,arguments)})},{key:"deriveKey",value:(to=a(k().mark((function e(){var t,r=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.subtle).deriveKey.apply(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(){return to.apply(this,arguments)})},{key:"deriveBits",value:(eo=a(k().mark((function e(){var t,r=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.subtle).deriveBits.apply(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(){return eo.apply(this,arguments)})},{key:"wrapKey",value:($u=a(k().mark((function e(){var t,r=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.subtle).wrapKey.apply(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(){return $u.apply(this,arguments)})},{key:"unwrapKey",value:(Zu=a(k().mark((function e(){var t,r=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.subtle).unwrapKey.apply(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(){return Zu.apply(this,arguments)})},{key:"exportKey",value:function(){var e;return(e=this.subtle).exportKey.apply(e,arguments)}},{key:"importKey",value:function(){var e;return(e=this.subtle).importKey.apply(e,arguments)}},{key:"getRandomValues",value:function(e){return this.crypto.getRandomValues(e)}}]);function oo(e,t,r,a,n){return lo.apply(this,arguments)}function lo(){return(lo=a(k().mark((function e(t,r,a,n,i){var s,u,o,l,c,h,f,m,v,d,g,p,y,w,b,S,A;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.toUpperCase(),e.next="SHA-1"===e.t0?3:"SHA-256"===e.t0?7:"SHA-384"===e.t0?11:"SHA-512"===e.t0?15:19;break;case 3:return s=20,u=64,o=Ca,e.abrupt("break",20);case 7:return s=32,u=64,o=Va,e.abrupt("break",20);case 11:return s=48,u=128,o=Fa,e.abrupt("break",20);case 15:return s=64,u=128,o=Ja,e.abrupt("break",20);case 19:throw new Error("Unsupported hashing algorithm");case 20:for(l=new Uint8Array(a),c=(new TextDecoder).decode(a),(new TextEncoder).encode(c).some((function(e,t){return e!==l[t]}))&&(c=String.fromCharCode.apply(String,N(l))),h=new Uint8Array(2*c.length+2),f=new DataView(h.buffer),m=0;m<c.length;m++)f.setUint16(2*m,c.charCodeAt(m),!1);f.setUint16(2*c.length,0,!1),v=new Uint8Array(u).fill(3),d=new Uint8Array(n),g=new Uint8Array(u*Math.ceil(d.length/u)).map((function(e,t){return d[t%d.length]})),p=new Uint8Array(u*Math.ceil(h.length/u)).map((function(e,t){return h[t%h.length]})),(y=new Uint8Array(g.length+p.length)).set(g),y.set(p,g.length),w=Math.ceil((r>>3)/s),b=[],S=k().mark((function e(){var t,r,a,n,s,l,c,f,m;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for((t=new Uint8Array(v.length+y.length)).set(v),t.set(y,v.length),r=0;r<i;r++)t=o(t);for(a=new Uint8Array(u).map((function(e,r){return t[r%t.length]})),n=Math.ceil(d.length/u)+Math.ceil(h.length/u),s=[],l=0;l<n;l++){for(c=Array.from(y.slice(l*u,(l+1)*u)),f=511,m=a.length-1;m>=0;m--)f>>=8,f+=a[m]+(c[m]||0),c[m]=255&f;s.push.apply(s,c)}y=new Uint8Array(s),b.push.apply(b,N(t));case 10:case"end":return e.stop()}}),e)})),A=0;case 39:if(!(A<w)){e.next=44;break}return e.delegateYield(S(),"t1",41);case 41:A++,e.next=39;break;case 44:return e.abrupt("return",new Uint8Array(b.slice(0,r>>3)).buffer);case 45:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function co(e){var t="string"==typeof e?{name:e}:e;return"hash"in t?p(p({},t),{},{hash:co(t.hash)}):t}var ho=function(e){function t(){return i(this,t),n(this,t,arguments)}return m(t,e),o(t,[{key:"importKey",value:(p=a(k().mark((function e(t,r,a,n,i){var s,u,o,l,c,h,f,m,v,d,g,p,y,w,b,S,A,N,C,x;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:f={},m=co(a),e.t0=t.toLowerCase(),e.next="raw"===e.t0?5:"spki"===e.t0?6:"pkcs8"===e.t0?97:"jwk"===e.t0?185:187;break;case 5:return e.abrupt("return",this.subtle.importKey("raw",r,a,n,i));case 6:v=Et(Ie.toArrayBuffer(r)),za.assert(v,"keyData"),d=new $s,e.prev=9,d.fromSchema(v.result),e.next=16;break;case 13:throw e.prev=13,e.t1=e.catch(9),new Ga("Incorrect keyData");case 16:e.t2=m.name.toUpperCase(),e.next="RSA-PSS"===e.t2?19:"RSASSA-PKCS1-V1_5"===e.t2?33:"ECDSA"===e.t2?57:"ECDH"===e.t2?58:"RSA-OAEP"===e.t2?64:"RSAES-PKCS1-V1_5"===e.t2?88:95;break;case 19:if(m.hash){e.next=21;break}throw new Wa("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");case 21:e.t3=m.hash.name.toUpperCase(),e.next="SHA-1"===e.t3?24:"SHA-256"===e.t3?26:"SHA-384"===e.t3?28:"SHA-512"===e.t3?30:32;break;case 24:return f.alg="PS1",e.abrupt("break",33);case 26:return f.alg="PS256",e.abrupt("break",33);case 28:return f.alg="PS384",e.abrupt("break",33);case 30:return f.alg="PS512",e.abrupt("break",33);case 32:throw new Error("Incorrect hash algorithm: ".concat(m.hash.name.toUpperCase()));case 33:if(i=["verify"],f.kty="RSA",f.ext=n,f.key_ops=i,"1.2.840.113549.1.1.1"===d.algorithm.algorithmId){e.next=39;break}throw new Error("Incorrect public key algorithm: ".concat(d.algorithm.algorithmId));case 39:if(f.alg){e.next=54;break}if(m.hash){e.next=42;break}throw new Wa("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");case 42:e.t4=m.hash.name.toUpperCase(),e.next="SHA-1"===e.t4?45:"SHA-256"===e.t4?47:"SHA-384"===e.t4?49:"SHA-512"===e.t4?51:53;break;case 45:return f.alg="RS1",e.abrupt("break",54);case 47:return f.alg="RS256",e.abrupt("break",54);case 49:return f.alg="RS384",e.abrupt("break",54);case 51:return f.alg="RS512",e.abrupt("break",54);case 53:throw new Error("Incorrect hash algorithm: ".concat(m.hash.name.toUpperCase()));case 54:return g=d.toJSON(),Object.assign(f,g),e.abrupt("break",96);case 57:i=["verify"];case 58:if(f={kty:"EC",ext:n,key_ops:i},"1.2.840.10045.2.1"===d.algorithm.algorithmId){e.next=61;break}throw new Error("Incorrect public key algorithm: ".concat(d.algorithm.algorithmId));case 61:return p=d.toJSON(),Object.assign(f,p),e.abrupt("break",96);case 64:if(f.kty="RSA",f.ext=n,f.key_ops=i,"safari"!==this.name.toLowerCase()){e.next=71;break}f.alg="RSA-OAEP",e.next=85;break;case 71:if(m.hash){e.next=73;break}throw new Wa("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");case 73:e.t5=m.hash.name.toUpperCase(),e.next="SHA-1"===e.t5?76:"SHA-256"===e.t5?78:"SHA-384"===e.t5?80:"SHA-512"===e.t5?82:84;break;case 76:return f.alg="RSA-OAEP",e.abrupt("break",85);case 78:return f.alg="RSA-OAEP-256",e.abrupt("break",85);case 80:return f.alg="RSA-OAEP-384",e.abrupt("break",85);case 82:return f.alg="RSA-OAEP-512",e.abrupt("break",85);case 84:throw new Error("Incorrect hash algorithm: ".concat(m.hash.name.toUpperCase()));case 85:return y=d.toJSON(),Object.assign(f,y),e.abrupt("break",96);case 88:return f.kty="RSA",f.ext=n,f.key_ops=i,f.alg="PS1",w=d.toJSON(),Object.assign(f,w),e.abrupt("break",96);case 95:throw new Error("Incorrect algorithm name: ".concat(m.name.toUpperCase()));case 96:return e.abrupt("break",188);case 97:b=new Bu,S=Et(Ie.toArrayBuffer(r)),za.assert(S,"keyData"),e.prev=100,b.fromSchema(S.result),e.next=107;break;case 104:throw e.prev=104,e.t6=e.catch(100),new Error("Incorrect keyData");case 107:if(b.parsedKey){e.next=109;break}throw new Error("Incorrect keyData");case 109:e.t7=m.name.toUpperCase(),e.next="RSA-PSS"===e.t7?112:"RSASSA-PKCS1-V1_5"===e.t7?124:"ECDSA"===e.t7?146:"ECDH"===e.t7?147:"RSA-OAEP"===e.t7?153:"RSAES-PKCS1-V1_5"===e.t7?175:183;break;case 112:e.t8=null===(s=m.hash)||void 0===s?void 0:s.name.toUpperCase(),e.next="SHA-1"===e.t8?115:"SHA-256"===e.t8?117:"SHA-384"===e.t8?119:"SHA-512"===e.t8?121:123;break;case 115:return f.alg="PS1",e.abrupt("break",124);case 117:return f.alg="PS256",e.abrupt("break",124);case 119:return f.alg="PS384",e.abrupt("break",124);case 121:return f.alg="PS512",e.abrupt("break",124);case 123:throw new Error("Incorrect hash algorithm: ".concat(null===(u=m.hash)||void 0===u?void 0:u.name.toUpperCase()));case 124:if(i=["sign"],f.kty="RSA",f.ext=n,f.key_ops=i,"1.2.840.113549.1.1.1"===b.privateKeyAlgorithm.algorithmId){e.next=130;break}throw new Error("Incorrect private key algorithm: ".concat(b.privateKeyAlgorithm.algorithmId));case 130:if("alg"in f!=0){e.next=143;break}e.t9=null===(o=m.hash)||void 0===o?void 0:o.name.toUpperCase(),e.next="SHA-1"===e.t9?134:"SHA-256"===e.t9?136:"SHA-384"===e.t9?138:"SHA-512"===e.t9?140:142;break;case 134:return f.alg="RS1",e.abrupt("break",143);case 136:return f.alg="RS256",e.abrupt("break",143);case 138:return f.alg="RS384",e.abrupt("break",143);case 140:return f.alg="RS512",e.abrupt("break",143);case 142:throw new Error("Incorrect hash algorithm: ".concat(null===(l=m.hash)||void 0===l?void 0:l.name.toUpperCase()));case 143:return A=b.toJSON(),Object.assign(f,A),e.abrupt("break",184);case 146:i=["sign"];case 147:if(f={kty:"EC",ext:n,key_ops:i},"1.2.840.10045.2.1"===b.privateKeyAlgorithm.algorithmId){e.next=150;break}throw new Error("Incorrect algorithm: ".concat(b.privateKeyAlgorithm.algorithmId));case 150:return N=b.toJSON(),Object.assign(f,N),e.abrupt("break",184);case 153:if(f.kty="RSA",f.ext=n,f.key_ops=i,"safari"!==this.name.toLowerCase()){e.next=160;break}f.alg="RSA-OAEP",e.next=172;break;case 160:e.t10=null===(c=m.hash)||void 0===c?void 0:c.name.toUpperCase(),e.next="SHA-1"===e.t10?163:"SHA-256"===e.t10?165:"SHA-384"===e.t10?167:"SHA-512"===e.t10?169:171;break;case 163:return f.alg="RSA-OAEP",e.abrupt("break",172);case 165:return f.alg="RSA-OAEP-256",e.abrupt("break",172);case 167:return f.alg="RSA-OAEP-384",e.abrupt("break",172);case 169:return f.alg="RSA-OAEP-512",e.abrupt("break",172);case 171:throw new Error("Incorrect hash algorithm: ".concat(null===(h=m.hash)||void 0===h?void 0:h.name.toUpperCase()));case 172:return C=b.toJSON(),Object.assign(f,C),e.abrupt("break",184);case 175:return i=["decrypt"],f.kty="RSA",f.ext=n,f.key_ops=i,f.alg="PS1",x=b.toJSON(),Object.assign(f,x),e.abrupt("break",184);case 183:throw new Error("Incorrect algorithm name: ".concat(m.name.toUpperCase()));case 184:return e.abrupt("break",188);case 185:return f=r,e.abrupt("break",188);case 187:throw new Error("Incorrect format: ".concat(t));case 188:if("safari"!==this.name.toLowerCase()){e.next=196;break}return e.prev=189,e.abrupt("return",this.subtle.importKey("jwk",Ye(JSON.stringify(f)),a,n,i));case 193:return e.prev=193,e.t11=e.catch(189),e.abrupt("return",this.subtle.importKey("jwk",f,a,n,i));case 196:return e.abrupt("return",this.subtle.importKey("jwk",f,a,n,i));case 197:case"end":return e.stop()}}),e,this,[[9,13],[100,104],[189,193]])}))),function(e,t,r,a,n){return p.apply(this,arguments)})},{key:"exportKey",value:(g=a(k().mark((function e(t,r){var a,n,i;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.subtle.exportKey("jwk",r);case 2:a=e.sent,"safari"===this.name.toLowerCase()&&a instanceof ArrayBuffer&&(a=JSON.parse(ze(a))),e.t0=t.toLowerCase(),e.next="raw"===e.t0?7:"spki"===e.t0?8:"pkcs8"===e.t0?17:"jwk"===e.t0?26:27;break;case 7:return e.abrupt("return",this.subtle.exportKey("raw",r));case 8:n=new $s,e.prev=9,n.fromJSON(a),e.next=16;break;case 13:throw e.prev=13,e.t1=e.catch(9),new Error("Incorrect key data");case 16:return e.abrupt("return",n.toSchema().toBER(!1));case 17:i=new Bu,e.prev=18,i.fromJSON(a),e.next=25;break;case 22:throw e.prev=22,e.t2=e.catch(18),new Error("Incorrect key data");case 25:return e.abrupt("return",i.toSchema().toBER(!1));case 26:return e.abrupt("return",a);case 27:throw new Error("Incorrect format: ".concat(t));case 28:case"end":return e.stop()}}),e,this,[[9,13],[18,22]])}))),function(e,t){return g.apply(this,arguments)})},{key:"convert",value:(d=a(k().mark((function e(t,r,a,n,i,s){var u;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.toLowerCase()!==r.toLowerCase()){e.next=2;break}return e.abrupt("return",a);case 2:return e.next=4,this.importKey(t,a,n,i,s);case 4:return u=e.sent,e.abrupt("return",this.exportKey(r,u));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,r,a,n,i){return d.apply(this,arguments)})},{key:"getAlgorithmByOID",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;switch(e){case"1.2.840.113549.1.1.1":return{name:"RSAES-PKCS1-v1_5"};case"1.2.840.113549.1.1.5":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case"1.2.840.113549.1.1.11":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"1.2.840.113549.1.1.12":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case"1.2.840.113549.1.1.13":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case"1.2.840.113549.1.1.10":return{name:"RSA-PSS"};case"1.2.840.113549.1.1.7":return{name:"RSA-OAEP"};case"1.2.840.10045.2.1":case"1.2.840.10045.4.1":return{name:"ECDSA",hash:{name:"SHA-1"}};case"1.2.840.10045.4.3.2":return{name:"ECDSA",hash:{name:"SHA-256"}};case"1.2.840.10045.4.3.3":return{name:"ECDSA",hash:{name:"SHA-384"}};case"1.2.840.10045.4.3.4":return{name:"ECDSA",hash:{name:"SHA-512"}};case"1.3.133.16.840.63.0.2":return{name:"ECDH",kdf:"SHA-1"};case"1.3.132.1.11.1":return{name:"ECDH",kdf:"SHA-256"};case"1.3.132.1.11.2":return{name:"ECDH",kdf:"SHA-384"};case"1.3.132.1.11.3":return{name:"ECDH",kdf:"SHA-512"};case"2.16.840.1.101.3.4.1.2":return{name:"AES-CBC",length:128};case"2.16.840.1.101.3.4.1.22":return{name:"AES-CBC",length:192};case"2.16.840.1.101.3.4.1.42":return{name:"AES-CBC",length:256};case"2.16.840.1.101.3.4.1.6":return{name:"AES-GCM",length:128};case"2.16.840.1.101.3.4.1.26":return{name:"AES-GCM",length:192};case"2.16.840.1.101.3.4.1.46":return{name:"AES-GCM",length:256};case"2.16.840.1.101.3.4.1.4":return{name:"AES-CFB",length:128};case"2.16.840.1.101.3.4.1.24":return{name:"AES-CFB",length:192};case"2.16.840.1.101.3.4.1.44":return{name:"AES-CFB",length:256};case"2.16.840.1.101.3.4.1.5":return{name:"AES-KW",length:128};case"2.16.840.1.101.3.4.1.25":return{name:"AES-KW",length:192};case"2.16.840.1.101.3.4.1.45":return{name:"AES-KW",length:256};case"1.2.840.113549.2.7":return{name:"HMAC",hash:{name:"SHA-1"}};case"1.2.840.113549.2.9":return{name:"HMAC",hash:{name:"SHA-256"}};case"1.2.840.113549.2.10":return{name:"HMAC",hash:{name:"SHA-384"}};case"1.2.840.113549.2.11":return{name:"HMAC",hash:{name:"SHA-512"}};case"1.2.840.113549.1.9.16.3.5":return{name:"DH"};case"1.3.14.3.2.26":return{name:"SHA-1"};case"2.16.840.1.101.3.4.2.1":return{name:"SHA-256"};case"2.16.840.1.101.3.4.2.2":return{name:"SHA-384"};case"2.16.840.1.101.3.4.2.3":return{name:"SHA-512"};case"1.2.840.113549.1.5.12":return{name:"PBKDF2"};case"1.2.840.10045.3.1.7":return{name:"P-256"};case"1.3.132.0.34":return{name:"P-384"};case"1.3.132.0.35":return{name:"P-521"}}if(t)throw new Error("Unsupported algorithm identifier ".concat(r?"for ".concat(r," "):Xa,": ").concat(e));return{}}},{key:"getOIDByAlgorithm",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,a=Xa;switch(e.name.toUpperCase()){case"RSAES-PKCS1-V1_5":a="1.2.840.113549.1.1.1";break;case"RSASSA-PKCS1-V1_5":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.1.1.5";break;case"SHA-256":a="1.2.840.113549.1.1.11";break;case"SHA-384":a="1.2.840.113549.1.1.12";break;case"SHA-512":a="1.2.840.113549.1.1.13"}break;case"RSA-PSS":a="1.2.840.113549.1.1.10";break;case"RSA-OAEP":a="1.2.840.113549.1.1.7";break;case"ECDSA":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.10045.4.1";break;case"SHA-256":a="1.2.840.10045.4.3.2";break;case"SHA-384":a="1.2.840.10045.4.3.3";break;case"SHA-512":a="1.2.840.10045.4.3.4"}break;case"ECDH":switch(e.kdf.toUpperCase()){case"SHA-1":a="1.3.133.16.840.63.0.2";break;case"SHA-256":a="1.3.132.1.11.1";break;case"SHA-384":a="1.3.132.1.11.2";break;case"SHA-512":a="1.3.132.1.11.3"}break;case"AES-CTR":case"AES-CMAC":case"CONCAT":case"HKDF":break;case"AES-CBC":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.2";break;case 192:a="2.16.840.1.101.3.4.1.22";break;case 256:a="2.16.840.1.101.3.4.1.42"}break;case"AES-GCM":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.6";break;case 192:a="2.16.840.1.101.3.4.1.26";break;case 256:a="2.16.840.1.101.3.4.1.46"}break;case"AES-CFB":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.4";break;case 192:a="2.16.840.1.101.3.4.1.24";break;case 256:a="2.16.840.1.101.3.4.1.44"}break;case"AES-KW":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.5";break;case 192:a="2.16.840.1.101.3.4.1.25";break;case 256:a="2.16.840.1.101.3.4.1.45"}break;case"HMAC":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.2.7";break;case"SHA-256":a="1.2.840.113549.2.9";break;case"SHA-384":a="1.2.840.113549.2.10";break;case"SHA-512":a="1.2.840.113549.2.11"}break;case"DH":a="1.2.840.113549.1.9.16.3.5";break;case"SHA-1":a="1.3.14.3.2.26";break;case"SHA-256":a="2.16.840.1.101.3.4.2.1";break;case"SHA-384":a="2.16.840.1.101.3.4.2.2";break;case"SHA-512":a="2.16.840.1.101.3.4.2.3";break;case"PBKDF2":a="1.2.840.113549.1.5.12";break;case"P-256":a="1.2.840.10045.3.1.7";break;case"P-384":a="1.3.132.0.34";break;case"P-521":a="1.3.132.0.35"}if(!a&&t)throw new Error("Unsupported algorithm ".concat(r?"for ".concat(r," "):Xa,": ").concat(e.name));return a}},{key:"getAlgorithmParameters",value:function(e,t){var r={algorithm:{},usages:[]};switch(e.toUpperCase()){case"RSAES-PKCS1-V1_5":case"RSASSA-PKCS1-V1_5":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["sign","verify"]};break;case"verify":case"sign":case"importkey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},usages:["verify"]};break;default:return{algorithm:{name:"RSASSA-PKCS1-v1_5"},usages:[]}}break;case"RSA-PSS":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"},saltLength:20},usages:["sign","verify"]};break;case"generatekey":r={algorithm:{name:"RSA-PSS",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"}},usages:["verify"]};break;default:return{algorithm:{name:"RSA-PSS"},usages:[]}}break;case"RSA-OAEP":switch(t.toLowerCase()){case"encrypt":case"decrypt":r={algorithm:{name:"RSA-OAEP"},usages:["encrypt","decrypt"]};break;case"generatekey":r={algorithm:{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"importkey":r={algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]};break;default:return{algorithm:{name:"RSA-OAEP"},usages:[]}}break;case"ECDSA":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["verify"]};break;case"verify":case"sign":r={algorithm:{name:"ECDSA",hash:{name:"SHA-256"}},usages:["sign"]};break;default:return{algorithm:{name:"ECDSA"},usages:[]}}break;case"ECDH":switch(t.toLowerCase()){case"exportkey":case"importkey":case"generatekey":r={algorithm:{name:"ECDH",namedCurve:"P-256"},usages:["deriveKey","deriveBits"]};break;case"derivekey":case"derivebits":r={algorithm:{name:"ECDH",namedCurve:"P-256",public:[]},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"ECDH"},usages:[]}}break;case"AES-CTR":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CTR",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CTR",counter:new Uint8Array(16),length:10},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CTR"},usages:[]}}break;case"AES-CBC":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CBC",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CBC",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CBC"},usages:[]}}break;case"AES-GCM":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-GCM",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-GCM",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-GCM"},usages:[]}}break;case"AES-KW":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":case"wrapkey":case"unwrapkey":r={algorithm:{name:"AES-KW",length:256},usages:["wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-KW"},usages:[]}}break;case"HMAC":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"HMAC"},usages:["sign","verify"]};break;case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"HMAC",length:32,hash:{name:"SHA-256"}},usages:["sign","verify"]};break;default:return{algorithm:{name:"HMAC"},usages:[]}}break;case"HKDF":if("derivekey"!==t.toLowerCase())return{algorithm:{name:"HKDF"},usages:[]};r={algorithm:{name:"HKDF",hash:"SHA-256",salt:new Uint8Array([]),info:new Uint8Array([])},usages:["encrypt","decrypt"]};break;case"PBKDF2":if("derivekey"!==t.toLowerCase())return{algorithm:{name:"PBKDF2"},usages:[]};r={algorithm:{name:"PBKDF2",hash:{name:"SHA-256"},salt:new Uint8Array([]),iterations:1e4},usages:["encrypt","decrypt"]}}return r}},{key:"getHashAlgorithm",value:function(e){var t=Xa;switch(e.algorithmId){case"1.2.840.10045.4.1":case"1.2.840.113549.1.1.5":t="SHA-1";break;case"1.2.840.10045.4.3.2":case"1.2.840.113549.1.1.11":t="SHA-256";break;case"1.2.840.10045.4.3.3":case"1.2.840.113549.1.1.12":t="SHA-384";break;case"1.2.840.10045.4.3.4":case"1.2.840.113549.1.1.13":t="SHA-512";break;case"1.2.840.113549.1.1.10":try{var r=new _u({schema:e.algorithmParams});if(r.hashAlgorithm){var a=this.getAlgorithmByOID(r.hashAlgorithm.algorithmId);if(!("name"in a))return Xa;t=a.name}else t="SHA-1"}catch(e){}}return t}},{key:"encryptEncryptedContentInfo",value:(v=a(k().mark((function e(t){var r,a,n,i,s,u,o,l,c,h,f,m,v,d;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Wa.assert(t,"password","contentEncryptionAlgorithm","hmacHashAlgorithm","iterationCount","contentToEncrypt","contentToEncrypt","contentType"),r=this.getOIDByAlgorithm(t.contentEncryptionAlgorithm,!0,"contentEncryptionAlgorithm"),a=this.getOIDByAlgorithm({name:"PBKDF2"},!0,"PBKDF2"),n=this.getOIDByAlgorithm({name:"HMAC",hash:{name:t.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),i=new ArrayBuffer(16),s=new Uint8Array(i),this.getRandomValues(s),u=new ArrayBuffer(64),o=new Uint8Array(u),this.getRandomValues(o),l=new Uint8Array(t.contentToEncrypt),c=new Gu({salt:new _t({valueHex:u}),iterationCount:t.iterationCount,prf:new Nn({algorithmId:n,algorithmParams:new Ut})}),h=new Uint8Array(t.password),e.next=15,this.importKey("raw",h,"PBKDF2",!1,["deriveKey"]);case 15:return f=e.sent,e.next=18,this.deriveKey({name:"PBKDF2",hash:{name:t.hmacHashAlgorithm},salt:o,iterations:t.iterationCount},f,t.contentEncryptionAlgorithm,!1,["encrypt"]);case 18:return m=e.sent,e.next=21,this.encrypt({name:t.contentEncryptionAlgorithm.name,iv:s},m,l);case 21:return v=e.sent,d=new Qu({keyDerivationFunc:new Nn({algorithmId:a,algorithmParams:c.toSchema()}),encryptionScheme:new Nn({algorithmId:r,algorithmParams:new _t({valueHex:i})})}),e.abrupt("return",new Uu({contentType:t.contentType,contentEncryptionAlgorithm:new Nn({algorithmId:"1.2.840.113549.1.5.13",algorithmParams:d.toSchema()}),encryptedContent:new _t({valueHex:v})}));case 24:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"decryptEncryptedContentInfo",value:(f=a(k().mark((function e(t){var r,a,n,i,s,u,o,l,c,h,f,m,v;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Wa.assert(t,"password","encryptedContentInfo"),"1.2.840.113549.1.5.13"===t.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId){e.next=3;break}throw new Error('Unknown "contentEncryptionAlgorithm": '.concat(t.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId));case 3:e.prev=3,r=new Qu({schema:t.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams}),e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(3),new Error('Incorrectly encoded "pbes2Parameters"');case 10:e.prev=10,a=new Gu({schema:r.keyDerivationFunc.algorithmParams}),e.next=17;break;case 14:throw e.prev=14,e.t1=e.catch(10),new Error('Incorrectly encoded "pbkdf2Params"');case 17:return n=this.getAlgorithmByOID(r.encryptionScheme.algorithmId,!0),i=r.encryptionScheme.algorithmParams.valueBlock.valueHex,s=new Uint8Array(i),u=a.salt.valueBlock.valueHex,o=new Uint8Array(u),l=a.iterationCount,c="SHA-1",a.prf&&(h=this.getAlgorithmByOID(a.prf.algorithmId,!0),c=h.hash.name),e.next=27,this.importKey("raw",t.password,"PBKDF2",!1,["deriveKey"]);case 27:return f=e.sent,e.next=30,this.deriveKey({name:"PBKDF2",hash:{name:c},salt:o,iterations:l},f,n,!1,["decrypt"]);case 30:return m=e.sent,v=t.encryptedContentInfo.getEncryptedContent(),e.abrupt("return",this.decrypt({name:n.name,iv:s},m,v));case 33:case"end":return e.stop()}}),e,this,[[3,7],[10,14]])}))),function(e){return f.apply(this,arguments)})},{key:"stampDataWithPassword",value:(h=a(k().mark((function e(t){var r,a,n,i;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof Object!=0){e.next=2;break}throw new Error('Parameters must have type "Object"');case 2:Wa.assert(t,"password","hashAlgorithm","iterationCount","salt","contentToStamp"),e.t0=t.hashAlgorithm.toLowerCase(),e.next="sha-1"===e.t0?6:"sha-256"===e.t0?8:"sha-384"===e.t0?10:"sha-512"===e.t0?12:14;break;case 6:return r=160,e.abrupt("break",15);case 8:return r=256,e.abrupt("break",15);case 10:return r=384,e.abrupt("break",15);case 12:return r=512,e.abrupt("break",15);case 14:throw new Error('Incorrect "parameters.hashAlgorithm" parameter: '.concat(t.hashAlgorithm));case 15:return a={name:"HMAC",length:r,hash:{name:t.hashAlgorithm}},e.next=18,oo(t.hashAlgorithm,r,t.password,t.salt,t.iterationCount);case 18:return n=e.sent,e.next=21,this.importKey("raw",new Uint8Array(n),a,!1,["sign"]);case 21:return i=e.sent,e.abrupt("return",this.sign(a,i,new Uint8Array(t.contentToStamp)));case 23:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"verifyDataStampedWithPassword",value:(c=a(k().mark((function e(t){var r,a,n,i;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Wa.assert(t,"password","hashAlgorithm","salt","iterationCount","contentToVerify","signatureToVerify"),r=0,e.t0=t.hashAlgorithm.toLowerCase(),e.next="sha-1"===e.t0?5:"sha-256"===e.t0?7:"sha-384"===e.t0?9:"sha-512"===e.t0?11:13;break;case 5:return r=160,e.abrupt("break",14);case 7:return r=256,e.abrupt("break",14);case 9:return r=384,e.abrupt("break",14);case 11:return r=512,e.abrupt("break",14);case 13:throw new Error('Incorrect "parameters.hashAlgorithm" parameter: '.concat(t.hashAlgorithm));case 14:return a={name:"HMAC",length:r,hash:{name:t.hashAlgorithm}},e.next=17,oo(t.hashAlgorithm,r,t.password,t.salt,t.iterationCount);case 17:return n=e.sent,e.next=20,this.importKey("raw",new Uint8Array(n),a,!1,["verify"]);case 20:return i=e.sent,e.abrupt("return",this.verify(a,i,new Uint8Array(t.signatureToVerify),new Uint8Array(t.contentToVerify)));case 22:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"getSignatureParameters",value:(l=a(k().mark((function e(t){var r,a,n,i,s,u,o,l=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=l.length>1&&void 0!==l[1]?l[1]:"SHA-1",this.getOIDByAlgorithm({name:r},!0,"hashAlgorithm"),a=new Nn,n=this.getAlgorithmParameters(t.algorithm.name,"sign"),Object.keys(n.algorithm).length){e.next=6;break}throw new Error("Parameter 'algorithm' is empty");case 6:i=n.algorithm,"hash"in t.algorithm&&t.algorithm.hash&&t.algorithm.hash.name?i.hash.name=t.algorithm.hash.name:i.hash.name=r,e.t0=t.algorithm.name.toUpperCase(),e.next="RSASSA-PKCS1-V1_5"===e.t0||"ECDSA"===e.t0?11:"RSA-PSS"===e.t0?13:29;break;case 11:return a.algorithmId=this.getOIDByAlgorithm(i,!0),e.abrupt("break",30);case 13:e.t1=i.hash.name.toUpperCase(),e.next="SHA-256"===e.t1?16:"SHA-384"===e.t1?18:"SHA-512"===e.t1?20:22;break;case 16:return i.saltLength=32,e.abrupt("break",22);case 18:return i.saltLength=48,e.abrupt("break",22);case 20:return i.saltLength=64,e.abrupt("break",22);case 22:return s={},"SHA-1"!==i.hash.name.toUpperCase()&&(u=this.getOIDByAlgorithm({name:i.hash.name},!0,"hashAlgorithm"),s.hashAlgorithm=new Nn({algorithmId:u,algorithmParams:new Ut}),s.maskGenAlgorithm=new Nn({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:s.hashAlgorithm.toSchema()})),20!==i.saltLength&&(s.saltLength=i.saltLength),o=new _u(s),a.algorithmId="1.2.840.113549.1.1.10",a.algorithmParams=o.toSchema(),e.abrupt("break",30);case 29:throw new Error("Unsupported signature algorithm: ".concat(t.algorithm.name));case 30:return e.abrupt("return",{signatureAlgorithm:a,parameters:n});case 31:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"signWithPrivateKey",value:(u=a(k().mark((function e(t,r,a){var n;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sign(a.algorithm,r,t);case 2:if(n=e.sent,"ECDSA"!==a.algorithm.name){e.next=5;break}return e.abrupt("return",yo(n));case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return u.apply(this,arguments)})},{key:"fillPublicKeyParameters",value:function(e,t){var r,a={},n=this.getHashAlgorithm(t);if(n===Xa)throw new Error("Unsupported signature algorithm: ".concat(t.algorithmId));r="1.2.840.113549.1.1.10"===t.algorithmId?t.algorithmId:e.algorithm.algorithmId;var i=this.getAlgorithmByOID(r,!0);if(a.algorithm=this.getAlgorithmParameters(i.name,"importKey"),"hash"in a.algorithm.algorithm&&(a.algorithm.algorithm.hash.name=n),"ECDSA"===i.name){var s=e.algorithm;if(!s.algorithmParams)throw new Error("Algorithm parameters for ECDSA public key are missed");var u=s.algorithmParams;if("idBlock"in s.algorithmParams&&(1!==u.idBlock.tagClass||6!==u.idBlock.tagNumber))throw new Error("Incorrect type for ECDSA public key parameters");var o=this.getAlgorithmByOID(u.valueBlock.toString(),!0);a.algorithm.algorithm.namedCurve=o.name}return a}},{key:"getPublicKey",value:(s=a(k().mark((function e(t,r,a){var n;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a||(a=this.fillPublicKeyParameters(t,r)),n=t.toSchema().toBER(!1),e.abrupt("return",this.importKey("spki",n,a.algorithm.algorithm,!0,a.algorithm.usages));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return s.apply(this,arguments)})},{key:"verifyWithPublicKey",value:(r=a(k().mark((function e(t,r,a,n,i){var s,u,o,l,c,h,f,m,v,d,g,p,y;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=9;break}if(i=this.getHashAlgorithm(n)){e.next=4;break}throw new Error("Unsupported signature algorithm: ".concat(n.algorithmId));case 4:return e.next=6,this.getPublicKey(a,n);case 6:s=e.sent,e.next=24;break;case 9:if(u={},o="1.2.840.113549.1.1.10"===n.algorithmId?n.algorithmId:a.algorithm.algorithmId,l=this.getAlgorithmByOID(o,!0),u.algorithm=this.getAlgorithmParameters(l.name,"importKey"),"hash"in u.algorithm.algorithm&&(u.algorithm.algorithm.hash.name=i),"ECDSA"!==l.name){e.next=21;break}if(c=!1,"algorithmParams"in a.algorithm==1&&"idBlock"in a.algorithm.algorithmParams&&1===a.algorithm.algorithmParams.idBlock.tagClass&&6===a.algorithm.algorithmParams.idBlock.tagNumber&&(c=!0),!1!==c){e.next=19;break}throw new Error("Incorrect type for ECDSA public key parameters");case 19:h=this.getAlgorithmByOID(a.algorithm.algorithmParams.valueBlock.toString(),!0),u.algorithm.algorithm.namedCurve=h.name;case 21:return e.next=23,this.getPublicKey(a,null,u);case 23:s=e.sent;case 24:if("hash"in(f=this.getAlgorithmParameters(s.algorithm.name,"verify")).algorithm&&(f.algorithm.hash.name=i),m=r.valueBlock.valueHexView,"ECDSA"!==s.algorithm.name){e.next=34;break}if(v=_s.find(s.algorithm.namedCurve)){e.next=31;break}throw new Error("Unsupported named curve in use");case 31:d=Et(m),za.assert(d,"Signature value"),m=ko(d.result,v.size);case 34:return"RSA-PSS"===s.algorithm.name&&(g=new _u({schema:n.algorithmParams}),f.algorithm.saltLength="saltLength"in g?g.saltLength:20,p="SHA-1","hashAlgorithm"in g&&(y=this.getAlgorithmByOID(g.hashAlgorithm.algorithmId,!0),p=y.name),f.algorithm.hash.name=p),e.abrupt("return",this.verify(f.algorithm,s,m,t));case 36:case"end":return e.stop()}}),e,this)}))),function(e,t,a,n,i){return r.apply(this,arguments)})}]);var r,s,u,l,c,h,f,v,d,g,p}(uo),fo={name:"none",crypto:null};function mo(e){return!(!e||"object"!==x(e)||!("crypto"in e))}function vo(e){var t=null;if((arguments.length<=1?0:arguments.length-1)<2)t=!(arguments.length<=1)&&arguments.length-1?arguments.length<=1?void 0:arguments[1]:"undefined"!=typeof self&&self.crypto?new ho({name:"browser",crypto:self.crypto}):null;else{var r=arguments.length<=1?void 0:arguments[1],a=arguments.length<=2?void 0:arguments[2];mo(a)?t=a:mo(r)?t=r:"subtle"in r&&"getRandomValues"in r&&(t=new ho({crypto:r}))}if("undefined"!=typeof process&&"pid"in process&&"undefined"!=typeof global&&"undefined"==typeof window){if(void 0===global[process.pid])global[process.pid]={};else if("object"!==x(global[process.pid]))throw new Error("Name global.".concat(process.pid," already exists and it is not an object"));if(void 0===global[process.pid].pkijs)global[process.pid].pkijs={};else if("object"!==x(global[process.pid].pkijs))throw new Error("Name global.".concat(process.pid,".pkijs already exists and it is not an object"));global[process.pid].pkijs.engine={name:e,crypto:t}}else fo={name:e,crypto:t}}function go(){if("undefined"!=typeof process&&"pid"in process&&"undefined"!=typeof global&&"undefined"==typeof window){var e;try{e=global[process.pid].pkijs.engine}catch(e){throw new Error("Please call 'setEngine' before call to 'getEngine'")}return e}return fo}function po(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=go();if(!t.crypto&&e)throw new Error("Unable to create WebCrypto object");return t.crypto}function yo(e){if(e.byteLength%2!=0)return qa;var t=e.byteLength/2,r=new ArrayBuffer(t);new Uint8Array(r).set(new Uint8Array(e,0,t));var a=new Zt({valueHex:r}),n=new ArrayBuffer(t);new Uint8Array(n).set(new Uint8Array(e,t,t));var i=new Zt({valueHex:n});return new cr({value:[a.convertToDER(),i.convertToDER()]}).toBER(!1)}function ko(e,t){if(!(e instanceof cr&&2===e.valueBlock.value.length&&e.valueBlock.value[0]instanceof Zt&&e.valueBlock.value[1]instanceof Zt))return qa;var r=e.valueBlock.value[0].convertFromDER().valueBlock.valueHexView,a=e.valueBlock.value[1].convertFromDER().valueBlock.valueHexView,n=new Uint8Array(2*t);return n.set(r,t-r.byteLength),n.set(a,2*t-a.byteLength),n.buffer}function wo(e,t,r,a,n){return bo.apply(this,arguments)}function bo(){return(bo=a(k().mark((function e(t,r,a,n,i){var s,u,o,l;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.toUpperCase(),e.next="SHA-1"===e.t0||"SHA-256"===e.t0||"SHA-384"===e.t0||"SHA-512"===e.t0?3:4;break;case 3:return e.abrupt("break",5);case 4:throw new Ga("Unknown hash function: ".concat(t));case 5:if(Ga.assert(r,"zBuffer","ArrayBuffer"),0!==r.byteLength){e.next=8;break}throw new Ga("'zBuffer' has zero length, error");case 8:if(Ga.assert(n,"SharedInfo","ArrayBuffer"),!(a>255)){e.next=11;break}throw new Ga("Please set 'Counter' argument to value less or equal to 255");case 11:return s=new ArrayBuffer(4),(u=new Uint8Array(s))[0]=0,u[1]=0,u[2]=0,u[3]=a,o=Ke(o=qa,r),o=Ke(o,s),o=Ke(o,n),e.next=23,i.digest({name:t},o);case 23:return l=e.sent,e.abrupt("return",{counter:a,result:l});case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function So(e,t,r,a){return Ao.apply(this,arguments)}function Ao(){return Ao=a(k().mark((function e(t,r,a,n){var i,s,u,o,c,h,f,m,v,d,g,p,y,w,b,S,A=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=A.length>4&&void 0!==A[4]?A[4]:po(!0),s=0,u=1,e.t0=t.toUpperCase(),e.next="SHA-1"===e.t0?6:"SHA-256"===e.t0?8:"SHA-384"===e.t0?10:"SHA-512"===e.t0?12:14;break;case 6:return s=160,e.abrupt("break",15);case 8:return s=256,e.abrupt("break",15);case 10:return s=384,e.abrupt("break",15);case 12:return s=512,e.abrupt("break",15);case 14:throw new Ga("Unknown hash function: ".concat(t));case 15:if(Ga.assert(r,"Zbuffer","ArrayBuffer"),0!==r.byteLength){e.next=18;break}throw new Ga("'Zbuffer' has zero length, error");case 18:Ga.assert(n,"SharedInfo","ArrayBuffer"),o=a/s,Math.floor(o)>0&&(u=Math.floor(o),o-u>0&&u++),c=[],h=1;case 23:if(!(h<=u)){e.next=32;break}return e.t1=c,e.next=27,wo(t,r,h,n,i);case 27:e.t2=e.sent,e.t1.push.call(e.t1,e.t2);case 29:h++,e.next=23;break;case 32:f=qa,m=1,v=!0;case 35:if(!v){e.next=59;break}v=!1,d=l(c),e.prev=38,d.s();case 40:if((g=d.n()).done){e.next=48;break}if((p=g.value).counter!==m){e.next=46;break}return f=Ke(f,p.result),v=!0,e.abrupt("break",48);case 46:e.next=40;break;case 48:e.next=53;break;case 50:e.prev=50,e.t3=e.catch(38),d.e(e.t3);case 53:return e.prev=53,d.f(),e.finish(53);case 56:m++,e.next=35;break;case 59:if(a>>=3,!(f.byteLength>a)){e.next=66;break}for(y=new ArrayBuffer(a),w=new Uint8Array(y),b=new Uint8Array(f),S=0;S<a;S++)w[S]=b[S];return e.abrupt("return",y);case 66:return e.abrupt("return",f);case 67:case"end":return e.stop()}}),e,null,[[38,50,53,56]])}))),Ao.apply(this,arguments)}var No="version",Co="logID",xo="extensions",Eo="timestamp",Io="hashAlgorithm",Bo="signatureAlgorithm",Vo="signature",Do="none",Po="sha1",Oo="sha224",Ro="sha256",Uo="sha384",Lo="sha512",To="anonymous",Ho="ecdsa",Mo=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).version=Le(r,No,t.defaultValues(No)),e.logID=Le(r,Co,t.defaultValues(Co)),e.timestamp=Le(r,Eo,t.defaultValues(Eo)),e.extensions=Le(r,xo,t.defaultValues(xo)),e.hashAlgorithm=Le(r,Io,t.defaultValues(Io)),e.signatureAlgorithm=Le(r,Bo,t.defaultValues(Bo)),e.signature=Le(r,Vo,t.defaultValues(Vo)),"stream"in r&&r.stream&&e.fromStream(r.stream),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){if(e instanceof ia==!1)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestamp");var t=new la({stream:new ua({buffer:e.data})});this.fromStream(t)}},{key:"fromStream",value:function(e){var t=e.getUint16();if(this.version=e.getBlock(1)[0],0===this.version){this.logID=new Uint8Array(e.getBlock(32)).buffer.slice(0),this.timestamp=new Date(He(new Uint8Array(e.getBlock(8)),8));var r=e.getUint16();switch(this.extensions=new Uint8Array(e.getBlock(r)).buffer.slice(0),e.getBlock(1)[0]){case 0:this.hashAlgorithm=Do;break;case 1:this.hashAlgorithm="md5";break;case 2:this.hashAlgorithm=Po;break;case 3:this.hashAlgorithm=Oo;break;case 4:this.hashAlgorithm=Ro;break;case 5:this.hashAlgorithm=Uo;break;case 6:this.hashAlgorithm=Lo;break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}switch(e.getBlock(1)[0]){case 0:this.signatureAlgorithm=To;break;case 1:this.signatureAlgorithm="rsa";break;case 2:this.signatureAlgorithm="dsa";break;case 3:this.signatureAlgorithm=Ho;break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}var a=e.getUint16(),n=Et(new Uint8Array(e.getBlock(a)).buffer.slice(0));if(za.assert(n,"SignedCertificateTimestamp"),this.signature=n.result,t!==47+r+a)throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}}},{key:"toSchema",value:function(){var e=this.toStream();return new ia({data:e.stream.buffer})}},{key:"toStream",value:function(){var e=new la;e.appendUint16(47+this.extensions.byteLength+this.signature.valueBeforeDecodeView.byteLength),e.appendChar(this.version),e.appendView(new Uint8Array(this.logID));var t,r,a=new ArrayBuffer(8),n=new Uint8Array(a),i=Me(this.timestamp.valueOf(),8);switch(n.set(new Uint8Array(i),8-i.byteLength),e.appendView(n),e.appendUint16(this.extensions.byteLength),this.extensions.byteLength&&e.appendView(new Uint8Array(this.extensions)),this.hashAlgorithm.toLowerCase()){case Do:t=0;break;case"md5":t=1;break;case Po:t=2;break;case Oo:t=3;break;case Ro:t=4;break;case Uo:t=5;break;case Lo:t=6;break;default:throw new Error("Incorrect data for hashAlgorithm: ".concat(this.hashAlgorithm))}switch(e.appendChar(t),this.signatureAlgorithm.toLowerCase()){case To:r=0;break;case"rsa":r=1;break;case"dsa":r=2;break;case Ho:r=3;break;default:throw new Error("Incorrect data for signatureAlgorithm: ".concat(this.signatureAlgorithm))}e.appendChar(r);var s=this.signature.toBER(!1);return e.appendUint16(s.byteLength),e.appendView(new Uint8Array(s)),e}},{key:"toJSON",value:function(){return{version:this.version,logID:Te(this.logID),timestamp:this.timestamp,extensions:Te(this.extensions),hashAlgorithm:this.hashAlgorithm,signatureAlgorithm:this.signatureAlgorithm,signature:this.signature.toJSON()}}},{key:"verify",value:(r=a(k().mark((function e(t,r){var a,n,i,s,u,o,c,h,f,m,v,d,g,p=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=p.length>2&&void 0!==p[2]?p[2]:0,n=p.length>3&&void 0!==p[3]?p[3]:po(!0),i=Ge(ze(this.logID)),s=null,u=new la,o=l(t),e.prev=6,o.s();case 8:if((c=o.n()).done){e.next=15;break}if((h=c.value).log_id!==i){e.next=13;break}return s=h.key,e.abrupt("break",15);case 13:e.next=8;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(6),o.e(e.t0);case 20:return e.prev=20,o.f(),e.finish(20);case 23:if(s){e.next=25;break}throw new Error("Public key not found for CT with logId: ".concat(i));case 25:return f=Ye(We(s)),m=$s.fromBER(f),u.appendChar(0),u.appendChar(0),v=new ArrayBuffer(8),d=new Uint8Array(v),g=Me(this.timestamp.valueOf(),8),d.set(new Uint8Array(g),8-g.byteLength),u.appendView(d),u.appendUint16(a),0===a&&u.appendUint24(r.byteLength),u.appendView(new Uint8Array(r)),u.appendUint16(this.extensions.byteLength),0!==this.extensions.byteLength&&u.appendView(new Uint8Array(this.extensions)),e.abrupt("return",n.verifyWithPublicKey(u.buffer.slice(0,u.length),new _t({valueHex:this.signature.toBER(!1)}),m,{algorithmId:Xa},"SHA-256"));case 40:case"end":return e.stop()}}),e,this,[[6,17,20,23]])}))),function(e,t){return r.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case No:return 0;case Co:case xo:return qa;case Eo:return new Date(0);case Io:case Bo:return Xa;case Vo:return new ra;default:return A(t,"defaultValues",this,2)([e])}}}]);var r}(Ya);Mo.CLASS_NAME="SignedCertificateTimestamp";var Ko="timestamps",_o=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).timestamps=Le(r,Ko,t.defaultValues(Ko)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){if(e instanceof _t==!1)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");var t=new la({stream:new ua({buffer:e.valueBlock.valueHex})});if(t.getUint16()!==t.length)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");for(;t.length;)this.timestamps.push(new Mo({stream:t}))}},{key:"toSchema",value:function(){var e,t=new la,r=0,a=[],n=l(this.timestamps);try{for(n.s();!(e=n.n()).done;){var i=e.value.toStream();a.push(i),r+=i.stream.buffer.byteLength}}catch(e){n.e(e)}finally{n.f()}t.appendUint16(r);for(var s=0,u=a;s<u.length;s++){var o=u[s];t.appendView(o.stream.view)}return new _t({valueHex:t.stream.buffer.slice(0)})}},{key:"toJSON",value:function(){return{timestamps:Array.from(this.timestamps,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===Ko?[]:A(t,"defaultValues",this,2)([e])}},{key:"compareWithDefault",value:function(e,r){return e===Ko?0===r.length:A(t,"defaultValues",this,2)([e])}},{key:"schema",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=Le(t,"names",{});return null!==(e=r.optional)&&void 0!==e||(r.optional=!1),new _t({name:r.blockName||"SignedCertificateTimestampList",optional:r.optional})}}])}(Ya);_o.CLASS_NAME="SignedCertificateTimestampList";var jo="attributes",Jo=[jo],Fo=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).attributes=Le(r,jo,t.defaultValues(jo)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Jo);var r=sa(e,e,t.schema({names:{attributes:jo}}));za.assertSchema(r,this.className),this.attributes=Array.from(r.result.attributes,(function(e){return new Dn({schema:e})}))}},{key:"toSchema",value:function(){return new cr({value:Array.from(this.attributes,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{attributes:Array.from(this.attributes,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===jo?[]:A(t,"defaultValues",this,2)([e])}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new na({name:t.attributes||Xa,value:Dn.schema()})]})}}])}(Ya);Fo.CLASS_NAME="SubjectDirectoryAttributes";var qo=function(){function e(){i(this,e)}return o(e,null,[{key:"getItems",value:function(){return this.types||(this.types={},e.register(_n,"SubjectAltName",En),e.register(jn,"IssuerAltName",En),e.register(Zn,"AuthorityKeyIdentifier",gi),e.register(Jn,"BasicConstraints",ki),e.register("1.3.6.1.4.1.311.21.1","MicrosoftCaVersion",Si),e.register(zn,"CertificatePolicies",Oi),e.register("1.3.6.1.4.1.311.21.10","CertificatePoliciesMicrosoft",Oi),e.register("1.3.6.1.4.1.311.21.7","MicrosoftCertTemplateV2",Hi),e.register(Gn,"CRLDistributionPoints",Wi),e.register(Wn,"FreshestCRL",Wi),e.register("2.5.29.37","ExtKeyUsage",Qi),e.register(qn,"CertificateIssuer",Hn),e.register(ti,"AuthorityInfoAccess",$i),e.register("1.3.6.1.5.5.7.1.11","SubjectInfoAccess",$i),e.register(Fn,"IssuingDistributionPoint",os),e.register(Xn,"NameConstraints",ps),e.register($n,"PolicyConstraints",bs),e.register(Qn,"PolicyMappings",Is),e.register("2.5.29.16","PrivateKeyUsagePeriod",Ps),e.register("1.3.6.1.5.5.7.1.3","QCStatements",Ks),e.register("1.3.6.1.4.1.11129.2.4.2","SignedCertificateTimestampList",_o),e.register("2.5.29.9","SubjectDirectoryAttributes",Fo)),this.types}},{key:"fromBER",value:function(e,t){var r=Et(t);if(-1===r.offset)return null;var a=this.find(e);if(a)try{return new a.type({schema:r.result})}catch(t){var n=new a.type;return n.parsingError="Incorrectly formatted value of extension ".concat(a.name," (").concat(e,")"),n}return r.result}},{key:"find",value:function(e){return this.getItems()[e]||null}},{key:"register",value:function(e,t,r){this.getItems()[e]={name:t,type:r}}}])}(),Xo="extnID",Go="critical",Wo="extnValue",zo="parsedValue",Yo=[Xo,Go,Wo],Qo=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).extnID=Le(r,Xo,t.defaultValues(Xo)),e.critical=Le(r,Go,t.defaultValues(Go)),e.extnValue=Wo in r?new _t({valueHex:r.extnValue}):t.defaultValues(Wo),zo in r&&(e.parsedValue=Le(r,zo,t.defaultValues(zo))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"parsedValue",get:function(){if(void 0===this._parsedValue){var e=qo.fromBER(this.extnID,this.extnValue.valueBlock.valueHexView);this._parsedValue=e}return this._parsedValue||void 0},set:function(e){this._parsedValue=e}},{key:"fromSchema",value:function(e){Ze(e,Yo);var r=sa(e,e,t.schema({names:{extnID:Xo,critical:Go,extnValue:Wo}}));za.assertSchema(r,this.className),this.extnID=r.result.extnID.valueBlock.toString(),Go in r.result&&(this.critical=r.result.critical.valueBlock.value),this.extnValue=r.result.extnValue}},{key:"toSchema",value:function(){var e=[];return e.push(new ar({value:this.extnID})),this.critical!==t.defaultValues(Go)&&e.push(new Ht({value:this.critical})),e.push(this.extnValue),new cr({value:e})}},{key:"toJSON",value:function(){var e={extnID:this.extnID,extnValue:this.extnValue.toJSON()};return this.critical!==t.defaultValues(Go)&&(e.critical=this.critical),this.parsedValue&&this.parsedValue.toJSON&&(e.parsedValue=this.parsedValue.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Xo:return Xa;case Go:return!1;case Wo:return new _t;case zo:return{};default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new ar({name:t.extnID||Xa}),new Ht({name:t.critical||Xa,optional:!0}),new _t({name:t.extnValue||Xa})]})}}])}(Ya);Qo.CLASS_NAME="Extension";var Zo="extensions",$o=[Zo],el=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).extensions=Le(r,Zo,t.defaultValues(Zo)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,$o);var r=sa(e,e,t.schema({names:{extensions:Zo}}));za.assertSchema(r,this.className),this.extensions=Array.from(r.result.extensions,(function(e){return new Qo({schema:e})}))}},{key:"toSchema",value:function(){return new cr({value:Array.from(this.extensions,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{extensions:this.extensions.map((function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===Zo?[]:A(t,"defaultValues",this,2)([e])}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Le(e,"names",{});return new cr({optional:t,name:r.blockName||Xa,value:[new na({name:r.extensions||Xa,value:Qo.schema(r.extension||{})})]})}}])}(Ya);el.CLASS_NAME="Extensions";var tl="issuer",rl="serialNumber",al="issuerUID",nl=[tl,rl,al],il=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).issuer=Le(r,tl,t.defaultValues(tl)),e.serialNumber=Le(r,rl,t.defaultValues(rl)),al in r&&(e.issuerUID=Le(r,al,t.defaultValues(al))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,nl);var r=sa(e,e,t.schema({names:{issuer:{names:{blockName:tl}},serialNumber:rl,issuerUID:al}}));za.assertSchema(r,this.className),this.issuer=new Hn({schema:r.result.issuer}),this.serialNumber=r.result.serialNumber,al in r.result&&(this.issuerUID=r.result.issuerUID)}},{key:"toSchema",value:function(){var e=new cr({value:[this.issuer.toSchema(),this.serialNumber]});return this.issuerUID&&e.valueBlock.value.push(this.issuerUID),e}},{key:"toJSON",value:function(){var e={issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()};return this.issuerUID&&(e.issuerUID=this.issuerUID.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case tl:return new Hn;case rl:return new Zt;case al:return new qt;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[Hn.schema(t.issuer||{}),new Zt({name:t.serialNumber||Xa}),new qt({optional:!0,name:t.issuerUID||Xa})]})}}])}(Ya);il.CLASS_NAME="IssuerSerial";var sl="version",ul="baseCertificateID",ol="subjectName",ll="issuer",cl="signature",hl="serialNumber",fl="attrCertValidityPeriod",ml="attributes",vl="issuerUniqueID",dl="extensions",gl=[sl,ul,ol,ll,cl,hl,fl,ml,vl,dl],pl=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).version=Le(r,sl,t.defaultValues(sl)),ul in r&&(e.baseCertificateID=Le(r,ul,t.defaultValues(ul))),ol in r&&(e.subjectName=Le(r,ol,t.defaultValues(ol))),e.issuer=Le(r,ll,t.defaultValues(ll)),e.signature=Le(r,cl,t.defaultValues(cl)),e.serialNumber=Le(r,hl,t.defaultValues(hl)),e.attrCertValidityPeriod=Le(r,fl,t.defaultValues(fl)),e.attributes=Le(r,ml,t.defaultValues(ml)),vl in r&&(e.issuerUniqueID=Le(r,vl,t.defaultValues(vl))),dl in r&&(e.extensions=Le(r,dl,t.defaultValues(dl))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,gl);var r=sa(e,e,t.schema({names:{version:sl,baseCertificateID:ul,subjectName:ol,issuer:ll,signature:{names:{blockName:cl}},serialNumber:hl,attrCertValidityPeriod:{names:{blockName:fl}},attributes:ml,issuerUniqueID:vl,extensions:{names:{blockName:dl}}}}));za.assertSchema(r,this.className),this.version=r.result.version.valueBlock.valueDec,ul in r.result&&(this.baseCertificateID=new il({schema:new cr({value:r.result.baseCertificateID.valueBlock.value})})),ol in r.result&&(this.subjectName=new Hn({schema:new cr({value:r.result.subjectName.valueBlock.value})})),this.issuer=r.result.issuer,this.signature=new Nn({schema:r.result.signature}),this.serialNumber=r.result.serialNumber,this.attrCertValidityPeriod=new Un({schema:r.result.attrCertValidityPeriod}),this.attributes=Array.from(r.result.attributes.valueBlock.value,(function(e){return new Dn({schema:e})})),vl in r.result&&(this.issuerUniqueID=r.result.issuerUniqueID),dl in r.result&&(this.extensions=new el({schema:r.result.extensions}))}},{key:"toSchema",value:function(){var e=new cr({value:[new Zt({value:this.version})]});return this.baseCertificateID&&e.valueBlock.value.push(new Vt({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.subjectName&&e.valueBlock.value.push(new Vt({idBlock:{tagClass:3,tagNumber:1},value:this.subjectName.toSchema().valueBlock.value})),e.valueBlock.value.push(this.issuer.toSchema()),e.valueBlock.value.push(this.signature.toSchema()),e.valueBlock.value.push(this.serialNumber),e.valueBlock.value.push(this.attrCertValidityPeriod.toSchema()),e.valueBlock.value.push(new cr({value:Array.from(this.attributes,(function(e){return e.toSchema()}))})),this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}},{key:"toJSON",value:function(){var e={version:this.version};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.subjectName&&(e.subjectName=this.subjectName.toJSON()),e.issuer=this.issuer.toJSON(),e.signature=this.signature.toJSON(),e.serialNumber=this.serialNumber.toJSON(),e.attrCertValidityPeriod=this.attrCertValidityPeriod.toJSON(),e.attributes=Array.from(this.attributes,(function(e){return e.toJSON()})),this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case sl:return 0;case ul:return new il;case ol:case ll:return new Hn;case cl:return new Nn;case hl:return new Zt;case fl:return new Un;case ml:return[];case vl:return new qt;case dl:return new el;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Zt({name:t.version||Xa}),new aa({value:[new Vt({name:t.baseCertificateID||Xa,idBlock:{tagClass:3,tagNumber:0},value:il.schema().valueBlock.value}),new Vt({name:t.subjectName||Xa,idBlock:{tagClass:3,tagNumber:1},value:Hn.schema().valueBlock.value})]}),Hn.schema({names:{blockName:t.issuer||Xa}}),Nn.schema(t.signature||{}),new Zt({name:t.serialNumber||Xa}),Un.schema(t.attrCertValidityPeriod||{}),new cr({name:t.attributes||Xa,value:[new na({value:Dn.schema()})]}),new qt({optional:!0,name:t.issuerUniqueID||Xa}),el.schema(t.extensions||{},!0)]})}}])}(Ya);pl.CLASS_NAME="AttributeCertificateInfoV1";var yl="acinfo",kl="signatureAlgorithm",wl="signatureValue",bl=[yl,wl,kl],Sl=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).acinfo=Le(r,yl,t.defaultValues(yl)),e.signatureAlgorithm=Le(r,kl,t.defaultValues(kl)),e.signatureValue=Le(r,wl,t.defaultValues(wl)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,bl);var r=sa(e,e,t.schema({names:{acinfo:{names:{blockName:yl}},signatureAlgorithm:{names:{blockName:kl}},signatureValue:wl}}));za.assertSchema(r,this.className),this.acinfo=new pl({schema:r.result.acinfo}),this.signatureAlgorithm=new Nn({schema:r.result.signatureAlgorithm}),this.signatureValue=r.result.signatureValue}},{key:"toSchema",value:function(){return new cr({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}},{key:"toJSON",value:function(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case yl:return new pl;case kl:return new Nn;case wl:return new qt;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[pl.schema(t.acinfo||{}),Nn.schema(t.signatureAlgorithm||{}),new qt({name:t.signatureValue||Xa})]})}}])}(Ya);Sl.CLASS_NAME="AttributeCertificateV1";var Al="digestedObjectType",Nl="otherObjectTypeID",Cl="digestAlgorithm",xl="objectDigest",El=[Al,Nl,Cl,xl],Il=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).digestedObjectType=Le(r,Al,t.defaultValues(Al)),Nl in r&&(e.otherObjectTypeID=Le(r,Nl,t.defaultValues(Nl))),e.digestAlgorithm=Le(r,Cl,t.defaultValues(Cl)),e.objectDigest=Le(r,xl,t.defaultValues(xl)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,El);var r=sa(e,e,t.schema({names:{digestedObjectType:Al,otherObjectTypeID:Nl,digestAlgorithm:{names:{blockName:Cl}},objectDigest:xl}}));za.assertSchema(r,this.className),this.digestedObjectType=r.result.digestedObjectType,Nl in r.result&&(this.otherObjectTypeID=r.result.otherObjectTypeID),this.digestAlgorithm=new Nn({schema:r.result.digestAlgorithm}),this.objectDigest=r.result.objectDigest}},{key:"toSchema",value:function(){var e=new cr({value:[this.digestedObjectType]});return this.otherObjectTypeID&&e.valueBlock.value.push(this.otherObjectTypeID),e.valueBlock.value.push(this.digestAlgorithm.toSchema()),e.valueBlock.value.push(this.objectDigest),e}},{key:"toJSON",value:function(){var e={digestedObjectType:this.digestedObjectType.toJSON(),digestAlgorithm:this.digestAlgorithm.toJSON(),objectDigest:this.objectDigest.toJSON()};return this.otherObjectTypeID&&(e.otherObjectTypeID=this.otherObjectTypeID.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Al:return new $t;case Nl:return new ar;case Cl:return new Nn;case xl:return new qt;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new $t({name:t.digestedObjectType||Xa}),new ar({optional:!0,name:t.otherObjectTypeID||Xa}),Nn.schema(t.digestAlgorithm||{}),new qt({name:t.objectDigest||Xa})]})}}])}(Ya);Il.CLASS_NAME="ObjectDigestInfo";var Bl="issuerName",Vl="baseCertificateID",Dl="objectDigestInfo",Pl=[Bl,Vl,Dl],Ol=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),e=n(this,t),Bl in r&&(e.issuerName=Le(r,Bl,t.defaultValues(Bl))),Vl in r&&(e.baseCertificateID=Le(r,Vl,t.defaultValues(Vl))),Dl in r&&(e.objectDigestInfo=Le(r,Dl,t.defaultValues(Dl))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Pl);var r=sa(e,e,t.schema({names:{issuerName:Bl,baseCertificateID:Vl,objectDigestInfo:Dl}}));za.assertSchema(r,this.className),Bl in r.result&&(this.issuerName=new Hn({schema:r.result.issuerName})),Vl in r.result&&(this.baseCertificateID=new il({schema:new cr({value:r.result.baseCertificateID.valueBlock.value})})),Dl in r.result&&(this.objectDigestInfo=new Il({schema:new cr({value:r.result.objectDigestInfo.valueBlock.value})}))}},{key:"toSchema",value:function(){var e=new cr;return this.issuerName&&e.valueBlock.value.push(this.issuerName.toSchema()),this.baseCertificateID&&e.valueBlock.value.push(new Vt({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new Vt({idBlock:{tagClass:3,tagNumber:1},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}},{key:"toJSON",value:function(){var e={};return this.issuerName&&(e.issuerName=this.issuerName.toJSON()),this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Bl:return new Hn;case Vl:return new il;case Dl:return new Il;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[Hn.schema({names:{blockName:t.issuerName}},!0),new Vt({optional:!0,name:t.baseCertificateID||Xa,idBlock:{tagClass:3,tagNumber:0},value:il.schema().valueBlock.value}),new Vt({optional:!0,name:t.objectDigestInfo||Xa,idBlock:{tagClass:3,tagNumber:1},value:Il.schema().valueBlock.value})]})}}])}(Ya);Ol.CLASS_NAME="V2Form";var Rl="baseCertificateID",Ul="entityName",Ll="objectDigestInfo",Tl=[Rl,Ul,Ll],Hl=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),e=n(this,t),Rl in r&&(e.baseCertificateID=Le(r,Rl,t.defaultValues(Rl))),Ul in r&&(e.entityName=Le(r,Ul,t.defaultValues(Ul))),Ll in r&&(e.objectDigestInfo=Le(r,Ll,t.defaultValues(Ll))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Tl);var r=sa(e,e,t.schema({names:{baseCertificateID:Rl,entityName:Ul,objectDigestInfo:Ll}}));za.assertSchema(r,this.className),Rl in r.result&&(this.baseCertificateID=new il({schema:new cr({value:r.result.baseCertificateID.valueBlock.value})})),Ul in r.result&&(this.entityName=new Hn({schema:new cr({value:r.result.entityName.valueBlock.value})})),Ll in r.result&&(this.objectDigestInfo=new Il({schema:new cr({value:r.result.objectDigestInfo.valueBlock.value})}))}},{key:"toSchema",value:function(){var e=new cr;return this.baseCertificateID&&e.valueBlock.value.push(new Vt({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.entityName&&e.valueBlock.value.push(new Vt({idBlock:{tagClass:3,tagNumber:1},value:this.entityName.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new Vt({idBlock:{tagClass:3,tagNumber:2},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}},{key:"toJSON",value:function(){var e={};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.entityName&&(e.entityName=this.entityName.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Rl:return new il;case Ul:return new Hn;case Ll:return new Il;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Vt({optional:!0,name:t.baseCertificateID||Xa,idBlock:{tagClass:3,tagNumber:0},value:il.schema().valueBlock.value}),new Vt({optional:!0,name:t.entityName||Xa,idBlock:{tagClass:3,tagNumber:1},value:Hn.schema().valueBlock.value}),new Vt({optional:!0,name:t.objectDigestInfo||Xa,idBlock:{tagClass:3,tagNumber:2},value:Il.schema().valueBlock.value})]})}}])}(Ya);Hl.CLASS_NAME="Holder";var Ml="version",Kl="holder",_l="issuer",jl="signature",Jl="serialNumber",Fl="attrCertValidityPeriod",ql="attributes",Xl="issuerUniqueID",Gl="extensions",Wl=[Ml,Kl,_l,jl,Jl,Fl,ql,Xl,Gl],zl=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).version=Le(r,Ml,t.defaultValues(Ml)),e.holder=Le(r,Kl,t.defaultValues(Kl)),e.issuer=Le(r,_l,t.defaultValues(_l)),e.signature=Le(r,jl,t.defaultValues(jl)),e.serialNumber=Le(r,Jl,t.defaultValues(Jl)),e.attrCertValidityPeriod=Le(r,Fl,t.defaultValues(Fl)),e.attributes=Le(r,ql,t.defaultValues(ql)),Xl in r&&(e.issuerUniqueID=Le(r,Xl,t.defaultValues(Xl))),Gl in r&&(e.extensions=Le(r,Gl,t.defaultValues(Gl))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Wl);var r=sa(e,e,t.schema({names:{version:Ml,holder:{names:{blockName:Kl}},issuer:_l,signature:{names:{blockName:jl}},serialNumber:Jl,attrCertValidityPeriod:{names:{blockName:Fl}},attributes:ql,issuerUniqueID:Xl,extensions:{names:{blockName:Gl}}}}));if(za.assertSchema(r,this.className),this.version=r.result.version.valueBlock.valueDec,this.holder=new Hl({schema:r.result.holder}),3!==r.result.issuer.idBlock.tagClass)throw new Error("Incorrect value for 'issuer' in AttributeCertificateInfoV2");this.issuer=new Ol({schema:new cr({value:r.result.issuer.valueBlock.value})}),this.signature=new Nn({schema:r.result.signature}),this.serialNumber=r.result.serialNumber,this.attrCertValidityPeriod=new Un({schema:r.result.attrCertValidityPeriod}),this.attributes=Array.from(r.result.attributes.valueBlock.value,(function(e){return new Dn({schema:e})})),Xl in r.result&&(this.issuerUniqueID=r.result.issuerUniqueID),Gl in r.result&&(this.extensions=new el({schema:r.result.extensions}))}},{key:"toSchema",value:function(){var e=new cr({value:[new Zt({value:this.version}),this.holder.toSchema(),new Vt({idBlock:{tagClass:3,tagNumber:0},value:this.issuer.toSchema().valueBlock.value}),this.signature.toSchema(),this.serialNumber,this.attrCertValidityPeriod.toSchema(),new cr({value:Array.from(this.attributes,(function(e){return e.toSchema()}))})]});return this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}},{key:"toJSON",value:function(){var e={version:this.version,holder:this.holder.toJSON(),issuer:this.issuer.toJSON(),signature:this.signature.toJSON(),serialNumber:this.serialNumber.toJSON(),attrCertValidityPeriod:this.attrCertValidityPeriod.toJSON(),attributes:Array.from(this.attributes,(function(e){return e.toJSON()}))};return this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Ml:return 1;case Kl:return new Hl;case _l:return{};case jl:return new Nn;case Jl:return new Zt;case Fl:return new Un;case ql:return[];case Xl:return new qt;case Gl:return new el;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Zt({name:t.version||Xa}),Hl.schema(t.holder||{}),new aa({value:[Hn.schema({names:{blockName:t.issuer||Xa}}),new Vt({name:t.issuer||Xa,idBlock:{tagClass:3,tagNumber:0},value:Ol.schema().valueBlock.value})]}),Nn.schema(t.signature||{}),new Zt({name:t.serialNumber||Xa}),Un.schema(t.attrCertValidityPeriod||{}),new cr({name:t.attributes||Xa,value:[new na({value:Dn.schema()})]}),new qt({optional:!0,name:t.issuerUniqueID||Xa}),el.schema(t.extensions||{},!0)]})}}])}(Ya);zl.CLASS_NAME="AttributeCertificateInfoV2";var Yl="acinfo",Ql="signatureAlgorithm",Zl="signatureValue",$l=[Yl,Ql,Zl],ec=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).acinfo=Le(r,Yl,t.defaultValues(Yl)),e.signatureAlgorithm=Le(r,Ql,t.defaultValues(Ql)),e.signatureValue=Le(r,Zl,t.defaultValues(Zl)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,$l);var r=sa(e,e,t.schema({names:{acinfo:{names:{blockName:Yl}},signatureAlgorithm:{names:{blockName:Ql}},signatureValue:Zl}}));za.assertSchema(r,this.className),this.acinfo=new zl({schema:r.result.acinfo}),this.signatureAlgorithm=new Nn({schema:r.result.signatureAlgorithm}),this.signatureValue=r.result.signatureValue}},{key:"toSchema",value:function(){return new cr({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}},{key:"toJSON",value:function(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case Yl:return new zl;case Ql:return new Nn;case Zl:return new qt;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[zl.schema(t.acinfo||{}),Nn.schema(t.signatureAlgorithm||{}),new qt({name:t.signatureValue||Xa})]})}}])}(Ya);ec.CLASS_NAME="AttributeCertificateV2";var tc="contentType",rc="content",ac=[tc,rc],nc=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).contentType=Le(r,tc,t.defaultValues(tc)),e.content=Le(r,rc,t.defaultValues(rc)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,ac);var r=sa(e,e,t.schema());za.assertSchema(r,this.className),this.contentType=r.result.contentType.valueBlock.toString(),this.content=r.result.content}},{key:"toSchema",value:function(){return new cr({value:[new ar({value:this.contentType}),new Vt({idBlock:{tagClass:3,tagNumber:0},value:[this.content]})]})}},{key:"toJSON",value:function(){var e={contentType:this.contentType};return this.content instanceof ra||(e.content=this.content.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case tc:return Xa;case rc:return new ra;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case tc:return"string"==typeof r&&r===this.defaultValues(tc);case rc:return r instanceof ra;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return"optional"in t==!1&&(t.optional=!1),new cr({name:t.blockName||"ContentInfo",optional:t.optional,value:[new ar({name:t.contentType||tc}),new Vt({idBlock:{tagClass:3,tagNumber:0},value:[new ra({name:t.content||rc})]})]})}}])}(Ya);nc.CLASS_NAME="ContentInfo",nc.DATA=ri,nc.SIGNED_DATA=ai,nc.ENVELOPED_DATA=ni,nc.ENCRYPTED_DATA=ii;var ic,sc="type",uc="value",oc="utcTimeName",lc="generalTimeName",cc=[oc,lc];!function(e){e[e.UTCTime=0]="UTCTime",e[e.GeneralizedTime=1]="GeneralizedTime",e[e.empty=2]="empty"}(ic||(ic={}));var hc=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).type=Le(r,sc,t.defaultValues(sc)),e.value=Le(r,uc,t.defaultValues(uc)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,cc);var r=sa(e,e,t.schema({names:{utcTimeName:oc,generalTimeName:lc}}));za.assertSchema(r,this.className),oc in r.result&&(this.type=0,this.value=r.result.utcTimeName.toDate()),lc in r.result&&(this.type=1,this.value=r.result.generalTimeName.toDate())}},{key:"toSchema",value:function(){return 0===this.type?new Fr({valueDate:this.value}):1===this.type?new Xr({valueDate:this.value}):{}}},{key:"toJSON",value:function(){return{type:this.type,value:this.value}}}],[{key:"defaultValues",value:function(e){switch(e){case sc:return 0;case uc:return new Date(0,0,0);default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Le(e,"names",{});return new aa({optional:t,value:[new Fr({name:r.utcTimeName||Xa}),new Xr({name:r.generalTimeName||Xa})]})}}])}(Ya);hc.CLASS_NAME="Time";var fc="tbs",mc="version",vc="serialNumber",dc="signature",gc="issuer",pc="notBefore",yc="notAfter",kc="subject",wc="subjectPublicKeyInfo",bc="issuerUniqueID",Sc="subjectUniqueID",Ac="extensions",Nc="signatureAlgorithm",Cc="signatureValue",xc="tbsCertificate",Ec="".concat(xc,".").concat(mc),Ic="".concat(xc,".").concat(vc),Bc="".concat(xc,".").concat(dc),Vc="".concat(xc,".").concat(gc),Dc="".concat(xc,".").concat(pc),Pc="".concat(xc,".").concat(yc),Oc="".concat(xc,".").concat(kc),Rc="".concat(xc,".").concat(wc),Uc="".concat(xc,".").concat(bc),Lc="".concat(xc,".").concat(Sc),Tc="".concat(xc,".").concat(Ac),Hc=[xc,Ec,Ic,Bc,Vc,Dc,Pc,Oc,Rc,Uc,Lc,Tc,Nc,Cc];function Mc(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||xc,value:[new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Zt({name:t.tbsCertificateVersion||Ec})]}),new Zt({name:t.tbsCertificateSerialNumber||Ic}),Nn.schema(t.signature||{names:{blockName:Bc}}),an.schema(t.issuer||{names:{blockName:Vc}}),new cr({name:t.tbsCertificateValidity||"tbsCertificate.validity",value:[hc.schema(t.notBefore||{names:{utcTimeName:Dc,generalTimeName:Dc}}),hc.schema(t.notAfter||{names:{utcTimeName:Pc,generalTimeName:Pc}})]}),an.schema(t.subject||{names:{blockName:Oc}}),$s.schema(t.subjectPublicKeyInfo||{names:{blockName:Rc}}),new Nt({name:t.tbsCertificateIssuerUniqueID||Uc,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new Nt({name:t.tbsCertificateSubjectUniqueID||Lc,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[el.schema(t.extensions||{names:{blockName:Tc}})]})]})}var Kc=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).tbsView=new Uint8Array(Le(r,fc,t.defaultValues(fc))),e.version=Le(r,mc,t.defaultValues(mc)),e.serialNumber=Le(r,vc,t.defaultValues(vc)),e.signature=Le(r,dc,t.defaultValues(dc)),e.issuer=Le(r,gc,t.defaultValues(gc)),e.notBefore=Le(r,pc,t.defaultValues(pc)),e.notAfter=Le(r,yc,t.defaultValues(yc)),e.subject=Le(r,kc,t.defaultValues(kc)),e.subjectPublicKeyInfo=Le(r,wc,t.defaultValues(wc)),bc in r&&(e.issuerUniqueID=Le(r,bc,t.defaultValues(bc))),Sc in r&&(e.subjectUniqueID=Le(r,Sc,t.defaultValues(Sc))),Ac in r&&(e.extensions=Le(r,Ac,t.defaultValues(Ac))),e.signatureAlgorithm=Le(r,Nc,t.defaultValues(Nc)),e.signatureValue=Le(r,Cc,t.defaultValues(Cc)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"tbs",get:function(){return Ie.toArrayBuffer(this.tbsView)},set:function(e){this.tbsView=new Uint8Array(e)}},{key:"fromSchema",value:function(e){Ze(e,Hc);var r=sa(e,e,t.schema({names:{tbsCertificate:{names:{extensions:{names:{extensions:Tc}}}}}}));za.assertSchema(r,this.className),this.tbsView=r.result.tbsCertificate.valueBeforeDecodeView,Ec in r.result&&(this.version=r.result[Ec].valueBlock.valueDec),this.serialNumber=r.result[Ic],this.signature=new Nn({schema:r.result[Bc]}),this.issuer=new an({schema:r.result[Vc]}),this.notBefore=new hc({schema:r.result[Dc]}),this.notAfter=new hc({schema:r.result[Pc]}),this.subject=new an({schema:r.result[Oc]}),this.subjectPublicKeyInfo=new $s({schema:r.result[Rc]}),Uc in r.result&&(this.issuerUniqueID=r.result[Uc].valueBlock.valueHex),Lc in r.result&&(this.subjectUniqueID=r.result[Lc].valueBlock.valueHex),Tc in r.result&&(this.extensions=Array.from(r.result[Tc],(function(e){return new Qo({schema:e})}))),this.signatureAlgorithm=new Nn({schema:r.result.signatureAlgorithm}),this.signatureValue=r.result.signatureValue}},{key:"encodeTBS",value:function(){var e=[];return mc in this&&this.version!==t.defaultValues(mc)&&e.push(new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Zt({value:this.version})]})),e.push(this.serialNumber),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(new cr({value:[this.notBefore.toSchema(),this.notAfter.toSchema()]})),e.push(this.subject.toSchema()),e.push(this.subjectPublicKeyInfo.toSchema()),this.issuerUniqueID&&e.push(new Nt({optional:!0,idBlock:{tagClass:3,tagNumber:1},valueHex:this.issuerUniqueID})),this.subjectUniqueID&&e.push(new Nt({optional:!0,idBlock:{tagClass:3,tagNumber:2},valueHex:this.subjectUniqueID})),this.extensions&&e.push(new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[new cr({value:Array.from(this.extensions,(function(e){return e.toSchema()}))})]})),new cr({value:e})}},{key:"toSchema",value:function(){var e,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!1===r){if(!this.tbsView.byteLength)return t.schema().value[0];var a=Et(this.tbsView);za.assert(a,"TBS Certificate"),e=a.result}else e=this.encodeTBS();return new cr({value:[e,this.signatureAlgorithm.toSchema(),this.signatureValue]})}},{key:"toJSON",value:function(){var e={tbs:Ue.ToHex(this.tbsView),version:this.version,serialNumber:this.serialNumber.toJSON(),signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),notBefore:this.notBefore.toJSON(),notAfter:this.notAfter.toJSON(),subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return mc in this&&this.version!==t.defaultValues(mc)&&(e.version=this.version),this.issuerUniqueID&&(e.issuerUniqueID=Ue.ToHex(this.issuerUniqueID)),this.subjectUniqueID&&(e.subjectUniqueID=Ue.ToHex(this.subjectUniqueID)),this.extensions&&(e.extensions=Array.from(this.extensions,(function(e){return e.toJSON()}))),e}},{key:"getPublicKey",value:(l=a(k().mark((function e(t){var r,a=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:po(!0),e.abrupt("return",r.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"getKeyHash",value:(u=a(k().mark((function e(){var t,r,a=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:"SHA-1",r=a.length>1&&void 0!==a[1]?a[1]:po(!0),e.abrupt("return",r.digest({name:t},this.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView));case 3:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"sign",value:(s=a(k().mark((function e(t){var r,a,n,i,s,u=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>1&&void 0!==u[1]?u[1]:"SHA-1",a=u.length>2&&void 0!==u[2]?u[2]:po(!0),t){e.next=4;break}throw new Error("Need to provide a private key for signing");case 4:return e.next=6,a.getSignatureParameters(t,r);case 6:return n=e.sent,i=n.parameters,this.signature=n.signatureAlgorithm,this.signatureAlgorithm=n.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER()),e.next=13,a.signWithPrivateKey(this.tbsView,t,i);case 13:s=e.sent,this.signatureValue=new qt({valueHex:s});case 15:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"verify",value:(r=a(k().mark((function e(t){var r,a,n=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.length>1&&void 0!==n[1]?n[1]:po(!0),t?a=t.subjectPublicKeyInfo:this.issuer.isEqual(this.subject)&&(a=this.subjectPublicKeyInfo),a instanceof $s){e.next=4;break}throw new Error("Please provide issuer certificate as a parameter");case 4:return e.abrupt("return",r.verifyWithPublicKey(this.tbsView,this.signatureValue,a,this.signatureAlgorithm));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case fc:return qa;case mc:return 0;case vc:return new Zt;case dc:return new Nn;case gc:return new an;case pc:case yc:return new hc;case kc:return new an;case wc:return new $s;case bc:case Sc:return qa;case Ac:return[];case Nc:return new Nn;case Cc:return new qt;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[Mc(t.tbsCertificate),Nn.schema(t.signatureAlgorithm||{names:{blockName:Nc}}),new qt({name:t.signatureValue||Cc})]})}}]);var r,s,u,l}(Ya);function _c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t&&e.issuer.isEqual(t.issuer)&&e.serialNumber.isEqual(t.serialNumber))return null;var r=!1;if(e.extensions){var a,n=l(e.extensions);try{for(n.s();!(a=n.n()).done;){var i=a.value;if(i.extnID===Jn&&i.parsedValue instanceof ki&&i.parsedValue.cA){r=!0;break}}}catch(e){n.e(e)}finally{n.f()}}return r?e:null}Kc.CLASS_NAME="Certificate";var jc="certId",Jc="certValue",Fc="parsedValue",qc=[jc,Jc],Xc=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).certId=Le(r,jc,t.defaultValues(jc)),e.certValue=Le(r,Jc,t.defaultValues(Jc)),Fc in r&&(e.parsedValue=Le(r,Fc,t.defaultValues(Fc))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,qc);var r=sa(e,e,t.schema({names:{id:jc,value:Jc}}));za.assertSchema(r,this.className),this.certId=r.result.certId.valueBlock.toString(),this.certValue=r.result.certValue;var a=this.certValue.valueBlock.valueHexView;switch(this.certId){case ui:try{this.parsedValue=Kc.fromBER(a)}catch(e){ec.fromBER(a)}break;case oi:this.parsedValue=ec.fromBER(a);break;default:throw new Error("Incorrect CERT_ID value in CertBag: ".concat(this.certId))}}},{key:"toSchema",value:function(){return Fc in this&&("acinfo"in this.parsedValue?this.certId=oi:this.certId=ui,this.certValue=new _t({valueHex:this.parsedValue.toSchema().toBER(!1)})),new cr({value:[new ar({value:this.certId}),new Vt({idBlock:{tagClass:3,tagNumber:0},value:["toSchema"in this.certValue?this.certValue.toSchema():this.certValue]})]})}},{key:"toJSON",value:function(){return{certId:this.certId,certValue:this.certValue.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case jc:return Xa;case Jc:return new ra;case Fc:return{};default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case jc:return r===Xa;case Jc:return r instanceof ra;case Fc:return r instanceof Object&&0===Object.keys(r).length;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new ar({name:t.id||"id"}),new Vt({idBlock:{tagClass:3,tagNumber:0},value:[new ra({name:t.value||"value"})]})]})}}])}(Ya);Xc.CLASS_NAME="CertBag";var Gc="userCertificate",Wc="revocationDate",zc="crlEntryExtensions",Yc=[Gc,Wc,zc],Qc=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).userCertificate=Le(r,Gc,t.defaultValues(Gc)),e.revocationDate=Le(r,Wc,t.defaultValues(Wc)),zc in r&&(e.crlEntryExtensions=Le(r,zc,t.defaultValues(zc))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Yc);var r=sa(e,e,t.schema());za.assertSchema(r,this.className),this.userCertificate=r.result.userCertificate,this.revocationDate=new hc({schema:r.result.revocationDate}),zc in r.result&&(this.crlEntryExtensions=new el({schema:r.result.crlEntryExtensions}))}},{key:"toSchema",value:function(){var e=[this.userCertificate,this.revocationDate.toSchema()];return this.crlEntryExtensions&&e.push(this.crlEntryExtensions.toSchema()),new cr({value:e})}},{key:"toJSON",value:function(){var e={userCertificate:this.userCertificate.toJSON(),revocationDate:this.revocationDate.toJSON()};return this.crlEntryExtensions&&(e.crlEntryExtensions=this.crlEntryExtensions.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Gc:return new Zt;case Wc:return new hc;case zc:return new el;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Zt({name:t.userCertificate||Gc}),hc.schema({names:{utcTimeName:t.revocationDate||Wc,generalTimeName:t.revocationDate||Wc}}),el.schema({names:{blockName:t.crlEntryExtensions||zc}},!0)]})}}])}(Ya);Qc.CLASS_NAME="RevokedCertificate";var Zc="tbs",$c="version",eh="signature",th="issuer",rh="thisUpdate",ah="nextUpdate",nh="revokedCertificates",ih="crlExtensions",sh="signatureAlgorithm",uh="signatureValue",oh="tbsCertList",lh="".concat(oh,".version"),ch="".concat(oh,".signature"),hh="".concat(oh,".issuer"),fh="".concat(oh,".thisUpdate"),mh="".concat(oh,".nextUpdate"),vh="".concat(oh,".revokedCertificates"),dh="".concat(oh,".extensions"),gh=[oh,lh,ch,hh,fh,mh,vh,dh,sh,uh];function ph(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||oh,value:[new Zt({optional:!0,name:t.tbsCertListVersion||lh,value:2}),Nn.schema(t.signature||{names:{blockName:ch}}),an.schema(t.issuer||{names:{blockName:hh}}),hc.schema(t.tbsCertListThisUpdate||{names:{utcTimeName:fh,generalTimeName:fh}}),hc.schema(t.tbsCertListNextUpdate||{names:{utcTimeName:mh,generalTimeName:mh}},!0),new cr({optional:!0,value:[new na({name:t.tbsCertListRevokedCertificates||vh,value:new cr({value:[new Zt,hc.schema(),el.schema({},!0)]})})]}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[el.schema(t.crlExtensions||{names:{blockName:dh}})]})]})}var yh=[Zn,jn,"2.5.29.20","2.5.29.27",Fn,Wn,ti,"2.5.29.21","2.5.29.24",qn],kh=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).tbsView=new Uint8Array(Le(r,Zc,t.defaultValues(Zc))),e.version=Le(r,$c,t.defaultValues($c)),e.signature=Le(r,eh,t.defaultValues(eh)),e.issuer=Le(r,th,t.defaultValues(th)),e.thisUpdate=Le(r,rh,t.defaultValues(rh)),ah in r&&(e.nextUpdate=Le(r,ah,t.defaultValues(ah))),nh in r&&(e.revokedCertificates=Le(r,nh,t.defaultValues(nh))),ih in r&&(e.crlExtensions=Le(r,ih,t.defaultValues(ih))),e.signatureAlgorithm=Le(r,sh,t.defaultValues(sh)),e.signatureValue=Le(r,uh,t.defaultValues(uh)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"tbs",get:function(){return Ie.toArrayBuffer(this.tbsView)},set:function(e){this.tbsView=new Uint8Array(e)}},{key:"fromSchema",value:function(e){Ze(e,gh);var r=sa(e,e,t.schema());za.assertSchema(r,this.className),this.tbsView=r.result.tbsCertList.valueBeforeDecodeView,lh in r.result&&(this.version=r.result[lh].valueBlock.valueDec),this.signature=new Nn({schema:r.result[ch]}),this.issuer=new an({schema:r.result[hh]}),this.thisUpdate=new hc({schema:r.result[fh]}),mh in r.result&&(this.nextUpdate=new hc({schema:r.result[mh]})),vh in r.result&&(this.revokedCertificates=Array.from(r.result[vh],(function(e){return new Qc({schema:e})}))),dh in r.result&&(this.crlExtensions=new el({schema:r.result[dh]})),this.signatureAlgorithm=new Nn({schema:r.result.signatureAlgorithm}),this.signatureValue=r.result.signatureValue}},{key:"encodeTBS",value:function(){var e=[];return this.version!==t.defaultValues($c)&&e.push(new Zt({value:this.version})),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(this.thisUpdate.toSchema()),this.nextUpdate&&e.push(this.nextUpdate.toSchema()),this.revokedCertificates&&e.push(new cr({value:Array.from(this.revokedCertificates,(function(e){return e.toSchema()}))})),this.crlExtensions&&e.push(new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.crlExtensions.toSchema()]})),new cr({value:e})}},{key:"toSchema",value:function(){var e,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(r)e=this.encodeTBS();else{if(!this.tbsView.byteLength)return t.schema();var a=Et(this.tbsView);za.assert(a,"TBS Certificate Revocation List"),e=a.result}return new cr({value:[e,this.signatureAlgorithm.toSchema(),this.signatureValue]})}},{key:"toJSON",value:function(){var e={tbs:Ue.ToHex(this.tbsView),version:this.version,signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),thisUpdate:this.thisUpdate.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return this.version!==t.defaultValues($c)&&(e.version=this.version),this.nextUpdate&&(e.nextUpdate=this.nextUpdate.toJSON()),this.revokedCertificates&&(e.revokedCertificates=Array.from(this.revokedCertificates,(function(e){return e.toJSON()}))),this.crlExtensions&&(e.crlExtensions=this.crlExtensions.toJSON()),e}},{key:"isCertificateRevoked",value:function(e){if(!this.issuer.isEqual(e.issuer))return!1;if(!this.revokedCertificates)return!1;var t,r=l(this.revokedCertificates);try{for(r.s();!(t=r.n()).done;){if(t.value.userCertificate.isEqual(e.serialNumber))return!0}}catch(e){r.e(e)}finally{r.f()}return!1}},{key:"sign",value:(s=a(k().mark((function e(t){var r,a,n,i,s,u=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>1&&void 0!==u[1]?u[1]:"SHA-1",a=u.length>2&&void 0!==u[2]?u[2]:po(!0),t){e.next=4;break}throw new Error("Need to provide a private key for signing");case 4:return e.next=6,a.getSignatureParameters(t,r);case 6:return n=e.sent,i=n.parameters,this.signature=n.signatureAlgorithm,this.signatureAlgorithm=n.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER()),e.next=13,a.signWithPrivateKey(this.tbsView,t,i);case 13:s=e.sent,this.signatureValue=new qt({valueHex:s});case 15:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"verify",value:(r=a(k().mark((function e(){var t,r,a,n,i,s,u=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u.length>0&&void 0!==u[0]?u[0]:{},r=u.length>1&&void 0!==u[1]?u[1]:po(!0),!t.issuerCertificate){e.next=6;break}if(a=t.issuerCertificate.subjectPublicKeyInfo,this.issuer.isEqual(t.issuerCertificate.subject)){e.next=6;break}return e.abrupt("return",!1);case 6:if(t.publicKeyInfo&&(a=t.publicKeyInfo),a){e.next=9;break}throw new Error("Issuer's certificate must be provided as an input parameter");case 9:if(!this.crlExtensions){e.next=28;break}n=l(this.crlExtensions.extensions),e.prev=11,n.s();case 13:if((i=n.n()).done){e.next=20;break}if(!(s=i.value).critical){e.next=18;break}if(yh.includes(s.extnID)){e.next=18;break}return e.abrupt("return",!1);case 18:e.next=13;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(11),n.e(e.t0);case 25:return e.prev=25,n.f(),e.finish(25);case 28:return e.abrupt("return",r.verifyWithPublicKey(this.tbsView,this.signatureValue,a,this.signatureAlgorithm));case 29:case"end":return e.stop()}}),e,this,[[11,22,25,28]])}))),function(){return r.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case Zc:return qa;case $c:return 0;case eh:return new Nn;case th:return new an;case rh:case ah:return new hc;case nh:return[];case ih:return new el;case sh:return new Nn;case uh:return new qt;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||"CertificateList",value:[ph(e),Nn.schema(t.signatureAlgorithm||{names:{blockName:sh}}),new qt({name:t.signatureValue||uh})]})}}]);var r,s}(Ya);kh.CLASS_NAME="CertificateRevocationList";var wh="crlId",bh="crlValue",Sh="parsedValue",Ah=[wh,bh],Nh=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).crlId=Le(r,wh,t.defaultValues(wh)),e.crlValue=Le(r,bh,t.defaultValues(bh)),Sh in r&&(e.parsedValue=Le(r,Sh,t.defaultValues(Sh))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Ah);var r=sa(e,e,t.schema({names:{id:wh,value:bh}}));if(za.assertSchema(r,this.className),this.crlId=r.result.crlId.valueBlock.toString(),this.crlValue=r.result.crlValue,this.crlId!==li)throw new Error("Incorrect CRL_ID value in CRLBag: ".concat(this.crlId));this.parsedValue=kh.fromBER(this.certValue.valueBlock.valueHex)}},{key:"toSchema",value:function(){return this.parsedValue&&(this.crlId=li,this.crlValue=new _t({valueHex:this.parsedValue.toSchema().toBER(!1)})),new cr({value:[new ar({value:this.crlId}),new Vt({idBlock:{tagClass:3,tagNumber:0},value:[this.crlValue.toSchema()]})]})}},{key:"toJSON",value:function(){return{crlId:this.crlId,crlValue:this.crlValue.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case wh:return Xa;case bh:return new ra;case Sh:return{};default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case wh:return r===Xa;case bh:return r instanceof ra;case Sh:return r instanceof Object&&0===Object.keys(r).length;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new ar({name:t.id||"id"}),new Vt({idBlock:{tagClass:3,tagNumber:0},value:[new ra({name:t.value||"value"})]})]})}}])}(Ya);Nh.CLASS_NAME="CRLBag";var Ch="version",xh="encryptedContentInfo",Eh="unprotectedAttrs",Ih=[Ch,xh,Eh],Bh=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).version=Le(r,Ch,t.defaultValues(Ch)),e.encryptedContentInfo=Le(r,xh,t.defaultValues(xh)),Eh in r&&(e.unprotectedAttrs=Le(r,Eh,t.defaultValues(Eh))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Ih);var r=sa(e,e,t.schema({names:{version:Ch,encryptedContentInfo:{names:{blockName:xh}},unprotectedAttrs:Eh}}));za.assertSchema(r,this.className),this.version=r.result.version.valueBlock.valueDec,this.encryptedContentInfo=new Uu({schema:r.result.encryptedContentInfo}),Eh in r.result&&(this.unprotectedAttrs=Array.from(r.result.unprotectedAttrs,(function(e){return new Dn({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(new Zt({value:this.version})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,(function(e){return e.toSchema()}))})),new cr({value:e})}},{key:"toJSON",value:function(){var e={version:this.version,encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,(function(e){return e.toJSON()}))),e}},{key:"encrypt",value:(s=a(k().mark((function e(t){var r,a,n=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&void 0!==n[1]?n[1]:po(!0),Ga.assert(t,"parameters","object"),a=p(p({},t),{},{contentType:"1.2.840.113549.1.7.1"}),e.next=5,r.encryptEncryptedContentInfo(a);case 5:this.encryptedContentInfo=e.sent;case 6:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"decrypt",value:(r=a(k().mark((function e(t){var r,a,n=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&void 0!==n[1]?n[1]:po(!0),Ga.assert(t,"parameters","object"),a=p(p({},t),{},{encryptedContentInfo:this.encryptedContentInfo}),e.abrupt("return",r.decryptEncryptedContentInfo(a));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case Ch:return 0;case xh:return new Uu;case Eh:return[];default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case Ch:return 0===r;case xh:return Uu.compareWithDefault("contentType",r.contentType)&&Uu.compareWithDefault("contentEncryptionAlgorithm",r.contentEncryptionAlgorithm)&&Uu.compareWithDefault("encryptedContent",r.encryptedContent);case Eh:return 0===r.length;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Zt({name:t.version||Xa}),Uu.schema(t.encryptedContentInfo||{}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new na({name:t.unprotectedAttrs||Xa,value:Dn.schema()})]})]})}}]);var r,s}(Ya);Bh.CLASS_NAME="EncryptedData";var Vh="encryptionAlgorithm",Dh="encryptedData",Ph="parsedValue",Oh=[Vh,Dh],Rh=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).encryptionAlgorithm=Le(r,Vh,t.defaultValues(Vh)),e.encryptedData=Le(r,Dh,t.defaultValues(Dh)),Ph in r&&(e.parsedValue=Le(r,Ph,t.defaultValues(Ph))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Oh);var r=sa(e,e,t.schema({names:{encryptionAlgorithm:{names:{blockName:Vh}},encryptedData:Dh}}));za.assertSchema(r,this.className),this.encryptionAlgorithm=new Nn({schema:r.result.encryptionAlgorithm}),this.encryptedData=r.result.encryptedData}},{key:"toSchema",value:function(){return new cr({value:[this.encryptionAlgorithm.toSchema(),this.encryptedData]})}},{key:"toJSON",value:function(){return{encryptionAlgorithm:this.encryptionAlgorithm.toJSON(),encryptedData:this.encryptedData.toJSON()}}},{key:"parseInternalValues",value:(s=a(k().mark((function e(t){var r,a,n,i=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:po(!0),a=new Bh({encryptedContentInfo:new Uu({contentEncryptionAlgorithm:this.encryptionAlgorithm,encryptedContent:this.encryptedData})}),e.next=4,a.decrypt(t,r);case 4:n=e.sent,this.parsedValue=Bu.fromBER(n);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"makeInternalValues",value:(r=a(k().mark((function e(t){var r,a,n,i=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>1&&void 0!==i[1]?i[1]:po(!0),this.parsedValue){e.next=3;break}throw new Error('Please initialize "parsedValue" first');case 3:return a=new Bh,n=p(p({},t),{},{contentToEncrypt:this.parsedValue.toSchema().toBER(!1)}),e.next=7,a.encrypt(n,r);case 7:if(a.encryptedContentInfo.encryptedContent){e.next=9;break}throw new Error("The filed `encryptedContent` in EncryptedContentInfo is empty");case 9:this.encryptionAlgorithm=a.encryptedContentInfo.contentEncryptionAlgorithm,this.encryptedData=a.encryptedContentInfo.encryptedContent;case 11:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case Vh:return new Nn;case Dh:return new _t;case Ph:return{};default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case Vh:return Nn.compareWithDefault("algorithmId",r.algorithmId)&&"algorithmParams"in r==!1;case Dh:return r.isEqual(t.defaultValues(e));case Ph:return r instanceof Object&&0===Object.keys(r).length;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[Nn.schema(t.encryptionAlgorithm||{names:{blockName:Vh}}),new aa({value:[new _t({name:t.encryptedData||Dh}),new _t({idBlock:{isConstructed:!0},name:t.encryptedData||Dh})]})]})}}]);var r,s}(Ya);Rh.CLASS_NAME="PKCS8ShroudedKeyBag";var Uh="secretTypeId",Lh="secretValue",Th=[Uh,Lh],Hh=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).secretTypeId=Le(r,Uh,t.defaultValues(Uh)),e.secretValue=Le(r,Lh,t.defaultValues(Lh)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Th);var r=sa(e,e,t.schema({names:{id:Uh,value:Lh}}));za.assertSchema(r,this.className),this.secretTypeId=r.result.secretTypeId.valueBlock.toString(),this.secretValue=r.result.secretValue}},{key:"toSchema",value:function(){return new cr({value:[new ar({value:this.secretTypeId}),new Vt({idBlock:{tagClass:3,tagNumber:0},value:[this.secretValue.toSchema()]})]})}},{key:"toJSON",value:function(){return{secretTypeId:this.secretTypeId,secretValue:this.secretValue.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case Uh:return Xa;case Lh:return new ra;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case Uh:return r===Xa;case Lh:return r instanceof ra;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new ar({name:t.id||"id"}),new Vt({idBlock:{tagClass:3,tagNumber:0},value:[new ra({name:t.value||"value"})]})]})}}])}(Ya);Hh.CLASS_NAME="SecretBag";var Mh=function(){function e(){i(this,e)}return o(e,null,[{key:"getItems",value:function(){return this.items||(this.items={},e.register("1.2.840.113549.1.12.10.1.1",Bu),e.register("1.2.840.113549.1.12.10.1.2",Rh),e.register("1.2.840.113549.1.12.10.1.3",Xc),e.register("1.2.840.113549.1.12.10.1.4",Nh),e.register("1.2.840.113549.1.12.10.1.5",Hh),e.register("1.2.840.113549.1.12.10.1.6",Xh)),this.items}},{key:"register",value:function(e,t){this.getItems()[e]=t}},{key:"find",value:function(e){return this.getItems()[e]||null}}])}(),Kh="bagId",_h="bagValue",jh="bagAttributes",Jh=[Kh,_h,jh],Fh=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).bagId=Le(r,Kh,t.defaultValues(Kh)),e.bagValue=Le(r,_h,t.defaultValues(_h)),jh in r&&(e.bagAttributes=Le(r,jh,t.defaultValues(jh))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Jh);var r=sa(e,e,t.schema({names:{bagId:Kh,bagValue:_h,bagAttributes:jh}}));za.assertSchema(r,this.className),this.bagId=r.result.bagId.valueBlock.toString();var a=Mh.find(this.bagId);if(!a)throw new Error("Invalid BAG_ID for SafeBag: ".concat(this.bagId));this.bagValue=new a({schema:r.result.bagValue}),jh in r.result&&(this.bagAttributes=Array.from(r.result.bagAttributes,(function(e){return new Dn({schema:e})})))}},{key:"toSchema",value:function(){var e=[new ar({value:this.bagId}),new Vt({idBlock:{tagClass:3,tagNumber:0},value:[this.bagValue.toSchema()]})];return this.bagAttributes&&e.push(new hr({value:Array.from(this.bagAttributes,(function(e){return e.toSchema()}))})),new cr({value:e})}},{key:"toJSON",value:function(){var e={bagId:this.bagId,bagValue:this.bagValue.toJSON()};return this.bagAttributes&&(e.bagAttributes=Array.from(this.bagAttributes,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case Kh:return Xa;case _h:return new ra;case jh:return[];default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case Kh:return r===Xa;case _h:return r instanceof ra;case jh:return 0===r.length;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new ar({name:t.bagId||Kh}),new Vt({idBlock:{tagClass:3,tagNumber:0},value:[new ra({name:t.bagValue||_h})]}),new hr({optional:!0,value:[new na({name:t.bagAttributes||jh,value:Dn.schema()})]})]})}}])}(Ya);Fh.CLASS_NAME="SafeBag";var qh="safeBags",Xh=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).safeBags=Le(r,qh,t.defaultValues(qh)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,[qh]);var r=sa(e,e,t.schema({names:{safeBags:qh}}));za.assertSchema(r,this.className),this.safeBags=Array.from(r.result.safeBags,(function(e){return new Fh({schema:e})}))}},{key:"toSchema",value:function(){return new cr({value:Array.from(this.safeBags,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{safeBags:Array.from(this.safeBags,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===qh?[]:A(t,"defaultValues",this,2)([e])}},{key:"compareWithDefault",value:function(e,r){return e===qh?0===r.length:A(t,"defaultValues",this,2)([e])}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new na({name:t.safeBags||Xa,value:Fh.schema()})]})}}])}(Ya);Xh.CLASS_NAME="SafeContents";var Gh="otherCertFormat",Wh="otherCert",zh=[Gh,Wh],Yh=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).otherCertFormat=Le(r,Gh,t.defaultValues(Gh)),e.otherCert=Le(r,Wh,t.defaultValues(Wh)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,zh);var r=sa(e,e,t.schema());za.assertSchema(r,this.className),this.otherCertFormat=r.result.otherCertFormat.valueBlock.toString(),this.otherCert=r.result.otherCert}},{key:"toSchema",value:function(){return new cr({value:[new ar({value:this.otherCertFormat}),this.otherCert]})}},{key:"toJSON",value:function(){var e={otherCertFormat:this.otherCertFormat};return this.otherCert instanceof ra||(e.otherCert=this.otherCert.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Gh:return Xa;case Wh:return new ra;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new ar({name:t.otherCertFormat||Gh}),new ra({name:t.otherCert||Wh})]})}}])}(Ya),Qh="certificates",Zh=[Qh],$h=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).certificates=Le(r,Qh,t.defaultValues(Qh)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Zh);var r=sa(e,e,t.schema());za.assertSchema(r,this.className),this.certificates=Array.from(r.result.certificates||[],(function(e){var t=e.idBlock.tagNumber;if(1===e.idBlock.tagClass)return new Kc({schema:e});var r=new cr({value:e.valueBlock.value});switch(t){case 1:return 1===r.valueBlock.value[0].valueBlock.value[0].valueBlock.valueDec?new ec({schema:r}):new Sl({schema:r});case 2:return new ec({schema:r});case 3:return new Yh({schema:r})}return e}))}},{key:"toSchema",value:function(){return new hr({value:Array.from(this.certificates,(function(e){switch(!0){case e instanceof Kc:return e.toSchema();case e instanceof Sl:return new Vt({idBlock:{tagClass:3,tagNumber:1},value:e.toSchema().valueBlock.value});case e instanceof ec:return new Vt({idBlock:{tagClass:3,tagNumber:2},value:e.toSchema().valueBlock.value});case e instanceof Yh:return new Vt({idBlock:{tagClass:3,tagNumber:3},value:e.toSchema().valueBlock.value})}return e.toSchema()}))})}},{key:"toJSON",value:function(){return{certificates:Array.from(this.certificates,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===Qh?[]:A(t,"defaultValues",this,2)([e])}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new hr({name:t.blockName||Xa,value:[new na({name:t.certificates||Qh,value:new aa({value:[Kc.schema(),new Vt({idBlock:{tagClass:3,tagNumber:0},value:[new ra]}),new Vt({idBlock:{tagClass:3,tagNumber:1},value:[new cr]}),new Vt({idBlock:{tagClass:3,tagNumber:2},value:ec.schema().valueBlock.value}),new Vt({idBlock:{tagClass:3,tagNumber:3},value:Yh.schema().valueBlock.value})]})})]})}}])}(Ya);$h.CLASS_NAME="CertificateSet";var ef="otherRevInfoFormat",tf="otherRevInfo",rf=[ef,tf],af=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).otherRevInfoFormat=Le(r,ef,t.defaultValues(ef)),e.otherRevInfo=Le(r,tf,t.defaultValues(tf)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,rf);var r=sa(e,e,t.schema());za.assertSchema(r,this.className),this.otherRevInfoFormat=r.result.otherRevInfoFormat.valueBlock.toString(),this.otherRevInfo=r.result.otherRevInfo}},{key:"toSchema",value:function(){return new cr({value:[new ar({value:this.otherRevInfoFormat}),this.otherRevInfo]})}},{key:"toJSON",value:function(){var e={otherRevInfoFormat:this.otherRevInfoFormat};return this.otherRevInfo instanceof ra||(e.otherRevInfo=this.otherRevInfo.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case ef:return Xa;case tf:return new ra;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new ar({name:t.otherRevInfoFormat||ef}),new ra({name:t.otherRevInfo||tf})]})}}])}(Ya);af.CLASS_NAME="OtherRevocationInfoFormat";var nf="crls",sf="otherRevocationInfos",uf=[nf],of=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).crls=Le(r,nf,t.defaultValues(nf)),e.otherRevocationInfos=Le(r,sf,t.defaultValues(sf)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,uf);var r=sa(e,e,t.schema({names:{crls:nf}}));if(za.assertSchema(r,this.className),r.result.crls){var a,n=l(r.result.crls);try{for(n.s();!(a=n.n()).done;){var i=a.value;1===i.idBlock.tagClass?this.crls.push(new kh({schema:i})):this.otherRevocationInfos.push(new af({schema:i}))}}catch(e){n.e(e)}finally{n.f()}}}},{key:"toSchema",value:function(){var e=[];return e.push.apply(e,N(Array.from(this.crls,(function(e){return e.toSchema()})))),e.push.apply(e,N(Array.from(this.otherRevocationInfos,(function(e){var t=e.toSchema();return t.idBlock.tagClass=3,t.idBlock.tagNumber=1,t})))),new hr({value:e})}},{key:"toJSON",value:function(){return{crls:Array.from(this.crls,(function(e){return e.toJSON()})),otherRevocationInfos:Array.from(this.otherRevocationInfos,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){switch(e){case nf:case sf:return[];default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new hr({name:t.blockName||Xa,value:[new na({name:t.crls||Xa,value:new aa({value:[kh.schema(),new Vt({idBlock:{tagClass:3,tagNumber:1},value:[new ar,new ra]})]})})]})}}])}(Ya);of.CLASS_NAME="RevocationInfoChoices";var lf="certs",cf="crls",hf=[lf,cf],ff=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).crls=Le(r,cf,t.defaultValues(cf)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,hf);var r=sa(e,e,t.schema({names:{certs:lf,crls:cf}}));za.assertSchema(r,this.className),lf in r.result&&(this.certs=new $h({schema:new hr({value:r.result.certs.valueBlock.value})})),cf in r.result&&(this.crls=new of({schema:new hr({value:r.result.crls.valueBlock.value})}))}},{key:"toSchema",value:function(){var e=[];return this.certs&&e.push(new Vt({idBlock:{tagClass:3,tagNumber:0},value:this.certs.toSchema().valueBlock.value})),this.crls&&e.push(new Vt({idBlock:{tagClass:3,tagNumber:1},value:this.crls.toSchema().valueBlock.value})),new cr({value:e})}},{key:"toJSON",value:function(){var e={};return this.certs&&(e.certs=this.certs.toJSON()),this.crls&&(e.crls=this.crls.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case lf:return new $h;case cf:return new of;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case lf:return 0===r.certificates.length;case cf:return 0===r.crls.length&&0===r.otherRevocationInfos.length;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Vt({name:t.certs||Xa,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:$h.schema().valueBlock.value}),new Vt({name:t.crls||Xa,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:of.schema().valueBlock.value})]})}}])}(Ya);ff.CLASS_NAME="OriginatorInfo";var mf="issuer",vf="serialNumber",df=[mf,vf],gf=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).issuer=Le(r,mf,t.defaultValues(mf)),e.serialNumber=Le(r,vf,t.defaultValues(vf)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,df);var r=sa(e,e,t.schema({names:{issuer:{names:{blockName:mf}},serialNumber:vf}}));za.assertSchema(r,this.className),this.issuer=new an({schema:r.result.issuer}),this.serialNumber=r.result.serialNumber}},{key:"toSchema",value:function(){return new cr({value:[this.issuer.toSchema(),this.serialNumber]})}},{key:"toJSON",value:function(){return{issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case mf:return new an;case vf:return new Zt;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[an.schema(t.issuer||{}),new Zt({name:t.serialNumber||Xa})]})}}])}(Ya);gf.CLASS_NAME="IssuerAndSerialNumber";var pf="variant",yf="value",kf=["blockName"],wf=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).variant=Le(r,pf,t.defaultValues(pf)),yf in r&&(e.value=Le(r,yf,t.defaultValues(yf))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,kf);var r=sa(e,e,t.schema({names:{blockName:"blockName"}}));za.assertSchema(r,this.className),1===r.result.blockName.idBlock.tagClass?(this.variant=1,this.value=new gf({schema:r.result.blockName})):(this.variant=2,this.value=new _t({valueHex:r.result.blockName.valueBlock.valueHex}))}},{key:"toSchema",value:function(){switch(this.variant){case 1:if(!(this.value instanceof gf))throw new Error("Incorrect type of RecipientIdentifier.value. It should be IssuerAndSerialNumber.");return this.value.toSchema();case 2:if(!(this.value instanceof _t))throw new Error("Incorrect type of RecipientIdentifier.value. It should be ASN.1 OctetString.");return new Nt({idBlock:{tagClass:3,tagNumber:0},valueHex:this.value.valueBlock.valueHexView});default:return new ra}}},{key:"toJSON",value:function(){var e={variant:this.variant};return 1!==this.variant&&2!==this.variant||!this.value||(e.value=this.value.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case pf:return-1;case yf:return{};default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case pf:return-1===r;case yf:return 0===Object.keys(r).length;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new aa({value:[gf.schema({names:{blockName:t.blockName||Xa}}),new Nt({name:t.blockName||Xa,idBlock:{tagClass:3,tagNumber:0}})]})}}])}(Ya);wf.CLASS_NAME="RecipientIdentifier";var bf="version",Sf="rid",Af="keyEncryptionAlgorithm",Nf="encryptedKey",Cf="recipientCertificate",xf=[bf,Sf,Af,Nf],Ef=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).version=Le(r,bf,t.defaultValues(bf)),e.rid=Le(r,Sf,t.defaultValues(Sf)),e.keyEncryptionAlgorithm=Le(r,Af,t.defaultValues(Af)),e.encryptedKey=Le(r,Nf,t.defaultValues(Nf)),e.recipientCertificate=Le(r,Cf,t.defaultValues(Cf)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,xf);var r=sa(e,e,t.schema({names:{version:bf,rid:{names:{blockName:Sf}},keyEncryptionAlgorithm:{names:{blockName:Af}},encryptedKey:Nf}}));za.assertSchema(r,this.className),this.version=r.result.version.valueBlock.valueDec,3===r.result.rid.idBlock.tagClass?this.rid=new _t({valueHex:r.result.rid.valueBlock.valueHex}):this.rid=new gf({schema:r.result.rid}),this.keyEncryptionAlgorithm=new Nn({schema:r.result.keyEncryptionAlgorithm}),this.encryptedKey=r.result.encryptedKey}},{key:"toSchema",value:function(){var e=[];return this.rid instanceof gf?(this.version=0,e.push(new Zt({value:this.version})),e.push(this.rid.toSchema())):(this.version=2,e.push(new Zt({value:this.version})),e.push(new Nt({idBlock:{tagClass:3,tagNumber:0},valueHex:this.rid.valueBlock.valueHexView}))),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new cr({value:e})}},{key:"toJSON",value:function(){return{version:this.version,rid:this.rid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case bf:return-1;case Sf:return{};case Af:return new Nn;case Nf:return new _t;case Cf:return new Kc;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case bf:return r===t.defaultValues(bf);case Sf:return 0===Object.keys(r).length;case Af:case Nf:return r.isEqual(t.defaultValues(e));case Cf:return!1;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Zt({name:t.version||Xa}),wf.schema(t.rid||{}),Nn.schema(t.keyEncryptionAlgorithm||{}),new _t({name:t.encryptedKey||Xa})]})}}])}(Ya);Ef.CLASS_NAME="KeyTransRecipientInfo";var If="algorithm",Bf="publicKey",Vf=[If,Bf],Df=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).algorithm=Le(r,If,t.defaultValues(If)),e.publicKey=Le(r,Bf,t.defaultValues(Bf)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Vf);var r=sa(e,e,t.schema({names:{algorithm:{names:{blockName:If}},publicKey:Bf}}));za.assertSchema(r,this.className),this.algorithm=new Nn({schema:r.result.algorithm}),this.publicKey=r.result.publicKey}},{key:"toSchema",value:function(){return new cr({value:[this.algorithm.toSchema(),this.publicKey]})}},{key:"toJSON",value:function(){return{algorithm:this.algorithm.toJSON(),publicKey:this.publicKey.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case If:return new Nn;case Bf:return new qt;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case If:case Bf:return r.isEqual(t.defaultValues(e));default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[Nn.schema(t.algorithm||{}),new qt({name:t.publicKey||Xa})]})}}])}(Ya);Df.CLASS_NAME="OriginatorPublicKey";var Pf="variant",Of="value",Rf=["blockName"],Uf=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).variant=Le(r,Pf,t.defaultValues(Pf)),Of in r&&(e.value=Le(r,Of,t.defaultValues(Of))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Rf);var r=sa(e,e,t.schema({names:{blockName:"blockName"}}));za.assertSchema(r,this.className),1===r.result.blockName.idBlock.tagClass?(this.variant=1,this.value=new gf({schema:r.result.blockName})):0===r.result.blockName.idBlock.tagNumber?(r.result.blockName.idBlock.tagClass=1,r.result.blockName.idBlock.tagNumber=4,this.variant=2,this.value=r.result.blockName):(this.variant=3,this.value=new Df({schema:new cr({value:r.result.blockName.valueBlock.value})}))}},{key:"toSchema",value:function(){switch(this.variant){case 1:return this.value.toSchema();case 2:return this.value.idBlock.tagClass=3,this.value.idBlock.tagNumber=0,this.value;case 3:var e=this.value.toSchema();return e.idBlock.tagClass=3,e.idBlock.tagNumber=1,e;default:return new ra}}},{key:"toJSON",value:function(){var e={variant:this.variant};return 1!==this.variant&&2!==this.variant&&3!==this.variant||(e.value=this.value.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Pf:return-1;case Of:return{};default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case Pf:return-1===r;case Of:return 0===Object.keys(r).length;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new aa({value:[gf.schema({names:{blockName:t.blockName||Xa}}),new Nt({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||Xa}),new Vt({idBlock:{tagClass:3,tagNumber:1},name:t.blockName||Xa,value:Df.schema().valueBlock.value})]})}}])}(Ya);Uf.CLASS_NAME="OriginatorIdentifierOrKey";var Lf="keyAttrId",Tf="keyAttr",Hf=[Lf,Tf],Mf=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).keyAttrId=Le(r,Lf,t.defaultValues(Lf)),Tf in r&&(e.keyAttr=Le(r,Tf,t.defaultValues(Tf))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Hf);var r=sa(e,e,t.schema({names:{keyAttrId:Lf,keyAttr:Tf}}));za.assertSchema(r,this.className),this.keyAttrId=r.result.keyAttrId.valueBlock.toString(),Tf in r.result&&(this.keyAttr=r.result.keyAttr)}},{key:"toSchema",value:function(){var e=[];return e.push(new ar({value:this.keyAttrId})),Tf in this&&e.push(this.keyAttr),new cr({value:e})}},{key:"toJSON",value:function(){var e={keyAttrId:this.keyAttrId};return Tf in this&&(e.keyAttr=this.keyAttr.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Lf:return Xa;case Tf:return{};default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case Lf:return"string"==typeof r&&r===Xa;case Tf:return 0===Object.keys(r).length;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({optional:t.optional||!0,name:t.blockName||Xa,value:[new ar({name:t.keyAttrId||Xa}),new ra({optional:!0,name:t.keyAttr||Xa})]})}}])}(Ya);Mf.CLASS_NAME="OtherKeyAttribute";var Kf="subjectKeyIdentifier",_f="date",jf="other",Jf=[Kf,_f,jf],Ff=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).subjectKeyIdentifier=Le(r,Kf,t.defaultValues(Kf)),_f in r&&(e.date=Le(r,_f,t.defaultValues(_f))),jf in r&&(e.other=Le(r,jf,t.defaultValues(jf))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Jf);var r=sa(e,e,t.schema({names:{subjectKeyIdentifier:Kf,date:_f,other:{names:{blockName:jf}}}}));za.assertSchema(r,this.className),this.subjectKeyIdentifier=r.result.subjectKeyIdentifier,_f in r.result&&(this.date=r.result.date),jf in r.result&&(this.other=new Mf({schema:r.result.other}))}},{key:"toSchema",value:function(){var e=[];return e.push(this.subjectKeyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new cr({value:e})}},{key:"toJSON",value:function(){var e={subjectKeyIdentifier:this.subjectKeyIdentifier.toJSON()};return this.date&&(e.date=this.date.toJSON()),this.other&&(e.other=this.other.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Kf:return new _t;case _f:return new Xr;case jf:return new Mf;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case Kf:return r.isEqual(t.defaultValues(Kf));case _f:return 0===r.year&&0===r.month&&0===r.day&&0===r.hour&&0===r.minute&&0===r.second&&0===r.millisecond;case jf:return r.keyAttrId===Xa&&"keyAttr"in r==!1;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new _t({name:t.subjectKeyIdentifier||Xa}),new Xr({optional:!0,name:t.date||Xa}),Mf.schema(t.other||{})]})}}])}(Ya);Ff.CLASS_NAME="RecipientKeyIdentifier";var qf="variant",Xf="value",Gf=["blockName"],Wf=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).variant=Le(r,qf,t.defaultValues(qf)),e.value=Le(r,Xf,t.defaultValues(Xf)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Gf);var r=sa(e,e,t.schema({names:{blockName:"blockName"}}));za.assertSchema(r,this.className),1===r.result.blockName.idBlock.tagClass?(this.variant=1,this.value=new gf({schema:r.result.blockName})):(this.variant=2,this.value=new Ff({schema:new cr({value:r.result.blockName.valueBlock.value})}))}},{key:"toSchema",value:function(){switch(this.variant){case 1:return this.value.toSchema();case 2:return new Vt({idBlock:{tagClass:3,tagNumber:0},value:this.value.toSchema().valueBlock.value});default:return new ra}}},{key:"toJSON",value:function(){var e={variant:this.variant};return 1!==this.variant&&2!==this.variant||(e.value=this.value.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case qf:return-1;case Xf:return{};default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case qf:return-1===r;case Xf:return 0===Object.keys(r).length;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new aa({value:[gf.schema(t.issuerAndSerialNumber||{names:{blockName:t.blockName||Xa}}),new Vt({name:t.blockName||Xa,idBlock:{tagClass:3,tagNumber:0},value:Ff.schema(t.rKeyId||{names:{blockName:t.blockName||Xa}}).valueBlock.value})]})}}])}(Ya);Wf.CLASS_NAME="KeyAgreeRecipientIdentifier";var zf="rid",Yf="encryptedKey",Qf=[zf,Yf],Zf=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).rid=Le(r,zf,t.defaultValues(zf)),e.encryptedKey=Le(r,Yf,t.defaultValues(Yf)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Qf);var r=sa(e,e,t.schema({names:{rid:{names:{blockName:zf}},encryptedKey:Yf}}));za.assertSchema(r,this.className),this.rid=new Wf({schema:r.result.rid}),this.encryptedKey=r.result.encryptedKey}},{key:"toSchema",value:function(){return new cr({value:[this.rid.toSchema(),this.encryptedKey]})}},{key:"toJSON",value:function(){return{rid:this.rid.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case zf:return new Wf;case Yf:return new _t;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case zf:return-1===r.variant&&"value"in r==!1;case Yf:return r.isEqual(t.defaultValues(Yf));default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[Wf.schema(t.rid||{}),new _t({name:t.encryptedKey||Xa})]})}}])}(Ya);Zf.CLASS_NAME="RecipientEncryptedKey";var $f="encryptedKeys",em="RecipientEncryptedKeys",tm=[em],rm=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).encryptedKeys=Le(r,$f,t.defaultValues($f)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,tm);var r=sa(e,e,t.schema({names:{RecipientEncryptedKeys:em}}));za.assertSchema(r,this.className),this.encryptedKeys=Array.from(r.result.RecipientEncryptedKeys,(function(e){return new Zf({schema:e})}))}},{key:"toSchema",value:function(){return new cr({value:Array.from(this.encryptedKeys,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{encryptedKeys:Array.from(this.encryptedKeys,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===$f?[]:A(t,"defaultValues",this,2)([e])}},{key:"compareWithDefault",value:function(e,r){return e===$f?0===r.length:A(t,"defaultValues",this,2)([e])}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new na({name:t.RecipientEncryptedKeys||Xa,value:Zf.schema()})]})}}])}(Ya);rm.CLASS_NAME="RecipientEncryptedKeys";var am="version",nm="originator",im="ukm",sm="keyEncryptionAlgorithm",um="recipientEncryptedKeys",om="recipientCertificate",lm="recipientPublicKey",cm=[am,nm,im,sm,um],hm=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).version=Le(r,am,t.defaultValues(am)),e.originator=Le(r,nm,t.defaultValues(nm)),im in r&&(e.ukm=Le(r,im,t.defaultValues(im))),e.keyEncryptionAlgorithm=Le(r,sm,t.defaultValues(sm)),e.recipientEncryptedKeys=Le(r,um,t.defaultValues(um)),e.recipientCertificate=Le(r,om,t.defaultValues(om)),e.recipientPublicKey=Le(r,lm,t.defaultValues(lm)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,cm);var r=sa(e,e,t.schema({names:{version:am,originator:{names:{blockName:nm}},ukm:im,keyEncryptionAlgorithm:{names:{blockName:sm}},recipientEncryptedKeys:{names:{blockName:um}}}}));za.assertSchema(r,this.className),this.version=r.result.version.valueBlock.valueDec,this.originator=new Uf({schema:r.result.originator}),im in r.result&&(this.ukm=r.result.ukm),this.keyEncryptionAlgorithm=new Nn({schema:r.result.keyEncryptionAlgorithm}),this.recipientEncryptedKeys=new rm({schema:r.result.recipientEncryptedKeys})}},{key:"toSchema",value:function(){var e=[];return e.push(new Zt({value:this.version})),e.push(new Vt({idBlock:{tagClass:3,tagNumber:0},value:[this.originator.toSchema()]})),this.ukm&&e.push(new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[this.ukm]})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.recipientEncryptedKeys.toSchema()),new cr({value:e})}},{key:"toJSON",value:function(){var e={version:this.version,originator:this.originator.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),recipientEncryptedKeys:this.recipientEncryptedKeys.toJSON()};return this.ukm&&(e.ukm=this.ukm.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case am:return 0;case nm:return new Uf;case im:return new _t;case sm:return new Nn;case um:return new rm;case om:return new Kc;case lm:return null;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case am:return 0===r;case nm:return-1===r.variant&&"value"in r==!1;case im:return r.isEqual(t.defaultValues(im));case sm:return r.algorithmId===Xa&&"algorithmParams"in r==!1;case um:return 0===r.encryptedKeys.length;case om:case lm:return!1;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Zt({name:t.version||Xa}),new Vt({idBlock:{tagClass:3,tagNumber:0},value:[Uf.schema(t.originator||{})]}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new _t({name:t.ukm||Xa})]}),Nn.schema(t.keyEncryptionAlgorithm||{}),rm.schema(t.recipientEncryptedKeys||{})]})}}])}(Ya);hm.CLASS_NAME="KeyAgreeRecipientInfo";var fm="keyIdentifier",mm="date",vm="other",dm=[fm,mm,vm],gm=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).keyIdentifier=Le(r,fm,t.defaultValues(fm)),mm in r&&(e.date=Le(r,mm,t.defaultValues(mm))),vm in r&&(e.other=Le(r,vm,t.defaultValues(vm))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,dm);var r=sa(e,e,t.schema({names:{keyIdentifier:fm,date:mm,other:{names:{blockName:vm}}}}));za.assertSchema(r,this.className),this.keyIdentifier=r.result.keyIdentifier,mm in r.result&&(this.date=r.result.date),vm in r.result&&(this.other=new Mf({schema:r.result.other}))}},{key:"toSchema",value:function(){var e=[];return e.push(this.keyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new cr({value:e})}},{key:"toJSON",value:function(){var e={keyIdentifier:this.keyIdentifier.toJSON()};return this.date&&(e.date=this.date),this.other&&(e.other=this.other.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case fm:return new _t;case mm:return new Xr;case vm:return new Mf;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case fm:return r.isEqual(t.defaultValues(fm));case mm:return 0===r.year&&0===r.month&&0===r.day&&0===r.hour&&0===r.minute&&0===r.second&&0===r.millisecond;case vm:return r.compareWithDefault("keyAttrId",r.keyAttrId)&&"keyAttr"in r==!1;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new _t({name:t.keyIdentifier||Xa}),new Xr({optional:!0,name:t.date||Xa}),Mf.schema(t.other||{})]})}}])}(Ya);gm.CLASS_NAME="KEKIdentifier";var pm="version",ym="kekid",km="keyEncryptionAlgorithm",wm="encryptedKey",bm="preDefinedKEK",Sm=[pm,ym,km,wm],Am=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).version=Le(r,pm,t.defaultValues(pm)),e.kekid=Le(r,ym,t.defaultValues(ym)),e.keyEncryptionAlgorithm=Le(r,km,t.defaultValues(km)),e.encryptedKey=Le(r,wm,t.defaultValues(wm)),e.preDefinedKEK=Le(r,bm,t.defaultValues(bm)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Sm);var r=sa(e,e,t.schema({names:{version:pm,kekid:{names:{blockName:ym}},keyEncryptionAlgorithm:{names:{blockName:km}},encryptedKey:wm}}));za.assertSchema(r,this.className),this.version=r.result.version.valueBlock.valueDec,this.kekid=new gm({schema:r.result.kekid}),this.keyEncryptionAlgorithm=new Nn({schema:r.result.keyEncryptionAlgorithm}),this.encryptedKey=r.result.encryptedKey}},{key:"toSchema",value:function(){return new cr({value:[new Zt({value:this.version}),this.kekid.toSchema(),this.keyEncryptionAlgorithm.toSchema(),this.encryptedKey]})}},{key:"toJSON",value:function(){return{version:this.version,kekid:this.kekid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case pm:return 0;case ym:return new gm;case km:return new Nn;case wm:return new _t;case bm:return qa;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case"KEKRecipientInfo":return r===t.defaultValues(pm);case ym:return r.compareWithDefault("keyIdentifier",r.keyIdentifier)&&"date"in r==!1&&"other"in r==!1;case km:return r.algorithmId===Xa&&"algorithmParams"in r==!1;case wm:return r.isEqual(t.defaultValues(wm));case bm:return 0===r.byteLength;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Zt({name:t.version||Xa}),gm.schema(t.kekid||{}),Nn.schema(t.keyEncryptionAlgorithm||{}),new _t({name:t.encryptedKey||Xa})]})}}])}(Ya);Am.CLASS_NAME="KEKRecipientInfo";var Nm="version",Cm="keyDerivationAlgorithm",xm="keyEncryptionAlgorithm",Em="encryptedKey",Im="password",Bm=[Nm,Cm,xm,Em],Vm=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).version=Le(r,Nm,t.defaultValues(Nm)),Cm in r&&(e.keyDerivationAlgorithm=Le(r,Cm,t.defaultValues(Cm))),e.keyEncryptionAlgorithm=Le(r,xm,t.defaultValues(xm)),e.encryptedKey=Le(r,Em,t.defaultValues(Em)),e.password=Le(r,Im,t.defaultValues(Im)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Bm);var r=sa(e,e,t.schema({names:{version:Nm,keyDerivationAlgorithm:Cm,keyEncryptionAlgorithm:{names:{blockName:xm}},encryptedKey:Em}}));za.assertSchema(r,this.className),this.version=r.result.version.valueBlock.valueDec,Cm in r.result&&(this.keyDerivationAlgorithm=new Nn({schema:new cr({value:r.result.keyDerivationAlgorithm.valueBlock.value})})),this.keyEncryptionAlgorithm=new Nn({schema:r.result.keyEncryptionAlgorithm}),this.encryptedKey=r.result.encryptedKey}},{key:"toSchema",value:function(){var e=[];return e.push(new Zt({value:this.version})),this.keyDerivationAlgorithm&&e.push(new Vt({idBlock:{tagClass:3,tagNumber:0},value:this.keyDerivationAlgorithm.toSchema().valueBlock.value})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new cr({value:e})}},{key:"toJSON",value:function(){var e={version:this.version,keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()};return this.keyDerivationAlgorithm&&(e.keyDerivationAlgorithm=this.keyDerivationAlgorithm.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Nm:return-1;case Cm:case xm:return new Nn;case Em:return new _t;case Im:return qa;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case Nm:return-1===r;case Cm:case xm:return r.algorithmId===Xa&&"algorithmParams"in r==!1;case Em:return r.isEqual(t.defaultValues(Em));case Im:return 0===r.byteLength;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Zt({name:t.version||Xa}),new Vt({name:t.keyDerivationAlgorithm||Xa,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Nn.schema().valueBlock.value}),Nn.schema(t.keyEncryptionAlgorithm||{}),new _t({name:t.encryptedKey||Xa})]})}}])}(Ya);Vm.CLASS_NAME="PasswordRecipientInfo";var Dm="oriType",Pm="oriValue",Om=[Dm,Pm],Rm=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).oriType=Le(r,Dm,t.defaultValues(Dm)),e.oriValue=Le(r,Pm,t.defaultValues(Pm)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Om);var r=sa(e,e,t.schema({names:{oriType:Dm,oriValue:Pm}}));za.assertSchema(r,this.className),this.oriType=r.result.oriType.valueBlock.toString(),this.oriValue=r.result.oriValue}},{key:"toSchema",value:function(){return new cr({value:[new ar({value:this.oriType}),this.oriValue]})}},{key:"toJSON",value:function(){var e={oriType:this.oriType};return t.compareWithDefault(Pm,this.oriValue)||(e.oriValue=this.oriValue.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Dm:return Xa;case Pm:return{};default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case Dm:return r===Xa;case Pm:return 0===Object.keys(r).length;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new ar({name:t.oriType||Xa}),new ra({name:t.oriValue||Xa})]})}}])}(Ya);Rm.CLASS_NAME="OtherRecipientInfo";var Um="variant",Lm="value",Tm=["blockName"],Hm=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).variant=Le(r,Um,t.defaultValues(Um)),Lm in r&&(e.value=Le(r,Lm,t.defaultValues(Lm))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Tm);var r=sa(e,e,t.schema({names:{blockName:"blockName"}}));if(za.assertSchema(r,this.className),1===r.result.blockName.idBlock.tagClass)this.variant=1,this.value=new Ef({schema:r.result.blockName});else{var a=new cr({value:r.result.blockName.valueBlock.value});switch(r.result.blockName.idBlock.tagNumber){case 1:this.variant=2,this.value=new hm({schema:a});break;case 2:this.variant=3,this.value=new Am({schema:a});break;case 3:this.variant=4,this.value=new Vm({schema:a});break;case 4:this.variant=5,this.value=new Rm({schema:a});break;default:throw new Error("Incorrect structure of RecipientInfo block")}}}},{key:"toSchema",value:function(){Wa.assertEmpty(this.value,"value","RecipientInfo");var e=this.value.toSchema();switch(this.variant){case 1:return e;case 2:case 3:case 4:return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.variant-1,e;default:return new ra}}},{key:"toJSON",value:function(){var e={variant:this.variant};return this.value&&this.variant>=1&&this.variant<=4&&(e.value=this.value.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Um:return-1;case Lm:return{};default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case Um:return r===t.defaultValues(e);case Lm:return 0===Object.keys(r).length;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new aa({value:[Ef.schema({names:{blockName:t.blockName||Xa}}),new Vt({name:t.blockName||Xa,idBlock:{tagClass:3,tagNumber:1},value:hm.schema().valueBlock.value}),new Vt({name:t.blockName||Xa,idBlock:{tagClass:3,tagNumber:2},value:Am.schema().valueBlock.value}),new Vt({name:t.blockName||Xa,idBlock:{tagClass:3,tagNumber:3},value:Vm.schema().valueBlock.value}),new Vt({name:t.blockName||Xa,idBlock:{tagClass:3,tagNumber:4},value:Rm.schema().valueBlock.value})]})}}])}(Ya);Hm.CLASS_NAME="RecipientInfo";var Mm="hashAlgorithm",Km="maskGenAlgorithm",_m="pSourceAlgorithm",jm=[Mm,Km,_m],Jm=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).hashAlgorithm=Le(r,Mm,t.defaultValues(Mm)),e.maskGenAlgorithm=Le(r,Km,t.defaultValues(Km)),e.pSourceAlgorithm=Le(r,_m,t.defaultValues(_m)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,jm);var r=sa(e,e,t.schema({names:{hashAlgorithm:{names:{blockName:Mm}},maskGenAlgorithm:{names:{blockName:Km}},pSourceAlgorithm:{names:{blockName:_m}}}}));za.assertSchema(r,this.className),Mm in r.result&&(this.hashAlgorithm=new Nn({schema:r.result.hashAlgorithm})),Km in r.result&&(this.maskGenAlgorithm=new Nn({schema:r.result.maskGenAlgorithm})),_m in r.result&&(this.pSourceAlgorithm=new Nn({schema:r.result.pSourceAlgorithm}))}},{key:"toSchema",value:function(){var e=[];return this.hashAlgorithm.isEqual(t.defaultValues(Mm))||e.push(new Vt({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(t.defaultValues(Km))||e.push(new Vt({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.pSourceAlgorithm.isEqual(t.defaultValues(_m))||e.push(new Vt({idBlock:{tagClass:3,tagNumber:2},value:[this.pSourceAlgorithm.toSchema()]})),new cr({value:e})}},{key:"toJSON",value:function(){var e={};return this.hashAlgorithm.isEqual(t.defaultValues(Mm))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(t.defaultValues(Km))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.pSourceAlgorithm.isEqual(t.defaultValues(_m))||(e.pSourceAlgorithm=this.pSourceAlgorithm.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Mm:return new Nn({algorithmId:"1.3.14.3.2.26",algorithmParams:new Ut});case Km:return new Nn({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new Nn({algorithmId:"1.3.14.3.2.26",algorithmParams:new Ut}).toSchema()});case _m:return new Nn({algorithmId:"1.2.840.113549.1.1.9",algorithmParams:new _t({valueHex:new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer})});default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Vt({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[Nn.schema(t.hashAlgorithm||{})]}),new Vt({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[Nn.schema(t.maskGenAlgorithm||{})]}),new Vt({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[Nn.schema(t.pSourceAlgorithm||{})]})]})}}])}(Ya);Jm.CLASS_NAME="RSAESOAEPParams";var Fm="keyInfo",qm="entityUInfo",Xm="suppPubInfo",Gm=[Fm,qm,Xm],Wm=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).keyInfo=Le(r,Fm,t.defaultValues(Fm)),qm in r&&(e.entityUInfo=Le(r,qm,t.defaultValues(qm))),e.suppPubInfo=Le(r,Xm,t.defaultValues(Xm)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Gm);var r=sa(e,e,t.schema({names:{keyInfo:{names:{blockName:Fm}},entityUInfo:qm,suppPubInfo:Xm}}));za.assertSchema(r,this.className),this.keyInfo=new Nn({schema:r.result.keyInfo}),qm in r.result&&(this.entityUInfo=r.result.entityUInfo.valueBlock.value[0]),this.suppPubInfo=r.result.suppPubInfo.valueBlock.value[0]}},{key:"toSchema",value:function(){var e=[];return e.push(this.keyInfo.toSchema()),this.entityUInfo&&e.push(new Vt({idBlock:{tagClass:3,tagNumber:0},value:[this.entityUInfo]})),e.push(new Vt({idBlock:{tagClass:3,tagNumber:2},value:[this.suppPubInfo]})),new cr({value:e})}},{key:"toJSON",value:function(){var e={keyInfo:this.keyInfo.toJSON(),suppPubInfo:this.suppPubInfo.toJSON()};return this.entityUInfo&&(e.entityUInfo=this.entityUInfo.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Fm:return new Nn;case qm:case Xm:return new _t;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case Fm:case qm:case Xm:return r.isEqual(t.defaultValues(e));default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[Nn.schema(t.keyInfo||{}),new Vt({name:t.entityUInfo||Xa,idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[new _t]}),new Vt({name:t.suppPubInfo||Xa,idBlock:{tagClass:3,tagNumber:2},value:[new _t]})]})}}])}(Ya);Wm.CLASS_NAME="ECCCMSSharedInfo";var zm="version",Ym="originatorInfo",Qm="recipientInfos",Zm="encryptedContentInfo",$m="unprotectedAttrs",ev=[zm,Ym,Qm,Zm,$m],tv={kdfAlgorithm:"SHA-512",kekEncryptionLength:256},rv={"P-256":256,"P-384":384,"P-521":528},av=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).version=Le(r,zm,t.defaultValues(zm)),Ym in r&&(e.originatorInfo=Le(r,Ym,t.defaultValues(Ym))),e.recipientInfos=Le(r,Qm,t.defaultValues(Qm)),e.encryptedContentInfo=Le(r,Zm,t.defaultValues(Zm)),$m in r&&(e.unprotectedAttrs=Le(r,$m,t.defaultValues($m))),e.policy={disableSplit:!!r.disableSplit},r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,ev);var r=sa(e,e,t.schema({names:{version:zm,originatorInfo:Ym,recipientInfos:Qm,encryptedContentInfo:{names:{blockName:Zm}},unprotectedAttrs:$m}}));za.assertSchema(r,this.className),this.version=r.result.version.valueBlock.valueDec,Ym in r.result&&(this.originatorInfo=new ff({schema:new cr({value:r.result.originatorInfo.valueBlock.value})})),this.recipientInfos=Array.from(r.result.recipientInfos,(function(e){return new Hm({schema:e})})),this.encryptedContentInfo=new Uu({schema:r.result.encryptedContentInfo}),$m in r.result&&(this.unprotectedAttrs=Array.from(r.result.unprotectedAttrs,(function(e){return new Dn({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(new Zt({value:this.version})),this.originatorInfo&&e.push(new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:this.originatorInfo.toSchema().valueBlock.value})),e.push(new hr({value:Array.from(this.recipientInfos,(function(e){return e.toSchema()}))})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,(function(e){return e.toSchema()}))})),new cr({value:e})}},{key:"toJSON",value:function(){var e={version:this.version,recipientInfos:Array.from(this.recipientInfos,(function(e){return e.toJSON()})),encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.originatorInfo&&(e.originatorInfo=this.originatorInfo.toJSON()),this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,(function(e){return e.toJSON()}))),e}},{key:"addRecipientByCertificate",value:function(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:po(!0),n=Object.assign({useOAEP:!0,oaepHashAlgorithm:"SHA-512"},tv,t||{});if(-1!==e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.113549"))r=1;else{if(-1===e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.10045"))throw new Error("Unknown type of certificate's public key: ".concat(e.subjectPublicKeyInfo.algorithm.algorithmId));r=2}switch(r){case 1:var i,s;if(!0===n.useOAEP){i=a.getOIDByAlgorithm({name:"RSA-OAEP"},!0,"keyEncryptionAlgorithm");var u=a.getOIDByAlgorithm({name:n.oaepHashAlgorithm},!0,"RSAES-OAEP-params"),o=new Nn({algorithmId:u,algorithmParams:new Ut}),l=new Jm({hashAlgorithm:o,maskGenAlgorithm:new Nn({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:o.toSchema()})});s=l.toSchema()}else{if((i=a.getOIDByAlgorithm({name:"RSAES-PKCS1-v1_5"}))===Xa)throw new Error("Can not find OID for RSAES-PKCS1-v1_5");s=new Ut}var c=new Ef({version:0,rid:new gf({issuer:e.issuer,serialNumber:e.serialNumber}),keyEncryptionAlgorithm:new Nn({algorithmId:i,algorithmParams:s}),recipientCertificate:e});this.recipientInfos.push(new Hm({variant:1,value:c}));break;case 2:var h=new Wf({variant:1,value:new gf({issuer:e.issuer,serialNumber:e.serialNumber})});this._addKeyAgreeRecipientInfo(h,n,{recipientCertificate:e},a);break;default:throw new Error('Unknown "variant" value: '.concat(r))}return!0}},{key:"addRecipientByPreDefinedData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:po(!0);if(Ga.assert(e,"preDefinedData","ArrayBuffer"),!e.byteLength)throw new Error("Pre-defined data could have zero length");if(!t.keyIdentifier){var n=new ArrayBuffer(16),i=new Uint8Array(n);a.getRandomValues(i),t.keyIdentifier=n}switch(t.hmacHashAlgorithm||(t.hmacHashAlgorithm="SHA-512"),void 0===t.iterationCount&&(t.iterationCount=2048),t.keyEncryptionAlgorithm||(t.keyEncryptionAlgorithm={name:"AES-KW",length:256}),t.keyEncryptionAlgorithmParams||(t.keyEncryptionAlgorithmParams=new Ut),r){case 1:var s=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),u=new Am({version:4,kekid:new gm({keyIdentifier:new _t({valueHex:t.keyIdentifier})}),keyEncryptionAlgorithm:new Nn({algorithmId:s,algorithmParams:t.keyEncryptionAlgorithmParams}),preDefinedKEK:e});this.recipientInfos.push(new Hm({variant:3,value:u}));break;case 2:var o=a.getOIDByAlgorithm({name:"PBKDF2"},!0,"keyDerivationAlgorithm"),l=new ArrayBuffer(64),c=new Uint8Array(l);a.getRandomValues(c);var h=a.getOIDByAlgorithm({name:"HMAC",hash:{name:t.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),f=new Gu({salt:new _t({valueHex:l}),iterationCount:t.iterationCount,prf:new Nn({algorithmId:h,algorithmParams:new Ut})}),m=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),v=new Vm({version:0,keyDerivationAlgorithm:new Nn({algorithmId:o,algorithmParams:f.toSchema()}),keyEncryptionAlgorithm:new Nn({algorithmId:m,algorithmParams:t.keyEncryptionAlgorithmParams}),password:e});this.recipientInfos.push(new Hm({variant:4,value:v}));break;default:throw new Error('Unknown value for "variant": '.concat(r))}}},{key:"addRecipientByKeyIdentifier",value:function(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:po(!0),n=Object.assign({},tv,r||{}),i=new Wf({variant:2,value:new Ff({subjectKeyIdentifier:new _t({valueHex:t})})});this._addKeyAgreeRecipientInfo(i,n,{recipientPublicKey:e},a)}},{key:"_addKeyAgreeRecipientInfo",value:function(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:po(!0),n=new Zf({rid:e}),i=a.getOIDByAlgorithm({name:"AES-KW",length:t.kekEncryptionLength},!0,"keyEncryptionAlgorithm"),s=new Nn({algorithmId:i}),u=a.getOIDByAlgorithm({name:"ECDH",kdf:t.kdfAlgorithm},!0,"KeyAgreeRecipientInfo"),o=new ArrayBuffer(64),l=new Uint8Array(o);a.getRandomValues(l);var c={version:3,ukm:new _t({valueHex:o}),keyEncryptionAlgorithm:new Nn({algorithmId:u,algorithmParams:s.toSchema()}),recipientEncryptedKeys:new rm({encryptedKeys:[n]})},h=new hm(Object.assign(c,r));this.recipientInfos.push(new Hm({variant:2,value:h}))}},{key:"encrypt",value:(s=a(k().mark((function e(t,r){var n,i,s,u,o,l,c,h,f,m,v,d,g,p,y=this,w=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=w.length>2&&void 0!==w[2]?w[2]:po(!0),i=new ArrayBuffer(16),s=new Uint8Array(i),n.getRandomValues(s),u=new Uint8Array(r),o=n.getOIDByAlgorithm(t,!0,"contentEncryptionAlgorithm"),e.next=8,n.generateKey(t,!0,["encrypt"]);case 8:return l=e.sent,e.next=11,n.encrypt({name:t.name,iv:s},l,u);case 11:return c=e.sent,e.next=14,n.exportKey("raw",l);case 14:h=e.sent,this.version=2,this.encryptedContentInfo=new Uu({disableSplit:this.policy.disableSplit,contentType:"1.2.840.113549.1.7.1",contentEncryptionAlgorithm:new Nn({algorithmId:o,algorithmParams:new _t({valueHex:i})}),encryptedContent:new _t({valueHex:c})}),f=function(){var e=a(k().mark((function e(t){var r,a,i,s,u,o,c,h,f,m,v,d,g,p,w,b,S,A,N,C,x,E;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=y.recipientInfos[t].value).recipientPublicKey){e.next=6;break}a=r.recipientPublicKey.algorithm.namedCurve,i=r.recipientPublicKey,e.next=27;break;case 6:if(!r.recipientCertificate){e.next=26;break}if((s=r.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams).constructor.blockName()===ar.blockName()){e.next=10;break}throw new Error('Incorrect "recipientCertificate" for index '.concat(t));case 10:u=s.valueBlock.toString(),e.t0=u,e.next="1.2.840.10045.3.1.7"===e.t0?14:"1.3.132.0.34"===e.t0?16:"1.3.132.0.35"===e.t0?18:20;break;case 14:return a="P-256",e.abrupt("break",21);case 16:return a="P-384",e.abrupt("break",21);case 18:return a="P-521",e.abrupt("break",21);case 20:throw new Error("Incorrect curve OID for index ".concat(t));case 21:return e.next=23,r.recipientCertificate.getPublicKey({algorithm:{algorithm:{name:"ECDH",namedCurve:a},usages:[]}},n);case 23:i=e.sent,e.next=27;break;case 26:throw new Error("Unsupported RecipientInfo");case 27:return o=rv[a],e.next=30,n.generateKey({name:"ECDH",namedCurve:a},!0,["deriveBits"]);case 30:return c=e.sent,e.next=33,n.exportKey("spki",c.publicKey);case 33:return h=e.sent,e.next=36,n.deriveBits({name:"ECDH",public:i},c.privateKey,o);case 36:for(f=e.sent,m=new Nn({schema:r.keyEncryptionAlgorithm.algorithmParams}),v=n.getAlgorithmByOID(m.algorithmId,!0,"aesKWAlgorithm"),d=v.length,g=new ArrayBuffer(4),p=new Uint8Array(g),w=3;w>=0;w--)p[w]=d,d>>=8;return b=new Wm({keyInfo:new Nn({algorithmId:m.algorithmId}),entityUInfo:r.ukm,suppPubInfo:new _t({valueHex:g})}),S=b.toSchema().toBER(!1),A=n.getAlgorithmByOID(r.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm"),e.next=48,So(A.kdf,f,v.length,S,n);case 48:return N=e.sent,e.next=51,n.importKey("raw",N,{name:"AES-KW"},!0,["wrapKey"]);case 51:return C=e.sent,e.next=54,n.wrapKey("raw",l,C,{name:"AES-KW"});case 54:return x=e.sent,(E=new Uf).variant=3,E.value=Df.fromBER(h),r.originator=E,r.recipientEncryptedKeys.encryptedKeys[0].encryptedKey=new _t({valueHex:x}),e.abrupt("return",{ecdhPrivateKey:c.privateKey});case 61:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m=function(){var e=a(k().mark((function e(t){var r,a,i,s,u,o;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=y.recipientInfos[t].value,"RSA-OAEP"!==(a=n.getAlgorithmByOID(r.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm")).name){e.next=8;break}if(i=r.keyEncryptionAlgorithm.algorithmParams,s=new Jm({schema:i}),a.hash=n.getAlgorithmByOID(s.hashAlgorithm.algorithmId),"name"in a.hash!=0){e.next=8;break}throw new Error("Incorrect OID for hash algorithm: ".concat(s.hashAlgorithm.algorithmId));case 8:return e.prev=8,e.next=11,r.recipientCertificate.getPublicKey({algorithm:{algorithm:a,usages:["encrypt","wrapKey"]}},n);case 11:return u=e.sent,e.next=14,n.encrypt(u.algorithm,u,h);case 14:o=e.sent,r.encryptedKey=new _t({valueHex:o}),e.next=20;break;case 18:e.prev=18,e.t0=e.catch(8);case 20:case"end":return e.stop()}}),e,null,[[8,18]])})));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=a(k().mark((function e(t){var r,a,i,s;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=y.recipientInfos[t].value,a=n.getAlgorithmByOID(r.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),e.next=4,n.importKey("raw",new Uint8Array(r.preDefinedKEK),a,!0,["wrapKey"]);case 4:return i=e.sent,e.next=7,n.wrapKey("raw",l,i,a);case 7:s=e.sent,r.encryptedKey=new _t({valueHex:s});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d=function(){var e=a(k().mark((function e(t){var r,a,i,s,u,o,c,h,f,m,v;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=y.recipientInfos[t].value).keyDerivationAlgorithm){e.next=3;break}throw new Error('Please append encoded "keyDerivationAlgorithm"');case 3:if(r.keyDerivationAlgorithm.algorithmParams){e.next=5;break}throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');case 5:e.prev=5,a=new Gu({schema:r.keyDerivationAlgorithm.algorithmParams}),e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(5),new Error('Incorrectly encoded "keyDerivationAlgorithm"');case 12:return i=new Uint8Array(r.password),e.next=15,n.importKey("raw",i,"PBKDF2",!1,["deriveKey"]);case 15:return s=e.sent,u=n.getAlgorithmByOID(r.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),o="SHA-1",a.prf&&(c=n.getAlgorithmByOID(a.prf.algorithmId,!0,"prfAlgorithm"),o=c.hash.name),h=new Uint8Array(a.salt.valueBlock.valueHex),f=a.iterationCount,e.next=23,n.deriveKey({name:"PBKDF2",hash:{name:o},salt:h,iterations:f},s,u,!0,["wrapKey"]);case 23:return m=e.sent,e.next=26,n.wrapKey("raw",l,m,u);case 26:v=e.sent,r.encryptedKey=new _t({valueHex:v});case 28:case"end":return e.stop()}}),e,null,[[5,9]])})));return function(t){return e.apply(this,arguments)}}(),g=[],p=0;case 23:if(!(p<this.recipientInfos.length)){e.next=55;break}e.t0=this.recipientInfos[p].variant,e.next=1===e.t0?27:2===e.t0?33:3===e.t0?39:4===e.t0?45:51;break;case 27:return e.t1=g,e.next=30,m(p);case 30:return e.t2=e.sent,e.t1.push.call(e.t1,e.t2),e.abrupt("break",52);case 33:return e.t3=g,e.next=36,f(p);case 36:return e.t4=e.sent,e.t3.push.call(e.t3,e.t4),e.abrupt("break",52);case 39:return e.t5=g,e.next=42,v(p);case 42:return e.t6=e.sent,e.t5.push.call(e.t5,e.t6),e.abrupt("break",52);case 45:return e.t7=g,e.next=48,d(p);case 48:return e.t8=e.sent,e.t7.push.call(e.t7,e.t8),e.abrupt("break",52);case 51:throw new Error("Unknown recipient type in array with index ".concat(p));case 52:p++,e.next=23;break;case 55:return e.abrupt("return",g);case 56:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"decrypt",value:(r=a(k().mark((function e(t,r){var n,i,s,u,o,l,c,h,f,m,v,d,g=this,p=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=p.length>2&&void 0!==p[2]?p[2]:po(!0),i=r||{},!(t+1>this.recipientInfos.length)){e.next=4;break}throw new Error('Maximum value for "index" is: '.concat(this.recipientInfos.length-1));case 4:s=function(){var e=a(k().mark((function e(t){var r,s,u,o,l,c,h,f,m,v,d,p,y,w,b,S,A,N,C,x;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w=function(){return(w=a(k().mark((function e(t){var a,i,s,u,o,l,c,h,f,m;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=t||!1,a=new Nn({schema:r.keyEncryptionAlgorithm.algorithmParams}),i=n.getAlgorithmByOID(a.algorithmId,!0,"kwAlgorithm"),s=i.length,u=new ArrayBuffer(4),o=new Uint8Array(u),l=3;l>=0;l--)o[l]=s,s>>=8;if(c={algorithmId:a.algorithmId},t&&(c.algorithmParams=new Ut),h=new Wm({keyInfo:new Nn(c),entityUInfo:r.ukm,suppPubInfo:new _t({valueHex:u})}),f=h.toSchema().toBER(!1),(m=n.getAlgorithmByOID(r.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm")).name){e.next=14;break}throw new Error("Incorrect OID for key encryption algorithm: ".concat(r.keyEncryptionAlgorithm.algorithmId));case 14:return e.abrupt("return",So(m.kdf,p,i.length,f,n));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)},y=function(e){return w.apply(this,arguments)},r=g.recipientInfos[t].value,l=r.originator,!i.recipientCertificate){e.next=11;break}if((c=i.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams).constructor.blockName()===ar.blockName()){e.next=8;break}throw new Error('Incorrect "recipientCertificate" for index '.concat(t));case 8:s=c.valueBlock.toString(),e.next=19;break;case 11:if(!l.value.algorithm.algorithmParams){e.next=18;break}if((h=l.value.algorithm.algorithmParams).constructor.blockName()===ar.blockName()){e.next=15;break}throw new Error("Incorrect originator for index ".concat(t));case 15:s=h.valueBlock.toString(),e.next=19;break;case 18:throw new Error('Parameter "recipientCertificate" is mandatory for "KeyAgreeRecipientInfo" if algorithm params are missing from originator');case 19:if(i.recipientPrivateKey){e.next=21;break}throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyAgreeRecipientInfo"');case 21:e.t0=s,e.next="1.2.840.10045.3.1.7"===e.t0?24:"1.3.132.0.34"===e.t0?27:"1.3.132.0.35"===e.t0?30:33;break;case 24:return u="P-256",o=256,e.abrupt("break",34);case 27:return u="P-384",o=384,e.abrupt("break",34);case 30:return u="P-521",o=528,e.abrupt("break",34);case 33:throw new Error("Incorrect curve OID for index ".concat(t));case 34:if(m=n,!Ie.isBufferSource(i.recipientPrivateKey)){e.next=41;break}return e.next=38,n.importKey("pkcs8",i.recipientPrivateKey,{name:"ECDH",namedCurve:u},!0,["deriveBits"]);case 38:f=e.sent,e.next=43;break;case 41:f=i.recipientPrivateKey,"crypto"in i&&i.crypto&&(m=i.crypto.subtle);case 43:return"algorithmParams"in l.value.algorithm==0&&(l.value.algorithm.algorithmParams=new ar({value:s})),v=l.value.toSchema().toBER(!1),e.next=47,n.importKey("spki",v,{name:"ECDH",namedCurve:u},!0,[]);case 47:return d=e.sent,e.next=50,m.deriveBits({name:"ECDH",public:d},f,o);case 50:return p=e.sent,e.next=53,y();case 53:return b=e.sent,S=function(){var e=a(k().mark((function e(t){return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.importKey("raw",t,{name:"AES-KW"},!0,["unwrapKey"]));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=57,S(b);case 57:return A=e.sent,N=function(){var e=a(k().mark((function e(t){var a,i;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=g.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,i=n.getAlgorithmByOID(a,!0,"contentEncryptionAlgorithm"),e.abrupt("return",n.unwrapKey("raw",r.recipientEncryptedKeys.encryptedKeys[0].encryptedKey.valueBlock.valueHexView,t,{name:"AES-KW"},i,!0,["decrypt"]));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.prev=59,e.next=62,N(A);case 62:return e.abrupt("return",e.sent);case 65:return e.prev=65,e.t1=e.catch(59),e.next=69,y(!0);case 69:return C=e.sent,e.next=72,S(C);case 72:return x=e.sent,e.abrupt("return",N(x));case 74:case"end":return e.stop()}}),e,null,[[59,65]])})));return function(t){return e.apply(this,arguments)}}(),u=function(){var e=a(k().mark((function e(t){var r,a,s,u,o,l,c,h,f;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=g.recipientInfos[t].value,i.recipientPrivateKey){e.next=3;break}throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyTransRecipientInfo"');case 3:if("RSA-OAEP"!==(a=n.getAlgorithmByOID(r.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm")).name){e.next=10;break}if(s=r.keyEncryptionAlgorithm.algorithmParams,u=new Jm({schema:s}),a.hash=n.getAlgorithmByOID(u.hashAlgorithm.algorithmId),"name"in a.hash!=0){e.next=10;break}throw new Error("Incorrect OID for hash algorithm: ".concat(u.hashAlgorithm.algorithmId));case 10:if(l=n,!Ie.isBufferSource(i.recipientPrivateKey)){e.next=17;break}return e.next=14,n.importKey("pkcs8",i.recipientPrivateKey,a,!0,["decrypt"]);case 14:o=e.sent,e.next=19;break;case 17:o=i.recipientPrivateKey,"crypto"in i&&i.crypto&&(l=i.crypto.subtle);case 19:return e.next=21,l.decrypt(o.algorithm,o,r.encryptedKey.valueBlock.valueHexView);case 21:if(c=e.sent,h=g.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,"name"in(f=n.getAlgorithmByOID(h,!0,"contentEncryptionAlgorithm"))!=0){e.next=26;break}throw new Error('Incorrect "contentEncryptionAlgorithm": '.concat(h));case 26:return e.abrupt("return",n.importKey("raw",c,f,!0,["decrypt"]));case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o=function(){var e=a(k().mark((function e(t){var r,a,s,u,o;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=g.recipientInfos[t].value,i.preDefinedData){e.next=3;break}throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');case 3:return a=n.getAlgorithmByOID(r.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),e.next=6,n.importKey("raw",i.preDefinedData,a,!0,["unwrapKey"]);case 6:if(s=e.sent,u=g.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,(o=n.getAlgorithmByOID(u,!0,"contentEncryptionAlgorithm")).name){e.next=11;break}throw new Error('Incorrect "contentEncryptionAlgorithm": '.concat(u));case 11:return e.abrupt("return",n.unwrapKey("raw",r.encryptedKey.valueBlock.valueHexView,s,a,o,!0,["decrypt"]));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l=function(){var e=a(k().mark((function e(t){var r,a,s,u,o,l,c,h,f,m;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=g.recipientInfos[t].value,i.preDefinedData){e.next=3;break}throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');case 3:if(r.keyDerivationAlgorithm){e.next=5;break}throw new Error('Please append encoded "keyDerivationAlgorithm"');case 5:if(r.keyDerivationAlgorithm.algorithmParams){e.next=7;break}throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');case 7:e.prev=7,a=new Gu({schema:r.keyDerivationAlgorithm.algorithmParams}),e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(7),new Error('Incorrectly encoded "keyDerivationAlgorithm"');case 14:return e.next=16,n.importKey("raw",i.preDefinedData,"PBKDF2",!1,["deriveKey"]);case 16:return s=e.sent,u=n.getAlgorithmByOID(r.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm"),o=a.prf?n.getAlgorithmByOID(a.prf.algorithmId,!0,"prfAlgorithm").hash.name:"SHA-1",l=new Uint8Array(a.salt.valueBlock.valueHex),c=a.iterationCount,e.next=23,n.deriveKey({name:"PBKDF2",hash:{name:o},salt:l,iterations:c},s,u,!0,["unwrapKey"]);case 23:return h=e.sent,f=g.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,m=n.getAlgorithmByOID(f,!0,"contentEncryptionAlgorithm"),e.abrupt("return",n.unwrapKey("raw",r.encryptedKey.valueBlock.valueHexView,h,u,m,!0,["decrypt"]));case 27:case"end":return e.stop()}}),e,null,[[7,11]])})));return function(t){return e.apply(this,arguments)}}(),e.t0=this.recipientInfos[t].variant,e.next=1===e.t0?11:2===e.t0?15:3===e.t0?19:4===e.t0?23:27;break;case 11:return e.next=13,u(t);case 13:case 17:case 21:case 25:return c=e.sent,e.abrupt("break",28);case 15:return e.next=17,s(t);case 19:return e.next=21,o(t);case 23:return e.next=25,l(t);case 27:throw new Error("Unknown recipient type in array with index ".concat(t));case 28:if(h=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,f=n.getAlgorithmByOID(h,!0,"contentEncryptionAlgorithm"),m=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams.valueBlock.valueHex,v=new Uint8Array(m),this.encryptedContentInfo.encryptedContent){e.next=34;break}throw new Error("Required property `encryptedContent` is empty");case 34:return d=this.encryptedContentInfo.getEncryptedContent(),e.abrupt("return",n.decrypt({name:f.name,iv:v},c,d));case 36:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case zm:return 0;case Ym:return new ff;case Qm:return[];case Zm:return new Uu;case $m:return[];default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case zm:return r===t.defaultValues(e);case Ym:return 0===r.certs.certificates.length&&0===r.crls.crls.length;case Qm:case $m:return 0===r.length;case Zm:return Uu.compareWithDefault("contentType",r.contentType)&&Uu.compareWithDefault("contentEncryptionAlgorithm",r.contentEncryptionAlgorithm)&&Uu.compareWithDefault("encryptedContent",r.encryptedContent);default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Zt({name:t.version||Xa}),new Vt({name:t.originatorInfo||Xa,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:ff.schema().valueBlock.value}),new hr({value:[new na({name:t.recipientInfos||Xa,value:Hm.schema()})]}),Uu.schema(t.encryptedContentInfo||{}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new na({name:t.unprotectedAttrs||Xa,value:Dn.schema()})]})]})}}]);var r,s}(Ya);av.CLASS_NAME="EnvelopedData";var nv="safeContents",iv="parsedValue",sv="contentInfos",uv=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).safeContents=Le(r,nv,t.defaultValues(nv)),iv in r&&(e.parsedValue=Le(r,iv,t.defaultValues(iv))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,[sv]);var r=sa(e,e,t.schema({names:{contentInfos:sv}}));za.assertSchema(r,this.className),this.safeContents=Array.from(r.result.contentInfos,(function(e){return new nc({schema:e})}))}},{key:"toSchema",value:function(){return new cr({value:Array.from(this.safeContents,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{safeContents:Array.from(this.safeContents,(function(e){return e.toJSON()}))}}},{key:"parseInternalValues",value:(s=a(k().mark((function e(t){var r,a,n,i,s,u,o,c,h,f,m,v,d,g,p,y,w,S=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=S.length>1&&void 0!==S[1]?S[1]:po(!0),Wa.assert(t,nv),Ga.assert(t.safeContents,nv,"Array"),t.safeContents.length===this.safeContents.length){e.next=5;break}throw new Ga('Length of "parameters.safeContents" must be equal to "this.safeContents.length"');case 5:this.parsedValue={safeContents:[]},a=l(this.safeContents.entries()),e.prev=7,a.s();case 9:if((n=a.n()).done){e.next=41;break}i=b(n.value,2),s=i[0],u=i[1],o=t.safeContents[s],c="parameters.safeContents[".concat(s,"]"),e.t0=u.contentType,e.next=e.t0===ri?16:e.t0===ni?20:e.t0===ii?30:38;break;case 16:return Ga.assert(u.content,"this.safeContents[j].content",_t),h=u.content.getValue(),this.parsedValue.safeContents.push({privacyMode:0,value:Xh.fromBER(h)}),e.abrupt("break",39);case 20:return f=new av({schema:u.content}),Wa.assert(c,o,"recipientCertificate","recipientKey"),v=(m=o).recipientCertificate,d=m.recipientKey,e.next=27,f.decrypt(0,{recipientCertificate:v,recipientPrivateKey:d},r);case 27:return g=e.sent,this.parsedValue.safeContents.push({privacyMode:2,value:Xh.fromBER(g)}),e.abrupt("break",39);case 30:return p=new Bh({schema:u.content}),Wa.assert(c,o,"password"),y=o.password,e.next=35,p.decrypt({password:y},r);case 35:return w=e.sent,this.parsedValue.safeContents.push({privacyMode:1,value:Xh.fromBER(w)}),e.abrupt("break",39);case 38:throw new Error('Unknown "contentType" for AuthenticatedSafe: " '.concat(u.contentType));case 39:e.next=9;break;case 41:e.next=46;break;case 43:e.prev=43,e.t1=e.catch(7),a.e(e.t1);case 46:return e.prev=46,a.f(),e.finish(46);case 49:case"end":return e.stop()}}),e,this,[[7,43,46,49]])}))),function(e){return s.apply(this,arguments)})},{key:"makeInternalValues",value:(r=a(k().mark((function e(t){var r,a,n,i,s,u,o,c,h,f,m,v,d,g=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=g.length>1&&void 0!==g[1]?g[1]:po(!0),this.parsedValue){e.next=3;break}throw new Error('Please run "parseValues" first or add "parsedValue" manually');case 3:if(Ga.assert(this.parsedValue,"this.parsedValue","object"),Ga.assert(this.parsedValue.safeContents,"this.parsedValue.safeContents","Array"),Ga.assert(t,"parameters","object"),Wa.assert(t,"safeContents"),Ga.assert(t.safeContents,"parameters.safeContents","Array"),t.safeContents.length===this.parsedValue.safeContents.length){e.next=10;break}throw new Ga('Length of "parameters.safeContents" must be equal to "this.parsedValue.safeContents"');case 10:this.safeContents=[],a=l(this.parsedValue.safeContents.entries()),e.prev=12,a.s();case 14:if((n=a.n()).done){e.next=54;break}i=b(n.value,2),s=i[0],u=i[1],Wa.assert("content",u,"privacyMode","value"),Ga.assert(u.value,"content.value",Xh),e.t0=u.privacyMode,e.next=0===e.t0?21:1===e.t0?24:2===e.t0?31:51;break;case 21:return o=u.value.toSchema().toBER(!1),this.safeContents.push(new nc({contentType:"1.2.840.113549.1.7.1",content:new _t({valueHex:o})})),e.abrupt("break",52);case 24:return c=new Bh,(h=t.safeContents[s]).contentToEncrypt=u.value.toSchema().toBER(!1),e.next=29,c.encrypt(h,r);case 29:return this.safeContents.push(new nc({contentType:"1.2.840.113549.1.7.6",content:c.toSchema()})),e.abrupt("break",52);case 31:f=new av,m=u.value.toSchema().toBER(!1),v=t.safeContents[s],Wa.assert("parameters.safeContents[".concat(s,"]"),v,"encryptingCertificate","encryptionAlgorithm"),e.t1=!0,e.next=e.t1===("aes-cbc"===v.encryptionAlgorithm.name.toLowerCase())||e.t1===("aes-gcm"===v.encryptionAlgorithm.name.toLowerCase())?38:39;break;case 38:return e.abrupt("break",40);case 39:throw new Error('Incorrect parameter "encryptionAlgorithm" in "parameters.safeContents[i]": '.concat(v.encryptionAlgorithm));case 40:e.t2=!0,e.next=e.t2===(128===v.encryptionAlgorithm.length)||e.t2===(192===v.encryptionAlgorithm.length)||e.t2===(256===v.encryptionAlgorithm.length)?43:44;break;case 43:return e.abrupt("break",45);case 44:throw new Error('Incorrect parameter "encryptionAlgorithm.length" in "parameters.safeContents[i]": '.concat(v.encryptionAlgorithm.length));case 45:return d=v.encryptionAlgorithm,f.addRecipientByCertificate(v.encryptingCertificate,{},void 0,r),e.next=49,f.encrypt(d,m,r);case 49:return this.safeContents.push(new nc({contentType:"1.2.840.113549.1.7.3",content:f.toSchema()})),e.abrupt("break",52);case 51:throw new Error('Incorrect value for "content.privacyMode": '.concat(u.privacyMode));case 52:e.next=14;break;case 54:e.next=59;break;case 56:e.prev=56,e.t3=e.catch(12),a.e(e.t3);case 59:return e.prev=59,a.f(),e.finish(59);case 62:return e.abrupt("return",this);case 63:case"end":return e.stop()}}),e,this,[[12,56,59,62]])}))),function(e){return r.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case nv:return[];case iv:return{};default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case nv:return 0===r.length;case iv:return r instanceof Object&&0===Object.keys(r).length;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new na({name:t.contentInfos||Xa,value:nc.schema()})]})}}]);var r,s}(Ya);uv.CLASS_NAME="AuthenticatedSafe";var ov="hashAlgorithm",lv="issuerNameHash",cv="issuerKeyHash",hv="serialNumber",fv=[ov,lv,cv,hv],mv=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).hashAlgorithm=Le(r,ov,t.defaultValues(ov)),e.issuerNameHash=Le(r,lv,t.defaultValues(lv)),e.issuerKeyHash=Le(r,cv,t.defaultValues(cv)),e.serialNumber=Le(r,hv,t.defaultValues(hv)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,fv);var r=sa(e,e,t.schema({names:{hashAlgorithm:ov,issuerNameHash:lv,issuerKeyHash:cv,serialNumber:hv}}));za.assertSchema(r,this.className),this.hashAlgorithm=new Nn({schema:r.result.hashAlgorithm}),this.issuerNameHash=r.result.issuerNameHash,this.issuerKeyHash=r.result.issuerKeyHash,this.serialNumber=r.result.serialNumber}},{key:"toSchema",value:function(){return new cr({value:[this.hashAlgorithm.toSchema(),this.issuerNameHash,this.issuerKeyHash,this.serialNumber]})}},{key:"toJSON",value:function(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),issuerNameHash:this.issuerNameHash.toJSON(),issuerKeyHash:this.issuerKeyHash.toJSON(),serialNumber:this.serialNumber.toJSON()}}},{key:"isEqual",value:function(e){return this.hashAlgorithm.algorithmId===e.hashAlgorithm.algorithmId&&(!!Ie.isEqual(this.issuerNameHash.valueBlock.valueHexView,e.issuerNameHash.valueBlock.valueHexView)&&(!!Ie.isEqual(this.issuerKeyHash.valueBlock.valueHexView,e.issuerKeyHash.valueBlock.valueHexView)&&!!this.serialNumber.isEqual(e.serialNumber)))}},{key:"createForCertificate",value:(s=a(k().mark((function e(t,r){var a,n,i,s,u,o,l=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=l.length>2&&void 0!==l[2]?l[2]:po(!0),Wa.assert(r,ov,"issuerCertificate"),n=a.getOIDByAlgorithm({name:r.hashAlgorithm},!0,"hashAlgorithm"),this.hashAlgorithm=new Nn({algorithmId:n,algorithmParams:new Ut}),i=r.issuerCertificate,this.serialNumber=t.serialNumber,e.next=8,a.digest({name:r.hashAlgorithm},i.subject.toSchema().toBER(!1));case 8:return s=e.sent,this.issuerNameHash=new _t({valueHex:s}),u=i.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView,e.next=13,a.digest({name:r.hashAlgorithm},u);case 13:o=e.sent,this.issuerKeyHash=new _t({valueHex:o});case 15:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})}],[{key:"create",value:(r=a(k().mark((function e(r,a){var n,i,s=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>2&&void 0!==s[2]?s[2]:po(!0),i=new t,e.next=4,i.createForCertificate(r,a,n);case 4:return e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"defaultValues",value:function(e){switch(e){case ov:return new Nn;case lv:case cv:return new _t;case hv:return new Zt;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case ov:return r.algorithmId===Xa&&"algorithmParams"in r==!1;case lv:case cv:case hv:return r.isEqual(t.defaultValues(hv));default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[Nn.schema(t.hashAlgorithmObject||{names:{blockName:t.hashAlgorithm||Xa}}),new _t({name:t.issuerNameHash||Xa}),new _t({name:t.issuerKeyHash||Xa}),new Zt({name:t.serialNumber||Xa})]})}}]);var r,s}(Ya);mv.CLASS_NAME="CertID";var vv="certID",dv="certStatus",gv="thisUpdate",pv="nextUpdate",yv="singleExtensions",kv=[vv,dv,gv,pv,yv],wv=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).certID=Le(r,vv,t.defaultValues(vv)),e.certStatus=Le(r,dv,t.defaultValues(dv)),e.thisUpdate=Le(r,gv,t.defaultValues(gv)),pv in r&&(e.nextUpdate=Le(r,pv,t.defaultValues(pv))),yv in r&&(e.singleExtensions=Le(r,yv,t.defaultValues(yv))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,kv);var r=sa(e,e,t.schema({names:{certID:{names:{blockName:vv}},certStatus:dv,thisUpdate:gv,nextUpdate:pv,singleExtensions:{names:{blockName:yv}}}}));za.assertSchema(r,this.className),this.certID=new mv({schema:r.result.certID}),this.certStatus=r.result.certStatus,this.thisUpdate=r.result.thisUpdate.toDate(),pv in r.result&&(this.nextUpdate=r.result.nextUpdate.toDate()),yv in r.result&&(this.singleExtensions=Array.from(r.result.singleExtensions.valueBlock.value,(function(e){return new Qo({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(this.certID.toSchema()),e.push(this.certStatus),e.push(new Xr({valueDate:this.thisUpdate})),this.nextUpdate&&e.push(new Vt({idBlock:{tagClass:3,tagNumber:0},value:[new Xr({valueDate:this.nextUpdate})]})),this.singleExtensions&&e.push(new cr({value:Array.from(this.singleExtensions,(function(e){return e.toSchema()}))})),new cr({value:e})}},{key:"toJSON",value:function(){var e={certID:this.certID.toJSON(),certStatus:this.certStatus.toJSON(),thisUpdate:this.thisUpdate};return this.nextUpdate&&(e.nextUpdate=this.nextUpdate),this.singleExtensions&&(e.singleExtensions=Array.from(this.singleExtensions,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case vv:return new mv;case dv:return{};case gv:case pv:return new Date(0,0,0);case yv:return[];default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case vv:return mv.compareWithDefault("hashAlgorithm",r.hashAlgorithm)&&mv.compareWithDefault("issuerNameHash",r.issuerNameHash)&&mv.compareWithDefault("issuerKeyHash",r.issuerKeyHash)&&mv.compareWithDefault("serialNumber",r.serialNumber);case dv:return 0===Object.keys(r).length;case gv:case pv:return r===t.defaultValues(e);default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[mv.schema(t.certID||{}),new aa({value:[new Nt({name:t.certStatus||Xa,idBlock:{tagClass:3,tagNumber:0}}),new Vt({name:t.certStatus||Xa,idBlock:{tagClass:3,tagNumber:1},value:[new Xr,new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new $t]})]}),new Nt({name:t.certStatus||Xa,idBlock:{tagClass:3,tagNumber:2},lenBlock:{length:1}})]}),new Xr({name:t.thisUpdate||Xa}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Xr({name:t.nextUpdate||Xa})]}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[el.schema(t.singleExtensions||{})]})]})}}])}(Ya);wv.CLASS_NAME="SingleResponse";var bv="tbs",Sv="version",Av="responderID",Nv="producedAt",Cv="responses",xv="responseExtensions",Ev="ResponseData",Iv="".concat(Ev,".").concat(Sv),Bv="".concat(Ev,".").concat(Av),Vv="".concat(Ev,".").concat(Nv),Dv="".concat(Ev,".").concat(Cv),Pv="".concat(Ev,".").concat(xv),Ov=[Ev,Iv,Bv,Vv,Dv,Pv],Rv=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).tbsView=new Uint8Array(Le(r,bv,t.defaultValues(bv))),Sv in r&&(e.version=Le(r,Sv,t.defaultValues(Sv))),e.responderID=Le(r,Av,t.defaultValues(Av)),e.producedAt=Le(r,Nv,t.defaultValues(Nv)),e.responses=Le(r,Cv,t.defaultValues(Cv)),xv in r&&(e.responseExtensions=Le(r,xv,t.defaultValues(xv))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"tbs",get:function(){return Ie.toArrayBuffer(this.tbsView)},set:function(e){this.tbsView=new Uint8Array(e)}},{key:"fromSchema",value:function(e){Ze(e,Ov);var r=sa(e,e,t.schema());za.assertSchema(r,this.className),this.tbsView=r.result.ResponseData.valueBeforeDecodeView,Iv in r.result&&(this.version=r.result[Iv].valueBlock.valueDec),1===r.result[Bv].idBlock.tagNumber?this.responderID=new an({schema:r.result[Bv].valueBlock.value[0]}):this.responderID=r.result[Bv].valueBlock.value[0],this.producedAt=r.result[Vv].toDate(),this.responses=Array.from(r.result[Dv],(function(e){return new wv({schema:e})})),Pv in r.result&&(this.responseExtensions=Array.from(r.result[Pv].valueBlock.value,(function(e){return new Qo({schema:e})})))}},{key:"toSchema",value:function(){var e,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!1===r){if(!this.tbsView.byteLength)return t.schema();var a=Et(this.tbsView);za.assert(a,"TBS Response Data"),e=a.result}else{var n=[];Sv in this&&n.push(new Vt({idBlock:{tagClass:3,tagNumber:0},value:[new Zt({value:this.version})]})),this.responderID instanceof an?n.push(new Vt({idBlock:{tagClass:3,tagNumber:1},value:[this.responderID.toSchema()]})):n.push(new Vt({idBlock:{tagClass:3,tagNumber:2},value:[this.responderID]})),n.push(new Xr({valueDate:this.producedAt})),n.push(new cr({value:Array.from(this.responses,(function(e){return e.toSchema()}))})),this.responseExtensions&&n.push(new Vt({idBlock:{tagClass:3,tagNumber:1},value:[new cr({value:Array.from(this.responseExtensions,(function(e){return e.toSchema()}))})]})),e=new cr({value:n})}return e}},{key:"toJSON",value:function(){var e={};return Sv in this&&(e.version=this.version),this.responderID&&(e.responderID=this.responderID),this.producedAt&&(e.producedAt=this.producedAt),this.responses&&(e.responses=Array.from(this.responses,(function(e){return e.toJSON()}))),this.responseExtensions&&(e.responseExtensions=Array.from(this.responseExtensions,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case Sv:return 0;case bv:return qa;case Av:return{};case Nv:return new Date(0,0,0);case Cv:case xv:return[];default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case bv:return 0===r.byteLength;case Av:return 0===Object.keys(r).length;case Nv:return r===t.defaultValues(e);case Cv:case xv:return 0===r.length;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Ev,value:[new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Zt({name:t.version||Iv})]}),new aa({value:[new Vt({name:t.responderID||Bv,idBlock:{tagClass:3,tagNumber:1},value:[an.schema(t.ResponseDataByName||{names:{blockName:"ResponseData.byName"}})]}),new Vt({name:t.responderID||Bv,idBlock:{tagClass:3,tagNumber:2},value:[new _t({name:t.ResponseDataByKey||"ResponseData.byKey"})]})]}),new Xr({name:t.producedAt||Vv}),new cr({value:[new na({name:Dv,value:wv.schema(t.response||{})})]}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[el.schema(t.extensions||{names:{blockName:Pv}})]})]})}}])}(Ya);Rv.CLASS_NAME="ResponseData";var Uv,Lv="trustedCerts",Tv="certs",Hv="crls",Mv="ocsps",Kv="checkDate",_v="findOrigin",jv="findIssuer";!function(e){e[e.unknown=-1]="unknown",e[e.success=0]="success",e[e.noRevocation=11]="noRevocation",e[e.noPath=60]="noPath",e[e.noValidPath=97]="noValidPath"}(Uv||(Uv={}));var Jv=function(e){function t(e,r){var a;return i(this,t),(a=n(this,t,[r])).name=t.NAME,a.code=e,a.message=r,a}return m(t,e),o(t)}(I(Error));function Fv(e,t){for(var r=0;r<t.length;r++)if(Ie.isEqual(e.tbsView,t[r].tbsView))return!0;return!1}Jv.NAME="ChainValidationError";var qv=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e),this.trustedCerts=Le(t,Lv,this.defaultValues(Lv)),this.certs=Le(t,Tv,this.defaultValues(Tv)),this.crls=Le(t,Hv,this.defaultValues(Hv)),this.ocsps=Le(t,Mv,this.defaultValues(Mv)),this.checkDate=Le(t,Kv,this.defaultValues(Kv)),this.findOrigin=Le(t,_v,this.defaultValues(_v)),this.findIssuer=Le(t,jv,this.defaultValues(jv))}return o(e,[{key:"defaultFindIssuer",value:(n=a(k().mark((function e(t,r){var a,n,i,s,u,o,c,h,f,m,v,d,g,p,y,w,b=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f=function(e){if(null!==i&&e.extensions){var r,a=!1,o=l(e.extensions);try{for(o.s();!(r=o.n()).done;){var c=r.value;if(c.extnID===Mn&&c.parsedValue){a=!0,Ie.isEqual(c.parsedValue.valueBlock.valueHex,i.valueBlock.valueHexView)&&n.push(e);break}}}catch(e){o.e(e)}finally{o.f()}if(a)return}var h=!1;null!==u&&(h=e.serialNumber.isEqual(u)),null!==s?e.subject.isEqual(s)&&h&&n.push(e):t.issuer.isEqual(e.subject)&&n.push(e)},a=b.length>2&&void 0!==b[2]?b[2]:po(!0),n=[],i=null,s=null,u=null,!t.subject.isEqual(t.issuer)){e.next=17;break}return e.prev=7,e.next=10,t.verify(void 0,a);case 10:if(!e.sent){e.next=13;break}return e.abrupt("return",[t]);case 13:e.next=17;break;case 15:e.prev=15,e.t0=e.catch(7);case 17:if(!t.extensions){e.next=36;break}o=l(t.extensions),e.prev=19,o.s();case 21:if((c=o.n()).done){e.next=28;break}if(!((h=c.value).extnID===Zn&&h.parsedValue instanceof gi)){e.next=26;break}return h.parsedValue.keyIdentifier?i=h.parsedValue.keyIdentifier:(h.parsedValue.authorityCertIssuer&&(s=h.parsedValue.authorityCertIssuer),h.parsedValue.authorityCertSerialNumber&&(u=h.parsedValue.authorityCertSerialNumber)),e.abrupt("break",28);case 26:e.next=21;break;case 28:e.next=33;break;case 30:e.prev=30,e.t1=e.catch(19),o.e(e.t1);case 33:return e.prev=33,o.f(),e.finish(33);case 36:m=l(r.trustedCerts);try{for(m.s();!(v=m.n()).done;)d=v.value,f(d)}catch(e){m.e(e)}finally{m.f()}g=l(r.certs);try{for(g.s();!(p=g.n()).done;)y=p.value,f(y)}catch(e){g.e(e)}finally{g.f()}w=n.length-1;case 41:if(!(w>=0)){e.next=55;break}return e.prev=42,e.next=45,t.verify(n[w],a);case 45:!1===e.sent&&n.splice(w,1),e.next=52;break;case 49:e.prev=49,e.t2=e.catch(42),n.splice(w,1);case 52:w--,e.next=41;break;case 55:return e.abrupt("return",n);case 56:case"end":return e.stop()}}),e,null,[[7,15],[19,30,33,36],[42,49]])}))),function(e,t){return n.apply(this,arguments)})},{key:"defaultValues",value:function(t){switch(t){case Lv:case Tv:case Hv:case Mv:return[];case Kv:return new Date;case _v:return e.defaultFindOrigin;case jv:return this.defaultFindIssuer;default:throw new Error("Invalid member name for CertificateChainValidationEngine class: ".concat(t))}}},{key:"sort",value:(r=a(k().mark((function e(){var t,r,n,i,s,u,o,c,h,f,m,v,d,g,p,y,w,S,A,C,x,E,I,B=this,V=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=function(){return c=a(k().mark((function e(t){var r,a,n,i,s,u,o,l,c=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=c.length>1&&void 0!==c[1]&&c[1],a=!1,n=!1,i=!1,s=!1,!t.extensions){e.next=22;break}u=0;case 7:if(!(u<t.extensions.length)){e.next=16;break}if(!(o=t.extensions[u]).critical||o.parsedValue){e.next=11;break}return e.abrupt("return",{result:!1,resultCode:6,resultMessage:"Unable to parse critical certificate extension: ".concat(o.extnID)});case 11:o.extnID===Kn&&(i=!0,4==(4&(l=new Uint8Array(o.parsedValue.valueBlock.valueHex))[0])&&(n=!0),2==(2&l[0])&&(s=!0)),o.extnID===Jn&&"cA"in o.parsedValue&&!0===o.parsedValue.cA&&(a=!0);case 13:u++,e.next=7;break;case 16:if(!0!==n||!1!==a){e.next=18;break}return e.abrupt("return",{result:!1,resultCode:3,resultMessage:'Unable to build certificate chain - using "keyCertSign" flag set without BasicConstraints'});case 18:if(!0!==i||!0!==a||!1!==n){e.next=20;break}return e.abrupt("return",{result:!1,resultCode:4,resultMessage:'Unable to build certificate chain - "keyCertSign" flag was not set'});case 20:if(!0!==a||!0!==i||!r||!1!==s){e.next=22;break}return e.abrupt("return",{result:!1,resultCode:5,resultMessage:'Unable to build certificate chain - intermediate certificate must have "cRLSign" key usage flag'});case 22:if(!1!==a){e.next=24;break}return e.abrupt("return",{result:!1,resultCode:7,resultMessage:"Unable to build certificate chain - more than one possible end-user certificate"});case 24:return e.abrupt("return",{result:!0,resultCode:0,resultMessage:Xa});case 25:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)},o=function(e){return c.apply(this,arguments)},t=V.length>0&&void 0!==V[0]&&V[0],r=V.length>1&&void 0!==V[1]?V[1]:po(!0),n=[],i=function(){var e=a(k().mark((function e(t,r){var a,n,s,u,o,l,c;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=function(e){for(var t=!0,r=0;r<e.length;r++){for(var a=0;a<e.length;a++)if(a!==r&&e[r]===e[a]){t=!1;break}if(!t)break}return t},a=[],!Fv(t,B.trustedCerts)){e.next=4;break}return e.abrupt("return",[[t]]);case 4:return e.next=6,B.findIssuer(t,B,r);case 6:if(0!==(s=e.sent).length){e.next=9;break}throw new Error("No valid certificate paths found");case 9:u=0;case 10:if(!(u<s.length)){e.next=21;break}if(!Ie.isEqual(s[u].tbsView,t.tbsView)){e.next=14;break}return a.push([s[u]]),e.abrupt("continue",18);case 14:return e.next=16,i(s[u],r);case 16:for(o=e.sent,l=0;l<o.length;l++)(c=o[l].slice()).splice(0,0,s[u]),n(c)?a.push(c):a.push(o[l]);case 18:u++,e.next=10;break;case 21:return e.abrupt("return",a);case 22:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),s=function(){var e=a(k().mark((function e(t){var a,i,s,u,o,l;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=[],s=[],(a=[]).push.apply(a,N(n.filter((function(e){return t.issuer.isEqual(e.subject)})))),0!==a.length){e.next=6;break}return e.abrupt("return",{status:1,statusMessage:"No certificate's issuers"});case 6:if(i.push.apply(i,N(B.crls.filter((function(e){return e.issuer.isEqual(t.issuer)})))),0!==i.length){e.next=9;break}return e.abrupt("return",{status:2,statusMessage:"No CRLs for specific certificate issuer"});case 9:u=0;case 10:if(!(u<i.length)){e.next=33;break}if(!((o=i[u]).nextUpdate&&o.nextUpdate.value<B.checkDate)){e.next=14;break}return e.abrupt("continue",30);case 14:l=0;case 15:if(!(l<a.length)){e.next=30;break}return e.prev=16,e.next=19,i[u].verify({issuerCertificate:a[l]},r);case 19:if(!e.sent){e.next=23;break}return s.push({crl:i[u],certificate:a[l]}),e.abrupt("break",30);case 23:e.next=27;break;case 25:e.prev=25,e.t0=e.catch(16);case 27:l++,e.next=15;break;case 30:u++,e.next=10;break;case 33:if(!s.length){e.next=35;break}return e.abrupt("return",{status:0,statusMessage:Xa,result:s});case 35:return e.abrupt("return",{status:3,statusMessage:"No valid CRLs found"});case 36:case"end":return e.stop()}}),e,null,[[16,25]])})));return function(t){return e.apply(this,arguments)}}(),u=function(){var e=a(k().mark((function e(t,a){var n,i,s,u;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=r.getAlgorithmByOID(t.signatureAlgorithm.algorithmId)).name){e.next=3;break}return e.abrupt("return",1);case 3:if(n.hash){e.next=5;break}return e.abrupt("return",1);case 5:i=0;case 6:if(!(i<B.ocsps.length)){e.next=18;break}return s=B.ocsps[i],e.next=10,s.getCertificateStatus(t,a,r);case 10:if(!(u=e.sent).isForCertificate){e.next=15;break}if(0!==u.status){e.next=14;break}return e.abrupt("return",0);case 14:return e.abrupt("return",1);case 15:i++,e.next=6;break;case 18:return e.abrupt("return",2);case 19:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),h=function(){var e=a(k().mark((function e(r,a){var n,i,c,h,f,m,v,d,g,p,y,w,S,A,N,C;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<r.length)){e.next=7;break}if(!(r[n].notBefore.value>a||r[n].notAfter.value<a)){e.next=4;break}return e.abrupt("return",{result:!1,resultCode:8,resultMessage:"The certificate is either not yet valid or expired"});case 4:n++,e.next=1;break;case 7:if(!(r.length<2)){e.next=9;break}return e.abrupt("return",{result:!1,resultCode:9,resultMessage:"Too short certificate path"});case 9:i=r.length-2;case 10:if(!(i>=0)){e.next=17;break}if(!1!==r[i].issuer.isEqual(r[i].subject)){e.next=14;break}if(!1!==r[i].issuer.isEqual(r[i+1].subject)){e.next=14;break}return e.abrupt("return",{result:!1,resultCode:10,resultMessage:"Incorrect name chaining"});case 14:i--,e.next=10;break;case 17:if(0===B.crls.length&&0===B.ocsps.length){e.next=86;break}c=0;case 19:if(!(c<r.length-1)){e.next=86;break}if(h=2,f={status:0,statusMessage:Xa},0===B.ocsps.length){e.next=31;break}return e.next=25,u(r[c],r[c+1]);case 25:h=e.sent,e.t0=h,e.next=0===e.t0?29:1===e.t0?30:31;break;case 29:return e.abrupt("continue",83);case 30:return e.abrupt("return",{result:!1,resultCode:12,resultMessage:"One of certificates was revoked via OCSP response"});case 31:if(0===B.crls.length){e.next=55;break}return e.next=34,s(r[c]);case 34:if(0!==(f=e.sent).status||!f.result){e.next=51;break}m=0;case 37:if(!(m<f.result.length)){e.next=49;break}if(!f.result[m].crl.isCertificateRevoked(r[c])){e.next=41;break}return e.abrupt("return",{result:!1,resultCode:12,resultMessage:"One of certificates had been revoked"});case 41:return e.next=43,o(f.result[m].certificate,!0);case 43:if(!1!==e.sent.result){e.next=46;break}return e.abrupt("return",{result:!1,resultCode:13,resultMessage:"CRL issuer certificate is not a CA certificate or does not have crlSign flag"});case 46:m++,e.next=37;break;case 49:e.next=53;break;case 51:if(!1!==t){e.next=53;break}throw new Jv(Uv.noRevocation,"No revocation values found for one of certificates: ".concat(f.statusMessage));case 53:e.next=57;break;case 55:if(2!==h){e.next=57;break}return e.abrupt("return",{result:!1,resultCode:11,resultMessage:"No revocation values found for one of certificates"});case 57:if(2!==h||2!==f.status||!t){e.next=83;break}if(v=r[c+1],d=!1,!v.extensions){e.next=81;break}g=l(v.extensions),e.prev=62,g.s();case 64:if((p=g.n()).done){e.next=73;break}y=p.value,e.t1=y.extnID,e.next=e.t1===Gn||e.t1===Wn||e.t1===ti?69:71;break;case 69:return d=!0,e.abrupt("break",71);case 71:e.next=64;break;case 73:e.next=78;break;case 75:e.prev=75,e.t2=e.catch(62),g.e(e.t2);case 78:return e.prev=78,g.f(),e.finish(78);case 81:if(!d){e.next=83;break}throw new Jv(Uv.noRevocation,"No revocation values found for one of certificates: ".concat(f.statusMessage));case 83:c++,e.next=19;break;case 86:w=l(r.entries()),e.prev=87,w.s();case 89:if((S=w.n()).done){e.next=100;break}if(A=b(S.value,2),N=A[0],C=A[1],N){e.next=93;break}return e.abrupt("continue",98);case 93:return e.next=95,o(C);case 95:if(e.sent.result){e.next=98;break}return e.abrupt("return",{result:!1,resultCode:14,resultMessage:"One of intermediate certificates is not a CA certificate"});case 98:e.next=89;break;case 100:e.next=105;break;case 102:e.prev=102,e.t3=e.catch(87),w.e(e.t3);case 105:return e.prev=105,w.f(),e.finish(105);case 108:return e.abrupt("return",{result:!0});case 109:case"end":return e.stop()}}),e,null,[[62,75,78,81],[87,102,105,108]])})));return function(t,r){return e.apply(this,arguments)}}(),n.push.apply(n,N(this.trustedCerts)),n.push.apply(n,N(this.certs)),f=0;case 12:if(!(f<n.length)){e.next=27;break}m=0;case 14:if(!(m<n.length)){e.next=24;break}if(f!==m){e.next=17;break}return e.abrupt("continue",21);case 17:if(!Ie.isEqual(n[f].tbsView,n[m].tbsView)){e.next=21;break}return n.splice(m,1),f=0,e.abrupt("break",24);case 21:m++,e.next=14;break;case 24:f++,e.next=12;break;case 27:return v=n[n.length-1],g=[v],e.next=31,i(v,r);case 31:if(0!==(d=e.sent).length){e.next=34;break}throw new Jv(Uv.noPath,"Unable to find certificate path");case 34:p=d.length-1;case 35:if(!(p>=0)){e.next=57;break}y=!1,w=0;case 38:if(!(w<d[p].length)){e.next=53;break}S=d[p][w],A=0;case 41:if(!(A<this.trustedCerts.length)){e.next=48;break}if(!Ie.isEqual(S.tbsView,this.trustedCerts[A].tbsView)){e.next=45;break}return y=!0,e.abrupt("break",48);case 45:A++,e.next=41;break;case 48:if(!y){e.next=50;break}return e.abrupt("break",53);case 50:w++,e.next=38;break;case 53:y||d.splice(p,1);case 54:p--,e.next=35;break;case 57:if(0!==d.length){e.next=59;break}throw new Jv(Uv.noValidPath,"No valid certificate paths found");case 59:for(C=d[0].length,x=0,E=0;E<d.length;E++)d[E].length<C&&(C=d[E].length,x=E);for(I=0;I<d[x].length;I++)g.push(d[x][I]);return e.next=65,h(g,this.checkDate);case 65:if(!1!==(d=e.sent).result){e.next=68;break}throw d;case 68:return e.abrupt("return",g);case 69:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"verify",value:(t=a(k().mark((function e(){var t,r,a,n,i,s,u,o,l,c,h,f,m,v,d,g,p,y,w,b,S,A,N,C,E,I,B,V,D,P,O,R,U,L,T,H,M,K,_,j,J,F,q,X,G,W,z,Y,Q,Z,$,ee,te,re,ae,ne,ie,se,ue,oe,le,ce,he,fe,me,ve,de,ge,pe,ye,ke,we,be,Se,Ae,Ne,Ce,xe,Ee,Ie,Be,Ve,De,Pe,Oe,Re,Ue,Le,Te,He,Me,Ke,_e=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=function(e,t){if(0===e.typesAndValues.length||0===t.typesAndValues.length)return!0;if(e.typesAndValues.length<t.typesAndValues.length)return!1;for(var r=!0,a=0,n=0;n<t.typesAndValues.length;n++){for(var i=!1,s=a;s<e.typesAndValues.length;s++)if(i=e.typesAndValues[s].isEqual(t.typesAndValues[n]),e.typesAndValues[s].type===t.typesAndValues[n].type&&(r=r&&i),!0===i){if(0===a||a===s){a=s+1;break}return!1}if(!1===i)return!1}return 0!==a&&r},s=function(e,t){var r=e.valueBlock.valueHexView,a=t.valueBlock.valueHexView;if(4===r.length&&8===a.length){for(var n=0;n<4;n++)if((r[n]^a[n])&a[n+4])return!1;return!0}if(16===r.length&&32===a.length){for(var i=0;i<16;i++)if((r[i]^a[i])&a[i+16])return!1;return!0}return!1},i=function(e,t){var r=Qa(e),n=Qa(t),i=r.split("/");if(n.split("/").length>1)return!1;if(i.length>1)for(var s=0;s<i.length;s++)if(i[s].length>0&&":"!==i[s].charAt(i[s].length-1)){r=i[s].split(":")[0];break}if(a(r,n)){var u=r.split("."),o=n.split(".");return 0===o[0].length||u.length===o.length}return!1},n=function(e,t){var r=Qa(e),n=Qa(t),i=r.split("@"),s=n.split("@");if(0===i.length||0===s.length||i.length<s.length)return!1;if(1===s.length){if(a(i[1],s[0])){var u=i[1].split("."),o=s[0].split(".");return 0===o[0].length||u.length===o.length}return!1}return 0===r.localeCompare(n)},a=function(e,t){var r=Qa(e),a=Qa(t),n=r.split("."),i=a.split("."),s=n.length,u=i.length;if(0===s||0===u||s<u)return!1;for(var o=0;o<s;o++)if(0===n[o].length)return!1;for(var l=0;l<u;l++)if(0===i[l].length){if(0===l){if(1===u)return!1;continue}return!1}for(var c=0;c<u;c++)if(0!==i[u-1-c].length&&0!==n[s-1-c].localeCompare(i[u-1-c]))return!1;return!0},t=_e.length>0&&void 0!==_e[0]?_e[0]:{},r=_e.length>1&&void 0!==_e[1]?_e[1]:po(!0),e.prev=7,0!==this.certs.length){e.next=10;break}throw new Error("Empty certificate array");case 10:return o=t.passedWhenNotRevValues||!1,l=t.initialPolicySet||[Yn],c=t.initialExplicitPolicy||!1,h=t.initialPolicyMappingInhibit||!1,f=t.initialInhibitPolicy||!1,m=t.initialPermittedSubtreesSet||[],v=t.initialExcludedSubtreesSet||[],d=t.initialRequiredNameForms||[],g=c,p=h,y=f,w=[!1,!1,!1],b=0,S=0,A=0,N=m,C=v,E=d,e.next=31,this.sort(o,r);case 31:for(this.certs=e.sent,(I=[]).push(Yn),B=[],V=new Array(this.certs.length-1),D=0;D<this.certs.length-1;D++)V[D]=!0;B.push(V),P=new Array(this.certs.length-1),O=new Array(this.certs.length-1),R=g?this.certs.length-1:-1,U=this.certs.length-2;case 42:if(!(U>=0)){e.next=100;break}if(!(L=this.certs[U]).extensions){e.next=97;break}T=0;case 46:if(!(T<L.extensions.length)){e.next=83;break}if((H=L.extensions[T]).extnID!==zn){e.next=74;break}O[U]=H.parsedValue,M=0;case 51:if(!(M<I.length)){e.next=58;break}if(I[M]!==Yn){e.next=55;break}return delete B[M][U],e.abrupt("break",58);case 55:M++,e.next=51;break;case 58:K=0;case 59:if(!(K<H.parsedValue.certificatePolicies.length)){e.next=74;break}_=-1,j=H.parsedValue.certificatePolicies[K].policyIdentifier,J=0;case 63:if(!(J<I.length)){e.next=70;break}if(j!==I[J]){e.next=67;break}return _=J,e.abrupt("break",70);case 67:J++,e.next=63;break;case 70:-1===_?(I.push(j),(F=new Array(this.certs.length-1))[U]=!0,B.push(F)):B[_][U]=!0;case 71:K++,e.next=59;break;case 74:if(H.extnID!==Qn){e.next=78;break}if(!p){e.next=77;break}return e.abrupt("return",{result:!1,resultCode:98,resultMessage:"Policy mapping prohibited"});case 77:P[U]=H.parsedValue;case 78:H.extnID===$n&&!1===g&&(0===H.parsedValue.requireExplicitPolicy?(g=!0,R=U):!1===w[0]?(w[0]=!0,b=H.parsedValue.requireExplicitPolicy):b=b>H.parsedValue.requireExplicitPolicy?H.parsedValue.requireExplicitPolicy:b,0===H.parsedValue.inhibitPolicyMapping?p=!0:!1===w[1]?(w[1]=!0,S=H.parsedValue.inhibitPolicyMapping+1):S=S>H.parsedValue.inhibitPolicyMapping+1?H.parsedValue.inhibitPolicyMapping+1:S),H.extnID===ei&&!1===y&&(0===H.parsedValue.valueBlock.valueDec?y=!0:!1===w[2]?(w[2]=!0,A=H.parsedValue.valueBlock.valueDec):A=A>H.parsedValue.valueBlock.valueDec?H.parsedValue.valueBlock.valueDec:A);case 80:T++,e.next=46;break;case 83:if(!0!==y){e.next=94;break}q=-1,X=0;case 86:if(!(X<I.length)){e.next=93;break}if(I[X]!==Yn){e.next=90;break}return q=X,e.abrupt("break",93);case 90:X++,e.next=86;break;case 93:-1!==q&&delete B[0][U];case 94:!1===g&&!0===w[0]&&0==--b&&(g=!0,R=U,w[0]=!1),!1===p&&!0===w[1]&&0==--S&&(p=!0,w[1]=!1),!1===y&&!0===w[2]&&0==--A&&(y=!0,w[2]=!1);case 97:U--,e.next=42;break;case 100:G=0;case 101:if(!(G<this.certs.length-1)){e.next=118;break}if(!(G<this.certs.length-2&&void 0!==P[G+1])){e.next=115;break}W=0;case 104:if(!(W<P[G+1].mappings.length)){e.next=115;break}if(P[G+1].mappings[W].issuerDomainPolicy!==Yn&&P[G+1].mappings[W].subjectDomainPolicy!==Yn){e.next=107;break}return e.abrupt("return",{result:!1,resultCode:99,resultMessage:'The "anyPolicy" should not be a part of policy mapping scheme'});case 107:for(z=-1,Y=-1,Q=0;Q<I.length;Q++)I[Q]===P[G+1].mappings[W].issuerDomainPolicy&&(z=Q),I[Q]===P[G+1].mappings[W].subjectDomainPolicy&&(Y=Q);for(void 0!==B[z][G]&&delete B[z][G],Z=0;Z<O[G].certificatePolicies.length;Z++)if(P[G+1].mappings[W].subjectDomainPolicy===O[G].certificatePolicies[Z].policyIdentifier&&-1!==z&&-1!==Y)for($=0;$<=G;$++)void 0!==B[Y][$]&&(B[z][$]=!0,delete B[Y][$]);case 112:W++,e.next=104;break;case 115:G++,e.next=101;break;case 118:for(ee=0;ee<I.length;ee++)if(I[ee]===Yn)for(te=0;te<R;te++)delete B[ee][te];re=[],ae=0;case 121:if(!(ae<B.length)){e.next=149;break}ne=!0,ie=0;case 124:if(!(ie<this.certs.length-1)){e.next=145;break}if(se=!1,!(ie<R&&I[ae]===Yn&&I.length>1)){e.next=129;break}return ne=!1,e.abrupt("break",145);case 129:if(void 0!==B[ae][ie]){e.next=142;break}if(!(ie>=R)){e.next=139;break}ue=0;case 132:if(!(ue<I.length)){e.next=139;break}if(I[ue]!==Yn){e.next=136;break}return!0===B[ue][ie]&&(se=!0),e.abrupt("break",139);case 136:ue++,e.next=132;break;case 139:if(se){e.next=142;break}return ne=!1,e.abrupt("break",145);case 142:ie++,e.next=124;break;case 145:!0===ne&&re.push(I[ae]);case 146:ae++,e.next=121;break;case 149:if(oe=[],1!==l.length||l[0]!==Yn||!1!==g){e.next=154;break}oe=l,e.next=171;break;case 154:if(1!==re.length||re[0]!==Yn){e.next=158;break}oe=l,e.next=171;break;case 158:le=0;case 159:if(!(le<re.length)){e.next=171;break}ce=0;case 161:if(!(ce<l.length)){e.next=168;break}if(l[ce]!==re[le]&&l[ce]!==Yn){e.next=165;break}return oe.push(re[le]),e.abrupt("break",168);case 165:ce++,e.next=161;break;case 168:le++,e.next=159;break;case 171:if(he={result:oe.length>0,resultCode:0,resultMessage:oe.length>0?Xa:'Zero "userConstrPolicies" array, no intersections with "authConstrPolicies"',authConstrPolicies:re,userConstrPolicies:oe,explicitPolicyIndicator:g,policyMappings:P,certificatePath:this.certs},0!==oe.length){e.next=174;break}return e.abrupt("return",he);case 174:if(!1!==he.result){e.next=176;break}return e.abrupt("return",he);case 176:fe=this.certs.length-2;case 178:if(!(fe>=0)){e.next=296;break}if(me=this.certs[fe],ve=[],de=[],ge=[],me.extensions)for(pe=0;pe<me.extensions.length;pe++)(ye=me.extensions[pe]).extnID===Xn&&("permittedSubtrees"in ye.parsedValue&&(de=de.concat(ye.parsedValue.permittedSubtrees)),"excludedSubtrees"in ye.parsedValue&&(ge=ge.concat(ye.parsedValue.excludedSubtrees))),ye.extnID===_n&&(ve=ve.concat(ye.parsedValue.altNames));ke=E.length<=0,we=0;case 186:if(!(we<E.length)){e.next=207;break}e.t0=E[we].base.type,e.next=4===e.t0?190:204;break;case 190:if(E[we].base.value.typesAndValues.length===me.subject.typesAndValues.length){e.next=192;break}return e.abrupt("continue",204);case 192:ke=!0,be=0;case 194:if(!(be<me.subject.typesAndValues.length)){e.next=201;break}if(me.subject.typesAndValues[be].type===E[we].base.value.typesAndValues[be].type){e.next=198;break}return ke=!1,e.abrupt("break",201);case 198:be++,e.next=194;break;case 201:if(!0!==ke){e.next=203;break}return e.abrupt("break",204);case 203:return e.abrupt("break",204);case 204:we++,e.next=186;break;case 207:if(!1!==ke){e.next=212;break}throw he.result=!1,he.resultCode=21,he.resultMessage="No necessary name form found",he;case 212:Se=[[],[],[],[],[]],Ae=0;case 214:if(!(Ae<N.length)){e.next=231;break}e.t1=N[Ae].base.type,e.next=1===e.t1?218:2===e.t1?220:4===e.t1?222:6===e.t1?224:7===e.t1?226:228;break;case 218:return Se[0].push(N[Ae]),e.abrupt("break",228);case 220:return Se[1].push(N[Ae]),e.abrupt("break",228);case 222:return Se[2].push(N[Ae]),e.abrupt("break",228);case 224:return Se[3].push(N[Ae]),e.abrupt("break",228);case 226:return Se[4].push(N[Ae]),e.abrupt("break",228);case 228:Ae++,e.next=214;break;case 231:Ne=0;case 232:if(!(Ne<5)){e.next=265;break}Ce=!1,xe=!1,Ee=Se[Ne],Ie=0;case 237:if(!(Ie<Ee.length)){e.next=257;break}e.t2=Ne,e.next=0===e.t2?241:1===e.t2?243:2===e.t2?245:3===e.t2?248:4===e.t2?250:252;break;case 241:if(ve.length>0)for(Be=0;Be<ve.length;Be++)1===ve[Be].type&&(xe=!0,Ce=Ce||n(ve[Be].value,Ee[Ie].base.value));else for(Ve=0;Ve<me.subject.typesAndValues.length;Ve++)"1.2.840.113549.1.9.1"!==me.subject.typesAndValues[Ve].type&&"0.9.2342.19200300.100.1.3"!==me.subject.typesAndValues[Ve].type||(xe=!0,Ce=Ce||n(me.subject.typesAndValues[Ve].value.valueBlock.value,Ee[Ie].base.value));return e.abrupt("break",252);case 243:if(ve.length>0)for(De=0;De<ve.length;De++)2===ve[De].type&&(xe=!0,Ce=Ce||a(ve[De].value,Ee[Ie].base.value));return e.abrupt("break",252);case 245:return xe=!0,Ce=u(me.subject,Ee[Ie].base.value),e.abrupt("break",252);case 248:if(ve.length>0)for(Pe=0;Pe<ve.length;Pe++)6===ve[Pe].type&&(xe=!0,Ce=Ce||i(ve[Pe].value,Ee[Ie].base.value));return e.abrupt("break",252);case 250:if(ve.length>0)for(Oe=0;Oe<ve.length;Oe++)7===ve[Oe].type&&(xe=!0,Ce=Ce||s(ve[Oe].value,Ee[Ie].base.value));return e.abrupt("break",252);case 252:if(!Ce){e.next=254;break}return e.abrupt("break",257);case 254:Ie++,e.next=237;break;case 257:if(!(!1===Ce&&Ee.length>0&&xe)){e.next=262;break}throw he.result=!1,he.resultCode=41,he.resultMessage='Failed to meet "permitted sub-trees" name constraint',he;case 262:Ne++,e.next=232;break;case 265:Re=!1,Ue=0;case 267:if(!(Ue<C.length)){e.next=286;break}e.t3=C[Ue].base.type,e.next=1===e.t3?271:2===e.t3?273:4===e.t3?275:6===e.t3?277:7===e.t3?279:281;break;case 271:if(ve.length>=0)for(Le=0;Le<ve.length;Le++)1===ve[Le].type&&(Re=Re||n(ve[Le].value,C[Ue].base.value));else for(Te=0;Te<me.subject.typesAndValues.length;Te++)"1.2.840.113549.1.9.1"!==me.subject.typesAndValues[Te].type&&"0.9.2342.19200300.100.1.3"!==me.subject.typesAndValues[Te].type||(Re=Re||n(me.subject.typesAndValues[Te].value.valueBlock.value,C[Ue].base.value));return e.abrupt("break",281);case 273:if(ve.length>0)for(He=0;He<ve.length;He++)2===ve[He].type&&(Re=Re||a(ve[He].value,C[Ue].base.value));return e.abrupt("break",281);case 275:return Re=Re||u(me.subject,C[Ue].base.value),e.abrupt("break",281);case 277:if(ve.length>0)for(Me=0;Me<ve.length;Me++)6===ve[Me].type&&(Re=Re||i(ve[Me].value,C[Ue].base.value));return e.abrupt("break",281);case 279:if(ve.length>0)for(Ke=0;Ke<ve.length;Ke++)7===ve[Ke].type&&(Re=Re||s(ve[Ke].value,C[Ue].base.value));return e.abrupt("break",281);case 281:if(!Re){e.next=283;break}return e.abrupt("break",286);case 283:Ue++,e.next=267;break;case 286:if(!0!==Re){e.next=291;break}throw he.result=!1,he.resultCode=42,he.resultMessage='Failed to meet "excluded sub-trees" name constraint',he;case 291:N=N.concat(de),C=C.concat(ge);case 293:fe--,e.next=178;break;case 296:return e.abrupt("return",he);case 299:if(e.prev=299,e.t4=e.catch(7),!(e.t4 instanceof Error)){e.next=305;break}if(!(e.t4 instanceof Jv)){e.next=304;break}return e.abrupt("return",{result:!1,resultCode:e.t4.code,resultMessage:e.t4.message,error:e.t4});case 304:return e.abrupt("return",{result:!1,resultCode:Uv.unknown,resultMessage:e.t4.message,error:e.t4});case 305:if(!e.t4||"object"!==x(e.t4)||!("resultMessage"in e.t4)){e.next=307;break}return e.abrupt("return",e.t4);case 307:return e.abrupt("return",{result:!1,resultCode:-1,resultMessage:"".concat(e.t4)});case 308:case"end":return e.stop()}}),e,this,[[7,299]])}))),function(){return t.apply(this,arguments)})}],[{key:"defaultFindOrigin",value:function(e,t){0===e.tbsView.byteLength&&(e.tbsView=new Uint8Array(e.encodeTBS().toBER()));var r,a=l(t.certs);try{for(a.s();!(r=a.n()).done;){var n=r.value;if(0===n.tbsView.byteLength&&(n.tbsView=new Uint8Array(n.encodeTBS().toBER())),Ie.isEqual(e.tbsView,n.tbsView))return"Intermediate Certificates"}}catch(e){a.e(e)}finally{a.f()}var i,s=l(t.trustedCerts);try{for(s.s();!(i=s.n()).done;){var u=i.value;if(0===u.tbsView.byteLength&&(u.tbsView=new Uint8Array(u.encodeTBS().toBER())),Ie.isEqual(e.tbsView,u.tbsView))return"Trusted Certificates"}}catch(e){s.e(e)}finally{s.f()}return"Unknown"}}]);var t,r,n}(),Xv="tbsResponseData",Gv="signatureAlgorithm",Wv="signature",zv="certs",Yv="BasicOCSPResponse",Qv="".concat(Yv,".").concat(Xv),Zv="".concat(Yv,".").concat(Gv),$v="".concat(Yv,".").concat(Wv),ed="".concat(Yv,".").concat(zv),td=[Qv,Zv,$v,ed],rd=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).tbsResponseData=Le(r,Xv,t.defaultValues(Xv)),e.signatureAlgorithm=Le(r,Gv,t.defaultValues(Gv)),e.signature=Le(r,Wv,t.defaultValues(Wv)),zv in r&&(e.certs=Le(r,zv,t.defaultValues(zv))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,td);var r=sa(e,e,t.schema());za.assertSchema(r,this.className),this.tbsResponseData=new Rv({schema:r.result[Qv]}),this.signatureAlgorithm=new Nn({schema:r.result[Zv]}),this.signature=r.result[$v],ed in r.result&&(this.certs=Array.from(r.result[ed],(function(e){return new Kc({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(this.tbsResponseData.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new Vt({idBlock:{tagClass:3,tagNumber:0},value:[new cr({value:Array.from(this.certs,(function(e){return e.toSchema()}))})]})),new cr({value:e})}},{key:"toJSON",value:function(){var e={tbsResponseData:this.tbsResponseData.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,(function(e){return e.toJSON()}))),e}},{key:"getCertificateStatus",value:(u=a(k().mark((function e(t,r){var a,n,i,s,u,o,c,h,f,m,v,d,g,p,y,w=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=w.length>2&&void 0!==w[2]?w[2]:po(!0),n={isForCertificate:!1,status:2},i={},s=[],u=l(this.tbsResponseData.responses),e.prev=5,u.s();case 7:if((o=u.n()).done){e.next=18;break}if(c=o.value,h=a.getAlgorithmByOID(c.certID.hashAlgorithm.algorithmId,!0,"CertID.hashAlgorithm"),i[h.name]){e.next=16;break}return i[h.name]=1,f=new mv,s.push(f),e.next=16,f.createForCertificate(t,{hashAlgorithm:h.name,issuerCertificate:r},a);case 16:e.next=7;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(5),u.e(e.t0);case 23:return e.prev=23,u.f(),e.finish(23);case 26:m=l(this.tbsResponseData.responses),e.prev=27,m.s();case 29:if((v=m.n()).done){e.next=69;break}d=v.value,g=l(s),e.prev=32,g.s();case 34:if((p=g.n()).done){e.next=59;break}if(y=p.value,!d.certID.isEqual(y)){e.next=57;break}n.isForCertificate=!0,e.prev=38,e.t1=d.certStatus.idBlock.isConstructed,e.next=!0===e.t1?42:!1===e.t1?44:52;break;case 42:return 1===d.certStatus.idBlock.tagNumber&&(n.status=1),e.abrupt("break",52);case 44:e.t2=d.certStatus.idBlock.tagNumber,e.next=0===e.t2?47:2===e.t2?49:51;break;case 47:return n.status=0,e.abrupt("break",51);case 49:return n.status=2,e.abrupt("break",51);case 51:return e.abrupt("break",52);case 52:e.next=56;break;case 54:e.prev=54,e.t3=e.catch(38);case 56:return e.abrupt("return",n);case 57:e.next=34;break;case 59:e.next=64;break;case 61:e.prev=61,e.t4=e.catch(32),g.e(e.t4);case 64:return e.prev=64,g.f(),e.finish(64);case 67:e.next=29;break;case 69:e.next=74;break;case 71:e.prev=71,e.t5=e.catch(27),m.e(e.t5);case 74:return e.prev=74,m.f(),e.finish(74);case 77:return e.abrupt("return",n);case 78:case"end":return e.stop()}}),e,this,[[5,20,23,26],[27,71,74,77],[32,61,64,67],[38,54]])}))),function(e,t){return u.apply(this,arguments)})},{key:"sign",value:(s=a(k().mark((function e(t){var r,a,n,i,s,u=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>1&&void 0!==u[1]?u[1]:"SHA-1",a=u.length>2&&void 0!==u[2]?u[2]:po(!0),t){e.next=4;break}throw new Error("Need to provide a private key for signing");case 4:return e.next=6,a.getSignatureParameters(t,r);case 6:if(n=e.sent,"name"in(i=n.parameters.algorithm)){e.next=10;break}throw new Error("Empty algorithm");case 10:return this.signatureAlgorithm=n.signatureAlgorithm,this.tbsResponseData.tbsView=new Uint8Array(this.tbsResponseData.toSchema(!0).toBER()),e.next=14,a.signWithPrivateKey(this.tbsResponseData.tbsView,t,{algorithm:i});case 14:s=e.sent,this.signature=new qt({valueHex:s});case 16:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"verify",value:(r=a(k().mark((function e(){var t,r,a,n,i,s,u,o,c,h,f,m,v,d,g,p,y,w,S,A,N=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=N.length>0&&void 0!==N[0]?N[0]:{},r=N.length>1&&void 0!==N[1]?N[1]:po(!0),a=null,n=-1,i=t.trustedCerts||[],this.certs){e.next=7;break}throw new Error("No certificates attached to the BasicOCSPResponse");case 7:e.t0=!0,e.next=e.t0===this.tbsResponseData.responderID instanceof an?10:e.t0===this.tbsResponseData.responderID instanceof _t?29:51;break;case 10:s=l(this.certs.entries()),e.prev=11,s.s();case 13:if((u=s.n()).done){e.next=20;break}if(o=b(u.value,2),c=o[0],!o[1].subject.isEqual(this.tbsResponseData.responderID)){e.next=18;break}return n=c,e.abrupt("break",20);case 18:e.next=13;break;case 20:e.next=25;break;case 22:e.prev=22,e.t1=e.catch(11),s.e(e.t1);case 25:return e.prev=25,s.f(),e.finish(25);case 28:return e.abrupt("break",52);case 29:h=l(this.certs.entries()),e.prev=30,h.s();case 32:if((f=h.n()).done){e.next=42;break}return m=b(f.value,2),v=m[0],d=m[1],e.next=36,r.digest({name:"sha-1"},d.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);case 36:if(!Je(e.sent,this.tbsResponseData.responderID.valueBlock.valueHex)){e.next=40;break}return n=v,e.abrupt("break",42);case 40:e.next=32;break;case 42:e.next=47;break;case 44:e.prev=44,e.t2=e.catch(30),h.e(e.t2);case 47:return e.prev=47,h.f(),e.finish(47);case 50:return e.abrupt("break",52);case 51:throw new Error("Wrong value for responderID");case 52:if(-1!==n){e.next=54;break}throw new Error("Correct certificate was not found in OCSP response");case 54:a=this.certs[n],g=[a],p=l(this.certs),e.prev=57,p.s();case 59:if((y=p.n()).done){e.next=67;break}return w=y.value,e.next=63,_c(w,a);case 63:(S=e.sent)&&g.push(S);case 65:e.next=59;break;case 67:e.next=72;break;case 69:e.prev=69,e.t3=e.catch(57),p.e(e.t3);case 72:return e.prev=72,p.f(),e.finish(72);case 75:return A=new qv({certs:g,trustedCerts:i}),e.next=78,A.verify({},r);case 78:if(e.sent.result){e.next=81;break}throw new Error("Validation of signer's certificate failed");case 81:return e.abrupt("return",r.verifyWithPublicKey(this.tbsResponseData.tbsView,this.signature,this.certs[n].subjectPublicKeyInfo,this.signatureAlgorithm));case 82:case"end":return e.stop()}}),e,this,[[11,22,25,28],[30,44,47,50],[57,69,72,75]])}))),function(){return r.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case Xv:return new Rv;case Gv:return new Nn;case Wv:return new qt;case zv:return[];default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case"type":var a=Rv.compareWithDefault("tbs",r.tbs)&&Rv.compareWithDefault("responderID",r.responderID)&&Rv.compareWithDefault("producedAt",r.producedAt)&&Rv.compareWithDefault("responses",r.responses);return"responseExtensions"in r&&(a=a&&Rv.compareWithDefault("responseExtensions",r.responseExtensions)),a;case Gv:return r.algorithmId===Xa&&"algorithmParams"in r==!1;case Wv:return r.isEqual(t.defaultValues(e));case zv:return 0===r.length;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Yv,value:[Rv.schema(t.tbsResponseData||{names:{blockName:Qv}}),Nn.schema(t.signatureAlgorithm||{names:{blockName:Zv}}),new qt({name:t.signature||$v}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new cr({value:[new na({name:ed,value:Kc.schema(t.certs||{})})]})]})]})}}]);var r,s,u}(Ya);rd.CLASS_NAME="BasicOCSPResponse";var ad="tbs",nd="version",id="subject",sd="subjectPublicKeyInfo",ud="attributes",od="signatureAlgorithm",ld="signatureValue",cd="CertificationRequestInfo",hd="".concat(cd,".version"),fd="".concat(cd,".subject"),md="".concat(cd,".subjectPublicKeyInfo"),vd="".concat(cd,".attributes"),dd=[cd,hd,fd,md,vd,od,ld];function gd(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.CertificationRequestInfo||cd,value:[new Zt({name:t.CertificationRequestInfoVersion||hd}),an.schema(t.subject||{names:{blockName:fd}}),$s.schema({names:{blockName:md}}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new na({optional:!0,name:t.CertificationRequestInfoAttributes||vd,value:Dn.schema(t.attributes||{})})]})]})}var pd=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).tbsView=new Uint8Array(Le(r,ad,t.defaultValues(ad))),e.version=Le(r,nd,t.defaultValues(nd)),e.subject=Le(r,id,t.defaultValues(id)),e.subjectPublicKeyInfo=Le(r,sd,t.defaultValues(sd)),ud in r&&(e.attributes=Le(r,ud,t.defaultValues(ud))),e.signatureAlgorithm=Le(r,od,t.defaultValues(od)),e.signatureValue=Le(r,ld,t.defaultValues(ld)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"tbs",get:function(){return Ie.toArrayBuffer(this.tbsView)},set:function(e){this.tbsView=new Uint8Array(e)}},{key:"fromSchema",value:function(e){Ze(e,dd);var r=sa(e,e,t.schema());za.assertSchema(r,this.className),this.tbsView=r.result.CertificationRequestInfo.valueBeforeDecodeView,this.version=r.result[hd].valueBlock.valueDec,this.subject=new an({schema:r.result[fd]}),this.subjectPublicKeyInfo=new $s({schema:r.result[md]}),vd in r.result&&(this.attributes=Array.from(r.result[vd],(function(e){return new Dn({schema:e})}))),this.signatureAlgorithm=new Nn({schema:r.result.signatureAlgorithm}),this.signatureValue=r.result.signatureValue}},{key:"encodeTBS",value:function(){var e=[new Zt({value:this.version}),this.subject.toSchema(),this.subjectPublicKeyInfo.toSchema()];return ud in this&&e.push(new Vt({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes||[],(function(e){return e.toSchema()}))})),new cr({value:e})}},{key:"toSchema",value:function(){var e,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!1===r){if(0===this.tbsView.byteLength)return t.schema();var a=Et(this.tbsView);za.assert(a,"PKCS#10 Certificate Request"),e=a.result}else e=this.encodeTBS();return new cr({value:[e,this.signatureAlgorithm.toSchema(),this.signatureValue]})}},{key:"toJSON",value:function(){var e={tbs:Ue.ToHex(this.tbsView),version:this.version,subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return ud in this&&(e.attributes=Array.from(this.attributes||[],(function(e){return e.toJSON()}))),e}},{key:"sign",value:(u=a(k().mark((function e(t){var r,a,n,i,s,u=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>1&&void 0!==u[1]?u[1]:"SHA-1",a=u.length>2&&void 0!==u[2]?u[2]:po(!0),t){e.next=4;break}throw new Error("Need to provide a private key for signing");case 4:return e.next=6,a.getSignatureParameters(t,r);case 6:return n=e.sent,i=n.parameters,this.signatureAlgorithm=n.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER()),e.next=12,a.signWithPrivateKey(this.tbsView,t,i);case 12:s=e.sent,this.signatureValue=new qt({valueHex:s});case 14:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"verify",value:(s=a(k().mark((function e(){var t,r=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:po(!0),e.abrupt("return",t.verifyWithPublicKey(this.tbsView,this.signatureValue,this.subjectPublicKeyInfo,this.signatureAlgorithm));case 2:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"getPublicKey",value:(r=a(k().mark((function e(t){var r,a=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:po(!0),e.abrupt("return",r.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case ad:return qa;case nd:return 0;case id:return new an;case sd:return new $s;case ud:return[];case od:return new Nn;case ld:return new qt;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({value:[gd(t.certificationRequestInfo||{}),new cr({name:t.signatureAlgorithm||od,value:[new ar,new ra({optional:!0})]}),new qt({name:t.signatureValue||ld})]})}}]);var r,s,u}(Ya);pd.CLASS_NAME="CertificationRequest";var yd="digestAlgorithm",kd="digest",wd=[yd,kd],bd=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).digestAlgorithm=Le(r,yd,t.defaultValues(yd)),e.digest=Le(r,kd,t.defaultValues(kd)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,wd);var r=sa(e,e,t.schema({names:{digestAlgorithm:{names:{blockName:yd}},digest:kd}}));za.assertSchema(r,this.className),this.digestAlgorithm=new Nn({schema:r.result.digestAlgorithm}),this.digest=r.result.digest}},{key:"toSchema",value:function(){return new cr({value:[this.digestAlgorithm.toSchema(),this.digest]})}},{key:"toJSON",value:function(){return{digestAlgorithm:this.digestAlgorithm.toJSON(),digest:this.digest.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case yd:return new Nn;case kd:return new _t;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case yd:return Nn.compareWithDefault("algorithmId",r.algorithmId)&&"algorithmParams"in r==!1;case kd:return r.isEqual(t.defaultValues(e));default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[Nn.schema(t.digestAlgorithm||{names:{blockName:yd}}),new _t({name:t.digest||kd})]})}}])}(Ya);bd.CLASS_NAME="DigestInfo";var Sd="eContentType",Ad="eContent",Nd=[Sd,Ad],Cd=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(i(this,t),(e=n(this,t)).eContentType=Le(r,Sd,t.defaultValues(Sd)),Ad in r&&(e.eContent=Le(r,Ad,t.defaultValues(Ad)),1===e.eContent.idBlock.tagClass&&4===e.eContent.idBlock.tagNumber&&!1===e.eContent.idBlock.isConstructed)){for(var a=new _t({idBlock:{isConstructed:!0},isConstructed:!0}),s=0,u=e.eContent.valueBlock.valueHexView.slice().buffer,o=u.byteLength;o>0;){for(var l=new Uint8Array(u,s,s+65536>u.byteLength?u.byteLength-s:65536),c=new ArrayBuffer(l.length),h=new Uint8Array(c),f=0;f<h.length;f++)h[f]=l[f];a.valueBlock.value.push(new _t({valueHex:c})),o-=l.length,s+=l.length}e.eContent=a}return r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Nd);var r=sa(e,e,t.schema({names:{eContentType:Sd,eContent:Ad}}));za.assertSchema(r,this.className),this.eContentType=r.result.eContentType.valueBlock.toString(),Ad in r.result&&(this.eContent=r.result.eContent)}},{key:"toSchema",value:function(){var e=[];return e.push(new ar({value:this.eContentType})),this.eContent&&!1===t.compareWithDefault(Ad,this.eContent)&&e.push(new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.eContent]})),new cr({value:e})}},{key:"toJSON",value:function(){var e={eContentType:this.eContentType};return this.eContent&&!1===t.compareWithDefault(Ad,this.eContent)&&(e.eContent=this.eContent.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Sd:return Xa;case Ad:return new _t;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case Sd:return r===Xa;case Ad:return 1===r.idBlock.tagClass&&4===r.idBlock.tagNumber&&r.isEqual(t.defaultValues(Ad));default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new ar({name:t.eContentType||Xa}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ra({name:t.eContent||Xa})]})]})}}])}(Ya);Cd.CLASS_NAME="EncapsulatedContentInfo";var xd="mac",Ed="macSalt",Id="iterations",Bd=[xd,Ed,Id],Vd=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).mac=Le(r,xd,t.defaultValues(xd)),e.macSalt=Le(r,Ed,t.defaultValues(Ed)),Id in r&&(e.iterations=Le(r,Id,t.defaultValues(Id))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Bd);var r=sa(e,e,t.schema({names:{mac:{names:{blockName:xd}},macSalt:Ed,iterations:Id}}));za.assertSchema(r,this.className),this.mac=new bd({schema:r.result.mac}),this.macSalt=r.result.macSalt,Id in r.result&&(this.iterations=r.result.iterations.valueBlock.valueDec)}},{key:"toSchema",value:function(){var e=[this.mac.toSchema(),this.macSalt];return void 0!==this.iterations&&e.push(new Zt({value:this.iterations})),new cr({value:e})}},{key:"toJSON",value:function(){var e={mac:this.mac.toJSON(),macSalt:this.macSalt.toJSON()};return void 0!==this.iterations&&(e.iterations=this.iterations),e}}],[{key:"defaultValues",value:function(e){switch(e){case xd:return new bd;case Ed:return new _t;case Id:return 1;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case xd:return bd.compareWithDefault("digestAlgorithm",r.digestAlgorithm)&&bd.compareWithDefault("digest",r.digest);case Ed:return r.isEqual(t.defaultValues(e));case Id:return r===t.defaultValues(e);default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,optional:t.optional||!0,value:[bd.schema(t.mac||{names:{blockName:xd}}),new _t({name:t.macSalt||Ed}),new Zt({optional:!0,name:t.iterations||Id})]})}}])}(Ya);Vd.CLASS_NAME="MacData";var Dd="hashAlgorithm",Pd="hashedMessage",Od=[Dd,Pd],Rd=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).hashAlgorithm=Le(r,Dd,t.defaultValues(Dd)),e.hashedMessage=Le(r,Pd,t.defaultValues(Pd)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Od);var r=sa(e,e,t.schema({names:{hashAlgorithm:{names:{blockName:Dd}},hashedMessage:Pd}}));za.assertSchema(r,this.className),this.hashAlgorithm=new Nn({schema:r.result.hashAlgorithm}),this.hashedMessage=r.result.hashedMessage}},{key:"toSchema",value:function(){return new cr({value:[this.hashAlgorithm.toSchema(),this.hashedMessage]})}},{key:"toJSON",value:function(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),hashedMessage:this.hashedMessage.toJSON()}}}],[{key:"create",value:(r=a(k().mark((function e(r,a){var n,i,s,u,o=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>2&&void 0!==o[2]?o[2]:po(!0),i=n.getOIDByAlgorithm({name:r},!0,"hashAlgorithm"),e.next=4,n.digest(r,a);case 4:return s=e.sent,u=new t({hashAlgorithm:new Nn({algorithmId:i,algorithmParams:new Ut}),hashedMessage:new _t({valueHex:s})}),e.abrupt("return",u);case 7:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"defaultValues",value:function(e){switch(e){case Dd:return new Nn;case Pd:return new _t;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case Dd:return r.algorithmId===Xa&&"algorithmParams"in r==!1;case Pd:return 0===r.isEqual(t.defaultValues(e));default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[Nn.schema(t.hashAlgorithm||{}),new _t({name:t.hashedMessage||Xa})]})}}]);var r}(Ya);Rd.CLASS_NAME="MessageImprint";var Ud="reqCert",Ld="singleRequestExtensions",Td=[Ud,Ld],Hd=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).reqCert=Le(r,Ud,t.defaultValues(Ud)),Ld in r&&(e.singleRequestExtensions=Le(r,Ld,t.defaultValues(Ld))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Td);var r=sa(e,e,t.schema({names:{reqCert:{names:{blockName:Ud}},extensions:{names:{blockName:Ld}}}}));za.assertSchema(r,this.className),this.reqCert=new mv({schema:r.result.reqCert}),Ld in r.result&&(this.singleRequestExtensions=Array.from(r.result.singleRequestExtensions.valueBlock.value,(function(e){return new Qo({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(this.reqCert.toSchema()),this.singleRequestExtensions&&e.push(new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new cr({value:Array.from(this.singleRequestExtensions,(function(e){return e.toSchema()}))})]})),new cr({value:e})}},{key:"toJSON",value:function(){var e={reqCert:this.reqCert.toJSON()};return this.singleRequestExtensions&&(e.singleRequestExtensions=Array.from(this.singleRequestExtensions,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case Ud:return new mv;case Ld:return[];default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case Ud:return r.isEqual(t.defaultValues(e));case Ld:return 0===r.length;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[mv.schema(t.reqCert||{}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Qo.schema(t.extensions||{names:{blockName:t.singleRequestExtensions||Xa}})]})]})}}])}(Ya);Hd.CLASS_NAME="Request";var Md="tbs",Kd="version",_d="requestorName",jd="requestList",Jd="requestExtensions",Fd="TBSRequest",qd="".concat(Fd,".").concat(Kd),Xd="".concat(Fd,".").concat(_d),Gd="".concat(Fd,".requests"),Wd="".concat(Fd,".").concat(Jd),zd=[Fd,qd,Xd,Gd,Wd],Yd=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).tbsView=new Uint8Array(Le(r,Md,t.defaultValues(Md))),Kd in r&&(e.version=Le(r,Kd,t.defaultValues(Kd))),_d in r&&(e.requestorName=Le(r,_d,t.defaultValues(_d))),e.requestList=Le(r,jd,t.defaultValues(jd)),Jd in r&&(e.requestExtensions=Le(r,Jd,t.defaultValues(Jd))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"tbs",get:function(){return Ie.toArrayBuffer(this.tbsView)},set:function(e){this.tbsView=new Uint8Array(e)}},{key:"fromSchema",value:function(e){Ze(e,zd);var r=sa(e,e,t.schema());za.assertSchema(r,this.className),this.tbsView=r.result.TBSRequest.valueBeforeDecodeView,qd in r.result&&(this.version=r.result[qd].valueBlock.valueDec),Xd in r.result&&(this.requestorName=new cn({schema:r.result[Xd]})),this.requestList=Array.from(r.result[Gd],(function(e){return new Hd({schema:e})})),Wd in r.result&&(this.requestExtensions=Array.from(r.result[Wd].valueBlock.value,(function(e){return new Qo({schema:e})})))}},{key:"toSchema",value:function(){var e,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!1===r){if(0===this.tbsView.byteLength)return t.schema();var a=Et(this.tbsView);if(za.assert(a,"TBS Request"),!(a.result instanceof cr))throw new Error("ASN.1 result should be SEQUENCE");e=a.result}else{var n=[];void 0!==this.version&&n.push(new Vt({idBlock:{tagClass:3,tagNumber:0},value:[new Zt({value:this.version})]})),this.requestorName&&n.push(new Vt({idBlock:{tagClass:3,tagNumber:1},value:[this.requestorName.toSchema()]})),n.push(new cr({value:Array.from(this.requestList,(function(e){return e.toSchema()}))})),this.requestExtensions&&n.push(new Vt({idBlock:{tagClass:3,tagNumber:2},value:[new cr({value:Array.from(this.requestExtensions,(function(e){return e.toSchema()}))})]})),e=new cr({value:n})}return e}},{key:"toJSON",value:function(){var e={};return null!=this.version&&(e.version=this.version),this.requestorName&&(e.requestorName=this.requestorName.toJSON()),e.requestList=Array.from(this.requestList,(function(e){return e.toJSON()})),this.requestExtensions&&(e.requestExtensions=Array.from(this.requestExtensions,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case Md:return qa;case Kd:return 0;case _d:return new cn;case jd:case Jd:return[];default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case Md:return 0===r.byteLength;case Kd:return r===t.defaultValues(e);case _d:return r.type===cn.defaultValues("type")&&0===Object.keys(r.value).length;case jd:case Jd:return 0===r.length;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Fd,value:[new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Zt({name:t.TBSRequestVersion||qd})]}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[cn.schema(t.requestorName||{names:{blockName:Xd}})]}),new cr({name:t.requestList||"TBSRequest.requestList",value:[new na({name:t.requests||Gd,value:Hd.schema(t.requestNames||{})})]}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[el.schema(t.extensions||{names:{blockName:t.requestExtensions||Wd}})]})]})}}])}(Ya);Yd.CLASS_NAME="TBSRequest";var Qd="signatureAlgorithm",Zd="signature",$d="certs",eg=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).signatureAlgorithm=Le(r,Qd,t.defaultValues(Qd)),e.signature=Le(r,Zd,t.defaultValues(Zd)),$d in r&&(e.certs=Le(r,$d,t.defaultValues($d))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,[Qd,Zd,$d]);var r=sa(e,e,t.schema({names:{signatureAlgorithm:{names:{blockName:Qd}},signature:Zd,certs:$d}}));za.assertSchema(r,this.className),this.signatureAlgorithm=new Nn({schema:r.result.signatureAlgorithm}),this.signature=r.result.signature,$d in r.result&&(this.certs=Array.from(r.result.certs,(function(e){return new Kc({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new cr({value:Array.from(this.certs,(function(e){return e.toSchema()}))})]})),new cr({value:e})}},{key:"toJSON",value:function(){var e={signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case Qd:return new Nn;case Zd:return new qt;case $d:return[];default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case Qd:return r.algorithmId===Xa&&"algorithmParams"in r==!1;case Zd:return r.isEqual(t.defaultValues(e));case $d:return 0===r.length;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[Nn.schema(t.signatureAlgorithm||{}),new qt({name:t.signature||Xa}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new cr({value:[new na({name:t.certs||Xa,value:Kc.schema({})})]})]})]})}}])}(Ya);eg.CLASS_NAME="Signature";var tg="tbsRequest",rg="optionalSignature",ag=[tg,rg],ng=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).tbsRequest=Le(r,tg,t.defaultValues(tg)),rg in r&&(e.optionalSignature=Le(r,rg,t.defaultValues(rg))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,ag);var r=sa(e,e,t.schema());za.assertSchema(r,this.className),this.tbsRequest=new Yd({schema:r.result.tbsRequest}),rg in r.result&&(this.optionalSignature=new eg({schema:r.result.optionalSignature}))}},{key:"toSchema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=[];return t.push(this.tbsRequest.toSchema(e)),this.optionalSignature&&t.push(new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.optionalSignature.toSchema()]})),new cr({value:t})}},{key:"toJSON",value:function(){var e={tbsRequest:this.tbsRequest.toJSON()};return this.optionalSignature&&(e.optionalSignature=this.optionalSignature.toJSON()),e}},{key:"createForCertificate",value:(s=a(k().mark((function e(t,r){var a,n,i=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.length>2&&void 0!==i[2]?i[2]:po(!0),n=new mv,e.next=4,n.createForCertificate(t,r,a);case 4:this.tbsRequest.requestList.push(new Hd({reqCert:n}));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"sign",value:(r=a(k().mark((function e(t){var r,a,n,i,s,u,o=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>1&&void 0!==o[1]?o[1]:"SHA-1",a=o.length>2&&void 0!==o[2]?o[2]:po(!0),Wa.assertEmpty(t,"privateKey","OCSPRequest.sign method"),this.optionalSignature){e.next=5;break}throw new Error('Need to create "optionalSignature" field before signing');case 5:return e.next=7,a.getSignatureParameters(t,r);case 7:return n=e.sent,i=n.parameters,this.optionalSignature.signatureAlgorithm=n.signatureAlgorithm,s=this.tbsRequest.toSchema(!0).toBER(!1),e.next=13,a.signWithPrivateKey(s,t,i);case 13:u=e.sent,this.optionalSignature.signature=new qt({valueHex:u});case 15:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"verify",value:function(){}}],[{key:"defaultValues",value:function(e){switch(e){case tg:return new Yd;case rg:return new eg;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case tg:return Yd.compareWithDefault("tbs",r.tbs)&&Yd.compareWithDefault("version",r.version)&&Yd.compareWithDefault("requestorName",r.requestorName)&&Yd.compareWithDefault("requestList",r.requestList)&&Yd.compareWithDefault("requestExtensions",r.requestExtensions);case rg:return eg.compareWithDefault("signatureAlgorithm",r.signatureAlgorithm)&&eg.compareWithDefault("signature",r.signature)&&eg.compareWithDefault("certs",r.certs);default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||"OCSPRequest",value:[Yd.schema(t.tbsRequest||{names:{blockName:tg}}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[eg.schema(t.optionalSignature||{names:{blockName:rg}})]})]})}}]);var r,s}(Ya);ng.CLASS_NAME="OCSPRequest";var ig="responseType",sg="response",ug=[ig,sg],og=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).responseType=Le(r,ig,t.defaultValues(ig)),e.response=Le(r,sg,t.defaultValues(sg)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,ug);var r=sa(e,e,t.schema({names:{responseType:ig,response:sg}}));za.assertSchema(r,this.className),this.responseType=r.result.responseType.valueBlock.toString(),this.response=r.result.response}},{key:"toSchema",value:function(){return new cr({value:[new ar({value:this.responseType}),this.response]})}},{key:"toJSON",value:function(){return{responseType:this.responseType,response:this.response.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case ig:return Xa;case sg:return new _t;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case ig:return r===Xa;case sg:return r.isEqual(t.defaultValues(e));default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new ar({name:t.responseType||Xa}),new _t({name:t.response||Xa})]})}}])}(Ya);og.CLASS_NAME="ResponseBytes";var lg="responseStatus",cg="responseBytes",hg=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).responseStatus=Le(r,lg,t.defaultValues(lg)),cg in r&&(e.responseBytes=Le(r,cg,t.defaultValues(cg))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,[lg,cg]);var r=sa(e,e,t.schema());za.assertSchema(r,this.className),this.responseStatus=r.result.responseStatus,cg in r.result&&(this.responseBytes=new og({schema:r.result.responseBytes}))}},{key:"toSchema",value:function(){var e=[];return e.push(this.responseStatus),this.responseBytes&&e.push(new Vt({idBlock:{tagClass:3,tagNumber:0},value:[this.responseBytes.toSchema()]})),new cr({value:e})}},{key:"toJSON",value:function(){var e={responseStatus:this.responseStatus.toJSON()};return this.responseBytes&&(e.responseBytes=this.responseBytes.toJSON()),e}},{key:"getCertificateStatus",value:(u=a(k().mark((function e(t,r){var a,n,i,s,u=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=u.length>2&&void 0!==u[2]?u[2]:po(!0),i={isForCertificate:!1,status:2},this.responseBytes){e.next=4;break}return e.abrupt("return",i);case 4:if(this.responseBytes.responseType===hi){e.next=6;break}return e.abrupt("return",i);case 6:e.prev=6,s=Et(this.responseBytes.response.valueBlock.valueHexView),za.assert(s,"Basic OCSP response"),n=new rd({schema:s.result}),e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(6),e.abrupt("return",i);case 15:return e.abrupt("return",n.getCertificateStatus(t,r,a));case 16:case"end":return e.stop()}}),e,this,[[6,12]])}))),function(e,t){return u.apply(this,arguments)})},{key:"sign",value:(s=a(k().mark((function e(t,r){var a,n,i,s=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=s.length>2&&void 0!==s[2]?s[2]:po(!0),!this.responseBytes||this.responseBytes.responseType!==hi){e.next=4;break}return i=rd.fromBER(this.responseBytes.response.valueBlock.valueHexView),e.abrupt("return",i.sign(t,r,a));case 4:throw new Error("Unknown ResponseBytes type: ".concat((null===(n=this.responseBytes)||void 0===n?void 0:n.responseType)||"Unknown"));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"verify",value:(r=a(k().mark((function e(){var t,r,a,n,i=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:null,r=i.length>1&&void 0!==i[1]?i[1]:po(!0),cg in this!=0){e.next=4;break}throw new Error("Empty ResponseBytes field");case 4:if(!this.responseBytes||this.responseBytes.responseType!==hi){e.next=8;break}return n=rd.fromBER(this.responseBytes.response.valueBlock.valueHexView),null!==t&&(n.certs||(n.certs=[]),n.certs.push(t)),e.abrupt("return",n.verify({},r));case 8:throw new Error("Unknown ResponseBytes type: ".concat((null===(a=this.responseBytes)||void 0===a?void 0:a.responseType)||"Unknown"));case 9:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case lg:return new $t;case cg:return new og;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case lg:return r.isEqual(t.defaultValues(e));case cg:return og.compareWithDefault("responseType",r.responseType)&&og.compareWithDefault("response",r.response);default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||"OCSPResponse",value:[new $t({name:t.responseStatus||lg}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[og.schema(t.responseBytes||{names:{blockName:cg}})]})]})}}]);var r,s,u}(Ya);hg.CLASS_NAME="OCSPResponse";var fg="type",mg="attributes",vg="encodedValue",dg=[mg],gg=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).type=Le(r,fg,t.defaultValues(fg)),e.attributes=Le(r,mg,t.defaultValues(mg)),e.encodedValue=Le(r,vg,t.defaultValues(vg)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,dg);var r=sa(e,e,t.schema({names:{tagNumber:this.type,attributes:mg}}));if(za.assertSchema(r,this.className),this.type=r.result.idBlock.tagNumber,this.encodedValue=Ie.toArrayBuffer(r.result.valueBeforeDecodeView),new Uint8Array(this.encodedValue)[0]=49,mg in r.result!=!1)this.attributes=Array.from(r.result.attributes,(function(e){return new Dn({schema:e})}));else if(0===this.type)throw new Error("Wrong structure of SignedUnsignedAttributes")}},{key:"toSchema",value:function(){if(t.compareWithDefault(fg,this.type)||t.compareWithDefault(mg,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:this.type},value:Array.from(this.attributes,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){if(t.compareWithDefault(fg,this.type)||t.compareWithDefault(mg,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return{type:this.type,attributes:Array.from(this.attributes,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){switch(e){case fg:return-1;case mg:return[];case vg:return qa;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case fg:return r===t.defaultValues(fg);case mg:return 0===r.length;case vg:return 0===r.byteLength;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new Vt({name:t.blockName||Xa,optional:!0,idBlock:{tagClass:3,tagNumber:t.tagNumber||0},value:[new na({name:t.attributes||Xa,value:Dn.schema()})]})}}])}(Ya);gg.CLASS_NAME="SignedAndUnsignedAttributes";var pg="version",yg="sid",kg="digestAlgorithm",wg="signedAttrs",bg="signatureAlgorithm",Sg="signature",Ag="unsignedAttrs",Ng="SignerInfo",Cg="".concat(Ng,".").concat(pg),xg="".concat(Ng,".").concat(yg),Eg="".concat(Ng,".").concat(kg),Ig="".concat(Ng,".").concat(wg),Bg="".concat(Ng,".").concat(bg),Vg="".concat(Ng,".").concat(Sg),Dg="".concat(Ng,".").concat(Ag),Pg=[Cg,xg,Eg,Ig,Bg,Vg,Dg],Og=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).version=Le(r,pg,t.defaultValues(pg)),e.sid=Le(r,yg,t.defaultValues(yg)),e.digestAlgorithm=Le(r,kg,t.defaultValues(kg)),wg in r&&(e.signedAttrs=Le(r,wg,t.defaultValues(wg))),e.signatureAlgorithm=Le(r,bg,t.defaultValues(bg)),e.signature=Le(r,Sg,t.defaultValues(Sg)),Ag in r&&(e.unsignedAttrs=Le(r,Ag,t.defaultValues(Ag))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Pg);var r=sa(e,e,t.schema());za.assertSchema(r,this.className),this.version=r.result[Cg].valueBlock.valueDec;var a=r.result[xg];1===a.idBlock.tagClass?this.sid=new gf({schema:a}):this.sid=a,this.digestAlgorithm=new Nn({schema:r.result[Eg]}),Ig in r.result&&(this.signedAttrs=new gg({type:0,schema:r.result[Ig]})),this.signatureAlgorithm=new Nn({schema:r.result[Bg]}),this.signature=r.result[Vg],Dg in r.result&&(this.unsignedAttrs=new gg({type:1,schema:r.result[Dg]}))}},{key:"toSchema",value:function(){if(t.compareWithDefault(yg,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');var e=[];return e.push(new Zt({value:this.version})),this.sid instanceof gf?e.push(this.sid.toSchema()):e.push(this.sid),e.push(this.digestAlgorithm.toSchema()),this.signedAttrs&&!1===t.compareWithDefault(wg,this.signedAttrs)&&e.push(this.signedAttrs.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.unsignedAttrs&&!1===t.compareWithDefault(Ag,this.unsignedAttrs)&&e.push(this.unsignedAttrs.toSchema()),new cr({value:e})}},{key:"toJSON",value:function(){if(t.compareWithDefault(yg,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');var e={version:this.version,digestAlgorithm:this.digestAlgorithm.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.sid instanceof ra||(e.sid=this.sid.toJSON()),this.signedAttrs&&!1===t.compareWithDefault(wg,this.signedAttrs)&&(e.signedAttrs=this.signedAttrs.toJSON()),this.unsignedAttrs&&!1===t.compareWithDefault(Ag,this.unsignedAttrs)&&(e.unsignedAttrs=this.unsignedAttrs.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case pg:return 0;case yg:return new ra;case kg:return new Nn;case wg:return new gg({type:0});case bg:return new Nn;case Sg:return new _t;case Ag:return new gg({type:1});default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case pg:return t.defaultValues(pg)===r;case yg:return r instanceof ra;case kg:return r instanceof Nn!=!1&&r.isEqual(t.defaultValues(kg));case wg:return gg.compareWithDefault("type",r.type)&&gg.compareWithDefault("attributes",r.attributes)&&gg.compareWithDefault("encodedValue",r.encodedValue);case bg:return r instanceof Nn!=!1&&r.isEqual(t.defaultValues(bg));case Sg:case Ag:return gg.compareWithDefault("type",r.type)&&gg.compareWithDefault("attributes",r.attributes)&&gg.compareWithDefault("encodedValue",r.encodedValue);default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:Ng,value:[new Zt({name:t.version||Cg}),new aa({value:[gf.schema(t.sidSchema||{names:{blockName:xg}}),new aa({value:[new Vt({optional:!0,name:t.sid||xg,idBlock:{tagClass:3,tagNumber:0},value:[new _t]}),new Nt({optional:!0,name:t.sid||xg,idBlock:{tagClass:3,tagNumber:0}})]})]}),Nn.schema(t.digestAlgorithm||{names:{blockName:Eg}}),gg.schema(t.signedAttrs||{names:{blockName:Ig,tagNumber:0}}),Nn.schema(t.signatureAlgorithm||{names:{blockName:Bg}}),new _t({name:t.signature||Vg}),gg.schema(t.unsignedAttrs||{names:{blockName:Dg,tagNumber:1}})]})}}])}(Ya);Og.CLASS_NAME="SignerInfo";var Rg="version",Ug="policy",Lg="messageImprint",Tg="serialNumber",Hg="genTime",Mg="ordering",Kg="nonce",_g="accuracy",jg="tsa",Jg="extensions",Fg="TSTInfo",qg="".concat(Fg,".").concat(Rg),Xg="".concat(Fg,".").concat(Ug),Gg="".concat(Fg,".").concat(Lg),Wg="".concat(Fg,".").concat(Tg),zg="".concat(Fg,".").concat(Hg),Yg="".concat(Fg,".").concat(_g),Qg="".concat(Fg,".").concat(Mg),Zg="".concat(Fg,".").concat(Kg),$g="".concat(Fg,".").concat(jg),ep="".concat(Fg,".").concat(Jg),tp=[qg,Xg,Gg,Wg,zg,Yg,Qg,Zg,$g,ep],rp=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).version=Le(r,Rg,t.defaultValues(Rg)),e.policy=Le(r,Ug,t.defaultValues(Ug)),e.messageImprint=Le(r,Lg,t.defaultValues(Lg)),e.serialNumber=Le(r,Tg,t.defaultValues(Tg)),e.genTime=Le(r,Hg,t.defaultValues(Hg)),_g in r&&(e.accuracy=Le(r,_g,t.defaultValues(_g))),Mg in r&&(e.ordering=Le(r,Mg,t.defaultValues(Mg))),Kg in r&&(e.nonce=Le(r,Kg,t.defaultValues(Kg))),jg in r&&(e.tsa=Le(r,jg,t.defaultValues(jg))),Jg in r&&(e.extensions=Le(r,Jg,t.defaultValues(Jg))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,tp);var r=sa(e,e,t.schema());za.assertSchema(r,this.className),this.version=r.result[qg].valueBlock.valueDec,this.policy=r.result[Xg].valueBlock.toString(),this.messageImprint=new Rd({schema:r.result[Gg]}),this.serialNumber=r.result[Wg],this.genTime=r.result[zg].toDate(),Yg in r.result&&(this.accuracy=new yn({schema:r.result[Yg]})),Qg in r.result&&(this.ordering=r.result[Qg].valueBlock.value),Zg in r.result&&(this.nonce=r.result[Zg]),$g in r.result&&(this.tsa=new cn({schema:r.result[$g]})),ep in r.result&&(this.extensions=Array.from(r.result[ep],(function(e){return new Qo({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(new Zt({value:this.version})),e.push(new ar({value:this.policy})),e.push(this.messageImprint.toSchema()),e.push(this.serialNumber),e.push(new Xr({valueDate:this.genTime})),this.accuracy&&e.push(this.accuracy.toSchema()),void 0!==this.ordering&&e.push(new Ht({value:this.ordering})),this.nonce&&e.push(this.nonce),this.tsa&&e.push(new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.tsa.toSchema()]})),this.extensions&&e.push(new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.extensions,(function(e){return e.toSchema()}))})),new cr({value:e})}},{key:"toJSON",value:function(){var e={version:this.version,policy:this.policy,messageImprint:this.messageImprint.toJSON(),serialNumber:this.serialNumber.toJSON(),genTime:this.genTime};return this.accuracy&&(e.accuracy=this.accuracy.toJSON()),void 0!==this.ordering&&(e.ordering=this.ordering),this.nonce&&(e.nonce=this.nonce.toJSON()),this.tsa&&(e.tsa=this.tsa.toJSON()),this.extensions&&(e.extensions=Array.from(this.extensions,(function(e){return e.toJSON()}))),e}},{key:"verify",value:(r=a(k().mark((function e(t){var r,a,n,i,s=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=s.length>1&&void 0!==s[1]?s[1]:po(!0),t.data){e.next=3;break}throw new Error('"data" is a mandatory attribute for TST_INFO verification');case 3:if(a=t.data,!t.notBefore){e.next=7;break}if(!(this.genTime<t.notBefore)){e.next=7;break}throw new Error("Generation time for TSTInfo object is less than notBefore value");case 7:if(!t.notAfter){e.next=10;break}if(!(this.genTime>t.notAfter)){e.next=10;break}throw new Error("Generation time for TSTInfo object is more than notAfter value");case 10:return n=r.getAlgorithmByOID(this.messageImprint.hashAlgorithm.algorithmId,!0,"MessageImprint.hashAlgorithm"),e.next=13,r.digest(n.name,new Uint8Array(a));case 13:return i=e.sent,e.abrupt("return",Ie.isEqual(i,this.messageImprint.hashedMessage.valueBlock.valueHexView));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case Rg:return 0;case Ug:return Xa;case Lg:return new Rd;case Tg:return new Zt;case Hg:return new Date(0,0,0);case _g:return new yn;case Mg:return!1;case Kg:return new Zt;case jg:return new cn;case Jg:return[];default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case Rg:case Ug:case Hg:case Mg:return r===t.defaultValues(Mg);case Lg:return Rd.compareWithDefault(Dd,r.hashAlgorithm)&&Rd.compareWithDefault(Pd,r.hashedMessage);case Tg:case Kg:return r.isEqual(t.defaultValues(Kg));case _g:return yn.compareWithDefault(dn,r.seconds)&&yn.compareWithDefault(gn,r.millis)&&yn.compareWithDefault(pn,r.micros);case jg:return cn.compareWithDefault(nn,r.type)&&cn.compareWithDefault(sn,r.value);case Jg:return 0===r.length;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Fg,value:[new Zt({name:t.version||qg}),new ar({name:t.policy||Xg}),Rd.schema(t.messageImprint||{names:{blockName:Gg}}),new Zt({name:t.serialNumber||Wg}),new Xr({name:t.genTime||zg}),yn.schema(t.accuracy||{names:{blockName:Yg}}),new Ht({name:t.ordering||Qg,optional:!0}),new Zt({name:t.nonce||Zg,optional:!0}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[cn.schema(t.tsa||{names:{blockName:$g}})]}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new na({name:t.extensions||ep,value:Qo.schema(t.extension||{})})]})]})}}]);var r}(Ya);rp.CLASS_NAME="TSTInfo";var ap="version",np="digestAlgorithms",ip="encapContentInfo",sp="certificates",up="crls",op="signerInfos",lp="ocsps",cp="SignedData",hp="".concat(cp,".").concat(ap),fp="".concat(cp,".").concat(np),mp="".concat(cp,".").concat(ip),vp="".concat(cp,".").concat(sp),dp="".concat(cp,".").concat(up),gp="".concat(cp,".").concat(op),pp=[hp,fp,mp,vp,dp,gp],yp=function(e){function t(e){var r,a=e.message,s=e.code,u=void 0===s?0:s,o=e.date,l=void 0===o?new Date:o,c=e.signatureVerified,h=void 0===c?null:c,f=e.signerCertificate,m=void 0===f?null:f,v=e.signerCertificateVerified,d=void 0===v?null:v,g=e.timestampSerial,p=void 0===g?null:g,y=e.certificatePath,k=void 0===y?[]:y;return i(this,t),(r=n(this,t,[a])).name="SignedDataVerifyError",r.date=l,r.code=u,r.timestampSerial=p,r.signatureVerified=h,r.signerCertificate=m,r.signerCertificateVerified=d,r.certificatePath=k,r}return m(t,e),o(t)}(I(Error)),kp=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).version=Le(r,ap,t.defaultValues(ap)),e.digestAlgorithms=Le(r,np,t.defaultValues(np)),e.encapContentInfo=Le(r,ip,t.defaultValues(ip)),sp in r&&(e.certificates=Le(r,sp,t.defaultValues(sp))),up in r&&(e.crls=Le(r,up,t.defaultValues(up))),lp in r&&(e.ocsps=Le(r,lp,t.defaultValues(lp))),e.signerInfos=Le(r,op,t.defaultValues(op)),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,pp);var r=sa(e,e,t.schema());if(za.assertSchema(r,this.className),this.version=r.result[hp].valueBlock.valueDec,fp in r.result&&(this.digestAlgorithms=Array.from(r.result[fp],(function(e){return new Nn({schema:e})}))),this.encapContentInfo=new Cd({schema:r.result[mp]}),vp in r.result){var a=new $h({schema:new hr({value:r.result[vp].valueBlock.value})});this.certificates=a.certificates.slice(0)}dp in r.result&&(this.crls=Array.from(r.result[dp],(function(e){return 1===e.idBlock.tagClass?new kh({schema:e}):(e.idBlock.tagClass=1,e.idBlock.tagNumber=16,new af({schema:e}))}))),gp in r.result&&(this.signerInfos=Array.from(r.result[gp],(function(e){return new Og({schema:e})})))}},{key:"toSchema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=[];if(this.certificates&&this.certificates.length&&this.certificates.some((function(e){return e instanceof Yh}))||this.crls&&this.crls.length&&this.crls.some((function(e){return e instanceof af}))?this.version=5:this.certificates&&this.certificates.length&&this.certificates.some((function(e){return e instanceof ec}))?this.version=4:this.certificates&&this.certificates.length&&this.certificates.some((function(e){return e instanceof Sl}))||this.signerInfos.some((function(e){return 3===e.version}))||this.encapContentInfo.eContentType!==t.ID_DATA?this.version=3:this.version=1,r.push(new Zt({value:this.version})),r.push(new hr({value:Array.from(this.digestAlgorithms,(function(e){return e.toSchema()}))})),r.push(this.encapContentInfo.toSchema()),this.certificates){var a=new $h({certificates:this.certificates}),n=a.toSchema();r.push(new Vt({idBlock:{tagClass:3,tagNumber:0},value:n.valueBlock.value}))}return this.crls&&r.push(new Vt({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.crls,(function(t){if(t instanceof af){var r=t.toSchema();return r.idBlock.tagClass=3,r.idBlock.tagNumber=1,r}return t.toSchema(e)}))})),r.push(new hr({value:Array.from(this.signerInfos,(function(e){return e.toSchema()}))})),new cr({value:r})}},{key:"toJSON",value:function(){var e={version:this.version,digestAlgorithms:Array.from(this.digestAlgorithms,(function(e){return e.toJSON()})),encapContentInfo:this.encapContentInfo.toJSON(),signerInfos:Array.from(this.signerInfos,(function(e){return e.toJSON()}))};return this.certificates&&(e.certificates=Array.from(this.certificates,(function(e){return e.toJSON()}))),this.crls&&(e.crls=Array.from(this.crls,(function(e){return e.toJSON()}))),e}},{key:"verify",value:(s=a(k().mark((function e(){var t,r,a,n,i,s,u,o,c,h,f,m,v,d,g,p,y,w,b,S,A,C,x,E,I,B,V,D,P,O,R,U,L,T,H,M,K,_,j,J,F,q,X,G,W,z,Y,Q,Z,$,ee,te=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=te.length>0&&void 0!==te[0]?te[0]:{},r=t.signer,a=void 0===r?-1:r,n=t.data,i=void 0===n?qa:n,s=t.trustedCerts,u=void 0===s?[]:s,o=t.checkDate,c=void 0===o?new Date:o,h=t.checkChain,f=void 0!==h&&h,m=t.passedWhenNotRevValues,v=void 0!==m&&m,d=t.extendedMode,g=void 0!==d&&d,p=t.findOrigin,y=void 0===p?null:p,w=t.findIssuer,b=void 0===w?null:w,S=te.length>1&&void 0!==te[1]?te[1]:po(!0),A=null,C=null,e.prev=4,x=qa,E=Xa,I=[],B=this.signerInfos[a]){e.next=11;break}throw new yp({date:c,code:1,message:"Unable to get signer by supplied index"});case 11:if(this.certificates){e.next=13;break}throw new yp({date:c,code:2,message:"No certificates attached to this signed data"});case 13:if(!(B.sid instanceof gf)){e.next=36;break}V=l(this.certificates),e.prev=15,V.s();case 17:if((D=V.n()).done){e.next=26;break}if((P=D.value)instanceof Kc){e.next=21;break}return e.abrupt("continue",24);case 21:if(!P.issuer.isEqual(B.sid.issuer)||!P.serialNumber.isEqual(B.sid.serialNumber)){e.next=24;break}return A=P,e.abrupt("break",26);case 24:e.next=17;break;case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(15),V.e(e.t0);case 31:return e.prev=31,V.f(),e.finish(31);case 34:e.next=61;break;case 36:O=B.sid,R=O.idBlock.isConstructed?O.valueBlock.value[0].valueBlock.valueHex:O.valueBlock.valueHex,U=l(this.certificates),e.prev=39,U.s();case 41:if((L=U.n()).done){e.next=53;break}if((T=L.value)instanceof Kc){e.next=45;break}return e.abrupt("continue",51);case 45:return e.next=47,S.digest({name:"sha-1"},T.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);case 47:if(!Je(e.sent,R)){e.next=51;break}return A=T,e.abrupt("break",53);case 51:e.next=41;break;case 53:e.next=58;break;case 55:e.prev=55,e.t1=e.catch(39),U.e(e.t1);case 58:return e.prev=58,U.f(),e.finish(58);case 61:if(A){e.next=63;break}throw new yp({date:c,code:3,message:"Unable to find signer certificate"});case 63:if(this.encapContentInfo.eContentType!==si){e.next=81;break}if(this.encapContentInfo.eContent){e.next=66;break}throw new yp({date:c,code:15,message:"Error during verification: TSTInfo eContent is empty",signatureVerified:null,signerCertificate:A,timestampSerial:C,signerCertificateVerified:!0});case 66:e.prev=66,H=rp.fromBER(this.encapContentInfo.eContent.valueBlock.valueHexView),e.next=73;break;case 70:throw e.prev=70,e.t2=e.catch(66),new yp({date:c,code:15,message:"Error during verification: TSTInfo wrong ASN.1 schema ",signatureVerified:null,signerCertificate:A,timestampSerial:C,signerCertificateVerified:!0});case 73:if(c=H.genTime,C=H.serialNumber.valueBlock.valueHexView.slice(),0!==i.byteLength){e.next=77;break}throw new yp({date:c,code:4,message:"Missed detached data input array"});case 77:return e.next=79,H.verify({data:i},S);case 79:if(e.sent){e.next=81;break}throw new yp({date:c,code:15,message:"Error during verification: TSTInfo verification is failed",signatureVerified:!1,signerCertificate:A,timestampSerial:C,signerCertificateVerified:!0});case 81:if(!f){e.next=96;break}if(M=this.certificates.filter((function(e){return e instanceof Kc&&!!_c(e,A)})),K={checkDate:c,certs:M,trustedCerts:u},b&&(K.findIssuer=b),y&&(K.findOrigin=y),(_=new qv(K)).certs.push(A),this.crls){j=l(this.crls);try{for(j.s();!(J=j.n()).done;)"thisUpdate"in(F=J.value)?_.crls.push(F):F.otherRevInfoFormat===hi&&_.ocsps.push(new rd({schema:F.otherRevInfo}))}catch(e){j.e(e)}finally{j.f()}}return this.ocsps&&(q=_.ocsps).push.apply(q,N(this.ocsps)),e.next=92,_.verify({passedWhenNotRevValues:v},S).catch((function(e){throw new yp({date:c,code:5,message:"Validation of signer's certificate failed with error: ".concat(e instanceof Object?e.resultMessage:e),signerCertificate:A,signerCertificateVerified:!1})}));case 92:if((X=e.sent).certificatePath&&(I=X.certificatePath),X.result){e.next=96;break}throw new yp({date:c,code:5,message:"Validation of signer's certificate failed: ".concat(X.resultMessage),signerCertificate:A,signerCertificateVerified:!1});case 96:if("name"in(G=S.getAlgorithmByOID(B.digestAlgorithm.algorithmId))){e.next=99;break}throw new yp({date:c,code:7,message:"Unsupported signature algorithm: ".concat(B.digestAlgorithm.algorithmId),signerCertificate:A,signerCertificateVerified:!0});case 99:if(E=G.name,!(W=this.encapContentInfo.eContent)){e.next=105;break}i=1===W.idBlock.tagClass&&4===W.idBlock.tagNumber?W.getValue():W.valueBlock.valueBeforeDecodeView,e.next=107;break;case 105:if(0!==i.byteLength){e.next=107;break}throw new yp({date:c,code:8,message:"Missed detached data input array",signerCertificate:A,signerCertificateVerified:!0});case 107:if(!B.signedAttrs){e.next=133;break}z=!1,Y=!1,Q=l(B.signedAttrs.attributes),e.prev=111,Q.s();case 113:if((Z=Q.n()).done){e.next=121;break}if("1.2.840.113549.1.9.3"===($=Z.value).type&&(z=!0),"1.2.840.113549.1.9.4"===$.type&&(Y=!0,x=$.values[0].valueBlock.valueHex),!z||!Y){e.next=119;break}return e.abrupt("break",121);case 119:e.next=113;break;case 121:e.next=126;break;case 123:e.prev=123,e.t3=e.catch(111),Q.e(e.t3);case 126:return e.prev=126,Q.f(),e.finish(126);case 129:if(!1!==z){e.next=131;break}throw new yp({date:c,code:9,message:'Attribute "content-type" is a mandatory attribute for "signed attributes"',signerCertificate:A,signerCertificateVerified:!0});case 131:if(!1!==Y){e.next=133;break}throw new yp({date:c,code:10,message:'Attribute "message-digest" is a mandatory attribute for "signed attributes"',signatureVerified:null,signerCertificate:A,signerCertificateVerified:!0});case 133:if(!B.signedAttrs){e.next=140;break}return e.next=136,S.digest(E,new Uint8Array(i));case 136:if(Je(e.sent,x)){e.next=139;break}throw new yp({date:c,code:15,message:"Error during verification: Message digest doesn't match",signatureVerified:null,signerCertificate:A,timestampSerial:C,signerCertificateVerified:!0});case 139:i=B.signedAttrs.encodedValue;case 140:if("1.2.840.113549.1.1.1"!==B.signatureAlgorithm.algorithmId){e.next=146;break}return e.next=143,S.verifyWithPublicKey(i,B.signature,A.subjectPublicKeyInfo,B.signatureAlgorithm,E);case 143:e.t4=e.sent,e.next=149;break;case 146:return e.next=148,S.verifyWithPublicKey(i,B.signature,A.subjectPublicKeyInfo,B.signatureAlgorithm);case 148:e.t4=e.sent;case 149:if(ee=e.t4,!g){e.next=154;break}return e.abrupt("return",{date:c,code:14,message:Xa,signatureVerified:ee,signerCertificate:A,timestampSerial:C,signerCertificateVerified:!0,certificatePath:I});case 154:return e.abrupt("return",ee);case 155:e.next=162;break;case 157:if(e.prev=157,e.t5=e.catch(4),!(e.t5 instanceof yp)){e.next=161;break}throw e.t5;case 161:throw new yp({date:c,code:15,message:"Error during verification: ".concat(e.t5 instanceof Error?e.t5.message:e.t5),signatureVerified:null,signerCertificate:A,timestampSerial:C,signerCertificateVerified:!0});case 162:case"end":return e.stop()}}),e,this,[[4,157],[15,28,31,34],[39,55,58,61],[66,70],[111,123,126,129]])}))),function(){return s.apply(this,arguments)})},{key:"sign",value:(r=a(k().mark((function e(t,r){var a,n,i,s,u,o,l,c,h,f,m=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=m.length>2&&void 0!==m[2]?m[2]:"SHA-1",n=m.length>3&&void 0!==m[3]?m[3]:qa,i=m.length>4&&void 0!==m[4]?m[4]:po(!0),t){e.next=5;break}throw new Error("Need to provide a private key for signing");case 5:if(u=this.signerInfos[r]){e.next=8;break}throw new RangeError("SignerInfo index is out of range");case 8:return!(null===(s=u.signedAttrs)||void 0===s?void 0:s.attributes.length)&&"hash"in t.algorithm&&"hash"in t.algorithm&&t.algorithm.hash&&(a=t.algorithm.hash.name),o=i.getOIDByAlgorithm({name:a},!0,"hashAlgorithm"),0===this.digestAlgorithms.filter((function(e){return e.algorithmId===o})).length&&this.digestAlgorithms.push(new Nn({algorithmId:o,algorithmParams:new Ut})),u.digestAlgorithm=new Nn({algorithmId:o,algorithmParams:new Ut}),e.next=14,i.getSignatureParameters(t,a);case 14:if(l=e.sent,c=l.parameters,u.signatureAlgorithm=l.signatureAlgorithm,!u.signedAttrs){e.next=21;break}0!==u.signedAttrs.encodedValue.byteLength?n=u.signedAttrs.encodedValue:(n=u.signedAttrs.toSchema().toBER(),Ie.toUint8Array(n)[0]=49),e.next=28;break;case 21:if(!(h=this.encapContentInfo.eContent)){e.next=26;break}n=1===h.idBlock.tagClass&&4===h.idBlock.tagNumber?h.getValue():h.valueBlock.valueBeforeDecodeView,e.next=28;break;case 26:if(0!==n.byteLength){e.next=28;break}throw new Error("Missed detached data input array");case 28:return e.next=30,i.signWithPrivateKey(n,t,c);case 30:f=e.sent,u.signature=new _t({valueHex:f});case 32:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case ap:return 0;case np:return[];case ip:return new Cd;case sp:case up:case lp:case op:return[];default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case ap:return r===t.defaultValues(ap);case ip:return Cd.compareWithDefault("eContentType",r.eContentType)&&Cd.compareWithDefault("eContent",r.eContent);case np:case sp:case up:case lp:case op:return 0===r.length;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return void 0===t.optional&&(t.optional=!1),new cr({name:t.blockName||cp,optional:t.optional,value:[new Zt({name:t.version||hp}),new hr({value:[new na({name:t.digestAlgorithms||fp,value:Nn.schema()})]}),Cd.schema(t.encapContentInfo||{names:{blockName:mp}}),new Vt({name:t.certificates||vp,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:$h.schema().valueBlock.value}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:of.schema(t.crls||{names:{crls:dp}}).valueBlock.value}),new hr({value:[new na({name:t.signerInfos||gp,value:Og.schema()})]})]})}}]);var r,s}(Ya);kp.CLASS_NAME="SignedData",kp.ID_DATA=ri;var wp="version",bp="authSafe",Sp="macData",Ap="parsedValue",Np=[wp,bp,Sp],Cp=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).version=Le(r,wp,t.defaultValues(wp)),e.authSafe=Le(r,bp,t.defaultValues(bp)),Sp in r&&(e.macData=Le(r,Sp,t.defaultValues(Sp))),Ap in r&&(e.parsedValue=Le(r,Ap,t.defaultValues(Ap))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Np);var r=sa(e,e,t.schema({names:{version:wp,authSafe:{names:{blockName:bp}},macData:{names:{blockName:Sp}}}}));za.assertSchema(r,this.className),this.version=r.result.version.valueBlock.valueDec,this.authSafe=new nc({schema:r.result.authSafe}),Sp in r.result&&(this.macData=new Vd({schema:r.result.macData}))}},{key:"toSchema",value:function(){var e=[new Zt({value:this.version}),this.authSafe.toSchema()];return this.macData&&e.push(this.macData.toSchema()),new cr({value:e})}},{key:"toJSON",value:function(){var e={version:this.version,authSafe:this.authSafe.toJSON()};return this.macData&&(e.macData=this.macData.toJSON()),e}},{key:"makeInternalValues",value:(s=a(k().mark((function e(){var t,r,a,n,i,s,u,o,l,c,h=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=h.length>0&&void 0!==h[0]?h[0]:{},r=h.length>1&&void 0!==h[1]?h[1]:po(!0),Ga.assert(t,"parameters","object"),this.parsedValue){e.next=5;break}throw new Error('Please call "parseValues" function first in order to make "parsedValue" data');case 5:Wa.assertEmpty(this.parsedValue.integrityMode,"integrityMode","parsedValue"),Wa.assertEmpty(this.parsedValue.authenticatedSafe,"authenticatedSafe","parsedValue"),e.t0=this.parsedValue.integrityMode,e.next=0===e.t0?10:1===e.t0?25:43;break;case 10:if("iterations"in t){e.next=12;break}throw new Wa("iterations");case 12:return Wa.assertEmpty(t.pbkdf2HashAlgorithm,"pbkdf2HashAlgorithm"),Wa.assertEmpty(t.hmacHashAlgorithm,"hmacHashAlgorithm"),Wa.assertEmpty(t.password,"password"),a=new ArrayBuffer(64),n=new Uint8Array(a),r.getRandomValues(n),i=this.parsedValue.authenticatedSafe.toSchema().toBER(!1),this.authSafe=new nc({contentType:nc.DATA,content:new _t({valueHex:i})}),e.next=22,r.stampDataWithPassword({password:t.password,hashAlgorithm:t.hmacHashAlgorithm,salt:a,iterationCount:t.iterations,contentToStamp:i});case 22:return s=e.sent,this.macData=new Vd({mac:new bd({digestAlgorithm:new Nn({algorithmId:r.getOIDByAlgorithm({name:t.hmacHashAlgorithm},!0,"hmacHashAlgorithm")}),digest:new _t({valueHex:s})}),macSalt:new _t({valueHex:a}),iterations:t.iterations}),e.abrupt("break",44);case 25:if("signingCertificate"in t){e.next=27;break}throw new Wa("signingCertificate");case 27:return Wa.assertEmpty(t.privateKey,"privateKey"),Wa.assertEmpty(t.hashAlgorithm,"hashAlgorithm"),u=this.parsedValue.authenticatedSafe.toSchema().toBER(!1),o=new kp({version:1,encapContentInfo:new Cd({eContentType:"1.2.840.113549.1.7.1",eContent:new _t({valueHex:u})}),certificates:[t.signingCertificate]}),e.next=33,r.digest({name:t.hashAlgorithm},new Uint8Array(u));case 33:return l=e.sent,(c=[]).push(new Dn({type:"1.2.840.113549.1.9.3",values:[new ar({value:"1.2.840.113549.1.7.1"})]})),c.push(new Dn({type:"1.2.840.113549.1.9.5",values:[new Fr({valueDate:new Date})]})),c.push(new Dn({type:"1.2.840.113549.1.9.4",values:[new _t({valueHex:l})]})),o.signerInfos.push(new Og({version:1,sid:new gf({issuer:t.signingCertificate.issuer,serialNumber:t.signingCertificate.serialNumber}),signedAttrs:new gg({type:0,attributes:c})})),e.next=41,o.sign(t.privateKey,0,t.hashAlgorithm,void 0,r);case 41:return this.authSafe=new nc({contentType:"1.2.840.113549.1.7.2",content:o.toSchema(!0)}),e.abrupt("break",44);case 43:throw new Error('Parameter "integrityMode" has unknown value: '.concat(this.parsedValue.integrityMode));case 44:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"parseInternalValues",value:(r=a(k().mark((function e(t){var r,a,n,i,s,u,o=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=o.length>1&&void 0!==o[1]?o[1]:po(!0),Ga.assert(t,"parameters","object"),void 0===t.checkIntegrity&&(t.checkIntegrity=!0),this.parsedValue={},e.t0=this.authSafe.contentType,e.next=e.t0===nc.DATA?7:e.t0===nc.SIGNED_DATA?22:35;break;case 7:if(Wa.assertEmpty(t.password,"password"),this.parsedValue.integrityMode=0,Ga.assert(this.authSafe.content,"authSafe.content",_t),a=this.authSafe.content.getValue(),this.parsedValue.authenticatedSafe=uv.fromBER(a),!t.checkIntegrity){e.next=21;break}if(this.macData){e.next=15;break}throw new Error('Absent "macData" value, can not check PKCS#12 data integrity');case 15:return n=r.getAlgorithmByOID(this.macData.mac.digestAlgorithm.algorithmId,!0,"digestAlgorithm"),e.next=18,r.verifyDataStampedWithPassword({password:t.password,hashAlgorithm:n.name,salt:Ie.toArrayBuffer(this.macData.macSalt.valueBlock.valueHexView),iterationCount:this.macData.iterations||1,contentToVerify:a,signatureToVerify:Ie.toArrayBuffer(this.macData.mac.digest.valueBlock.valueHexView)});case 18:if(e.sent){e.next=21;break}throw new Error("Integrity for the PKCS#12 data is broken!");case 21:case 34:return e.abrupt("break",36);case 22:return this.parsedValue.integrityMode=1,i=new kp({schema:this.authSafe.content}),s=i.encapContentInfo.eContent,Wa.assert(s,"eContent","cmsSigned.encapContentInfo"),Ga.assert(s,"eContent",_t),u=s.getValue(),this.parsedValue.authenticatedSafe=uv.fromBER(u),e.next=31,i.verify({signer:0,checkChain:!1},r);case 31:if(e.sent){e.next=34;break}throw new Error("Integrity for the PKCS#12 data is broken!");case 35:throw new Error('Incorrect value for "this.authSafe.contentType": '.concat(this.authSafe.contentType));case 36:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case wp:return 3;case bp:return new nc;case Sp:return new Vd;case Ap:return{};default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case wp:return r===t.defaultValues(e);case bp:return nc.compareWithDefault("contentType",r.contentType)&&nc.compareWithDefault("content",r.content);case Sp:return Vd.compareWithDefault("mac",r.mac)&&Vd.compareWithDefault("macSalt",r.macSalt)&&Vd.compareWithDefault("iterations",r.iterations);case Ap:return r instanceof Object&&0===Object.keys(r).length;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Zt({name:t.version||wp}),nc.schema(t.authSafe||{names:{blockName:bp}}),Vd.schema(t.macData||{names:{blockName:Sp,optional:!0}})]})}}]);var r,s}(Ya);Cp.CLASS_NAME="PFX";var xp,Ep="status",Ip="statusStrings",Bp="failInfo",Vp=[Ep,Ip,Bp];!function(e){e[e.granted=0]="granted",e[e.grantedWithMods=1]="grantedWithMods",e[e.rejection=2]="rejection",e[e.waiting=3]="waiting",e[e.revocationWarning=4]="revocationWarning",e[e.revocationNotification=5]="revocationNotification"}(xp||(xp={}));var Dp=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).status=Le(r,Ep,t.defaultValues(Ep)),Ip in r&&(e.statusStrings=Le(r,Ip,t.defaultValues(Ip))),Bp in r&&(e.failInfo=Le(r,Bp,t.defaultValues(Bp))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Vp);var r=sa(e,e,t.schema({names:{status:Ep,statusStrings:Ip,failInfo:Bp}}));za.assertSchema(r,this.className);var a=r.result.status;if(!0===a.valueBlock.isHexOnly||a.valueBlock.valueDec<0||a.valueBlock.valueDec>5)throw new Error('PKIStatusInfo "status" has invalid value');this.status=a.valueBlock.valueDec,Ip in r.result&&(this.statusStrings=r.result.statusStrings),Bp in r.result&&(this.failInfo=r.result.failInfo)}},{key:"toSchema",value:function(){var e=[];return e.push(new Zt({value:this.status})),this.statusStrings&&e.push(new cr({optional:!0,value:this.statusStrings})),this.failInfo&&e.push(this.failInfo),new cr({value:e})}},{key:"toJSON",value:function(){var e={status:this.status};return this.statusStrings&&(e.statusStrings=Array.from(this.statusStrings,(function(e){return e.toJSON()}))),this.failInfo&&(e.failInfo=this.failInfo.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Ep:return 2;case Ip:return[];case Bp:return new qt;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case Ep:return r===t.defaultValues(e);case Ip:return 0===r.length;case Bp:return r.isEqual(t.defaultValues(e));default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Xa,value:[new Zt({name:t.status||Xa}),new cr({optional:!0,value:[new na({name:t.statusStrings||Xa,value:new pr})]}),new qt({name:t.failInfo||Xa,optional:!0})]})}}])}(Ya);Dp.CLASS_NAME="PKIStatusInfo";var Pp="version",Op="messageImprint",Rp="reqPolicy",Up="nonce",Lp="certReq",Tp="extensions",Hp="TimeStampReq",Mp="".concat(Hp,".").concat(Pp),Kp="".concat(Hp,".").concat(Op),_p="".concat(Hp,".").concat(Rp),jp="".concat(Hp,".").concat(Up),Jp="".concat(Hp,".").concat(Lp),Fp="".concat(Hp,".").concat(Tp),qp=[Mp,Kp,_p,jp,Jp,Fp],Xp=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).version=Le(r,Pp,t.defaultValues(Pp)),e.messageImprint=Le(r,Op,t.defaultValues(Op)),Rp in r&&(e.reqPolicy=Le(r,Rp,t.defaultValues(Rp))),Up in r&&(e.nonce=Le(r,Up,t.defaultValues(Up))),Lp in r&&(e.certReq=Le(r,Lp,t.defaultValues(Lp))),Tp in r&&(e.extensions=Le(r,Tp,t.defaultValues(Tp))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,qp);var r=sa(e,e,t.schema());za.assertSchema(r,this.className),this.version=r.result[Mp].valueBlock.valueDec,this.messageImprint=new Rd({schema:r.result[Kp]}),_p in r.result&&(this.reqPolicy=r.result[_p].valueBlock.toString()),jp in r.result&&(this.nonce=r.result[jp]),Jp in r.result&&(this.certReq=r.result[Jp].valueBlock.value),Fp in r.result&&(this.extensions=Array.from(r.result[Fp],(function(e){return new Qo({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(new Zt({value:this.version})),e.push(this.messageImprint.toSchema()),this.reqPolicy&&e.push(new ar({value:this.reqPolicy})),this.nonce&&e.push(this.nonce),Lp in this&&!1===t.compareWithDefault(Lp,this.certReq)&&e.push(new Ht({value:this.certReq})),this.extensions&&e.push(new Vt({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.extensions,(function(e){return e.toSchema()}))})),new cr({value:e})}},{key:"toJSON",value:function(){var e={version:this.version,messageImprint:this.messageImprint.toJSON()};return void 0!==this.reqPolicy&&(e.reqPolicy=this.reqPolicy),void 0!==this.nonce&&(e.nonce=this.nonce.toJSON()),void 0!==this.certReq&&!1===t.compareWithDefault(Lp,this.certReq)&&(e.certReq=this.certReq),this.extensions&&(e.extensions=Array.from(this.extensions,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case Pp:return 0;case Op:return new Rd;case Rp:return Xa;case Up:return new Zt;case Lp:return!1;case Tp:return[];default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case Pp:case Rp:case Lp:return r===t.defaultValues(e);case Op:return Rd.compareWithDefault("hashAlgorithm",r.hashAlgorithm)&&Rd.compareWithDefault("hashedMessage",r.hashedMessage);case Up:return r.isEqual(t.defaultValues(e));case Tp:return 0===r.length;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||Hp,value:[new Zt({name:t.version||Mp}),Rd.schema(t.messageImprint||{names:{blockName:Kp}}),new ar({name:t.reqPolicy||_p,optional:!0}),new Zt({name:t.nonce||jp,optional:!0}),new Ht({name:t.certReq||Jp,optional:!0}),new Vt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new na({name:t.extensions||Fp,value:Qo.schema()})]})]})}}])}(Ya);Xp.CLASS_NAME="TimeStampReq";var Gp="status",Wp="timeStampToken",zp="TimeStampResp",Yp="".concat(zp,".").concat(Gp),Qp="".concat(zp,".").concat(Wp),Zp=[Yp,Qp],$p=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=n(this,t)).status=Le(r,Gp,t.defaultValues(Gp)),Wp in r&&(e.timeStampToken=Le(r,Wp,t.defaultValues(Wp))),r.schema&&e.fromSchema(r.schema),e}return m(t,e),o(t,[{key:"fromSchema",value:function(e){Ze(e,Zp);var r=sa(e,e,t.schema());za.assertSchema(r,this.className),this.status=new Dp({schema:r.result[Yp]}),Qp in r.result&&(this.timeStampToken=new nc({schema:r.result[Qp]}))}},{key:"toSchema",value:function(){var e=[];return e.push(this.status.toSchema()),this.timeStampToken&&e.push(this.timeStampToken.toSchema()),new cr({value:e})}},{key:"toJSON",value:function(){var e={status:this.status.toJSON()};return this.timeStampToken&&(e.timeStampToken=this.timeStampToken.toJSON()),e}},{key:"sign",value:(s=a(k().mark((function e(t,r){var a,n,i=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.length>2&&void 0!==i[2]?i[2]:po(!0),this.assertContentType(),n=new kp({schema:this.timeStampToken.content}),e.abrupt("return",n.sign(t,0,r,void 0,a));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"verify",value:(r=a(k().mark((function e(){var t,r,a,n=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{signer:0,trustedCerts:[],data:qa},r=n.length>1&&void 0!==n[1]?n[1]:po(!0),this.assertContentType(),a=new kp({schema:this.timeStampToken.content}),e.abrupt("return",a.verify(t,r));case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"assertContentType",value:function(){if(!this.timeStampToken)throw new Error("timeStampToken is absent in TSP response");if(this.timeStampToken.contentType!==ai)throw new Error("Wrong format of timeStampToken: ".concat(this.timeStampToken.contentType))}}],[{key:"defaultValues",value:function(e){switch(e){case Gp:return new Dp;case Wp:return new nc;default:return A(t,"defaultValues",this,2)([e])}}},{key:"compareWithDefault",value:function(e,r){switch(e){case Gp:return Dp.compareWithDefault(Gp,r.status)&&"statusStrings"in r==!1&&"failInfo"in r==!1;case Wp:return r.contentType===Xa&&r.content instanceof ra;default:return A(t,"defaultValues",this,2)([e])}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Le(e,"names",{});return new cr({name:t.blockName||zp,value:[Dp.schema(t.status||{names:{blockName:Yp}}),nc.schema(t.timeStampToken||{names:{blockName:Qp,optional:!0}})]})}}]);var r,s}(Ya);$p.CLASS_NAME="TimeStampResp",function(){if("undefined"!=typeof self){if("crypto"in self){var e="webcrypto";"webkitSubtle"in self.crypto&&(e="safari"),vo(e,new ho({name:e,crypto:crypto}))}}else if("undefined"!=typeof crypto&&"webcrypto"in crypto){var t="NodeJS ^15",r=crypto.webcrypto;vo(t,new ho({name:t,crypto:r}))}}();var ey=null,ty=o((function e(){i(this,e)}),null,[{key:"setEngine",value:function(e,t){ey=Object.assign(t,{name:e}),vo(e,new ho({name:e,crypto:t}))}},{key:"crypto",get:function(){if(!ey)throw new ie(ne.CRYPTOGRAPHIC_NO_MODULE);return ey}},{key:"isNodePlugin",value:function(){return"undefined"==typeof self&&"undefined"==typeof window}}]);ty.isNodePlugin()||ty.setEngine("W3 WebCrypto module",self.crypto);var ry,ay=o((function e(){i(this,e)}),[{key:"getAlgorithmName",value:function(){return this.namespaceURI}}]),ny=function(e){function t(){return i(this,t),n(this,t,arguments)}return m(t,e),o(t,[{key:"Digest",value:(r=a(k().mark((function e(t){var r,a,n;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"string"==typeof t?r=oe.FromString(t,"utf8"):ArrayBuffer.isView(t)?r=new Uint8Array(t.buffer):t instanceof ArrayBuffer?r=new Uint8Array(t):(a=(new XMLSerializer).serializeToString(t),r=oe.FromString(a,"utf8")),e.next=3,ty.crypto.subtle.digest(this.algorithm,r);case 3:return n=e.sent,e.abrupt("return",new Uint8Array(n));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})}]);var r}(ay),iy=function(e){function t(){return i(this,t),n(this,t,arguments)}return m(t,e),o(t,[{key:"Sign",value:(s=a(k().mark((function e(t,r,a){var n;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=oe.FromString(t,"utf8"),e.abrupt("return",ty.crypto.subtle.sign(a,r,n));case 2:case"end":return e.stop()}}),e)}))),function(e,t,r){return s.apply(this,arguments)})},{key:"Verify",value:(r=a(k().mark((function e(t,r,a,n){var i;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=oe.FromString(t,"utf8"),e.abrupt("return",ty.crypto.subtle.verify(n||this.algorithm,r,a,i));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,a,n){return r.apply(this,arguments)})}]);var r,s}(ay),sy="SHA-1",uy="SHA-256",oy="SHA-384",ly="SHA-512",cy="http://www.w3.org/2000/09/xmldsig#sha1",hy="http://www.w3.org/2001/04/xmlenc#sha256",fy="http://www.w3.org/2001/04/xmldsig-more#sha384",my="http://www.w3.org/2001/04/xmlenc#sha512",vy=function(e){function t(){var e;return i(this,t),(e=n(this,t,arguments)).algorithm={name:sy},e.namespaceURI=cy,e}return m(t,e),o(t)}(ny),dy=function(e){function t(){var e;return i(this,t),(e=n(this,t,arguments)).algorithm={name:uy},e.namespaceURI=hy,e}return m(t,e),o(t)}(ny),gy=function(e){function t(){var e;return i(this,t),(e=n(this,t,arguments)).algorithm={name:oy},e.namespaceURI=fy,e}return m(t,e),o(t)}(ny),py=function(e){function t(){var e;return i(this,t),(e=n(this,t,arguments)).algorithm={name:ly},e.namespaceURI=my,e}return m(t,e),o(t)}(ny),yy="ECDSA",ky="http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha1",wy="http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha256",by="http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha384",Sy="http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha512",Ay=function(e){function t(){var e;return i(this,t),(e=n(this,t,arguments)).algorithm={name:yy,hash:{name:sy}},e.namespaceURI=ky,e}return m(t,e),o(t)}(iy),Ny=function(e){function t(){var e;return i(this,t),(e=n(this,t,arguments)).algorithm={name:yy,hash:{name:uy}},e.namespaceURI=wy,e}return m(t,e),o(t)}(iy),Cy=function(e){function t(){var e;return i(this,t),(e=n(this,t,arguments)).algorithm={name:yy,hash:{name:oy}},e.namespaceURI=by,e}return m(t,e),o(t)}(iy),xy=function(e){function t(){var e;return i(this,t),(e=n(this,t,arguments)).algorithm={name:yy,hash:{name:ly}},e.namespaceURI=Sy,e}return m(t,e),o(t)}(iy),Ey="HMAC",Iy="http://www.w3.org/2000/09/xmldsig#hmac-sha1",By="http://www.w3.org/2001/04/xmldsig-more#hmac-sha256",Vy="http://www.w3.org/2001/04/xmldsig-more#hmac-sha384",Dy="http://www.w3.org/2001/04/xmldsig-more#hmac-sha512",Py=function(e){function t(){var e;return i(this,t),(e=n(this,t,arguments)).algorithm={name:Ey,hash:{name:sy}},e.namespaceURI=Iy,e}return m(t,e),o(t)}(iy),Oy=function(e){function t(){var e;return i(this,t),(e=n(this,t,arguments)).algorithm={name:Ey,hash:{name:uy}},e.namespaceURI=By,e}return m(t,e),o(t)}(iy),Ry=function(e){function t(){var e;return i(this,t),(e=n(this,t,arguments)).algorithm={name:Ey,hash:{name:oy}},e.namespaceURI=Vy,e}return m(t,e),o(t)}(iy),Uy=function(e){function t(){var e;return i(this,t),(e=n(this,t,arguments)).algorithm={name:Ey,hash:{name:ly}},e.namespaceURI=Dy,e}return m(t,e),o(t)}(iy),Ly="RSASSA-PKCS1-v1_5",Ty="http://www.w3.org/2000/09/xmldsig#rsa-sha1",Hy="http://www.w3.org/2001/04/xmldsig-more#rsa-sha256",My="http://www.w3.org/2001/04/xmldsig-more#rsa-sha384",Ky="http://www.w3.org/2001/04/xmldsig-more#rsa-sha512",_y=function(e){function t(){var e;return i(this,t),(e=n(this,t,arguments)).algorithm={name:Ly,hash:{name:sy}},e.namespaceURI=Ty,e}return m(t,e),o(t)}(iy),jy=function(e){function t(){var e;return i(this,t),(e=n(this,t,arguments)).algorithm={name:Ly,hash:{name:uy}},e.namespaceURI=Hy,e}return m(t,e),o(t)}(iy),Jy=function(e){function t(){var e;return i(this,t),(e=n(this,t,arguments)).algorithm={name:Ly,hash:{name:oy}},e.namespaceURI=My,e}return m(t,e),o(t)}(iy),Fy=function(e){function t(){var e;return i(this,t),(e=n(this,t,arguments)).algorithm={name:Ly,hash:{name:ly}},e.namespaceURI=Ky,e}return m(t,e),o(t)}(iy),qy="RSA-PSS",Xy="http://www.w3.org/2007/05/xmldsig-more#rsa-pss",Gy=function(e){function t(e){var r;return i(this,t),(r=n(this,t)).algorithm={name:qy,hash:{name:sy}},r.namespaceURI=Xy,e&&(r.algorithm.saltLength=e),r}return m(t,e),o(t)}(iy),Wy=function(e){function t(e){var r;return i(this,t),(r=n(this,t,[e])).algorithm.hash.name=sy,r}return m(t,e),o(t)}(Gy),zy=function(e){function t(e){var r;return i(this,t),(r=n(this,t,[e])).algorithm.hash.name=uy,r}return m(t,e),o(t)}(Gy),Yy=function(e){function t(e){var r;return i(this,t),(r=n(this,t,[e])).algorithm.hash.name=oy,r}return m(t,e),o(t)}(Gy),Qy=function(e){function t(e){var r;return i(this,t),(r=n(this,t,[e])).algorithm.hash.name=ly,r}return m(t,e),o(t)}(Gy),Zy="http://www.w3.org/2007/05/xmldsig-more#sha1-rsa-MGF1",$y="http://www.w3.org/2007/05/xmldsig-more#sha256-rsa-MGF1",ek="http://www.w3.org/2007/05/xmldsig-more#sha384-rsa-MGF1",tk="http://www.w3.org/2007/05/xmldsig-more#sha512-rsa-MGF1",rk=function(e){function t(){var e;return i(this,t),(e=n(this,t)).algorithm={name:qy,hash:{name:sy}},e.namespaceURI=Zy,e}return m(t,e),o(t)}(iy),ak=function(e){function t(){var e;return i(this,t),(e=n(this,t)).algorithm.hash.name=sy,e.algorithm.saltLength=20,e}return m(t,e),o(t)}(rk),nk=function(e){function t(){var e;return i(this,t),(e=n(this,t)).algorithm.hash.name=uy,e.algorithm.saltLength=32,e}return m(t,e),o(t)}(rk),ik=function(e){function t(){var e;return i(this,t),(e=n(this,t)).algorithm.hash.name=oy,e.algorithm.saltLength=48,e}return m(t,e),o(t)}(rk),sk=function(e){function t(){var e;return i(this,t),(e=n(this,t)).algorithm.hash.name=ly,e.algorithm.saltLength=64,e}return m(t,e),o(t)}(rk);e.XmlCanonicalizerState=void 0,(ry=e.XmlCanonicalizerState||(e.XmlCanonicalizerState={}))[ry.BeforeDocElement=0]="BeforeDocElement",ry[ry.InsideDocElement=1]="InsideDocElement",ry[ry.AfterDocElement=2]="AfterDocElement";var uk=o((function t(r,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Ee;i(this,t),this.propagatedNamespaces=new Ee,this.result=[],this.visibleNamespaces=new Ee,this.inclusiveNamespacesPrefixList=[],this.state=e.XmlCanonicalizerState.BeforeDocElement,this.withComments=r,this.exclusive=a,this.propagatedNamespaces=n}),[{key:"InclusiveNamespacesPrefixList",get:function(){return this.inclusiveNamespacesPrefixList.join(" ")},set:function(e){this.inclusiveNamespacesPrefixList=e.split(" ")}},{key:"Canonicalize",value:function(e){if(!e)throw new ie(ne.CRYPTOGRAPHIC,"Parameter 1 is not Node");return this.WriteNode(e),this.result.join("")}},{key:"WriteNode",value:function(t){switch(t.nodeType){case ue.Document:case ue.DocumentFragment:this.WriteDocumentNode(t);break;case ue.Element:this.WriteElementNode(t);break;case ue.CDATA:case ue.SignificantWhitespace:case ue.Text:be(t.parentNode)||this.WriteTextNode(t);break;case ue.Whitespace:this.state===e.XmlCanonicalizerState.InsideDocElement&&this.WriteTextNode(t);break;case ue.Comment:this.WriteCommentNode(t);break;case ue.ProcessingInstruction:this.WriteProcessingInstructionNode(t);break;case ue.EntityReference:for(var r=0;r<t.childNodes.length;r++)this.WriteNode(t.childNodes[r]);break;case ue.Attribute:case ue.EndElement:case ue.EndEntity:throw new ie(ne.CRYPTOGRAPHIC,"Attribute node is impossible here");case ue.DocumentType:case ue.Entity:case ue.Notation:case ue.XmlDeclaration:}}},{key:"WriteDocumentNode",value:function(t){this.state=e.XmlCanonicalizerState.BeforeDocElement;for(var r=t.firstChild;null!=r;r=r.nextSibling)this.WriteNode(r)}},{key:"WriteCommentNode",value:function(t){this.withComments&&(this.state===e.XmlCanonicalizerState.AfterDocElement?this.result.push(String.fromCharCode(10)+"\x3c!--"):this.result.push("\x3c!--"),this.result.push(this.NormalizeString(t.nodeValue,ue.Comment)),this.state===e.XmlCanonicalizerState.BeforeDocElement?this.result.push("--\x3e"+String.fromCharCode(10)):this.result.push("--\x3e"))}},{key:"WriteTextNode",value:function(e){this.result.push(this.NormalizeString(e.nodeValue,e.nodeType))}},{key:"WriteProcessingInstructionNode",value:function(t){var r=t.nodeName||t.tagName;"xml"!==r&&(this.state===e.XmlCanonicalizerState.AfterDocElement?this.result.push("\n<?"):this.result.push("<?"),this.result.push(r),t.nodeValue&&(this.result.push(" "),this.result.push(this.NormalizeString(t.nodeValue,ue.ProcessingInstruction))),this.state===e.XmlCanonicalizerState.BeforeDocElement?this.result.push("?>\n"):this.result.push("?>"))}},{key:"WriteElementNode",value:function(t){var r=this.state;this.state===e.XmlCanonicalizerState.BeforeDocElement&&(this.state=e.XmlCanonicalizerState.InsideDocElement),this.result.push("<"),this.result.push(t.nodeName);var a=this.WriteNamespacesAxis(t);this.WriteAttributesAxis(t),this.result.push(">");for(var n=t.firstChild;null!=n;n=n.nextSibling)this.WriteNode(n);for(this.result.push("</"),this.result.push(t.nodeName),this.result.push(">"),r===e.XmlCanonicalizerState.BeforeDocElement&&(this.state=e.XmlCanonicalizerState.AfterDocElement);a--;)this.visibleNamespaces.Pop()}},{key:"WriteNamespacesAxis",value:function(e){for(var t=this,r=[],a=0,n=0;n<e.attributes.length;n++){var i=e.attributes[n];if(hk(i)){if("xmlns"===i.localName&&!i.prefix&&!i.nodeValue){var s={prefix:i.prefix,namespace:i.nodeValue};r.push(s),this.visibleNamespaces.Add(s),a++}var u,o=null;(u=/xmlns:([\w\.-]+)/.exec(i.nodeName))&&(o=u[1]);var l=!0;if(this.exclusive&&!this.IsNamespaceInclusive(e,o)){var c=ck(e,o);if(c>1)l=!1;else if(0===c)continue}if(!this.IsNamespaceRendered(o,i.nodeValue)&&l){var h={prefix:o,namespace:i.nodeValue};r.push(h),this.visibleNamespaces.Add(h),a++}}else if(i.prefix&&!this.IsNamespaceRendered(i.prefix,i.namespaceURI)){var f={prefix:i.prefix,namespace:i.namespaceURI};r.push(f),this.visibleNamespaces.Add(f),a++}}if(!this.IsNamespaceRendered(e.prefix,e.namespaceURI)&&"http://www.w3.org/2000/xmlns/"!==e.namespaceURI){var m={prefix:e.prefix,namespace:e.namespaceURI};r.push(m),this.visibleNamespaces.Add(m),a++}r.sort(ok);var v=null;return r.forEach((function(e){e.prefix!==v&&(v=e.prefix,t.result.push(" xmlns"),e.prefix&&t.result.push(":"+e.prefix),t.result.push('="'),t.result.push(e.namespace),t.result.push('"'))})),a}},{key:"WriteAttributesAxis",value:function(e){for(var t=this,r=[],a=0;a<e.attributes.length;a++){var n=e.attributes[a];hk(n)||r.push(n)}r.sort(lk),r.forEach((function(e){null!=e&&(t.result.push(" "),t.result.push(e.nodeName),t.result.push('="'),t.result.push(t.NormalizeString(e.nodeValue,ue.Attribute)),t.result.push('"'))}))}},{key:"NormalizeString",value:function(e,t){var r=[];if(e)for(var a=0;a<e.length;a++){var n=e[a];"<"!==n||t!==ue.Attribute&&!this.IsTextNode(t)?">"===n&&this.IsTextNode(t)?r.push("&gt;"):"&"!==n||t!==ue.Attribute&&!this.IsTextNode(t)?'"'===n&&t===ue.Attribute?r.push("&quot;"):"\t"===n&&t===ue.Attribute?r.push("&#x9;"):"\n"===n&&t===ue.Attribute?r.push("&#xA;"):"\r"===n?r.push("&#xD;"):r.push(n):r.push("&amp;"):r.push("&lt;")}return r.join("")}},{key:"IsTextNode",value:function(e){switch(e){case ue.Text:case ue.CDATA:case ue.SignificantWhitespace:case ue.Whitespace:return!0}return!1}},{key:"IsNamespaceInclusive",value:function(e,t){var r=t||null;return e.prefix!==r&&-1!==this.inclusiveNamespacesPrefixList.indexOf(r||"")}},{key:"IsNamespaceRendered",value:function(e,t){if(t=t||"",!(e=e||"")&&!t)return!0;if("xml"===e&&"http://www.w3.org/XML/1998/namespace"===t)return!0;var r=this.visibleNamespaces.GetPrefix(e);return!!r&&r.namespace===t}}]);function ok(e,t){return e==t?0:e?t?e.prefix?t.prefix?e.prefix<t.prefix?-1:e.prefix>t.prefix?1:0:1:-1:1:-1}function lk(e,t){if(!e.namespaceURI&&t.namespaceURI)return-1;if(!t.namespaceURI&&e.namespaceURI)return 1;var r=e.namespaceURI+e.localName,a=t.namespaceURI+t.localName;return r===a?0:r<a?-1:1}function ck(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=t||null;if(e.prefix===a)return++r;if(e.attributes)for(var n=0;n<e.attributes.length;n++){var i=e.attributes[n];if(!hk(i)&&t&&e.attributes[n].prefix===t)return++r}for(var s=e.firstChild;s;s=s.nextSibling)if(s.nodeType===ue.Element){var u=s,o=ck(u,t,r);if(s.nodeType===ue.Element&&o)return++r+o}return r}function hk(e){return!(null===e||e.nodeType!==ue.Attribute||"xmlns"!==e.nodeName&&!/xmlns:/.test(e.nodeName))}function fk(e,t,r,a){var n,i=arguments.length,s=i<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,r):a;if("object"===("undefined"==typeof Reflect?"undefined":x(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,a);else for(var u=e.length-1;u>=0;u--)(n=e[u])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s}"function"==typeof SuppressedError&&SuppressedError;var mk={DefaultCanonMethod:"http://www.w3.org/TR/2001/REC-xml-c14n-20010315",DefaultDigestMethod:"http://www.w3.org/2001/04/xmlenc#sha256",DefaultPrefix:"ds",ElementNames:{CanonicalizationMethod:"CanonicalizationMethod",DigestMethod:"DigestMethod",DigestValue:"DigestValue",DSAKeyValue:"DSAKeyValue",DomainParameters:"DomainParameters",EncryptedKey:"EncryptedKey",HMACOutputLength:"HMACOutputLength",RSAPSSParams:"RSAPSSParams",MaskGenerationFunction:"MaskGenerationFunction",SaltLength:"SaltLength",KeyInfo:"KeyInfo",KeyName:"KeyName",KeyValue:"KeyValue",Modulus:"Modulus",Exponent:"Exponent",Manifest:"Manifest",Object:"Object",Reference:"Reference",RetrievalMethod:"RetrievalMethod",RSAKeyValue:"RSAKeyValue",ECDSAKeyValue:"ECDSAKeyValue",NamedCurve:"NamedCurve",PublicKey:"PublicKey",Signature:"Signature",SignatureMethod:"SignatureMethod",SignatureValue:"SignatureValue",SignedInfo:"SignedInfo",Transform:"Transform",Transforms:"Transforms",X509Data:"X509Data",PGPData:"PGPData",SPKIData:"SPKIData",SPKIexp:"SPKIexp",MgmtData:"MgmtData",X509IssuerSerial:"X509IssuerSerial",X509IssuerName:"X509IssuerName",X509SerialNumber:"X509SerialNumber",X509SKI:"X509SKI",X509SubjectName:"X509SubjectName",X509Certificate:"X509Certificate",X509CRL:"X509CRL",XPath:"XPath",X:"X",Y:"Y"},AttributeNames:{Algorithm:"Algorithm",Encoding:"Encoding",Id:"Id",MimeType:"MimeType",Type:"Type",URI:"URI"},AlgorithmNamespaces:{XmlDsigBase64Transform:"http://www.w3.org/2000/09/xmldsig#base64",XmlDsigC14NTransform:"http://www.w3.org/TR/2001/REC-xml-c14n-20010315",XmlDsigC14NWithCommentsTransform:"http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments",XmlDsigEnvelopedSignatureTransform:"http://www.w3.org/2000/09/xmldsig#enveloped-signature",XmlDsigXPathTransform:"http://www.w3.org/TR/1999/REC-xpath-19991116",XmlDsigXsltTransform:"http://www.w3.org/TR/1999/REC-xslt-19991116",XmlDsigExcC14NTransform:"http://www.w3.org/2001/10/xml-exc-c14n#",XmlDsigExcC14NWithCommentsTransform:"http://www.w3.org/2001/10/xml-exc-c14n#WithComments",XmlDecryptionTransform:"http://www.w3.org/2002/07/decrypt#XML",XmlLicenseTransform:"urn:mpeg:mpeg21:2003:01-REL-R-NS:licenseTransform"},Uri:{Manifest:"http://www.w3.org/2000/09/xmldsig#Manifest"},NamespaceURI:"http://www.w3.org/2000/09/xmldsig#",NamespaceURIMore:"http://www.w3.org/2007/05/xmldsig-more#",NamespaceURIPss:"http://www.example.org/xmldsig-pss/#"};e.XmlSignatureObject=function(e){function t(){return i(this,t),n(this,t,arguments)}return m(t,e),o(t)}(Ce),e.XmlSignatureObject=fk([Q({localName:"xmldsig",namespaceURI:mk.NamespaceURI,prefix:mk.DefaultPrefix})],e.XmlSignatureObject),e.XmlSignatureCollection=function(e){function t(){return i(this,t),n(this,t,arguments)}return m(t,e),o(t)}(xe),e.XmlSignatureCollection=fk([Q({localName:"xmldsig_collection",namespaceURI:mk.NamespaceURI,prefix:mk.DefaultPrefix})],e.XmlSignatureCollection);var vk=function(e){function t(){return i(this,t),n(this,t,arguments)}return m(t,e),o(t)}(e.XmlSignatureObject);e.CanonicalizationMethod=function(e){function t(){return i(this,t),n(this,t,arguments)}return m(t,e),o(t)}(e.XmlSignatureObject),fk([$({localName:mk.AttributeNames.Algorithm,required:!0,defaultValue:mk.DefaultCanonMethod})],e.CanonicalizationMethod.prototype,"Algorithm",void 0),e.CanonicalizationMethod=fk([Q({localName:mk.ElementNames.CanonicalizationMethod})],e.CanonicalizationMethod),e.DataObject=function(e){function t(){return i(this,t),n(this,t,arguments)}return m(t,e),o(t)}(e.XmlSignatureObject),fk([$({localName:mk.AttributeNames.Id,defaultValue:""})],e.DataObject.prototype,"Id",void 0),fk([$({localName:mk.AttributeNames.MimeType,defaultValue:""})],e.DataObject.prototype,"MimeType",void 0),fk([$({localName:mk.AttributeNames.Encoding,defaultValue:""})],e.DataObject.prototype,"Encoding",void 0),e.DataObject=fk([Q({localName:mk.ElementNames.Object})],e.DataObject),e.DataObjects=function(e){function t(){return i(this,t),n(this,t,arguments)}return m(t,e),o(t)}(e.XmlSignatureCollection),e.DataObjects=fk([Q({localName:"xmldsig_objects",parser:e.DataObject})],e.DataObjects),e.DigestMethod=function(e){function t(e){var r;return i(this,t),r=n(this,t),e&&(r.Algorithm=e),r}return m(t,e),o(t)}(e.XmlSignatureObject),fk([$({localName:mk.AttributeNames.Algorithm,required:!0,defaultValue:mk.DefaultDigestMethod})],e.DigestMethod.prototype,"Algorithm",void 0),e.DigestMethod=fk([Q({localName:mk.ElementNames.DigestMethod})],e.DigestMethod),e.KeyInfo=function(t){function r(){return i(this,r),n(this,r,arguments)}return m(r,t),o(r,[{key:"OnLoadXml",value:function(t){for(var r=0;r<t.childNodes.length;r++){var a=t.childNodes.item(r);if(a.nodeType===ue.Element){var n=null;switch(a.localName){case mk.ElementNames.KeyValue:n=e.KeyValue;break;case mk.ElementNames.X509Data:n=e.KeyInfoX509Data;break;case mk.ElementNames.SPKIData:n=e.SPKIData;case mk.ElementNames.KeyName:case mk.ElementNames.RetrievalMethod:case mk.ElementNames.PGPData:case mk.ElementNames.MgmtData:}if(n){var i=new n;i.LoadXml(a),this.Add(i)}}}}}])}(e.XmlSignatureCollection),fk([$({localName:mk.AttributeNames.Id,defaultValue:""})],e.KeyInfo.prototype,"Id",void 0),e.KeyInfo=fk([Q({localName:mk.ElementNames.KeyInfo})],e.KeyInfo),e.Transform=function(e){function t(){var e;return i(this,t),(e=n(this,t,arguments)).innerXml=null,e}return m(t,e),o(t,[{key:"GetOutput",value:function(){throw new ie(ne.METHOD_NOT_IMPLEMENTED)}},{key:"LoadInnerXml",value:function(e){if(!e)throw new ie(ne.PARAM_REQUIRED,"node");this.innerXml=e}},{key:"GetInnerXml",value:function(){return this.innerXml}}])}(e.XmlSignatureObject),fk([$({localName:mk.AttributeNames.Algorithm,defaultValue:""})],e.Transform.prototype,"Algorithm",void 0),fk([Z({localName:mk.ElementNames.XPath,defaultValue:""})],e.Transform.prototype,"XPath",void 0),e.Transform=fk([Q({localName:mk.ElementNames.Transform})],e.Transform);var dk=function(e){function t(){var e;return i(this,t),(e=n(this,t,arguments)).Algorithm=mk.AlgorithmNamespaces.XmlDsigBase64Transform,e}return m(t,e),o(t,[{key:"GetOutput",value:function(){if(!this.innerXml)throw new ie(ne.PARAM_REQUIRED,"innerXml");return oe.FromString(this.innerXml.textContent||"","base64")}}])}(e.Transform),gk=function(e){function t(){var e;return i(this,t),(e=n(this,t,arguments)).Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315",e.xmlCanonicalizer=new uk(!1,!1),e}return m(t,e),o(t,[{key:"GetOutput",value:function(){if(!this.innerXml)throw new ie(ne.PARAM_REQUIRED,"innerXml");return this.xmlCanonicalizer.Canonicalize(this.innerXml)}}])}(e.Transform),pk=function(e){function t(){var e;return i(this,t),(e=n(this,t,arguments)).Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments",e.xmlCanonicalizer=new uk(!0,!1),e}return m(t,e),o(t)}(gk),yk=function(e){function t(){var e;return i(this,t),(e=n(this,t,arguments)).Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature",e}return m(t,e),o(t,[{key:"GetOutput",value:function(){var e;if(!this.innerXml)throw new ie(ne.PARAM_REQUIRED,"innerXml");for(var t=this.innerXml.firstChild,r=[];t;)we(t)&&t.localName===mk.ElementNames.Signature&&t.namespaceURI===mk.NamespaceURI&&r.push(t),t=t.nextSibling;for(var a=0,n=r;a<n.length;a++){var i=n[a];null===(e=i.parentNode)||void 0===e||e.removeChild(i)}return this.innerXml}}])}(e.Transform),kk=function(e){function t(){var e;return i(this,t),(e=n(this,t,arguments)).Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#",e.xmlCanonicalizer=new uk(!1,!0),e}return m(t,e),o(t,[{key:"InclusiveNamespacesPrefixList",get:function(){return this.xmlCanonicalizer.InclusiveNamespacesPrefixList},set:function(e){this.xmlCanonicalizer.InclusiveNamespacesPrefixList=e}},{key:"LoadXml",value:function(e){if(A(t,"LoadXml",this,3)([e]),this.Element&&this.Element.childNodes)for(var r=0;r<this.Element.childNodes.length;r++){var a=this.Element.childNodes[r];if(a&&1===a.nodeType&&"InclusiveNamespaces"===a.localName)this.setInclusiveNamespacesElement(a)}}},{key:"GetOutput",value:function(){if(!this.innerXml)throw new ie(ne.PARAM_REQUIRED,"innerXml");return this.xmlCanonicalizer.Canonicalize(this.innerXml)}},{key:"setInclusiveNamespacesElement",value:function(e){var t=e.getAttribute("PrefixList");t&&t.length>0&&(this.xmlCanonicalizer.InclusiveNamespacesPrefixList=t)}}])}(e.Transform),wk=function(e){function t(){var e;return i(this,t),(e=n(this,t,arguments)).Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#WithComments",e.xmlCanonicalizer=new uk(!0,!0),e}return m(t,e),o(t)}(kk);function bk(e){return e.parentNode?bk(e.parentNode):e}var Sk=function(e){function t(){var e;return i(this,t),(e=n(this,t,arguments)).Algorithm=mk.AlgorithmNamespaces.XmlDsigXPathTransform,e}return m(t,e),o(t,[{key:"GetOutput",value:function(){if(!this.innerXml)throw new ie(ne.PARAM_REQUIRED,"innerXml");this.Filter(bk(this.innerXml),this.XPath)}},{key:"Filter",value:function(e,t){for(var r=this,a=e.childNodes,n=[],i=0;a&&i<a.length;i++){var s=a.item(i);n.push(s)}n.forEach((function(e){r.Evaluate(e,t)?e.parentNode&&e.parentNode.removeChild(e):r.Filter(e,t)}))}},{key:"GetEvaluator",value:function(e){return"undefined"!=typeof self?null==e.ownerDocument?e:e.ownerDocument:require("xpath")}},{key:"Evaluate",value:function(e,t){try{var r=this.GetEvaluator(e),a=this.GetXml().firstChild,n="boolean(".concat(t,")");return!r.evaluate(n,e,{lookupNamespaceURI:function(e){return a.lookupNamespaceURI(e)}},("undefined"==typeof self?require("xpath"):self).XPathResult.ANY_TYPE,null).booleanValue}catch(e){return!1}}}])}(e.Transform);function Ak(e,t){var r=new t;return r.LoadXml(e.Element),r}fk([Z({localName:mk.ElementNames.XPath,namespaceURI:mk.NamespaceURI,prefix:mk.DefaultPrefix,required:!0})],Sk.prototype,"XPath",void 0),e.Transforms=function(e){function t(){return i(this,t),n(this,t,arguments)}return m(t,e),o(t,[{key:"OnLoadXml",value:function(e){A(t,"OnLoadXml",this,3)([e]),this.items=this.GetIterator().map((function(e){switch(e.Algorithm){case mk.AlgorithmNamespaces.XmlDsigEnvelopedSignatureTransform:return Ak(e,yk);case mk.AlgorithmNamespaces.XmlDsigC14NTransform:return Ak(e,gk);case mk.AlgorithmNamespaces.XmlDsigC14NWithCommentsTransform:return Ak(e,pk);case mk.AlgorithmNamespaces.XmlDsigExcC14NTransform:return Ak(e,kk);case mk.AlgorithmNamespaces.XmlDsigExcC14NWithCommentsTransform:return Ak(e,wk);case mk.AlgorithmNamespaces.XmlDsigBase64Transform:return Ak(e,dk);case mk.AlgorithmNamespaces.XmlDsigXPathTransform:return Ak(e,Sk);default:throw new ie(ne.CRYPTOGRAPHIC_UNKNOWN_TRANSFORM,e.Algorithm)}}))}}])}(e.XmlSignatureCollection),e.Transforms=fk([Q({localName:mk.ElementNames.Transforms,parser:e.Transform})],e.Transforms),e.Reference=function(t){function r(t){var a;return i(this,r),(a=n(this,r)).DigestMethod=new e.DigestMethod,t&&(a.Uri=t),a}return m(r,t),o(r)}(e.XmlSignatureObject),fk([$({defaultValue:""})],e.Reference.prototype,"Id",void 0),fk([$({localName:mk.AttributeNames.URI})],e.Reference.prototype,"Uri",void 0),fk([$({localName:mk.AttributeNames.Type,defaultValue:""})],e.Reference.prototype,"Type",void 0),fk([Z({parser:e.Transforms})],e.Reference.prototype,"Transforms",void 0),fk([Z({required:!0,parser:e.DigestMethod})],e.Reference.prototype,"DigestMethod",void 0),fk([Z({required:!0,localName:mk.ElementNames.DigestValue,namespaceURI:mk.NamespaceURI,prefix:mk.DefaultPrefix,converter:Se})],e.Reference.prototype,"DigestValue",void 0),e.Reference=fk([Q({localName:mk.ElementNames.Reference})],e.Reference),e.References=function(e){function t(){return i(this,t),n(this,t,arguments)}return m(t,e),o(t)}(e.XmlSignatureCollection),e.References=fk([Q({localName:"References",parser:e.Reference})],e.References),e.SignatureMethodOther=function(t){function r(){return i(this,r),n(this,r,arguments)}return m(r,t),o(r,[{key:"OnLoadXml",value:function(t){for(var r=0;r<t.childNodes.length;r++){var a=t.childNodes.item(r);if(a.nodeType===ue.Element&&a.nodeName!==mk.ElementNames.HMACOutputLength){var n=void 0;if(a.localName===mk.ElementNames.RSAPSSParams)n=e.PssAlgorithmParams;if(n){var i=new n;i.LoadXml(a),this.Add(i)}}}}}])}(e.XmlSignatureCollection),e.SignatureMethodOther=fk([Q({localName:"Other"})],e.SignatureMethodOther),e.SignatureMethod=function(e){function t(){return i(this,t),n(this,t,arguments)}return m(t,e),o(t)}(e.XmlSignatureObject),fk([$({localName:mk.AttributeNames.Algorithm,required:!0,defaultValue:""})],e.SignatureMethod.prototype,"Algorithm",void 0),fk([Z({localName:mk.ElementNames.HMACOutputLength,namespaceURI:mk.NamespaceURI,prefix:mk.DefaultPrefix,converter:Ae})],e.SignatureMethod.prototype,"HMACOutputLength",void 0),fk([Z({parser:e.SignatureMethodOther,noRoot:!0,minOccurs:0})],e.SignatureMethod.prototype,"Any",void 0),e.SignatureMethod=fk([Q({localName:mk.ElementNames.SignatureMethod})],e.SignatureMethod),e.SignedInfo=function(e){function t(){return i(this,t),n(this,t,arguments)}return m(t,e),o(t)}(e.XmlSignatureObject),fk([$({localName:mk.AttributeNames.Id,defaultValue:""})],e.SignedInfo.prototype,"Id",void 0),fk([Z({parser:e.CanonicalizationMethod,required:!0})],e.SignedInfo.prototype,"CanonicalizationMethod",void 0),fk([Z({parser:e.SignatureMethod,required:!0})],e.SignedInfo.prototype,"SignatureMethod",void 0),fk([Z({parser:e.References,minOccurs:1,noRoot:!0})],e.SignedInfo.prototype,"References",void 0),e.SignedInfo=fk([Q({localName:mk.ElementNames.SignedInfo})],e.SignedInfo),e.Signature=function(e){function t(){return i(this,t),n(this,t,arguments)}return m(t,e),o(t)}(e.XmlSignatureObject),fk([$({localName:mk.AttributeNames.Id,defaultValue:""})],e.Signature.prototype,"Id",void 0),fk([Z({parser:e.SignedInfo,required:!0})],e.Signature.prototype,"SignedInfo",void 0),fk([Z({localName:mk.ElementNames.SignatureValue,namespaceURI:mk.NamespaceURI,prefix:mk.DefaultPrefix,required:!0,converter:Se,defaultValue:null})],e.Signature.prototype,"SignatureValue",void 0),fk([Z({parser:e.KeyInfo})],e.Signature.prototype,"KeyInfo",void 0),fk([Z({parser:e.DataObjects,noRoot:!0})],e.Signature.prototype,"ObjectList",void 0),e.Signature=fk([Q({localName:mk.ElementNames.Signature})],e.Signature);var Nk,Ck="http://www.w3.org/2001/04/xmldsig-more#",xk="ecdsa";function Ek(e){switch(e){case"P-256":return"urn:oid:1.2.840.10045.3.1.7";case"P-384":return"urn:oid:1.3.132.0.34";case"P-521":return"urn:oid:1.3.132.0.35"}throw new ie(ne.CRYPTOGRAPHIC,"Unknown NamedCurve")}function Ik(e){switch(e){case"urn:oid:1.2.840.10045.3.1.7":return"P-256";case"urn:oid:1.3.132.0.34":return"P-384";case"urn:oid:1.3.132.0.35":return"P-521"}throw new ie(ne.CRYPTOGRAPHIC,"Unknown NamedCurve OID")}e.EcdsaPublicKey=function(e){function t(){return i(this,t),n(this,t,arguments)}return m(t,e),o(t)}(Ce),fk([Z({localName:mk.ElementNames.X,namespaceURI:Ck,prefix:xk,required:!0,converter:Se})],e.EcdsaPublicKey.prototype,"X",void 0),fk([Z({localName:mk.ElementNames.Y,namespaceURI:Ck,prefix:xk,required:!0,converter:Se})],e.EcdsaPublicKey.prototype,"Y",void 0),e.EcdsaPublicKey=fk([Q({localName:mk.ElementNames.PublicKey,namespaceURI:Ck,prefix:xk})],e.EcdsaPublicKey),e.NamedCurve=function(e){function t(){return i(this,t),n(this,t,arguments)}return m(t,e),o(t)}(Ce),fk([$({localName:mk.AttributeNames.URI,required:!0})],e.NamedCurve.prototype,"Uri",void 0),e.NamedCurve=fk([Q({localName:mk.ElementNames.NamedCurve,namespaceURI:Ck,prefix:xk})],e.NamedCurve),e.DomainParameters=function(e){function t(){return i(this,t),n(this,t,arguments)}return m(t,e),o(t)}(Ce),fk([Z({parser:e.NamedCurve})],e.DomainParameters.prototype,"NamedCurve",void 0),e.DomainParameters=fk([Q({localName:mk.ElementNames.DomainParameters,namespaceURI:Ck,prefix:xk})],e.DomainParameters),e.EcdsaKeyValue=function(t){function r(){var e;return i(this,r),(e=n(this,r,arguments)).name=mk.ElementNames.ECDSAKeyValue,e.key=null,e.jwk=null,e.keyUsage=null,e}return m(r,t),o(r,[{key:"NamedCurve",get:function(){return Ek(this.DomainParameters.NamedCurve.Uri)}},{key:"importKey",value:(u=a(k().mark((function t(r){var a;return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("ECDSA"===r.algorithm.name.toUpperCase()){t.next=2;break}throw new ie(ne.ALGORITHM_WRONG_NAME,r.algorithm.name);case 2:return t.next=4,ty.crypto.subtle.exportKey("jwk",r);case 4:return a=t.sent,this.key=r,this.jwk=a,this.PublicKey=new e.EcdsaPublicKey,this.PublicKey.X=oe.FromString(a.x,"base64url"),this.PublicKey.Y=oe.FromString(a.y,"base64url"),this.DomainParameters||(this.DomainParameters=new e.DomainParameters),this.DomainParameters.NamedCurve||(this.DomainParameters.NamedCurve=new e.NamedCurve),this.DomainParameters.NamedCurve.Uri=Ek(a.crv),this.keyUsage=r.usages,t.abrupt("return",this);case 15:case"end":return t.stop()}}),t,this)}))),function(e){return u.apply(this,arguments)})},{key:"exportKey",value:(s=a(k().mark((function e(t){var r,a,n,i,s;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.key){e.next=2;break}return e.abrupt("return",this.key);case 2:return r=oe.ToBase64Url(this.PublicKey.X),a=oe.ToBase64Url(this.PublicKey.Y),n=Ik(this.DomainParameters.NamedCurve.Uri),i={kty:"EC",crv:n,x:r,y:a,ext:!0},this.keyUsage=["verify"],e.next=9,ty.crypto.subtle.importKey("jwk",i,{name:"ECDSA",namedCurve:n},!0,this.keyUsage);case 9:return s=e.sent,this.key=s,e.abrupt("return",this.key);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})}]);var s,u}(vk),fk([Z({parser:e.DomainParameters})],e.EcdsaKeyValue.prototype,"DomainParameters",void 0),fk([Z({parser:e.EcdsaPublicKey,required:!0})],e.EcdsaKeyValue.prototype,"PublicKey",void 0),e.EcdsaKeyValue=fk([Q({localName:mk.ElementNames.ECDSAKeyValue,namespaceURI:Ck,prefix:xk})],e.EcdsaKeyValue);var Bk={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};e.RsaKeyValue=function(e){function t(){var e;return i(this,t),(e=n(this,t,arguments)).key=null,e.jwk=null,e.keyUsage=[],e}return m(t,e),o(t,[{key:"importKey",value:(s=a(k().mark((function e(t){var r,a;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=t.algorithm.name.toUpperCase())===Ly.toUpperCase()||r===qy.toUpperCase()){e.next=3;break}throw new ie(ne.ALGORITHM_WRONG_NAME,t.algorithm.name);case 3:return this.key=t,e.next=6,ty.crypto.subtle.exportKey("jwk",t);case 6:return a=e.sent,this.jwk=a,this.Modulus=oe.FromBase64Url(a.n),this.Exponent=oe.FromBase64Url(a.e),this.keyUsage=t.usages,e.abrupt("return",this);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"exportKey",value:(r=a(k().mark((function e(){var t,r,a,n,i,s=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:Bk,!this.key){e.next=3;break}return e.abrupt("return",this.key);case 3:if(this.Modulus){e.next=5;break}throw new ie(ne.CRYPTOGRAPHIC,"RsaKeyValue has no Modulus");case 5:if(r=oe.ToBase64Url(this.Modulus),this.Exponent){e.next=8;break}throw new ie(ne.CRYPTOGRAPHIC,"RsaKeyValue has no Exponent");case 8:a=oe.ToBase64Url(this.Exponent),e.t0=t.name.toUpperCase(),e.next=e.t0===Ly.toUpperCase()?12:e.t0===qy.toUpperCase()?14:16;break;case 12:return n="R",e.abrupt("break",17);case 14:return n="P",e.abrupt("break",17);case 16:throw new ie(ne.ALGORITHM_NOT_SUPPORTED,t.name);case 17:e.t1=t.hash.name.toUpperCase(),e.next=e.t1===sy?20:e.t1===uy?22:e.t1===oy?24:e.t1===ly?26:28;break;case 20:return n+="S1",e.abrupt("break",28);case 22:return n+="S256",e.abrupt("break",28);case 24:return n+="S384",e.abrupt("break",28);case 26:return n+="S512",e.abrupt("break",28);case 28:return i={kty:"RSA",alg:n,n:r,e:a,ext:!0},e.abrupt("return",ty.crypto.subtle.importKey("jwk",i,t,!0,this.keyUsage));case 30:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"LoadXml",value:function(e){A(t,"LoadXml",this,3)([e]),this.keyUsage=["verify"]}}]);var r,s}(vk),fk([Z({localName:mk.ElementNames.Modulus,prefix:mk.DefaultPrefix,namespaceURI:mk.NamespaceURI,required:!0,converter:Se})],e.RsaKeyValue.prototype,"Modulus",void 0),fk([Z({localName:mk.ElementNames.Exponent,prefix:mk.DefaultPrefix,namespaceURI:mk.NamespaceURI,required:!0,converter:Se})],e.RsaKeyValue.prototype,"Exponent",void 0),e.RsaKeyValue=fk([Q({localName:mk.ElementNames.RSAKeyValue})],e.RsaKeyValue);var Vk="http://www.w3.org/2007/05/xmldsig-more#",Dk="pss";e.MaskGenerationFunction=function(e){function t(){return i(this,t),n(this,t,arguments)}return m(t,e),o(t)}(Ce),fk([Z({parser:e.DigestMethod})],e.MaskGenerationFunction.prototype,"DigestMethod",void 0),fk([$({localName:mk.AttributeNames.Algorithm,defaultValue:"http://www.w3.org/2007/05/xmldsig-more#MGF1"})],e.MaskGenerationFunction.prototype,"Algorithm",void 0),e.MaskGenerationFunction=fk([Q({localName:mk.ElementNames.MaskGenerationFunction,prefix:Dk,namespaceURI:Vk})],e.MaskGenerationFunction),e.PssAlgorithmParams=Nk=function(t){function r(e){var t;return i(this,r),t=n(this,r),e&&t.FromAlgorithm(e),t}return m(r,t),o(r,[{key:"FromAlgorithm",value:function(t){this.DigestMethod=new e.DigestMethod;var r=Wk.GetHashAlgorithm(t.hash);this.DigestMethod.Algorithm=r.namespaceURI,t.saltLength&&(this.SaltLength=t.saltLength)}}],[{key:"FromAlgorithm",value:function(e){return new Nk(e)}}])}(Ce),fk([Z({parser:e.DigestMethod})],e.PssAlgorithmParams.prototype,"DigestMethod",void 0),fk([Z({parser:e.MaskGenerationFunction})],e.PssAlgorithmParams.prototype,"MGF",void 0),fk([Z({converter:Ae,prefix:Dk,namespaceURI:Vk})],e.PssAlgorithmParams.prototype,"SaltLength",void 0),fk([Z({converter:Ae})],e.PssAlgorithmParams.prototype,"TrailerField",void 0),e.PssAlgorithmParams=Nk=fk([Q({localName:mk.ElementNames.RSAPSSParams,prefix:Dk,namespaceURI:Vk})],e.PssAlgorithmParams),e.KeyValue=function(t){function r(e){var t;return i(this,r),t=n(this,r),e&&(t.Value=e),t}return m(r,t),o(r,[{key:"Value",get:function(){return this.value},set:function(e){this.element=null,this.value=e}},{key:"importKey",value:(u=a(k().mark((function t(r){return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=r.algorithm.name.toUpperCase(),t.next=t.t0===qy.toUpperCase()||t.t0===Ly.toUpperCase()?3:t.t0===yy.toUpperCase()?7:11;break;case 3:return this.Value=new e.RsaKeyValue,t.next=6,this.Value.importKey(r);case 6:case 10:return t.abrupt("break",12);case 7:return this.Value=new e.EcdsaKeyValue,t.next=10,this.Value.importKey(r);case 11:throw new ie(ne.ALGORITHM_NOT_SUPPORTED,r.algorithm.name);case 12:return t.abrupt("return",this);case 13:case"end":return t.stop()}}),t,this)}))),function(e){return u.apply(this,arguments)})},{key:"exportKey",value:(s=a(k().mark((function e(t){return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.Value){e.next=2;break}throw new ie(ne.NULL_REFERENCE);case 2:return e.abrupt("return",this.Value.exportKey(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"OnGetXml",value:function(e){if(!this.Value)throw new ie(ne.CRYPTOGRAPHIC,"KeyValue has empty value");var t=this.Value.GetXml();t&&e.appendChild(t)}},{key:"OnLoadXml",value:function(t){for(var r=0,a=[e.RsaKeyValue,e.EcdsaKeyValue];r<a.length;r++){var n=a[r];try{for(var i=new n,s=0;s<t.childNodes.length;s++){var u=t.childNodes.item(s);if(we(u))return i.LoadXml(u),void(this.value=i)}}catch(e){}}throw new ie(ne.CRYPTOGRAPHIC,"Unsupported KeyValue in use")}}]);var s,u}(vk),e.KeyValue=fk([Q({localName:mk.ElementNames.KeyValue})],e.KeyValue);var Pk,Ok,Rk,Uk={"2.5.4.3":{short:"CN",long:"CommonName"},"2.5.4.6":{short:"C",long:"Country"},"2.5.4.5":{long:"DeviceSerialNumber"},"0.9.2342.19200300.100.1.25":{short:"DC",long:"DomainComponent"},"1.2.840.113549.1.9.1":{short:"E",long:"EMail"},"2.5.4.42":{short:"G",long:"GivenName"},"2.5.4.43":{short:"I",long:"Initials"},"2.5.4.7":{short:"L",long:"Locality"},"2.5.4.10":{short:"O",long:"Organization"},"2.5.4.11":{short:"OU",long:"OrganizationUnit"},"2.5.4.8":{short:"ST",long:"State"},"2.5.4.9":{short:"Street",long:"StreetAddress"},"2.5.4.4":{short:"SN",long:"SurName"},"2.5.4.12":{short:"T",long:"Title"},"1.2.840.113549.1.9.8":{long:"UnstructuredAddress"},"1.2.840.113549.1.9.2":{long:"UnstructuredName"}},Lk=o((function e(t){if(i(this,e),this.publicKey=null,t){var r=new Uint8Array(t);this.LoadRaw(r),this.raw=r}}),[{key:"SerialNumber",get:function(){return this.simpl.serialNumber.valueBlock.toString()}},{key:"Issuer",get:function(){return this.NameToString(this.simpl.issuer)}},{key:"Subject",get:function(){return this.NameToString(this.simpl.subject)}},{key:"Thumbprint",value:(Ok=a(k().mark((function e(){var t,r=arguments;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:"SHA-1",e.abrupt("return",ty.crypto.subtle.digest(t,this.raw));case 2:case"end":return e.stop()}}),e,this)}))),function(){return Ok.apply(this,arguments)})},{key:"PublicKey",get:function(){return this.publicKey}},{key:"GetRaw",value:function(){return this.raw}},{key:"exportKey",value:(Pk=a(k().mark((function e(t){var r,a,n;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=15;break}if((r={algorithm:t,usages:["verify"]}).algorithm.name.toUpperCase()!==yy){e.next=9;break}if(!("crv"in(a=this.simpl.subjectPublicKeyInfo.toJSON()))||!a.crv){e.next=8;break}r.algorithm.namedCurve=a.crv,e.next=9;break;case 8:throw new Error("Cannot get Curved name from the ECDSA public key");case 9:return this.isHashedAlgorithm(r.algorithm)&&"string"==typeof r.algorithm.hash&&(r.algorithm.hash={name:r.algorithm.hash}),e.next=12,this.simpl.getPublicKey({algorithm:r});case 12:return n=e.sent,this.publicKey=n,e.abrupt("return",n);case 15:if("1.2.840.113549.1.1.1"!==this.simpl.subjectPublicKeyInfo.algorithm.algorithmId){e.next=21;break}return e.next=18,this.simpl.getPublicKey({algorithm:{algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},usages:["verify"]}});case 18:this.publicKey=e.sent,e.next=24;break;case 21:return e.next=23,this.simpl.getPublicKey();case 23:this.publicKey=e.sent;case 24:return e.abrupt("return",this.publicKey);case 25:case"end":return e.stop()}}),e,this)}))),function(e){return Pk.apply(this,arguments)})},{key:"NameToString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",r=[];return e.typesAndValues.forEach((function(e){var t=e.type,a=Uk[t.toString()],n=a?a.short:null;r.push("".concat(n||t,"=").concat(e.value.valueBlock.value))})),r.join(t+" ")}},{key:"LoadRaw",value:function(e){this.raw=new Uint8Array(e);var t=Et(this.raw.buffer);this.simpl=new Kc({schema:t.result})}},{key:"isHashedAlgorithm",value:function(e){return!!e.hash}}]);e.X509IssuerSerial=function(e){function t(){return i(this,t),n(this,t,arguments)}return m(t,e),o(t)}(e.XmlSignatureObject),fk([Z({localName:mk.ElementNames.X509IssuerName,namespaceURI:mk.NamespaceURI,prefix:mk.DefaultPrefix,required:!0})],e.X509IssuerSerial.prototype,"X509IssuerName",void 0),fk([Z({localName:mk.ElementNames.X509SerialNumber,namespaceURI:mk.NamespaceURI,prefix:mk.DefaultPrefix,required:!0})],e.X509IssuerSerial.prototype,"X509SerialNumber",void 0),e.X509IssuerSerial=fk([Q({localName:mk.ElementNames.X509IssuerSerial})],e.X509IssuerSerial),e.X509IncludeOption=void 0,(Rk=e.X509IncludeOption||(e.X509IncludeOption={}))[Rk.None=0]="None",Rk[Rk.EndCertOnly=1]="EndCertOnly",Rk[Rk.ExcludeRoot=2]="ExcludeRoot",Rk[Rk.WholeChain=3]="WholeChain",e.KeyInfoX509Data=function(t){function r(t){var a,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.X509IncludeOption.None;if(i(this,r),(a=n(this,r)).x509crl=null,a.SubjectKeyIdList=[],t)if(t instanceof Uint8Array)a.AddCertificate(new Lk(t));else if(t instanceof Lk)switch(s){case e.X509IncludeOption.None:case e.X509IncludeOption.EndCertOnly:a.AddCertificate(t);break;case e.X509IncludeOption.ExcludeRoot:a.AddCertificatesChainFrom(t,!1);break;case e.X509IncludeOption.WholeChain:a.AddCertificatesChainFrom(t,!0)}return a}return m(r,t),o(r,[{key:"importKey",value:(u=a(k().mark((function e(t){return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new ie(ne.METHOD_NOT_SUPPORTED);case 1:case"end":return e.stop()}}),e)}))),function(e){return u.apply(this,arguments)})},{key:"exportKey",value:(s=a(k().mark((function e(t){return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.Certificates.length){e.next=2;break}throw new ie(ne.NULL_REFERENCE);case 2:return e.next=4,this.Certificates[0].exportKey(t);case 4:return this.Key=e.sent,e.abrupt("return",this.Key);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"Certificates",get:function(){return this.X509CertificateList}},{key:"CRL",get:function(){return this.x509crl},set:function(e){this.x509crl=e}},{key:"IssuerSerials",get:function(){return this.IssuerSerialList}},{key:"SubjectKeyIds",get:function(){return this.SubjectKeyIdList}},{key:"SubjectNames",get:function(){return this.SubjectNameList}},{key:"AddCertificate",value:function(e){if(!e)throw new ie(ne.PARAM_REQUIRED,"certificate");this.X509CertificateList||(this.X509CertificateList=[]),this.X509CertificateList.push(e)}},{key:"AddIssuerSerial",value:function(e,t){if(null==e)throw new ie(ne.PARAM_REQUIRED,"issuerName");null==this.IssuerSerialList&&(this.IssuerSerialList=[]);var r={issuerName:e,serialNumber:t};this.IssuerSerialList.push(r)}},{key:"AddSubjectKeyId",value:function(e){var t;(this.SubjectKeyIdList&&(this.SubjectKeyIdList=[]),"string"==typeof e)?null!=e&&(t=oe.FromBase64(e),this.SubjectKeyIdList.push(t)):this.SubjectKeyIdList.push(e)}},{key:"AddSubjectName",value:function(e){null==this.SubjectNameList&&(this.SubjectNameList=[]),this.SubjectNameList.push(e)}},{key:"GetXml",value:function(){var e=this.CreateDocument(),t=this.CreateElement(e),r=this.GetPrefix();if(null!=this.IssuerSerialList&&this.IssuerSerialList.length>0&&this.IssuerSerialList.forEach((function(a){var n=e.createElementNS(mk.NamespaceURI,r+mk.ElementNames.X509IssuerSerial),i=e.createElementNS(mk.NamespaceURI,r+mk.ElementNames.X509IssuerName);i.textContent=a.issuerName,n.appendChild(i);var s=e.createElementNS(mk.NamespaceURI,r+mk.ElementNames.X509SerialNumber);s.textContent=a.serialNumber,n.appendChild(s),t.appendChild(n)})),null!=this.SubjectKeyIdList&&this.SubjectKeyIdList.length>0&&this.SubjectKeyIdList.forEach((function(a){var n=e.createElementNS(mk.NamespaceURI,r+mk.ElementNames.X509SKI);n.textContent=oe.ToBase64(a),t.appendChild(n)})),null!=this.SubjectNameList&&this.SubjectNameList.length>0&&this.SubjectNameList.forEach((function(a){var n=e.createElementNS(mk.NamespaceURI,r+mk.ElementNames.X509SubjectName);n.textContent=a,t.appendChild(n)})),null!=this.X509CertificateList&&this.X509CertificateList.length>0&&this.X509CertificateList.forEach((function(a){var n=e.createElementNS(mk.NamespaceURI,r+mk.ElementNames.X509Certificate);n.textContent=oe.ToBase64(a.GetRaw()),t.appendChild(n)})),null!=this.x509crl){var a=e.createElementNS(mk.NamespaceURI,r+mk.ElementNames.X509CRL);a.textContent=oe.ToBase64(this.x509crl),t.appendChild(a)}return t}},{key:"LoadXml",value:function(t){var a=this;A(r,"LoadXml",this,3)([t]),this.IssuerSerialList&&(this.IssuerSerialList=[]),this.SubjectKeyIdList&&(this.SubjectKeyIdList=[]),this.SubjectNameList&&(this.SubjectNameList=[]),this.X509CertificateList&&(this.X509CertificateList=[]),this.x509crl=null;var n=this.GetChildren(mk.ElementNames.X509IssuerSerial);n&&n.forEach((function(t){var r=e.XmlSignatureObject.GetChild(t,mk.ElementNames.X509IssuerName,mk.NamespaceURI,!0),n=e.XmlSignatureObject.GetChild(t,mk.ElementNames.X509SerialNumber,mk.NamespaceURI,!0);r&&r.textContent&&n&&n.textContent&&a.AddIssuerSerial(r.textContent,n.textContent)})),(n=this.GetChildren(mk.ElementNames.X509SKI))&&n.forEach((function(e){if(e.textContent){var t=oe.FromBase64(e.textContent);a.AddSubjectKeyId(t)}})),null!=(n=this.GetChildren(mk.ElementNames.X509SubjectName))&&n.forEach((function(e){e.textContent&&a.AddSubjectName(e.textContent)})),(n=this.GetChildren(mk.ElementNames.X509Certificate))&&n.forEach((function(e){if(e.textContent){var t=oe.FromBase64(e.textContent);a.AddCertificate(new Lk(t))}}));var i=this.GetChild(mk.ElementNames.X509CRL,!1);i&&i.textContent&&(this.x509crl=oe.FromBase64(i.textContent))}},{key:"AddCertificatesChainFrom",value:function(e,t){throw new ie(ne.METHOD_NOT_IMPLEMENTED)}}]);var s,u}(vk),e.KeyInfoX509Data=fk([Q({localName:mk.ElementNames.X509Data})],e.KeyInfoX509Data),e.SPKIData=function(e){function t(){return i(this,t),n(this,t,arguments)}return m(t,e),o(t,[{key:"importKey",value:(s=a(k().mark((function e(t){var r;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ty.crypto.subtle.exportKey("spki",t);case 2:return r=e.sent,this.SPKIexp=new Uint8Array(r),this.Key=t,e.abrupt("return",this);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"exportKey",value:(r=a(k().mark((function e(t){var r;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ty.crypto.subtle.importKey("spki",this.SPKIexp,t,!0,["verify"]);case 2:return r=e.sent,this.Key=r,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})}]);var r,s}(vk),fk([Z({localName:mk.ElementNames.SPKIexp,namespaceURI:mk.NamespaceURI,prefix:mk.DefaultPrefix,required:!0,converter:Se})],e.SPKIData.prototype,"SPKIexp",void 0),e.SPKIData=fk([Q({localName:mk.ElementNames.SPKIData})],e.SPKIData);var Tk={};Tk[Ty]=_y,Tk[Hy]=jy,Tk[My]=Jy,Tk[Ky]=Fy,Tk[ky]=Ay,Tk[wy]=Ny,Tk[by]=Cy,Tk[Sy]=xy,Tk[Iy]=Py,Tk[By]=Oy,Tk[Vy]=Ry,Tk[Dy]=Uy,Tk[Zy]=ak,Tk[$y]=nk,Tk[ek]=ik,Tk[tk]=sk;var Hk={};Hk[cy]=vy,Hk[hy]=dy,Hk[fy]=gy,Hk[my]=py;var Mk,Kk,_k,jk,Jk,Fk,qk,Xk,Gk,Wk=o((function e(){i(this,e)}),null,[{key:"CreateFromName",value:function(e){var t;switch(e){case mk.AlgorithmNamespaces.XmlDsigBase64Transform:t=new dk;break;case mk.AlgorithmNamespaces.XmlDsigC14NTransform:t=new gk;break;case mk.AlgorithmNamespaces.XmlDsigC14NWithCommentsTransform:t=new pk;break;case mk.AlgorithmNamespaces.XmlDsigEnvelopedSignatureTransform:t=new yk;break;case mk.AlgorithmNamespaces.XmlDsigXPathTransform:case mk.AlgorithmNamespaces.XmlDsigXsltTransform:throw new ie(ne.ALGORITHM_NOT_SUPPORTED,e);case mk.AlgorithmNamespaces.XmlDsigExcC14NTransform:t=new kk;break;case mk.AlgorithmNamespaces.XmlDsigExcC14NWithCommentsTransform:t=new wk;break;case mk.AlgorithmNamespaces.XmlDecryptionTransform:default:throw new ie(ne.ALGORITHM_NOT_SUPPORTED,e)}return t}},{key:"CreateSignatureAlgorithm",value:function(t){var r=Tk[t.Algorithm]||null;if(r)return new r;if(t.Algorithm===Xy){var a;if(t.Any.Some((function(t){return t instanceof e.PssAlgorithmParams&&(a=t),!!a})),a)switch(a.DigestMethod.Algorithm){case cy:return new Wy(a.SaltLength);case hy:return new zy(a.SaltLength);case fy:return new Yy(a.SaltLength);case my:return new Qy(a.SaltLength)}throw new ie(ne.CRYPTOGRAPHIC,"Cannot get params for RSA-PSS algoriithm")}throw new Error("signature algorithm '".concat(t.Algorithm,"' is not supported"))}},{key:"CreateHashAlgorithm",value:function(e){var t=Hk[e];if(t)return new t;throw new Error("hash algorithm '"+e+"' is not supported")}},{key:"GetHashAlgorithm",value:function(e){var t="string"==typeof e?{name:e}:e;switch(t.name.toUpperCase()){case sy:return new vy;case uy:return new dy;case oy:return new gy;case ly:return new py;default:throw new ie(ne.ALGORITHM_NOT_SUPPORTED,t.name)}}},{key:"GetSignatureAlgorithm",value:function(e){"string"==typeof e.hash&&(e.hash={name:e.hash});var t,r=e.hash.name;if(!r)throw new Error("Signing algorithm doesn't have name for hash");switch(e.name.toUpperCase()){case Ly.toUpperCase():switch(r.toUpperCase()){case sy:t=new _y;break;case uy:t=new jy;break;case oy:t=new Jy;break;case ly:t=new Fy;break;default:throw new ie(ne.ALGORITHM_NOT_SUPPORTED,"".concat(e.name,":").concat(r))}break;case qy.toUpperCase():var a=e.saltLength;switch(r.toUpperCase()){case sy:t=a?new Wy(a):new ak;break;case uy:t=a?new zy(a):new nk;break;case oy:t=a?new Yy(a):new ik;break;case ly:t=a?new Qy(a):new sk;break;default:throw new ie(ne.ALGORITHM_NOT_SUPPORTED,"".concat(e.name,":").concat(r))}e.saltLength=t.algorithm.saltLength;break;case yy:switch(r.toUpperCase()){case sy:t=new Ay;break;case uy:t=new Ny;break;case oy:t=new Cy;break;case ly:t=new xy;break;default:throw new ie(ne.ALGORITHM_NOT_SUPPORTED,"".concat(e.name,":").concat(r))}break;case Ey:switch(r.toUpperCase()){case sy:t=new Py;break;case uy:t=new Oy;break;case oy:t=new Ry;break;case ly:t=new Uy;break;default:throw new ie(ne.ALGORITHM_NOT_SUPPORTED,"".concat(e.name,":").concat(r))}break;default:throw new ie(ne.ALGORITHM_NOT_SUPPORTED,e.name)}return t}}]),zk=o((function t(r){if(i(this,t),this.signature=new e.Signature,this.replaceCanonicalization=!1,r&&r.nodeType===ue.Document)this.document=r;else if(r&&r.nodeType===ue.Element){var a=(new XMLSerializer).serializeToString(r);this.document=(new DOMParser).parseFromString(a,le)}}),[{key:"XmlSignature",get:function(){return this.signature}},{key:"Signature",get:function(){return this.XmlSignature.SignatureValue}},{key:"Sign",value:(Gk=a(k().mark((function t(r,a,n){var i,s,u,o,l,c,h,f,m,v,d=arguments;return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=d.length>3&&void 0!==d[3]?d[3]:{},be(n)?n=n.cloneNode(!0).documentElement:we(n)&&(n=n.cloneNode(!0)),o=ye({},r),a.algorithm.hash&&(o.hash=a.algorithm.hash),s=Wk.GetSignatureAlgorithm(o),t.next=7,this.ApplySignOptions(this.XmlSignature,r,a,i);case 7:return u=this.XmlSignature.SignedInfo,t.next=10,this.DigestReferences(n);case 10:if(u.SignatureMethod.Algorithm=s.namespaceURI,!(s instanceof Gy)){t.next=18;break}"string"==typeof(l=ye({},a.algorithm,o)).hash&&(l.hash={name:l.hash}),c=new e.PssAlgorithmParams(l),this.XmlSignature.SignedInfo.SignatureMethod.Any.Add(c),t.next=33;break;case 18:if(Ey.toUpperCase()!==r.name.toUpperCase()){t.next=33;break}h=0,f=a.algorithm,t.t0=f.hash.name.toUpperCase(),t.next=t.t0===sy?24:t.t0===uy?26:t.t0===oy?28:t.t0===ly?30:32;break;case 24:return h=f.length||160,t.abrupt("break",32);case 26:return h=f.length||256,t.abrupt("break",32);case 28:return h=f.length||384,t.abrupt("break",32);case 30:return h=f.length||512,t.abrupt("break",32);case 32:this.XmlSignature.SignedInfo.SignatureMethod.HMACOutputLength=h;case 33:return m=this.TransformSignedInfo(n),t.next=36,s.Sign(m,a,o);case 36:return v=t.sent,this.Key=a,this.Algorithm=r,this.XmlSignature.SignatureValue=new Uint8Array(v),we(n)&&(this.document=n.ownerDocument),t.abrupt("return",this.XmlSignature);case 42:case"end":return t.stop()}}),t,this)}))),function(e,t,r){return Gk.apply(this,arguments)})},{key:"reimportKey",value:(Xk=a(k().mark((function e(t,r){var a;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ty.crypto.subtle.exportKey("spki",t);case 2:return a=e.sent,e.abrupt("return",ty.crypto.subtle.importKey("spki",a,r,!0,["verify"]));case 4:case"end":return e.stop()}}),e)}))),function(e,t){return Xk.apply(this,arguments)})},{key:"Verify",value:(qk=a(k().mark((function e(t){var r,a,n,i;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&("algorithm"in t&&"usages"in t&&"type"in t?a=t:(a=t.key,r=t.content)),!a||"public"!==a.type||!this.Algorithm){e.next=5;break}return e.next=4,this.reimportKey(a,this.Algorithm);case 4:a=e.sent;case 5:if(r){e.next=10;break}if((n=this.document)&&n.documentElement){e.next=9;break}throw new ie(ne.NULL_PARAM,"SignedXml","document");case 9:r=n.documentElement;case 10:return(be(r)||we(r))&&(r=r.cloneNode(!0)),e.next=13,this.ValidateReferences(r);case 13:if(!e.sent){e.next=26;break}if(!a){e.next=19;break}e.t0=[a],e.next=22;break;case 19:return e.next=21,this.GetPublicKeys();case 21:e.t0=e.sent;case 22:return i=e.t0,e.abrupt("return",this.ValidateSignatureValue(i));case 26:return e.abrupt("return",!1);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return qk.apply(this,arguments)})},{key:"GetXml",value:function(){return this.signature.GetXml()}},{key:"LoadXml",value:function(t){this.signature=e.Signature.LoadXml(t),this.Algorithm=Wk.CreateSignatureAlgorithm(this.XmlSignature.SignedInfo.SignatureMethod).algorithm}},{key:"toString",value:function(){var e=this.XmlSignature;if(e.SignedInfo.References&&e.SignedInfo.References.Some((function(e){return e.Transforms&&e.Transforms.Some((function(e){return e instanceof yk}))}))){var t=this.document.documentElement.cloneNode(!0),r=this.XmlSignature.GetXml();if(!r)throw new ie(ne.XML_EXCEPTION,"Cannot get Xml element from Signature");var a=r.cloneNode(!0);return t.appendChild(a),(new XMLSerializer).serializeToString(t)}return this.XmlSignature.toString()}},{key:"GetPublicKeys",value:(Fk=a(k().mark((function t(){var r,a,n,i,s,u,o,c,h,f,m,v,d,g;return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=[],a=Wk.CreateSignatureAlgorithm(this.XmlSignature.SignedInfo.SignatureMethod),n=l(this.XmlSignature.KeyInfo.GetIterator()),t.prev=3,n.s();case 5:if((i=n.n()).done){t.next=35;break}if(!((s=i.value)instanceof e.KeyInfoX509Data)){t.next=29;break}u=l(s.Certificates),t.prev=9,u.s();case 11:if((o=u.n()).done){t.next=19;break}return c=o.value,t.next=15,c.exportKey();case 15:h=t.sent,r.push(h);case 17:t.next=11;break;case 19:t.next=24;break;case 21:t.prev=21,t.t0=t.catch(9),u.e(t.t0);case 24:return t.prev=24,u.f(),t.finish(24);case 27:t.next=33;break;case 29:return t.next=31,s.exportKey();case 31:f=t.sent,r.push(f);case 33:t.next=5;break;case 35:t.next=40;break;case 37:t.prev=37,t.t1=t.catch(3),n.e(t.t1);case 40:return t.prev=40,n.f(),t.finish(40);case 43:if(!a.algorithm.name.startsWith("RSA")){t.next=58;break}m=0;case 45:if(!(m<r.length)){t.next=58;break}if(!(v=r[m]).algorithm.name.startsWith("RSA")){t.next=55;break}return t.next=50,ty.crypto.subtle.exportKey("spki",v);case 50:return d=t.sent,t.next=53,ty.crypto.subtle.importKey("spki",d,a.algorithm,!0,["verify"]);case 53:g=t.sent,r[m]=g;case 55:m++,t.next=45;break;case 58:return t.abrupt("return",r);case 59:case"end":return t.stop()}}),t,this,[[3,37,40,43],[9,21,24,27]])}))),function(){return Fk.apply(this,arguments)})},{key:"GetSignatureNamespaces",value:function(){var e={};return this.XmlSignature.NamespaceURI&&(e[this.XmlSignature.Prefix||""]=this.XmlSignature.NamespaceURI),e}},{key:"CopyNamespaces",value:function(e,t,r){this.InjectNamespaces($k(e),t,r)}},{key:"InjectNamespaces",value:function(e,t,r){for(var a in e){var n=e[a];r&&""===a||t.setAttribute("xmlns"+(a?":"+a:""),n)}}},{key:"DigestReference",value:(Jk=a(k().mark((function e(t,r,a){var n,i,s,u,o,l,c,h,f,m,v,d,g,p;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.contentHandler){e.next=5;break}return e.next=3,this.contentHandler(r,this);case 3:(n=e.sent)&&(t=be(n)?n.documentElement:n);case 5:if(!r.Uri){e.next=30;break}if(r.Uri.indexOf("#xpointer")?"#"===r.Uri[0]&&(i=r.Uri.substring(1)):(s=(s=(s=r.Uri).substring(9).replace(/[\r\n\t\s]/g,"")).length<2||"("!==s[0]||")"!==s[s.length-1]?"":s.substring(1,s.length-1)).length>6&&0===s.indexOf("id(")&&")"===s[s.length-1]&&(i=s.substring(4,s.length-2)),!i){e.next=30;break}u=null,o=[this.XmlSignature.KeyInfo.GetXml()],this.XmlSignature.ObjectList.ForEach((function(e){o.push(e.GetXml())})),l=0,c=o;case 12:if(!(l<c.length)){e.next=27;break}if(!(h=c[l])){e.next=24;break}if(!(u=Yk(h,i))){e.next=24;break}return f=u.cloneNode(!0),we(t)&&this.CopyNamespaces(t,f,!1),this.Parent&&(m=this.Parent instanceof Ce?this.Parent.GetXml():this.Parent,this.CopyNamespaces(m,f,!0)),this.CopyNamespaces(u,f,!1),this.InjectNamespaces(this.GetSignatureNamespaces(),f,!0),t=f,e.abrupt("break",27);case 24:l++,e.next=12;break;case 27:if(!u&&t&&we(t)&&(u=Ce.GetElementById(t,i))&&(v=u.cloneNode(!0),this.CopyNamespaces(u,v,!1),this.CopyNamespaces(t,v,!1),t=v),null!=u){e.next=30;break}throw new ie(ne.CRYPTOGRAPHIC,"Cannot get object by reference: ".concat(i));case 30:if(d=null,!r.Transforms||!r.Transforms.Count){e.next=37;break}if(!Ie.isBufferSource(t)){e.next=34;break}throw new Error("Transformation for argument 'source' of type BufferSource is not implemented");case 34:d=this.ApplyTransforms(r.Transforms,t),e.next=51;break;case 37:if(!r.Uri||"#"===r.Uri[0]){e.next=47;break}if(!we(t)){e.next=44;break}if(t.ownerDocument){e.next=41;break}throw new Error("Cannot get ownerDocument from the XML document");case 41:d=(new XMLSerializer).serializeToString(t.ownerDocument),e.next=45;break;case 44:d=Ie.toArrayBuffer(t);case 45:e.next=51;break;case 47:g=new gk,Ie.isBufferSource(t)&&(t=ve(Ue.ToUtf8String(t)).documentElement),g.LoadInnerXml(t),d=g.GetOutput();case 51:if(r.DigestMethod.Algorithm){e.next=53;break}throw new ie(ne.NULL_PARAM,"Reference","DigestMethod");case 53:return p=Wk.CreateHashAlgorithm(r.DigestMethod.Algorithm),e.abrupt("return",p.Digest(d));case 55:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return Jk.apply(this,arguments)})},{key:"DigestReferences",value:(jk=a(k().mark((function e(t){var r,a,n,i;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=l(this.XmlSignature.SignedInfo.References.GetIterator()),e.prev=1,r.s();case 3:if((a=r.n()).done){e.next=14;break}if(!(n=a.value).DigestValue){e.next=7;break}return e.abrupt("continue",12);case 7:return n.DigestMethod.Algorithm||(n.DigestMethod.Algorithm=(new dy).namespaceURI),e.next=10,this.DigestReference(t,n,!1);case 10:i=e.sent,n.DigestValue=i;case 12:e.next=3;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[1,16,19,22]])}))),function(e){return jk.apply(this,arguments)})},{key:"TransformSignedInfo",value:function(e){var t=Wk.CreateFromName(this.XmlSignature.SignedInfo.CanonicalizationMethod.Algorithm),r=this.XmlSignature.SignedInfo.GetXml();if(!r)throw new ie(ne.XML_EXCEPTION,"Cannot get Xml element from SignedInfo");var a=r.cloneNode(!0);if(this.CopyNamespaces(r,a,!1),e&&!Ie.isBufferSource(e)&&(e.nodeType===ue.Document?this.CopyNamespaces(e.documentElement,a,!1):this.CopyNamespaces(e,a,!1)),this.Parent){var n=this.Parent instanceof Ce?this.Parent.GetXml():this.Parent;n&&this.CopyNamespaces(n,a,!1)}var i=pe(r);for(var s in i){var u=i[s];s!==a.prefix&&a.setAttribute("xmlns"+(s?":"+s:""),u)}return t.LoadInnerXml(a),t.GetOutput()}},{key:"ResolveTransform",value:function(e){if("string"==typeof e)switch(e){case"enveloped":return new yk;case"c14n":return new gk;case"c14n-com":return new pk;case"exc-c14n":return new kk;case"exc-c14n-com":return new wk;case"base64":return new dk;default:throw new ie(ne.CRYPTOGRAPHIC_UNKNOWN_TRANSFORM,e)}if("xpath"===e.name){var t=new Sk;t.XPath=e.selector;var r=t.GetXml();if(r&&e.namespaces)for(var a=0,n=Object.entries(e.namespaces);a<n.length;a++){var i=b(n[a],2),s=i[0],u=i[1];r.firstChild.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:".concat(s),u)}return t}throw new ie(ne.CRYPTOGRAPHIC_UNKNOWN_TRANSFORM,e.name)}},{key:"ApplyTransforms",value:function(e,t){var r=this,a=null;if(e.Sort((function(e,t){var r=[gk,pk,kk,wk];return r.some((function(t){return e instanceof t}))?1:r.some((function(e){return t instanceof e}))?-1:0})).ForEach((function(e){r.replaceCanonicalization&&(e instanceof wk?e=new kk:e instanceof pk&&(e=new gk)),e.LoadInnerXml(t),e instanceof Sk?e.GetOutput():a=e.GetOutput()})),1===e.Count&&e.Item(0)instanceof yk){var n=new gk;n.LoadInnerXml(t),a=n.GetOutput()}return a}},{key:"ApplySignOptions",value:(_k=a(k().mark((function t(r,a,n,i){var s,u,o,l,c=this;return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i.id&&(this.XmlSignature.Id=i.id),!i.keyValue||n.algorithm.name.toUpperCase()===Ey){t.next=8;break}return r.KeyInfo||(r.KeyInfo=new e.KeyInfo),s=r.KeyInfo,u=new e.KeyValue,s.Add(u),t.next=8,u.importKey(i.keyValue);case 8:i.x509&&(r.KeyInfo||(r.KeyInfo=new e.KeyInfo),o=r.KeyInfo,i.x509.forEach((function(t){var r=oe.FromBase64(t),a=new e.KeyInfoX509Data(r);o.Add(a)}))),i.references&&i.references.forEach((function(t){var a=new e.Reference;t.id&&(a.Id=t.id),null!==t.uri&&void 0!==t.uri&&(a.Uri=t.uri),t.type&&(a.Type=t.type);var n=Wk.GetHashAlgorithm(t.hash);if(a.DigestMethod.Algorithm=n.namespaceURI,t.transforms&&t.transforms.length){var i=new e.Transforms;t.transforms.forEach((function(e){i.Add(c.ResolveTransform(e))})),a.Transforms=i}r.SignedInfo.References||(r.SignedInfo.References=new e.References),r.SignedInfo.References.Add(a)})),r.SignedInfo.References.Count||(l=new e.Reference,r.SignedInfo.References.Add(l));case 11:case"end":return t.stop()}}),t,this)}))),function(e,t,r,a){return _k.apply(this,arguments)})},{key:"ValidateReferences",value:(Kk=a(k().mark((function e(t){var r,a,n,i,s,u,o;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=l(this.XmlSignature.SignedInfo.References.GetIterator()),e.prev=1,r.s();case 3:if((a=r.n()).done){e.next=15;break}return n=a.value,e.next=7,this.DigestReference(t,n,!1);case 7:if(i=e.sent,s=oe.ToBase64(i),u=oe.ToString(n.DigestValue,"base64"),s===u){e.next=13;break}throw o="Invalid digest for uri '".concat(n.Uri,"'. Calculated digest is ").concat(s," but the xml to validate supplies digest ").concat(u),new ie(ne.CRYPTOGRAPHIC,o);case 13:e.next=3;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(1),r.e(e.t0);case 20:return e.prev=20,r.f(),e.finish(20);case 23:return e.abrupt("return",!0);case 24:case"end":return e.stop()}}),e,this,[[1,17,20,23]])}))),function(e){return Kk.apply(this,arguments)})},{key:"ValidateSignatureValue",value:(Mk=a(k().mark((function e(t){var r,a,n,i,s;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=this.TransformSignedInfo(this.document),r=Wk.CreateSignatureAlgorithm(this.XmlSignature.SignedInfo.SignatureMethod),n=l(t),e.prev=3,n.s();case 5:if((i=n.n()).done){e.next=14;break}return s=i.value,e.next=9,r.Verify(a,s,this.Signature);case 9:if(!e.sent){e.next=12;break}return e.abrupt("return",!0);case 12:e.next=5;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),n.e(e.t0);case 19:return e.prev=19,n.f(),e.finish(19);case 22:return e.abrupt("return",!1);case 23:case"end":return e.stop()}}),e,this,[[3,16,19,22]])}))),function(e){return Mk.apply(this,arguments)})}]);function Yk(e,t){if(e.nodeType!==ue.Element)return null;if(e.hasAttribute("Id")&&e.getAttribute("Id")===t)return e;if(e.childNodes&&e.childNodes.length)for(var r=0;r<e.childNodes.length;r++){var a=Yk(e.childNodes[r],t);if(a)return a}return null}function Qk(e,t,r){t in e||(e[t]=r)}function Zk(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(we(e)){e.namespaceURI&&"http://www.w3.org/XML/1998/namespace"!==e.namespaceURI&&Qk(t,e.prefix?e.prefix:"",e.namespaceURI);for(var r=0;r<e.attributes.length;r++){var a=e.attributes.item(r);a&&"xmlns"===a.prefix&&Qk(t,a.localName?a.localName:"",a.value)}e.parentNode&&Zk(e.parentNode,t)}}function $k(e){var t={};return Zk(e,t),t}return e.Application=ty,e.CryptoConfig=Wk,e.ECDSA=yy,e.ECDSA_SHA1_NAMESPACE=ky,e.ECDSA_SHA256_NAMESPACE=wy,e.ECDSA_SHA384_NAMESPACE=by,e.ECDSA_SHA512_NAMESPACE=Sy,e.EcdsaSha1=Ay,e.EcdsaSha256=Ny,e.EcdsaSha384=Cy,e.EcdsaSha512=xy,e.HMAC=Ey,e.HMAC_SHA1_NAMESPACE=Iy,e.HMAC_SHA256_NAMESPACE=By,e.HMAC_SHA384_NAMESPACE=Vy,e.HMAC_SHA512_NAMESPACE=Dy,e.HmacSha1=Py,e.HmacSha256=Oy,e.HmacSha384=Ry,e.HmacSha512=Uy,e.KeyInfoClause=vk,e.Parse=ve,e.RSA_PKCS1=Ly,e.RSA_PKCS1_SHA1_NAMESPACE=Ty,e.RSA_PKCS1_SHA256_NAMESPACE=Hy,e.RSA_PKCS1_SHA384_NAMESPACE=My,e.RSA_PKCS1_SHA512_NAMESPACE=Ky,e.RSA_PSS=qy,e.RSA_PSS_SHA1_NAMESPACE=Zy,e.RSA_PSS_SHA256_NAMESPACE=$y,e.RSA_PSS_SHA384_NAMESPACE=ek,e.RSA_PSS_SHA512_NAMESPACE=tk,e.RSA_PSS_WITH_PARAMS_NAMESPACE=Xy,e.RsaPkcs1Sha1=_y,e.RsaPkcs1Sha256=jy,e.RsaPkcs1Sha384=Jy,e.RsaPkcs1Sha512=Fy,e.RsaPssBase=Gy,e.RsaPssSha1=Wy,e.RsaPssSha256=zy,e.RsaPssSha384=Yy,e.RsaPssSha512=Qy,e.RsaPssWithoutParamsBase=rk,e.RsaPssWithoutParamsSha1=ak,e.RsaPssWithoutParamsSha256=nk,e.RsaPssWithoutParamsSha384=ik,e.RsaPssWithoutParamsSha512=sk,e.SHA1=sy,e.SHA1_NAMESPACE=cy,e.SHA256=uy,e.SHA256_NAMESPACE=hy,e.SHA384=oy,e.SHA384_NAMESPACE=fy,e.SHA512=ly,e.SHA512_NAMESPACE=my,e.Select=me,e.SelectRootNamespaces=$k,e.Sha1=vy,e.Sha256=dy,e.Sha384=gy,e.Sha512=py,e.SignedXml=zk,e.Stringify=function(e){return(new XMLSerializer).serializeToString(e)},e.X509Certificate=Lk,e.XmlCanonicalizer=uk,e.XmlDsigBase64Transform=dk,e.XmlDsigC14NTransform=gk,e.XmlDsigC14NWithCommentsTransform=pk,e.XmlDsigEnvelopedSignatureTransform=yk,e.XmlDsigExcC14NTransform=kk,e.XmlDsigExcC14NWithCommentsTransform=wk,e.XmlDsigXPathTransform=Sk,e.XmlSignature=mk,e}({});
